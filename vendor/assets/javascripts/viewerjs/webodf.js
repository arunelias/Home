/*

 This is a generated file. DO NOT EDIT.

 Copyright (C) 2010-2014 KO GmbH <copyright@kogmbh.com>

 @licstart
 This file is the compiled version of the WebODF library.

 WebODF is free software: you can redistribute it and/or modify it
 under the terms of the GNU Affero General Public License (GNU AGPL)
 as published by the Free Software Foundation, either version 3 of
 the License, or (at your option) any later version.

 WebODF is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU Affero General Public License for more details.

 You should have received a copy of the GNU Affero General Public License
 along with WebODF.  If not, see <http://www.gnu.org/licenses/>.
 @licend

 @source: http://www.webodf.org/
 @source: https://github.com/kogmbh/WebODF/
*/
var webodf_version="0.5.3";function Runtime(){}Runtime.prototype.getVariable=function(f){};Runtime.prototype.toJson=function(f){};Runtime.prototype.fromJson=function(f){};Runtime.prototype.byteArrayFromString=function(f,k){};Runtime.prototype.byteArrayToString=function(f,k){};Runtime.prototype.read=function(f,k,b,c){};Runtime.prototype.readFile=function(f,k,b){};Runtime.prototype.readFileSync=function(f,k){};Runtime.prototype.loadXML=function(f,k){};Runtime.prototype.writeFile=function(f,k,b){};
Runtime.prototype.deleteFile=function(f,k){};Runtime.prototype.log=function(f,k){};Runtime.prototype.setTimeout=function(f,k){};Runtime.prototype.clearTimeout=function(f){};Runtime.prototype.libraryPaths=function(){};Runtime.prototype.currentDirectory=function(){};Runtime.prototype.setCurrentDirectory=function(f){};Runtime.prototype.type=function(){};Runtime.prototype.getDOMImplementation=function(){};Runtime.prototype.parseXML=function(f){};Runtime.prototype.exit=function(f){};
Runtime.prototype.getWindow=function(){};Runtime.prototype.requestAnimationFrame=function(f){};Runtime.prototype.cancelAnimationFrame=function(f){};Runtime.prototype.assert=function(f,k){};var IS_COMPILED_CODE=!0;
Runtime.byteArrayToString=function(f,k){function b(c){var b="",d,r=c.length;for(d=0;d<r;d+=1)b+=String.fromCharCode(c[d]&255);return b}function c(c){var b="",d,r=c.length,m=[],h,a,e,q;for(d=0;d<r;d+=1)h=c[d],128>h?m.push(h):(d+=1,a=c[d],194<=h&&224>h?m.push((h&31)<<6|a&63):(d+=1,e=c[d],224<=h&&240>h?m.push((h&15)<<12|(a&63)<<6|e&63):(d+=1,q=c[d],240<=h&&245>h&&(h=(h&7)<<18|(a&63)<<12|(e&63)<<6|q&63,h-=65536,m.push((h>>10)+55296,(h&1023)+56320))))),1E3<=m.length&&(b+=String.fromCharCode.apply(null,
m),m.length=0);return b+String.fromCharCode.apply(null,m)}var d;"utf8"===k?d=c(f):("binary"!==k&&this.log("Unsupported encoding: "+k),d=b(f));return d};Runtime.getVariable=function(f){try{return eval(f)}catch(k){}};Runtime.toJson=function(f){return JSON.stringify(f)};Runtime.fromJson=function(f){return JSON.parse(f)};Runtime.getFunctionName=function(f){return void 0===f.name?(f=/function\s+(\w+)/.exec(f))&&f[1]:f.name};
Runtime.assert=function(f,k){if(!f)throw this.log("alert","ASSERTION FAILED:\n"+k),Error(k);};
function BrowserRuntime(f){function k(c){var h=c.length,a,e,q=0;for(a=0;a<h;a+=1)e=c.charCodeAt(a),q+=1+(128<e)+(2048<e),55040<e&&57344>e&&(q+=1,a+=1);return q}function b(c,h,a){var e=c.length,q,g;h=new Uint8Array(new ArrayBuffer(h));a?(h[0]=239,h[1]=187,h[2]=191,g=3):g=0;for(a=0;a<e;a+=1)q=c.charCodeAt(a),128>q?(h[g]=q,g+=1):2048>q?(h[g]=192|q>>>6,h[g+1]=128|q&63,g+=2):55040>=q||57344<=q?(h[g]=224|q>>>12&15,h[g+1]=128|q>>>6&63,h[g+2]=128|q&63,g+=3):(a+=1,q=(q-55296<<10|c.charCodeAt(a)-56320)+65536,
h[g]=240|q>>>18&7,h[g+1]=128|q>>>12&63,h[g+2]=128|q>>>6&63,h[g+3]=128|q&63,g+=4);return h}function c(c){var h=c.length,a=new Uint8Array(new ArrayBuffer(h)),e;for(e=0;e<h;e+=1)a[e]=c.charCodeAt(e)&255;return a}function d(c,h){var a,e,q;void 0!==h?q=c:h=c;f?(e=f.ownerDocument,q&&(a=e.createElement("span"),a.className=q,a.appendChild(e.createTextNode(q)),f.appendChild(a),f.appendChild(e.createTextNode(" "))),a=e.createElement("span"),0<h.length&&"<"===h[0]?a.innerHTML=h:a.appendChild(e.createTextNode(h)),
f.appendChild(a),f.appendChild(e.createElement("br"))):console&&console.log(h);r.enableAlerts&&"alert"===q&&alert(h)}function l(d,h,a){if(0!==a.status||a.responseText)if(200===a.status||0===a.status){if(a.response&&"string"!==typeof a.response)"binary"===h?(a=a.response,a=new Uint8Array(a)):a=String(a.response);else if("binary"===h)if(null!==a.responseBody&&"undefined"!==String(typeof VBArray)){a=(new VBArray(a.responseBody)).toArray();var e=a.length;h=new Uint8Array(new ArrayBuffer(e));for(d=0;d<
e;d+=1)h[d]=a[d];a=h}else{(d=a.getResponseHeader("Content-Length"))&&(d=parseInt(d,10));if(d&&d!==a.responseText.length)a:{e=a.responseText;h=!1;var q=k(e);if("number"===typeof d){if(d!==q&&d!==q+3){e=void 0;break a}h=q+3===d;q=d}e=b(e,q,h)}void 0===e&&(e=c(a.responseText));a=e}else a=a.responseText;a={err:null,data:a}}else a={err:a.responseText||a.statusText,data:null};else a={err:"File "+d+" is empty.",data:null};return a}function n(c,d,a){var e=new XMLHttpRequest;e.open("GET",c,a);e.overrideMimeType&&
("binary"!==d?e.overrideMimeType("text/plain; charset="+d):e.overrideMimeType("text/plain; charset=x-user-defined"));return e}function p(c,d,a){var e=n(c,d,!0);e.onreadystatechange=function(){var g;4===e.readyState&&(g=l(c,d,e),a(g.err,g.data))};try{e.send(null)}catch(q){a(q.message,null)}}var r=this;this.byteArrayFromString=function(d,h){var a;"utf8"===h?a=b(d,k(d),!1):("binary"!==h&&r.log("unknown encoding: "+h),a=c(d));return a};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=
Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=p;this.read=function(c,d,a,e){p(c,"binary",function(q,g){var c=null;if(g){if("string"===typeof g)throw"This should not happen.";c=g.subarray(d,d+a)}e(q,c)})};this.readFileSync=function(c,d){var a=n(c,d,!1),e;try{a.send(null);e=l(c,d,a);if(e.err)throw e.err;if(null===e.data)throw"No data read from "+c+".";}catch(q){throw q;}return e.data};this.writeFile=function(c,d,a){var e=new XMLHttpRequest,q;e.open("PUT",
c,!0);e.onreadystatechange=function(){4===e.readyState&&(0!==e.status||e.responseText?200<=e.status&&300>e.status||0===e.status?a(null):a("Status "+String(e.status)+": "+e.responseText||e.statusText):a("File "+c+" is empty."))};q=d.buffer&&!e.sendAsBinary?d.buffer:r.byteArrayToString(d,"binary");try{e.sendAsBinary?e.sendAsBinary(q):e.send(q)}catch(g){r.log("HUH? "+g+" "+d),a(g.message)}};this.deleteFile=function(c,d){var a=new XMLHttpRequest;a.open("DELETE",c,!0);a.onreadystatechange=function(){4===
a.readyState&&(200>a.status&&300<=a.status?d(a.responseText):d(null))};a.send(null)};this.loadXML=function(c,d){var a=new XMLHttpRequest;a.open("GET",c,!0);a.overrideMimeType&&a.overrideMimeType("text/xml");a.onreadystatechange=function(){4===a.readyState&&(0!==a.status||a.responseText?200===a.status||0===a.status?d(null,a.responseXML):d(a.responseText,null):d("File "+c+" is empty.",null))};try{a.send(null)}catch(e){d(e.message,null)}};this.log=d;this.enableAlerts=!0;this.assert=Runtime.assert;this.setTimeout=
function(c,d){return setTimeout(function(){c()},d)};this.clearTimeout=function(c){clearTimeout(c)};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(){};this.currentDirectory=function(){return""};this.type=function(){return"BrowserRuntime"};this.getDOMImplementation=function(){return window.document.implementation};this.parseXML=function(c){return(new DOMParser).parseFromString(c,"text/xml")};this.exit=function(c){d("Calling exit with code "+String(c)+", but exit() is not implemented.")};
this.getWindow=function(){return window};this.requestAnimationFrame=function(c){var d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,a=0;if(d)d.bind(window),a=d(c);else return setTimeout(c,15);return a};this.cancelAnimationFrame=function(c){var d=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;d?(d.bind(window),d(c)):clearTimeout(c)}}
function NodeJSRuntime(){function f(c){var d=c.length,b,a=new Uint8Array(new ArrayBuffer(d));for(b=0;b<d;b+=1)a[b]=c[b];return a}function k(b,p,h){function a(a,q){if(a)return h(a,null);if(!q)return h("No data for "+b+".",null);if("string"===typeof q)return h(a,q);h(a,f(q))}b=d.resolve(l,b);"binary"!==p?c.readFile(b,p,a):c.readFile(b,null,a)}var b=this,c=require("fs"),d=require("path"),l="",n,p;this.byteArrayFromString=function(c,d){var b=new Buffer(c,d),a,e=b.length,q=new Uint8Array(new ArrayBuffer(e));
for(a=0;a<e;a+=1)q[a]=b[a];return q};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=k;this.loadXML=function(c,d){k(c,"utf-8",function(h,a){if(h)return d(h,null);if(!a)return d("No data for "+c+".",null);d(null,b.parseXML(a))})};this.writeFile=function(b,p,h){p=new Buffer(p);b=d.resolve(l,b);c.writeFile(b,p,"binary",function(a){h(a||null)})};this.deleteFile=function(b,p){b=d.resolve(l,b);
c.unlink(b,p)};this.read=function(b,p,h,a){b=d.resolve(l,b);c.open(b,"r+",666,function(e,q){if(e)a(e,null);else{var g=new Buffer(h);c.read(q,g,0,h,p,function(e){c.close(q);a(e,f(g))})}})};this.readFileSync=function(d,b){var p;p=c.readFileSync(d,"binary"===b?null:b);if(null===p)throw"File "+d+" could not be read.";"binary"===b&&(p=f(p));return p};this.log=function(c,d){var b;void 0!==d?b=c:d=c;"alert"===b&&process.stderr.write("\n!!!!! ALERT !!!!!\n");process.stderr.write(d+"\n");"alert"===b&&process.stderr.write("!!!!! ALERT !!!!!\n")};
this.assert=Runtime.assert;this.setTimeout=function(c,d){return setTimeout(function(){c()},d)};this.clearTimeout=function(c){clearTimeout(c)};this.libraryPaths=function(){return[__dirname]};this.setCurrentDirectory=function(c){l=c};this.currentDirectory=function(){return l};this.type=function(){return"NodeJSRuntime"};this.getDOMImplementation=function(){return p};this.parseXML=function(c){return n.parseFromString(c,"text/xml")};this.exit=process.exit;this.getWindow=function(){return null};this.requestAnimationFrame=
function(c){return setTimeout(c,15)};this.cancelAnimationFrame=function(c){clearTimeout(c)};n=new (require("xmldom").DOMParser);p=b.parseXML("<a/>").implementation}
function RhinoRuntime(){var f=this,k={},b=k.javax.xml.parsers.DocumentBuilderFactory.newInstance(),c,d,l="";b.setValidating(!1);b.setNamespaceAware(!0);b.setExpandEntityReferences(!1);b.setSchema(null);d=k.org.xml.sax.EntityResolver({resolveEntity:function(c,d){var b=new k.java.io.FileReader(d);return new k.org.xml.sax.InputSource(b)}});c=b.newDocumentBuilder();c.setEntityResolver(d);this.byteArrayFromString=function(c,d){var b,l=c.length,h=new Uint8Array(new ArrayBuffer(l));for(b=0;b<l;b+=1)h[b]=
c.charCodeAt(b)&255;return h};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.loadXML=function(d,b){var l=new k.java.io.File(d),m=null;try{m=c.parse(l)}catch(h){return print(h),b(h,null)}b(null,m)};this.readFile=function(c,d,b){l&&(c=l+"/"+c);var m=new k.java.io.File(c),h="binary"===d?"latin1":d;m.isFile()?((c=readFile(c,h))&&"binary"===d&&(c=f.byteArrayFromString(c,"binary")),b(null,c)):b(c+" is not a file.",
null)};this.writeFile=function(c,d,b){l&&(c=l+"/"+c);c=new k.java.io.FileOutputStream(c);var m,h=d.length;for(m=0;m<h;m+=1)c.write(d[m]);c.close();b(null)};this.deleteFile=function(c,d){l&&(c=l+"/"+c);var b=new k.java.io.File(c),m=c+Math.random(),m=new k.java.io.File(m);b.rename(m)?(m.deleteOnExit(),d(null)):d("Could not delete "+c)};this.read=function(c,d,b,m){l&&(c=l+"/"+c);var h;h=c;var a="binary";(new k.java.io.File(h)).isFile()?("binary"===a&&(a="latin1"),h=readFile(h,a)):h=null;h?m(null,this.byteArrayFromString(h.substring(d,
d+b),"binary")):m("Cannot read "+c,null)};this.readFileSync=function(c,d){if(!d)return"";var b=readFile(c,d);if(null===b)throw"File could not be read.";return b};this.log=function(c,d){var b;void 0!==d?b=c:d=c;"alert"===b&&print("\n!!!!! ALERT !!!!!");print(d);"alert"===b&&print("!!!!! ALERT !!!!!")};this.assert=Runtime.assert;this.setTimeout=function(c){c();return 0};this.clearTimeout=function(){};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(c){l=c};this.currentDirectory=
function(){return l};this.type=function(){return"RhinoRuntime"};this.getDOMImplementation=function(){return c.getDOMImplementation()};this.parseXML=function(d){d=new k.java.io.StringReader(d);d=new k.org.xml.sax.InputSource(d);return c.parse(d)};this.exit=quit;this.getWindow=function(){return null};this.requestAnimationFrame=function(c){c();return 0};this.cancelAnimationFrame=function(){}}
Runtime.create=function(){return"undefined"!==String(typeof window)?new BrowserRuntime(window.document.getElementById("logoutput")):"undefined"!==String(typeof require)?new NodeJSRuntime:new RhinoRuntime};var runtime=Runtime.create(),core={},gui={},xmldom={},odf={},ops={},webodf={};(function(){webodf.Version="undefined"!==String(typeof webodf_version)?webodf_version:"From Source"})();
(function(){function f(c,d,b){var h=c+"/manifest.json",a,e;runtime.log("Loading manifest: "+h);try{a=runtime.readFileSync(h,"utf-8")}catch(q){if(b)runtime.log("No loadable manifest found.");else throw console.log(String(q)),q;return}b=JSON.parse(a);for(e in b)b.hasOwnProperty(e)&&(d[e]={dir:c,deps:b[e]})}function k(c,d,b){function h(g){if(!q[g]&&!b(g)){if(e[g])throw"Circular dependency detected for "+g+".";e[g]=!0;if(!d[g])throw"Missing dependency information for class "+g+".";var c=d[g],l=c.deps,
p,f=l.length;for(p=0;p<f;p+=1)h(l[p]);e[g]=!1;q[g]=!0;a.push(c.dir+"/"+g.replace(".","/")+".js")}}var a=[],e={},q={};c.forEach(h);return a}function b(c,d){return d+("\n//# sourceURL="+c)}function c(c){var d,l;for(d=0;d<c.length;d+=1)l=runtime.readFileSync(c[d],"utf-8"),l=b(c[d],l),eval(l)}function d(c){c=c.split(".");var d,b=n,h=c.length;for(d=0;d<h;d+=1){if(!b.hasOwnProperty(c[d]))return!1;b=b[c[d]]}return!0}var l,n={core:core,gui:gui,xmldom:xmldom,odf:odf,ops:ops};runtime.loadClasses=function(b,
n){if(IS_COMPILED_CODE||0===b.length)return n&&n();var m;if(!(m=l)){m=[];var h=runtime.libraryPaths(),a;runtime.currentDirectory()&&-1===h.indexOf(runtime.currentDirectory())&&f(runtime.currentDirectory(),m,!0);for(a=0;a<h.length;a+=1)f(h[a],m)}l=m;b=k(b,l,d);if(0===b.length)return n&&n();if("BrowserRuntime"===runtime.type()&&n){m=b;h=document.currentScript||document.documentElement.lastChild;a=document.createDocumentFragment();var e,q;for(q=0;q<m.length;q+=1)e=document.createElement("script"),e.type=
"text/javascript",e.charset="utf-8",e.async=!1,e.setAttribute("src",m[q]),a.appendChild(e);n&&(e.onload=n);h.parentNode.insertBefore(a,h)}else c(b),n&&n()};runtime.loadClass=function(c,d){runtime.loadClasses([c],d)}})();(function(){var f=function(f){return f};runtime.getTranslator=function(){return f};runtime.setTranslator=function(k){f=k};runtime.tr=function(k){var b=f(k);return b&&"string"===String(typeof b)?b:k}})();
(function(f){function k(b){if(b.length){var c=b[0];runtime.readFile(c,"utf8",function(d,l){function n(){var c;(c=eval(f))&&runtime.exit(c)}var p="",p=c.lastIndexOf("/"),f=l,p=-1!==p?c.substring(0,p):".";runtime.setCurrentDirectory(p);d?(runtime.log(d),runtime.exit(1)):null===f?(runtime.log("No code found for "+c),runtime.exit(1)):n.apply(null,b)})}}f=f?Array.prototype.slice.call(f):[];"NodeJSRuntime"===runtime.type()?k(process.argv.slice(2)):"RhinoRuntime"===runtime.type()?k(f):k(f.slice(1))})("undefined"!==
String(typeof arguments)&&arguments);(function(){core.Async=function(){return{forEach:function(f,k,b){function c(c){n!==l&&(c?(n=l,b(c)):(n+=1,n===l&&b(null)))}var d,l=f.length,n=0;for(d=0;d<l;d+=1)k(f[d],c)},destroyAll:function(f,k){function b(c,d){if(d)k(d);else if(c<f.length)f[c](function(d){b(c+1,d)});else k()}b(0,void 0)}}}()})();function makeBase64(){function f(a){var g,q=a.length,e=new Uint8Array(new ArrayBuffer(q));for(g=0;g<q;g+=1)e[g]=a.charCodeAt(g)&255;return e}function k(g){var a,q="",e,c=g.length-2;for(e=0;e<c;e+=3)a=g[e]<<16|g[e+1]<<8|g[e+2],q+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a>>>18],q+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a>>>12&63],q+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a>>>6&63],q+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a&
63];e===c+1?(a=g[e]<<4,q+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a>>>6],q+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a&63],q+="=="):e===c&&(a=g[e]<<10|g[e+1]<<2,q+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a>>>12],q+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a>>>6&63],q+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a&63],q+="=");return q}function b(a){a=a.replace(/[^A-Za-z0-9+\/]+/g,
"");var q=a.length,e=new Uint8Array(new ArrayBuffer(3*q)),c=a.length%4,d=0,b,A;for(b=0;b<q;b+=4)A=(g[a.charAt(b)]||0)<<18|(g[a.charAt(b+1)]||0)<<12|(g[a.charAt(b+2)]||0)<<6|(g[a.charAt(b+3)]||0),e[d]=A>>16,e[d+1]=A>>8&255,e[d+2]=A&255,d+=3;q=3*q-[0,0,2,1][c];return e.subarray(0,q)}function c(a){var g,q,e=a.length,c=0,d=new Uint8Array(new ArrayBuffer(3*e));for(g=0;g<e;g+=1)q=a[g],128>q?d[c++]=q:(2048>q?d[c++]=192|q>>>6:(d[c++]=224|q>>>12&15,d[c++]=128|q>>>6&63),d[c++]=128|q&63);return d.subarray(0,
c)}function d(a){var g,q,e,c,d=a.length,b=new Uint8Array(new ArrayBuffer(d)),h=0;for(g=0;g<d;g+=1)q=a[g],128>q?b[h++]=q:(g+=1,e=a[g],224>q?b[h++]=(q&31)<<6|e&63:(g+=1,c=a[g],b[h++]=(q&15)<<12|(e&63)<<6|c&63));return b.subarray(0,h)}function l(a){return k(f(a))}function n(a){return String.fromCharCode.apply(String,b(a))}function p(a){return d(f(a))}function r(a){a=d(a);for(var g="",q=0;q<a.length;)g+=String.fromCharCode.apply(String,a.subarray(q,q+45E3)),q+=45E3;return g}function m(a,g,q){var e,c,
d,b="";for(d=g;d<q;d+=1)g=a.charCodeAt(d)&255,128>g?b+=String.fromCharCode(g):(d+=1,e=a.charCodeAt(d)&255,224>g?b+=String.fromCharCode((g&31)<<6|e&63):(d+=1,c=a.charCodeAt(d)&255,b+=String.fromCharCode((g&15)<<12|(e&63)<<6|c&63)));return b}function h(a,g){function q(){var d=c+1E5;d>a.length&&(d=a.length);e+=m(a,c,d);c=d;d=c===a.length;g(e,d)&&!d&&runtime.setTimeout(q,0)}var e="",c=0;1E5>a.length?g(m(a,0,a.length),!0):("string"!==typeof a&&(a=a.slice()),q())}function a(a){return c(f(a))}function e(a){return String.fromCharCode.apply(String,
c(a))}function q(a){return String.fromCharCode.apply(String,c(f(a)))}var g=function(a){var g={},q,e;q=0;for(e=a.length;q<e;q+=1)g[a.charAt(q)]=q;return g}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),y,u,z=runtime.getWindow(),v,s;z&&z.btoa?(v=z.btoa,y=function(a){return v(q(a))}):(v=l,y=function(g){return k(a(g))});z&&z.atob?(s=z.atob,u=function(a){a=s(a);return m(a,0,a.length)}):(s=n,u=function(a){return r(b(a))});core.Base64=function(){this.convertByteArrayToBase64=this.convertUTF8ArrayToBase64=
k;this.convertBase64ToByteArray=this.convertBase64ToUTF8Array=b;this.convertUTF16ArrayToByteArray=this.convertUTF16ArrayToUTF8Array=c;this.convertByteArrayToUTF16Array=this.convertUTF8ArrayToUTF16Array=d;this.convertUTF8StringToBase64=l;this.convertBase64ToUTF8String=n;this.convertUTF8StringToUTF16Array=p;this.convertByteArrayToUTF16String=this.convertUTF8ArrayToUTF16String=r;this.convertUTF8StringToUTF16String=h;this.convertUTF16StringToByteArray=this.convertUTF16StringToUTF8Array=a;this.convertUTF16ArrayToUTF8String=
e;this.convertUTF16StringToUTF8String=q;this.convertUTF16StringToBase64=y;this.convertBase64ToUTF16String=u;this.fromBase64=n;this.toBase64=l;this.atob=s;this.btoa=v;this.utob=q;this.btou=h;this.encode=y;this.encodeURI=function(a){return y(a).replace(/[+\/]/g,function(a){return"+"===a?"-":"_"}).replace(/\\=+$/,"")};this.decode=function(a){return u(a.replace(/[\-_]/g,function(a){return"-"===a?"+":"/"}))};return this};return core.Base64}core.Base64=makeBase64();core.ByteArray=function(f){this.pos=0;this.data=f;this.readUInt32LE=function(){this.pos+=4;var f=this.data,b=this.pos;return f[--b]<<24|f[--b]<<16|f[--b]<<8|f[--b]};this.readUInt16LE=function(){this.pos+=2;var f=this.data,b=this.pos;return f[--b]<<8|f[--b]}};core.ByteArrayWriter=function(f){function k(b){b>d-c&&(d=Math.max(2*d,c+b),b=new Uint8Array(new ArrayBuffer(d)),b.set(l),l=b)}var b=this,c=0,d=1024,l=new Uint8Array(new ArrayBuffer(d));this.appendByteArrayWriter=function(c){b.appendByteArray(c.getByteArray())};this.appendByteArray=function(d){var b=d.length;k(b);l.set(d,c);c+=b};this.appendArray=function(d){var b=d.length;k(b);l.set(d,c);c+=b};this.appendUInt16LE=function(c){b.appendArray([c&255,c>>8&255])};this.appendUInt32LE=function(c){b.appendArray([c&
255,c>>8&255,c>>16&255,c>>24&255])};this.appendString=function(c){b.appendByteArray(runtime.byteArrayFromString(c,f))};this.getLength=function(){return c};this.getByteArray=function(){var d=new Uint8Array(new ArrayBuffer(c));d.set(l.subarray(0,c));return d}};core.CSSUnits=function(){var f=this,k={"in":1,cm:2.54,mm:25.4,pt:72,pc:12,px:96};this.convert=function(b,c,d){return b*k[d]/k[c]};this.convertMeasure=function(b,c){var d,l;b&&c&&(d=parseFloat(b),l=b.replace(d.toString(),""),d=f.convert(d,l,c));return d};this.getUnits=function(b){return b.substr(b.length-2,b.length)}};(function(){function f(){var c,d,l,f,p,k,m,h,a;void 0===b&&(d=(c=runtime.getWindow())&&c.document,k=d.documentElement,m=d.body,b={rangeBCRIgnoresElementBCR:!1,unscaledRangeClientRects:!1,elementBCRIgnoresBodyScroll:!1},d&&(f=d.createElement("div"),f.style.position="absolute",f.style.left="-99999px",f.style.transform="scale(2)",f.style["-webkit-transform"]="scale(2)",p=d.createElement("div"),f.appendChild(p),m.appendChild(f),c=d.createRange(),c.selectNode(p),b.rangeBCRIgnoresElementBCR=0===c.getClientRects().length,
p.appendChild(d.createTextNode("Rect transform test")),d=p.getBoundingClientRect(),l=c.getBoundingClientRect(),b.unscaledRangeClientRects=2<Math.abs(d.height-l.height),f.style.transform="",f.style["-webkit-transform"]="",d=k.style.overflow,l=m.style.overflow,h=m.style.height,a=m.scrollTop,k.style.overflow="visible",m.style.overflow="visible",m.style.height="200%",m.scrollTop=m.scrollHeight,b.elementBCRIgnoresBodyScroll=c.getBoundingClientRect().top!==p.getBoundingClientRect().top,m.scrollTop=a,m.style.height=
h,m.style.overflow=l,k.style.overflow=d,c.detach(),m.removeChild(f),c=Object.keys(b).map(function(a){return a+":"+String(b[a])}).join(", "),runtime.log("Detected browser quirks - "+c)));return b}function k(c,d,b){for(c=c?c.firstElementChild:null;c;){if(c.localName===b&&c.namespaceURI===d)return c;c=c.nextElementSibling}return null}var b;core.DomUtilsImpl=function(){function c(a,g){for(var e=0,c;a.parentNode!==g;)runtime.assert(null!==a.parentNode,"parent is null"),a=a.parentNode;for(c=g.firstChild;c!==
a;)e+=1,c=c.nextSibling;return e}function d(a,g){return 0>=a.compareBoundaryPoints(Range.START_TO_START,g)&&0<=a.compareBoundaryPoints(Range.END_TO_END,g)}function b(a,g){return 0>=a.compareBoundaryPoints(Range.END_TO_START,g)&&0<=a.compareBoundaryPoints(Range.START_TO_END,g)}function n(a,g){var e=null;a.nodeType===Node.TEXT_NODE&&(0===a.length?(a.parentNode.removeChild(a),g.nodeType===Node.TEXT_NODE&&(e=g)):(g.nodeType===Node.TEXT_NODE&&(a.appendData(g.data),g.parentNode.removeChild(g)),e=a));return e}
function p(a){for(var g=a.parentNode;a.firstChild;)g.insertBefore(a.firstChild,a);g.removeChild(a);return g}function r(a,g){for(var e=a.parentNode,c=a.firstChild,d;c;)d=c.nextSibling,r(c,g),c=d;e&&g(a)&&p(a);return e}function m(a,g){return a===g||Boolean(a.compareDocumentPosition(g)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function h(a,g){return f().unscaledRangeClientRects?a:a/g}function a(q,g,e){Object.keys(g).forEach(function(c){var d=c.split(":"),b=d[1],h=e(d[0]),d=g[c],l=typeof d;"object"===l?Object.keys(d).length&&
(c=h?q.getElementsByTagNameNS(h,b)[0]||q.ownerDocument.createElementNS(h,c):q.getElementsByTagName(b)[0]||q.ownerDocument.createElement(c),q.appendChild(c),a(c,d,e)):h&&(runtime.assert("number"===l||"string"===l,"attempting to map unsupported type '"+l+"' (key: "+c+")"),q.setAttributeNS(h,c,String(d)))})}var e=null;this.splitBoundaries=function(a){var g,e=[],d,b,h;if(a.startContainer.nodeType===Node.TEXT_NODE||a.endContainer.nodeType===Node.TEXT_NODE){d=a.endContainer;b=a.endContainer.nodeType!==
Node.TEXT_NODE?a.endOffset===a.endContainer.childNodes.length:!1;h=a.endOffset;g=a.endContainer;if(h<g.childNodes.length)for(g=g.childNodes.item(h),h=0;g.firstChild;)g=g.firstChild;else for(;g.lastChild;)g=g.lastChild,h=g.nodeType===Node.TEXT_NODE?g.textContent.length:g.childNodes.length;g===d&&(d=null);a.setEnd(g,h);h=a.endContainer;0!==a.endOffset&&h.nodeType===Node.TEXT_NODE&&(g=h,a.endOffset!==g.length&&(e.push(g.splitText(a.endOffset)),e.push(g)));h=a.startContainer;0!==a.startOffset&&h.nodeType===
Node.TEXT_NODE&&(g=h,a.startOffset!==g.length&&(h=g.splitText(a.startOffset),e.push(g),e.push(h),a.setStart(h,0)));if(null!==d){for(h=a.endContainer;h.parentNode&&h.parentNode!==d;)h=h.parentNode;b=b?d.childNodes.length:c(h,d);a.setEnd(d,b)}}return e};this.containsRange=d;this.rangesIntersect=b;this.rangeIntersection=function(a,g){var e;b(a,g)&&(e=a.cloneRange(),-1===a.compareBoundaryPoints(Range.START_TO_START,g)&&e.setStart(g.startContainer,g.startOffset),1===a.compareBoundaryPoints(Range.END_TO_END,
g)&&e.setEnd(g.endContainer,g.endOffset));return e};this.getNodesInRange=function(a,g,e){var c=[],d=a.commonAncestorContainer,d=d.nodeType===Node.TEXT_NODE?d.parentNode:d;e=a.startContainer.ownerDocument.createTreeWalker(d,e,g,!1);var b,h;a.endContainer.childNodes[a.endOffset-1]?(b=a.endContainer.childNodes[a.endOffset-1],h=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY):(b=a.endContainer,h=Node.DOCUMENT_POSITION_PRECEDING);a.startContainer.childNodes[a.startOffset]?(a=a.startContainer.childNodes[a.startOffset],
e.currentNode=a):a.startOffset===(a.startContainer.nodeType===Node.TEXT_NODE?a.startContainer.length:a.startContainer.childNodes.length)?(a=a.startContainer,e.currentNode=a,e.lastChild(),a=e.nextNode()):(a=a.startContainer,e.currentNode=a);if(a){a=e.currentNode;if(a!==d)for(a=a.parentNode;a&&a!==d;)g(a)===NodeFilter.FILTER_REJECT&&(e.currentNode=a),a=a.parentNode;a=e.currentNode;switch(g(a)){case NodeFilter.FILTER_REJECT:for(a=e.nextSibling();!a&&e.parentNode();)a=e.nextSibling();break;case NodeFilter.FILTER_SKIP:a=
e.nextNode()}for(;a;){g=b.compareDocumentPosition(a);if(0!==g&&0===(g&h))break;c.push(a);a=e.nextNode()}}return c};this.normalizeTextNodes=function(a){a&&a.nextSibling&&(a=n(a,a.nextSibling));a&&a.previousSibling&&n(a.previousSibling,a)};this.rangeContainsNode=function(a,g){var e=g.ownerDocument.createRange(),c=g.ownerDocument.createRange(),b;e.setStart(a.startContainer,a.startOffset);e.setEnd(a.endContainer,a.endOffset);c.selectNodeContents(g);b=d(e,c);e.detach();c.detach();return b};this.mergeIntoParent=
p;this.removeUnwantedNodes=r;this.getElementsByTagNameNS=function(a,g,e){var c=[];a=a.getElementsByTagNameNS(g,e);c.length=e=a.length;for(g=0;g<e;g+=1)c[g]=a.item(g);return c};this.getElementsByTagName=function(a,g){var e=[],c,d,b;c=a.getElementsByTagName(g);e.length=b=c.length;for(d=0;d<b;d+=1)e[d]=c.item(d);return e};this.containsNode=function(a,g){return a===g||a.contains(g)};this.comparePoints=function(a,g,e,d){if(a===e)return d-g;var b=a.compareDocumentPosition(e);2===b?b=-1:4===b?b=1:10===b?
(g=c(a,e),b=g<d?1:-1):(d=c(e,a),b=d<g?-1:1);return b};this.adaptRangeDifferenceToZoomLevel=h;this.translateRect=function(a,g,e){return{top:h(a.top-g.top,e),left:h(a.left-g.left,e),bottom:h(a.bottom-g.top,e),right:h(a.right-g.left,e),width:h(a.width,e),height:h(a.height,e)}};this.getBoundingClientRect=function(a){var g=a.ownerDocument,c=f(),d=g.body;if((!1===c.unscaledRangeClientRects||c.rangeBCRIgnoresElementBCR)&&a.nodeType===Node.ELEMENT_NODE)return a=a.getBoundingClientRect(),c.elementBCRIgnoresBodyScroll?
{left:a.left+d.scrollLeft,right:a.right+d.scrollLeft,top:a.top+d.scrollTop,bottom:a.bottom+d.scrollTop,width:a.width,height:a.height}:a;var b;e?b=e:e=b=g.createRange();c=b;c.selectNode(a);return c.getBoundingClientRect()};this.mapKeyValObjOntoNode=function(a,g,e){Object.keys(g).forEach(function(c){var d=c.split(":"),b=d[1],d=e(d[0]),h=g[c];d?(b=a.getElementsByTagNameNS(d,b)[0],b||(b=a.ownerDocument.createElementNS(d,c),a.appendChild(b)),b.textContent=h):runtime.log("Key ignored: "+c)})};this.removeKeyElementsFromNode=
function(a,g,e){g.forEach(function(g){var c=g.split(":"),d=c[1];(c=e(c[0]))?(d=a.getElementsByTagNameNS(c,d)[0])?d.parentNode.removeChild(d):runtime.log("Element for "+g+" not found."):runtime.log("Property Name ignored: "+g)})};this.getKeyValRepresentationOfNode=function(a,g){for(var e={},c=a.firstElementChild,d;c;){if(d=g(c.namespaceURI))e[d+":"+c.localName]=c.textContent;c=c.nextElementSibling}return e};this.mapObjOntoNode=a;this.cloneEvent=function(a){var g=Object.create(null);Object.keys(a).forEach(function(e){g[e]=
a[e]});g.prototype=a.constructor.prototype;return g};this.getDirectChild=k;(function(a){var g,e;e=runtime.getWindow();null!==e&&(g=e.navigator.appVersion.toLowerCase(),e=-1===g.indexOf("chrome")&&(-1!==g.indexOf("applewebkit")||-1!==g.indexOf("safari")),g=-1!==g.indexOf("msie")||-1!==g.indexOf("trident"),e||g)&&(a.containsNode=m)})(this)};core.DomUtils=new core.DomUtilsImpl})();core.Cursor=function(f,k){function b(a){a.parentNode&&(p.push(a.previousSibling),p.push(a.nextSibling),a.parentNode.removeChild(a))}function c(a,e,c){if(e.nodeType===Node.TEXT_NODE){runtime.assert(Boolean(e),"putCursorIntoTextNode: invalid container");var g=e.parentNode;runtime.assert(Boolean(g),"putCursorIntoTextNode: container without parent");runtime.assert(0<=c&&c<=e.length,"putCursorIntoTextNode: offset is out of bounds");0===c?g.insertBefore(a,e):(c!==e.length&&e.splitText(c),g.insertBefore(a,
e.nextSibling))}else e.nodeType===Node.ELEMENT_NODE&&e.insertBefore(a,e.childNodes.item(c));p.push(a.previousSibling);p.push(a.nextSibling)}var d=f.createElementNS("urn:webodf:names:cursor","cursor"),l=f.createElementNS("urn:webodf:names:cursor","anchor"),n,p=[],r=f.createRange(),m,h=core.DomUtils;this.getNode=function(){return d};this.getAnchorNode=function(){return l.parentNode?l:d};this.getSelectedRange=function(){m?(r.setStartBefore(d),r.collapse(!0)):(r.setStartAfter(n?l:d),r.setEndBefore(n?
d:l));return r};this.setSelectedRange=function(a,e){r&&r!==a&&r.detach();r=a;n=!1!==e;(m=a.collapsed)?(b(l),b(d),c(d,a.startContainer,a.startOffset)):(b(l),b(d),c(n?d:l,a.endContainer,a.endOffset),c(n?l:d,a.startContainer,a.startOffset));p.forEach(h.normalizeTextNodes);p.length=0};this.hasForwardSelection=function(){return n};this.remove=function(){b(d);p.forEach(h.normalizeTextNodes);p.length=0};d.setAttributeNS("urn:webodf:names:cursor","memberId",k);l.setAttributeNS("urn:webodf:names:cursor","memberId",
k)};core.Destroyable=function(){};core.Destroyable.prototype.destroy=function(f){};core.EventSource=function(){};core.EventSource.prototype.subscribe=function(f,k){};core.EventSource.prototype.unsubscribe=function(f,k){};core.EventNotifier=function(f){function k(c){runtime.assert(!b.hasOwnProperty(c),'Duplicated event ids: "'+c+'" registered more than once.');b[c]=[]}var b={};this.emit=function(c,d){var l,f;runtime.assert(b.hasOwnProperty(c),'unknown event fired "'+c+'"');f=b[c];for(l=0;l<f.length;l+=1)f[l](d)};this.subscribe=function(c,d){runtime.assert(b.hasOwnProperty(c),'tried to subscribe to unknown event "'+c+'"');b[c].push(d)};this.unsubscribe=function(c,d){var l;runtime.assert(b.hasOwnProperty(c),'tried to unsubscribe from unknown event "'+
c+'"');l=b[c].indexOf(d);runtime.assert(-1!==l,'tried to unsubscribe unknown callback from event "'+c+'"');-1!==l&&b[c].splice(l,1)};this.register=k;f&&f.forEach(k)};core.ScheduledTask=function(f,k,b){function c(){n&&(b(l),n=!1)}function d(){c();f.apply(void 0,p);p=null}var l,n=!1,p=[],r=!1;this.trigger=function(){runtime.assert(!1===r,"Can't trigger destroyed ScheduledTask instance");p=Array.prototype.slice.call(arguments);n||(n=!0,l=k(d))};this.triggerImmediate=function(){runtime.assert(!1===r,"Can't trigger destroyed ScheduledTask instance");p=Array.prototype.slice.call(arguments);d()};this.processRequests=function(){n&&d()};this.cancel=c;this.restart=function(){runtime.assert(!1===
r,"Can't trigger destroyed ScheduledTask instance");c();n=!0;l=k(d)};this.destroy=function(d){c();r=!0;d()}};(function(){var f;core.Task={};core.Task.SUPPRESS_MANUAL_PROCESSING=!1;core.Task.processTasks=function(){core.Task.SUPPRESS_MANUAL_PROCESSING||f.performRedraw()};core.Task.createRedrawTask=function(k){return new core.ScheduledTask(k,f.requestRedrawTask,f.cancelRedrawTask)};core.Task.createTimeoutTask=function(f,b){return new core.ScheduledTask(f,function(c){return runtime.setTimeout(c,b)},runtime.clearTimeout)};f=new function(){var f={};this.requestRedrawTask=function(b){var c=runtime.requestAnimationFrame(function(){b();
delete f[c]});f[c]=b;return c};this.performRedraw=function(){Object.keys(f).forEach(function(b){f[b]();runtime.cancelAnimationFrame(parseInt(b,10))});f={}};this.cancelRedrawTask=function(b){runtime.cancelAnimationFrame(b);delete f[b]}}})();core.EventSubscriptions=function(){function f(c,d,l){c.subscribe(d,l);b.push({eventSource:c,eventid:d,callback:l})}function k(){var l=[];b.forEach(function(c){c.eventSource.unsubscribe(c.eventid,c.callback)});b.length=0;Object.keys(d).forEach(function(c){d[c].forEach(function(c){l.push(c.task.destroy)});delete d[c]});core.Async.destroyAll(l,function(){});c=new core.EventNotifier}var b=[],c=new core.EventNotifier,d={},l=0;this.addSubscription=f;this.addFrameSubscription=function(b,p,k){var m,h,a,e;
d.hasOwnProperty(p)||(d[p]=[]);a=d[p];for(e=0;e<a.length;e+=1)if(a[e].eventSource===b){m=a[e];break}m||(h="s"+l,l+=1,c.register(h),m={frameEventId:h,eventSource:b,task:core.Task.createRedrawTask(function(){c.emit(h,void 0)})},a.push(m),f(b,p,m.task.trigger));c.subscribe(m.frameEventId,k)};this.unsubscribeAll=k;this.destroy=function(c){k();c()}};core.LazyProperty=function(f){var k,b=!1;this.value=function(){b||(k=f(),b=!0);return k};this.reset=function(){b=!1}};core.LoopWatchDog=function(f,k){var b=Date.now(),c=0;this.check=function(){var d;if(f&&(d=Date.now(),d-b>f))throw runtime.log("alert","watchdog timeout"),"timeout!";if(0<k&&(c+=1,c>k))throw runtime.log("alert","watchdog loop overflow"),"loop overflow";}};core.NodeFilterChain=function(f){var k=NodeFilter.FILTER_REJECT,b=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(c){var d;for(d=0;d<f.length;d+=1)if(f[d].acceptNode(c)===k)return k;return b}};core.PositionIterator=function(f,k,b,c){function d(){this.acceptNode=function(a){return!a||a.nodeType===q&&0===a.length?u:y}}function l(a){this.acceptNode=function(e){return!e||e.nodeType===q&&0===e.length?u:a.acceptNode(e)}}function n(){var e=h.currentNode,c=e.nodeType;a=c===q?e.length-1:c===g?1:0}function p(){if(null===h.previousSibling()){if(!h.parentNode()||h.currentNode===f)return h.firstChild(),!1;a=0}else n();return!0}function r(){var g=h.currentNode,c;c=e(g);if(g!==f)for(g=g.parentNode;g&&
g!==f;)e(g)===u&&(h.currentNode=g,c=u),g=g.parentNode;c===u?(a=h.currentNode.nodeType===q?g.length:1,g=m.nextPosition()):g=c===y?!0:m.nextPosition();g&&runtime.assert(e(h.currentNode)===y,"moveToAcceptedNode did not result in walker being on an accepted node");return g}var m=this,h,a,e,q=Node.TEXT_NODE,g=Node.ELEMENT_NODE,y=NodeFilter.FILTER_ACCEPT,u=NodeFilter.FILTER_REJECT;this.nextPosition=function(){var e=h.currentNode,c=e.nodeType;if(e===f)return!1;if(0===a&&c===g)null===h.firstChild()&&(a=1);
else if(c===q&&a+1<e.length)a+=1;else if(null!==h.nextSibling())a=0;else if(h.parentNode())a=1;else return!1;return!0};this.previousPosition=function(){var g=!0,e=h.currentNode;0===a?g=p():e.nodeType===q?a-=1:null!==h.lastChild()?n():e===f?g=!1:a=0;return g};this.previousNode=p;this.container=function(){var g=h.currentNode,e=g.nodeType;0===a&&e!==q&&(g=g.parentNode);return g};this.rightNode=function(){var c=h.currentNode,d=c.nodeType;if(d===q&&a===c.length)for(c=c.nextSibling;c&&e(c)!==y;)c=c.nextSibling;
else d===g&&1===a&&(c=null);return c};this.leftNode=function(){var c=h.currentNode;if(0===a)for(c=c.previousSibling;c&&e(c)!==y;)c=c.previousSibling;else if(c.nodeType===g)for(c=c.lastChild;c&&e(c)!==y;)c=c.previousSibling;return c};this.getCurrentNode=function(){return h.currentNode};this.unfilteredDomOffset=function(){if(h.currentNode.nodeType===q)return a;for(var g=0,e=h.currentNode,e=1===a?e.lastChild:e.previousSibling;e;)g+=1,e=e.previousSibling;return g};this.getPreviousSibling=function(){var a=
h.currentNode,g=h.previousSibling();h.currentNode=a;return g};this.getNextSibling=function(){var a=h.currentNode,g=h.nextSibling();h.currentNode=a;return g};this.setPositionBeforeElement=function(g){runtime.assert(Boolean(g),"setPositionBeforeElement called without element");h.currentNode=g;a=0;return r()};this.setUnfilteredPosition=function(g,e){runtime.assert(Boolean(g),"PositionIterator.setUnfilteredPosition called without container");h.currentNode=g;g.nodeType===q?(a=e,runtime.assert(e<=g.length,
"Error in setPosition: "+e+" > "+g.length),runtime.assert(0<=e,"Error in setPosition: "+e+" < 0"),e===g.length&&(h.nextSibling()?a=0:h.parentNode()?a=1:runtime.assert(!1,"Error in setUnfilteredPosition: position not valid."))):e<g.childNodes.length?(h.currentNode=g.childNodes.item(e),a=0):a=1;return r()};this.moveToEnd=function(){h.currentNode=f;a=1};this.moveToEndOfNode=function(g){g.nodeType===q?m.setUnfilteredPosition(g,g.length):(h.currentNode=g,a=1)};this.isBeforeNode=function(){return 0===a};
this.getNodeFilter=function(){return e};e=(b?new l(b):new d).acceptNode;e.acceptNode=e;k=k||NodeFilter.SHOW_ALL;runtime.assert(f.nodeType!==Node.TEXT_NODE,"Internet Explorer doesn't allow tree walker roots to be text nodes");h=f.ownerDocument.createTreeWalker(f,k,e,c);a=0;null===h.firstChild()&&(a=1)};core.PositionFilter=function(){};core.PositionFilter.FilterResult={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3};core.PositionFilter.prototype.acceptPosition=function(f){};core.PositionFilterChain=function(){var f=[],k=core.PositionFilter.FilterResult.FILTER_ACCEPT,b=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(c){var d;for(d=0;d<f.length;d+=1)if(f[d].acceptPosition(c)===b)return b;return k};this.addFilter=function(c){f.push(c)}};(function(){core.RawInflate=function(){var f;(function(k){f=k()})(function(){return function b(c,d,l){function f(p,m){if(!d[p]){if(!c[p])throw Error("Cannot find module '"+p+"'");var h=d[p]={exports:{}};c[p][0].call(h.exports,function(a){var e=c[p][1][a];return f(e?e:a)},h,h.exports,b,c,d,l)}return d[p].exports}for(var p=0;p<l.length;p++)f(l[p]);return f}({1:[function(b,c,d){function l(a,e){var c=new q(e);c.push(a,!0);if(c.err)throw c.msg;return c.result}var f=b("./zlib/inflate.js"),p=b("./utils/common"),
r=b("./utils/strings"),m=b("./zlib/constants"),h=b("./zlib/messages"),a=b("./zlib/zstream"),e=b("./zlib/gzheader"),q=function(g){var c=this.options=p.assign({chunkSize:16384,windowBits:0,to:""},g||{});c.raw&&0<=c.windowBits&&16>c.windowBits&&(c.windowBits=-c.windowBits,0===c.windowBits&&(c.windowBits=-15));!(0<=c.windowBits&&16>c.windowBits)||g&&g.windowBits||(c.windowBits+=32);15<c.windowBits&&48>c.windowBits&&0===(c.windowBits&15)&&(c.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=
[];this.strm=new a;this.strm.avail_out=0;g=f.inflateInit2(this.strm,c.windowBits);if(g!==m.Z_OK)throw Error(h[g]);this.header=new e;f.inflateGetHeader(this.strm,this.header)};q.prototype.push=function(a,e){var c=this.strm,d=this.options.chunkSize,b,q,h,l,B;if(this.ended)return!1;q=e===~~e?e:!0===e?m.Z_FINISH:m.Z_NO_FLUSH;c.input="string"===typeof a?r.binstring2buf(a):a;c.next_in=0;c.avail_in=c.input.length;do{0===c.avail_out&&(c.output=new p.Buf8(d),c.next_out=0,c.avail_out=d);b=f.inflate(c,m.Z_NO_FLUSH);
if(b!==m.Z_STREAM_END&&b!==m.Z_OK)return this.onEnd(b),this.ended=!0,!1;if(c.next_out&&(0===c.avail_out||b===m.Z_STREAM_END||0===c.avail_in&&q===m.Z_FINISH))if("string"===this.options.to)h=r.utf8border(c.output,c.next_out),l=c.next_out-h,B=r.buf2string(c.output,h),c.next_out=l,c.avail_out=d-l,l&&p.arraySet(c.output,c.output,h,l,0),this.onData(B);else this.onData(p.shrinkBuf(c.output,c.next_out))}while((0<c.avail_in||0===c.avail_out)&&b!==m.Z_STREAM_END);b===m.Z_STREAM_END&&(q=m.Z_FINISH);return q===
m.Z_FINISH?(b=f.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===m.Z_OK):!0};q.prototype.onData=function(a){this.chunks.push(a)};q.prototype.onEnd=function(a){a===m.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):p.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};d.Inflate=q;d.inflate=l;d.inflateRaw=function(a,e){e=e||{};e.raw=!0;return l(a,e)};d.ungzip=l},{"./utils/common":2,"./utils/strings":3,"./zlib/constants":5,"./zlib/gzheader":7,"./zlib/inflate.js":9,
"./zlib/messages":11,"./zlib/zstream":12}],2:[function(b,c,d){b="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Int32Array;d.assign=function(c){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var b=d.shift();if(b){if("object"!==typeof b)throw new TypeError(b+"must be non-object");for(var h in b)b.hasOwnProperty(h)&&(c[h]=b[h])}}return c};d.shrinkBuf=function(c,d){if(c.length===d)return c;if(c.subarray)return c.subarray(0,d);c.length=d;return c};
var l={arraySet:function(c,d,b,h,a){if(d.subarray&&c.subarray)c.set(d.subarray(b,b+h),a);else for(var e=0;e<h;e++)c[a+e]=d[b+e]},flattenChunks:function(c){var d,b,h,a,e;d=h=0;for(b=c.length;d<b;d++)h+=c[d].length;e=new Uint8Array(h);d=h=0;for(b=c.length;d<b;d++)a=c[d],e.set(a,h),h+=a.length;return e}},f={arraySet:function(c,d,b,h,a){for(var e=0;e<h;e++)c[a+e]=d[b+e]},flattenChunks:function(c){return[].concat.apply([],c)}};d.setTyped=function(c){c?(d.Buf8=Uint8Array,d.Buf16=Uint16Array,d.Buf32=Int32Array,
d.assign(d,l)):(d.Buf8=Array,d.Buf16=Array,d.Buf32=Array,d.assign(d,f))};d.setTyped(b)},{}],3:[function(b,c,d){function l(a,c){if(65537>c&&(a.subarray&&r||!a.subarray&&p))return String.fromCharCode.apply(null,f.shrinkBuf(a,c));for(var g="",d=0;d<c;d++)g+=String.fromCharCode(a[d]);return g}var f=b("./common"),p=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(m){p=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(h){r=!1}var a=new f.Buf8(256);for(b=0;256>b;b++)a[b]=252<=b?6:248<=
b?5:240<=b?4:224<=b?3:192<=b?2:1;a[254]=a[254]=1;d.string2buf=function(a){var c,g,d,b,h,l=a.length,p=0;for(b=0;b<l;b++)g=a.charCodeAt(b),55296===(g&64512)&&b+1<l&&(d=a.charCodeAt(b+1),56320===(d&64512)&&(g=65536+(g-55296<<10)+(d-56320),b++)),p+=128>g?1:2048>g?2:65536>g?3:4;c=new f.Buf8(p);for(b=h=0;h<p;b++)g=a.charCodeAt(b),55296===(g&64512)&&b+1<l&&(d=a.charCodeAt(b+1),56320===(d&64512)&&(g=65536+(g-55296<<10)+(d-56320),b++)),128>g?c[h++]=g:(2048>g?c[h++]=192|g>>>6:(65536>g?c[h++]=224|g>>>12:(c[h++]=
240|g>>>18,c[h++]=128|g>>>12&63),c[h++]=128|g>>>6&63),c[h++]=128|g&63);return c};d.buf2binstring=function(a){return l(a,a.length)};d.binstring2buf=function(a){for(var c=new f.Buf8(a.length),g=0,d=c.length;g<d;g++)c[g]=a.charCodeAt(g);return c};d.buf2string=function(c,d){var g,b,h,f,p=d||c.length,m=Array(2*p);for(g=b=0;g<p;)if(h=c[g++],128>h)m[b++]=h;else if(f=a[h],4<f)m[b++]=65533,g+=f-1;else{for(h&=2===f?31:3===f?15:7;1<f&&g<p;)h=h<<6|c[g++]&63,f--;1<f?m[b++]=65533:65536>h?m[b++]=h:(h-=65536,m[b++]=
55296|h>>10&1023,m[b++]=56320|h&1023)}return l(m,b)};d.utf8border=function(c,d){var g;d=d||c.length;d>c.length&&(d=c.length);for(g=d-1;0<=g&&128===(c[g]&192);)g--;return 0>g||0===g?d:g+a[c[g]]>d?g:d}},{"./common":2}],4:[function(b,c,d){c.exports=function(c,d,b,f){var m=c&65535|0;c=c>>>16&65535|0;for(var h=0;0!==b;){h=2E3<b?2E3:b;b-=h;do m=m+d[f++]|0,c=c+m|0;while(--h);m%=65521;c%=65521}return m|c<<16|0}},{}],5:[function(b,c,d){c.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,
Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],6:[function(b,c,d){var f=function(){for(var c,d=[],b=0;256>b;b++){c=b;for(var f=0;8>f;f++)c=c&1?3988292384^c>>>1:c>>>1;d[b]=c}return d}();c.exports=function(c,d,b,m){b=m+b;for(c^=
-1;m<b;m++)c=c>>>8^f[(c^d[m])&255];return c^-1}},{}],7:[function(b,c,d){c.exports=function(){this.os=this.xflags=this.time=this.text=0;this.extra=null;this.extra_len=0;this.comment=this.name="";this.hcrc=0;this.done=!1}},{}],8:[function(b,c,d){c.exports=function(c,d){var b,f,m,h,a,e,q,g,y,u,z,v,s,w,x,B,I,F,H,A,J,L,Q,E;b=c.state;f=c.next_in;Q=c.input;m=f+(c.avail_in-5);h=c.next_out;E=c.output;a=h-(d-c.avail_out);e=h+(c.avail_out-257);q=b.dmax;g=b.wsize;y=b.whave;u=b.wnext;z=b.window;v=b.hold;s=b.bits;
w=b.lencode;x=b.distcode;B=(1<<b.lenbits)-1;I=(1<<b.distbits)-1;a:do b:for(15>s&&(v+=Q[f++]<<s,s+=8,v+=Q[f++]<<s,s+=8),F=w[v&B];;){H=F>>>24;v>>>=H;s-=H;H=F>>>16&255;if(0===H)E[h++]=F&65535;else if(H&16){A=F&65535;if(H&=15)s<H&&(v+=Q[f++]<<s,s+=8),A+=v&(1<<H)-1,v>>>=H,s-=H;15>s&&(v+=Q[f++]<<s,s+=8,v+=Q[f++]<<s,s+=8);F=x[v&I];c:for(;;){H=F>>>24;v>>>=H;s-=H;H=F>>>16&255;if(H&16){F&=65535;H&=15;s<H&&(v+=Q[f++]<<s,s+=8,s<H&&(v+=Q[f++]<<s,s+=8));F+=v&(1<<H)-1;if(F>q){c.msg="invalid distance too far back";
b.mode=30;break a}v>>>=H;s-=H;H=h-a;if(F>H){H=F-H;if(H>y&&b.sane){c.msg="invalid distance too far back";b.mode=30;break a}J=0;L=z;if(0===u){if(J+=g-H,H<A){A-=H;do E[h++]=z[J++];while(--H);J=h-F;L=E}}else if(u<H){if(J+=g+u-H,H-=u,H<A){A-=H;do E[h++]=z[J++];while(--H);J=0;if(u<A){H=u;A-=H;do E[h++]=z[J++];while(--H);J=h-F;L=E}}}else if(J+=u-H,H<A){A-=H;do E[h++]=z[J++];while(--H);J=h-F;L=E}for(;2<A;)E[h++]=L[J++],E[h++]=L[J++],E[h++]=L[J++],A-=3;A&&(E[h++]=L[J++],1<A&&(E[h++]=L[J++]))}else{J=h-F;do E[h++]=
E[J++],E[h++]=E[J++],E[h++]=E[J++],A-=3;while(2<A);A&&(E[h++]=E[J++],1<A&&(E[h++]=E[J++]))}}else if(0===(H&64)){F=x[(F&65535)+(v&(1<<H)-1)];continue c}else{c.msg="invalid distance code";b.mode=30;break a}break}}else if(0===(H&64)){F=w[(F&65535)+(v&(1<<H)-1)];continue b}else{H&32?b.mode=12:(c.msg="invalid literal/length code",b.mode=30);break a}break}while(f<m&&h<e);A=s>>3;f-=A;s-=A<<3;c.next_in=f;c.next_out=h;c.avail_in=f<m?5+(m-f):5-(f-m);c.avail_out=h<e?257+(e-h):257-(h-e);b.hold=v&(1<<s)-1;b.bits=
s}},{}],9:[function(b,c,d){function f(a){return(a>>>24&255)+(a>>>8&65280)+((a&65280)<<8)+((a&255)<<24)}function n(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.total=this.check=this.dmax=this.flags=0;this.head=null;this.wnext=this.whave=this.wsize=this.wbits=0;this.window=null;this.extra=this.offset=this.length=this.bits=this.hold=0;this.distcode=this.lencode=null;this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0;this.next=null;this.lens=new a.Buf16(320);this.work=
new a.Buf16(288);this.distdyn=this.lendyn=null;this.was=this.back=this.sane=0}function p(c){var g;if(!c||!c.state)return z;g=c.state;c.total_in=c.total_out=g.total=0;c.msg="";g.wrap&&(c.adler=g.wrap&1);g.mode=v;g.last=0;g.havedict=0;g.dmax=32768;g.head=null;g.hold=0;g.bits=0;g.lencode=g.lendyn=new a.Buf32(s);g.distcode=g.distdyn=new a.Buf32(w);g.sane=1;g.back=-1;return u}function r(a){var c;if(!a||!a.state)return z;c=a.state;c.wsize=0;c.whave=0;c.wnext=0;return p(a)}function m(a,c){var g,e;if(!a||
!a.state)return z;e=a.state;0>c?(g=0,c=-c):(g=(c>>4)+1,48>c&&(c&=15));if(c&&(8>c||15<c))return z;null!==e.window&&e.wbits!==c&&(e.window=null);e.wrap=g;e.wbits=c;return r(a)}function h(a,c){var g;if(!a)return z;g=new n;a.state=g;g.window=null;g=m(a,c);g!==u&&(a.state=null);return g}var a=b("../utils/common"),e=b("./adler32"),q=b("./crc32"),g=b("./inffast"),y=b("./inftrees"),u=0,z=-2,v=1,s=852,w=592,x=!0,B,I;d.inflateReset=r;d.inflateReset2=m;d.inflateResetKeep=p;d.inflateInit=function(a){return h(a,
15)};d.inflateInit2=h;d.inflate=function(c,d){var b,h,L,m,p,n,r,t,s,w,O,G,S,$;G=0;var D,R,aa,ea,C,U=new a.Buf8(4),T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!c||!c.state||!c.output||!c.input&&0!==c.avail_in)return z;b=c.state;12===b.mode&&(b.mode=13);p=c.next_out;L=c.output;r=c.avail_out;m=c.next_in;h=c.input;n=c.avail_in;t=b.hold;s=b.bits;w=n;O=r;C=u;a:for(;;)switch(b.mode){case v:if(0===b.wrap){b.mode=13;break}for(;16>s;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}if(b.wrap&2&&35615===t){b.check=
0;U[0]=t&255;U[1]=t>>>8&255;b.check=q(b.check,U,2,0);s=t=0;b.mode=2;break}b.flags=0;b.head&&(b.head.done=!1);if(!(b.wrap&1)||(((t&255)<<8)+(t>>8))%31){c.msg="incorrect header check";b.mode=30;break}if(8!==(t&15)){c.msg="unknown compression method";b.mode=30;break}t>>>=4;s-=4;S=(t&15)+8;if(0===b.wbits)b.wbits=S;else if(S>b.wbits){c.msg="invalid window size";b.mode=30;break}b.dmax=1<<S;c.adler=b.check=1;b.mode=t&512?10:12;s=t=0;break;case 2:for(;16>s;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}b.flags=
t;if(8!==(b.flags&255)){c.msg="unknown compression method";b.mode=30;break}if(b.flags&57344){c.msg="unknown header flags set";b.mode=30;break}b.head&&(b.head.text=t>>8&1);b.flags&512&&(U[0]=t&255,U[1]=t>>>8&255,b.check=q(b.check,U,2,0));s=t=0;b.mode=3;case 3:for(;32>s;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}b.head&&(b.head.time=t);b.flags&512&&(U[0]=t&255,U[1]=t>>>8&255,U[2]=t>>>16&255,U[3]=t>>>24&255,b.check=q(b.check,U,4,0));s=t=0;b.mode=4;case 4:for(;16>s;){if(0===n)break a;n--;t+=h[m++]<<s;s+=
8}b.head&&(b.head.xflags=t&255,b.head.os=t>>8);b.flags&512&&(U[0]=t&255,U[1]=t>>>8&255,b.check=q(b.check,U,2,0));s=t=0;b.mode=5;case 5:if(b.flags&1024){for(;16>s;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}b.length=t;b.head&&(b.head.extra_len=t);b.flags&512&&(U[0]=t&255,U[1]=t>>>8&255,b.check=q(b.check,U,2,0));s=t=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(b.flags&1024&&(G=b.length,G>n&&(G=n),G&&(b.head&&(S=b.head.extra_len-b.length,b.head.extra||(b.head.extra=Array(b.head.extra_len)),a.arraySet(b.head.extra,
h,m,G,S)),b.flags&512&&(b.check=q(b.check,h,G,m)),n-=G,m+=G,b.length-=G),b.length))break a;b.length=0;b.mode=7;case 7:if(b.flags&2048){if(0===n)break a;G=0;do S=h[m+G++],b.head&&S&&65536>b.length&&(b.head.name+=String.fromCharCode(S));while(S&&G<n);b.flags&512&&(b.check=q(b.check,h,G,m));n-=G;m+=G;if(S)break a}else b.head&&(b.head.name=null);b.length=0;b.mode=8;case 8:if(b.flags&4096){if(0===n)break a;G=0;do S=h[m+G++],b.head&&S&&65536>b.length&&(b.head.comment+=String.fromCharCode(S));while(S&&G<
n);b.flags&512&&(b.check=q(b.check,h,G,m));n-=G;m+=G;if(S)break a}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(b.flags&512){for(;16>s;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}if(t!==(b.check&65535)){c.msg="header crc mismatch";b.mode=30;break}s=t=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0);c.adler=b.check=0;b.mode=12;break;case 10:for(;32>s;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}c.adler=b.check=f(t);s=t=0;b.mode=11;case 11:if(0===b.havedict)return c.next_out=p,c.avail_out=r,c.next_in=
m,c.avail_in=n,b.hold=t,b.bits=s,2;c.adler=b.check=1;b.mode=12;case 12:if(5===d||6===d)break a;case 13:if(b.last){t>>>=s&7;s-=s&7;b.mode=27;break}for(;3>s;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}b.last=t&1;t>>>=1;s-=1;switch(t&3){case 0:b.mode=14;break;case 1:G=b;if(x){S=void 0;B=new a.Buf32(512);I=new a.Buf32(32);for(S=0;144>S;)G.lens[S++]=8;for(;256>S;)G.lens[S++]=9;for(;280>S;)G.lens[S++]=7;for(;288>S;)G.lens[S++]=8;y(1,G.lens,0,288,B,0,G.work,{bits:9});for(S=0;32>S;)G.lens[S++]=5;y(2,G.lens,
0,32,I,0,G.work,{bits:5});x=!1}G.lencode=B;G.lenbits=9;G.distcode=I;G.distbits=5;b.mode=20;if(6===d){t>>>=2;s-=2;break a}break;case 2:b.mode=17;break;case 3:c.msg="invalid block type",b.mode=30}t>>>=2;s-=2;break;case 14:t>>>=s&7;for(s-=s&7;32>s;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}if((t&65535)!==(t>>>16^65535)){c.msg="invalid stored block lengths";b.mode=30;break}b.length=t&65535;s=t=0;b.mode=15;if(6===d)break a;case 15:b.mode=16;case 16:if(G=b.length){G>n&&(G=n);G>r&&(G=r);if(0===G)break a;a.arraySet(L,
h,m,G,p);n-=G;m+=G;r-=G;p+=G;b.length-=G;break}b.mode=12;break;case 17:for(;14>s;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}b.nlen=(t&31)+257;t>>>=5;s-=5;b.ndist=(t&31)+1;t>>>=5;s-=5;b.ncode=(t&15)+4;t>>>=4;s-=4;if(286<b.nlen||30<b.ndist){c.msg="too many length or distance symbols";b.mode=30;break}b.have=0;b.mode=18;case 18:for(;b.have<b.ncode;){for(;3>s;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}b.lens[T[b.have++]]=t&7;t>>>=3;s-=3}for(;19>b.have;)b.lens[T[b.have++]]=0;b.lencode=b.lendyn;b.lenbits=7;
G={bits:b.lenbits};C=y(0,b.lens,0,19,b.lencode,0,b.work,G);b.lenbits=G.bits;if(C){c.msg="invalid code lengths set";b.mode=30;break}b.have=0;b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;;){G=b.lencode[t&(1<<b.lenbits)-1];D=G>>>24;R=G>>>16&255;aa=G&65535;if(D<=s)break;if(0===n)break a;n--;t+=h[m++]<<s;s+=8}if(16>aa)t>>>=D,s-=D,b.lens[b.have++]=aa;else{if(16===aa){for(G=D+2;s<G;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}t>>>=D;s-=D;if(0===b.have){c.msg="invalid bit length repeat";b.mode=30;break}S=
b.lens[b.have-1];G=3+(t&3);t>>>=2;s-=2}else if(17===aa){for(G=D+3;s<G;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}t>>>=D;s-=D;S=0;G=3+(t&7);t>>>=3;s-=3}else{for(G=D+7;s<G;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}t>>>=D;s-=D;S=0;G=11+(t&127);t>>>=7;s-=7}if(b.have+G>b.nlen+b.ndist){c.msg="invalid bit length repeat";b.mode=30;break}for(;G--;)b.lens[b.have++]=S}}if(30===b.mode)break;if(0===b.lens[256]){c.msg="invalid code -- missing end-of-block";b.mode=30;break}b.lenbits=9;G={bits:b.lenbits};C=y(1,b.lens,
0,b.nlen,b.lencode,0,b.work,G);b.lenbits=G.bits;if(C){c.msg="invalid literal/lengths set";b.mode=30;break}b.distbits=6;b.distcode=b.distdyn;G={bits:b.distbits};C=y(2,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,G);b.distbits=G.bits;if(C){c.msg="invalid distances set";b.mode=30;break}b.mode=20;if(6===d)break a;case 20:b.mode=21;case 21:if(6<=n&&258<=r){c.next_out=p;c.avail_out=r;c.next_in=m;c.avail_in=n;b.hold=t;b.bits=s;g(c,O);p=c.next_out;L=c.output;r=c.avail_out;m=c.next_in;h=c.input;n=c.avail_in;
t=b.hold;s=b.bits;12===b.mode&&(b.back=-1);break}for(b.back=0;;){G=b.lencode[t&(1<<b.lenbits)-1];D=G>>>24;R=G>>>16&255;aa=G&65535;if(D<=s)break;if(0===n)break a;n--;t+=h[m++]<<s;s+=8}if(R&&0===(R&240)){S=D;$=R;for(ea=aa;;){G=b.lencode[ea+((t&(1<<S+$)-1)>>S)];D=G>>>24;R=G>>>16&255;aa=G&65535;if(S+D<=s)break;if(0===n)break a;n--;t+=h[m++]<<s;s+=8}t>>>=S;s-=S;b.back+=S}t>>>=D;s-=D;b.back+=D;b.length=aa;if(0===R){b.mode=26;break}if(R&32){b.back=-1;b.mode=12;break}if(R&64){c.msg="invalid literal/length code";
b.mode=30;break}b.extra=R&15;b.mode=22;case 22:if(b.extra){for(G=b.extra;s<G;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}b.length+=t&(1<<b.extra)-1;t>>>=b.extra;s-=b.extra;b.back+=b.extra}b.was=b.length;b.mode=23;case 23:for(;;){G=b.distcode[t&(1<<b.distbits)-1];D=G>>>24;R=G>>>16&255;aa=G&65535;if(D<=s)break;if(0===n)break a;n--;t+=h[m++]<<s;s+=8}if(0===(R&240)){S=D;$=R;for(ea=aa;;){G=b.distcode[ea+((t&(1<<S+$)-1)>>S)];D=G>>>24;R=G>>>16&255;aa=G&65535;if(S+D<=s)break;if(0===n)break a;n--;t+=h[m++]<<
s;s+=8}t>>>=S;s-=S;b.back+=S}t>>>=D;s-=D;b.back+=D;if(R&64){c.msg="invalid distance code";b.mode=30;break}b.offset=aa;b.extra=R&15;b.mode=24;case 24:if(b.extra){for(G=b.extra;s<G;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}b.offset+=t&(1<<b.extra)-1;t>>>=b.extra;s-=b.extra;b.back+=b.extra}if(b.offset>b.dmax){c.msg="invalid distance too far back";b.mode=30;break}b.mode=25;case 25:if(0===r)break a;G=O-r;if(b.offset>G){G=b.offset-G;if(G>b.whave&&b.sane){c.msg="invalid distance too far back";b.mode=30;break}G>
b.wnext?(G-=b.wnext,S=b.wsize-G):S=b.wnext-G;G>b.length&&(G=b.length);$=b.window}else $=L,S=p-b.offset,G=b.length;G>r&&(G=r);r-=G;b.length-=G;do L[p++]=$[S++];while(--G);0===b.length&&(b.mode=21);break;case 26:if(0===r)break a;L[p++]=b.length;r--;b.mode=21;break;case 27:if(b.wrap){for(;32>s;){if(0===n)break a;n--;t|=h[m++]<<s;s+=8}O-=r;c.total_out+=O;b.total+=O;O&&(c.adler=b.check=b.flags?q(b.check,L,O,p-O):e(b.check,L,O,p-O));O=r;if((b.flags?t:f(t))!==b.check){c.msg="incorrect data check";b.mode=
30;break}s=t=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;32>s;){if(0===n)break a;n--;t+=h[m++]<<s;s+=8}if(t!==(b.total&4294967295)){c.msg="incorrect length check";b.mode=30;break}s=t=0}b.mode=29;case 29:C=1;break a;case 30:C=-3;break a;case 31:return-4;default:return z}c.next_out=p;c.avail_out=r;c.next_in=m;c.avail_in=n;b.hold=t;b.bits=s;if(b.wsize||O!==c.avail_out&&30>b.mode&&(27>b.mode||4!==d))h=c.output,m=c.next_out,p=O-c.avail_out,r=c.state,null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=
0,r.window=new a.Buf8(r.wsize)),p>=r.wsize?(a.arraySet(r.window,h,m-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):(n=r.wsize-r.wnext,n>p&&(n=p),a.arraySet(r.window,h,m-p,n,r.wnext),(p-=n)?(a.arraySet(r.window,h,m-p,p,0),r.wnext=p,r.whave=r.wsize):(r.wnext+=n,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=n)));w-=c.avail_in;O-=c.avail_out;c.total_in+=w;c.total_out+=O;b.total+=O;b.wrap&&O&&(c.adler=b.check=b.flags?q(b.check,L,O,c.next_out-O):e(b.check,L,O,c.next_out-O));c.data_type=b.bits+
(b.last?64:0)+(12===b.mode?128:0)+(20===b.mode||15===b.mode?256:0);(0===w&&0===O||4===d)&&C===u&&(C=-5);return C};d.inflateEnd=function(a){if(!a||!a.state)return z;var b=a.state;b.window&&(b.window=null);a.state=null;return u};d.inflateGetHeader=function(a,b){var c;if(!a||!a.state)return z;c=a.state;if(0===(c.wrap&2))return z;c.head=b;b.done=!1;return u};d.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":2,"./adler32":4,"./crc32":6,"./inffast":8,"./inftrees":10}],10:[function(b,
c,d){var f=b("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],p=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],r=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],m=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];c.exports=function(b,a,c,d,g,y,u,z){for(var v=z.bits,s=0,w=
0,x=0,B=0,I=0,F=0,H=0,A=0,J=0,L=0,Q,E,Y=null,V=0,t,W=new f.Buf16(16),F=new f.Buf16(16),Z=null,O=0,G,S,$,s=0;15>=s;s++)W[s]=0;for(w=0;w<d;w++)W[a[c+w]]++;I=v;for(B=15;1<=B&&0===W[B];B--);I>B&&(I=B);if(0===B)return g[y++]=20971520,g[y++]=20971520,z.bits=1,0;for(x=1;x<B&&0===W[x];x++);I<x&&(I=x);for(s=A=1;15>=s;s++)if(A<<=1,A-=W[s],0>A)return-1;if(0<A&&(0===b||1!==B))return-1;F[1]=0;for(s=1;15>s;s++)F[s+1]=F[s]+W[s];for(w=0;w<d;w++)0!==a[c+w]&&(u[F[a[c+w]]++]=w);switch(b){case 0:Y=Z=u;t=19;break;case 1:Y=
n;V-=257;Z=p;O-=257;t=256;break;default:Y=r,Z=m,t=-1}w=L=0;s=x;v=y;F=I;H=0;E=-1;J=1<<I;d=J-1;if(1===b&&852<J||2===b&&592<J)return 1;for(var D=0;;){D++;G=s-H;u[w]<t?(S=0,$=u[w]):u[w]>t?(S=Z[O+u[w]],$=Y[V+u[w]]):(S=96,$=0);A=1<<s-H;x=Q=1<<F;do Q-=A,g[v+(L>>H)+Q]=G<<24|S<<16|$|0;while(0!==Q);for(A=1<<s-1;L&A;)A>>=1;0!==A?(L&=A-1,L+=A):L=0;w++;if(0===--W[s]){if(s===B)break;s=a[c+u[w]]}if(s>I&&(L&d)!==E){0===H&&(H=I);v+=x;F=s-H;for(A=1<<F;F+H<B;){A-=W[F+H];if(0>=A)break;F++;A<<=1}J+=1<<F;if(1===b&&852<
J||2===b&&592<J)return 1;E=L&d;g[E]=I<<24|F<<16|v-y|0}}0!==L&&(g[v+L]=s-H<<24|4194304);z.bits=I;return 0}},{"../utils/common":2}],11:[function(b,c,d){c.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],12:[function(b,c,d){c.exports=function(){this.input=null;this.total_in=this.avail_in=this.next_in=0;this.output=null;this.total_out=this.avail_out=this.next_out=0;
this.msg="";this.state=null;this.data_type=2;this.adler=0}},{}]},{},[1])(1)});return{inflate:function(k,b){return f.inflateRaw(k)}}}()})();core.StepDirection={PREVIOUS:1,NEXT:2};core.StepIterator=function(f,k){function b(){a=null;q=e=void 0}function c(){void 0===q&&(q=f.acceptPosition(k)===m);return q}function d(a,c){b();return k.setUnfilteredPosition(a,c)}function l(){a||(a=k.container());return a}function n(){void 0===e&&(e=k.unfilteredDomOffset());return e}function p(){for(b();k.nextPosition();)if(b(),c())return!0;return!1}function r(){for(b();k.previousPosition();)if(b(),c())return!0;return!1}var m=core.PositionFilter.FilterResult.FILTER_ACCEPT,h=core.StepDirection.NEXT,
a,e,q;this.isStep=c;this.setPosition=d;this.container=l;this.offset=n;this.nextStep=p;this.previousStep=r;this.advanceStep=function(a){return a===h?p():r()};this.roundToClosestStep=function(){var a,b,e=c();e||(a=l(),b=n(),e=r(),e||(d(a,b),e=p()));return e};this.roundToPreviousStep=function(){var a=c();a||(a=r());return a};this.roundToNextStep=function(){var a=c();a||(a=p());return a};this.leftNode=function(){return k.leftNode()};this.snapshot=function(){return new core.StepIterator.StepSnapshot(l(),
n())};this.restore=function(a){d(a.container,a.offset)}};core.StepIterator.StepSnapshot=function(f,k){this.container=f;this.offset=k};core.UnitTest=function(){};core.UnitTest.prototype.setUp=function(){};core.UnitTest.prototype.tearDown=function(){};core.UnitTest.prototype.description=function(){};core.UnitTest.prototype.tests=function(){};core.UnitTest.prototype.asyncTests=function(){};
core.UnitTest.provideTestAreaDiv=function(){var f=runtime.getWindow().document,k=f.getElementById("testarea");runtime.assert(!k,'Unclean test environment, found a div with id "testarea".');k=f.createElement("div");k.setAttribute("id","testarea");f.body.appendChild(k);return k};
core.UnitTest.cleanupTestAreaDiv=function(){var f=runtime.getWindow().document,k=f.getElementById("testarea");runtime.assert(!!k&&k.parentNode===f.body,'Test environment broken, found no div with id "testarea" below body.');f.body.removeChild(k)};core.UnitTest.createXmlDocument=function(f,k,b){var c="<?xml version='1.0' encoding='UTF-8'?>",c=c+("<"+f);Object.keys(b).forEach(function(d){c+=" xmlns:"+d+'="'+b[d]+'"'});c+=">";c+=k;c+="</"+f+">";return runtime.parseXML(c)};
core.UnitTest.createOdtDocument=function(f,k){return core.UnitTest.createXmlDocument("office:document",f,k)};
core.UnitTestLogger=function(){var f=[],k=0,b=0,c="",d="";this.startTest=function(l,n){f=[];k=0;c=l;d=n;b=Date.now()};this.endTest=function(){var l=Date.now();return{description:d,suite:[c,d],success:0===k,log:f,time:l-b}};this.debug=function(b){f.push({category:"debug",message:b})};this.fail=function(b){k+=1;f.push({category:"fail",message:b})};this.pass=function(b){f.push({category:"pass",message:b})}};
core.UnitTestRunner=function(f,k){function b(a){m+=1;e?k.debug(a):k.fail(a)}function c(a,c){var e;try{if(a.length!==c.length)return b("array of length "+a.length+" should be "+c.length+" long"),!1;for(e=0;e<a.length;e+=1)if(a[e]!==c[e])return b(a[e]+" should be "+c[e]+" at array index "+e),!1}catch(d){return!1}return!0}function d(a,c,e){var h=a.attributes,f=h.length,l,m,n;for(l=0;l<f;l+=1)if(m=h.item(l),"xmlns"!==m.prefix&&"urn:webodf:names:steps"!==m.namespaceURI){n=c.getAttributeNS(m.namespaceURI,
m.localName);if(!c.hasAttributeNS(m.namespaceURI,m.localName))return b("Attribute "+m.localName+" with value "+m.value+" was not present"),!1;if(n!==m.value)return b("Attribute "+m.localName+" was "+n+" should be "+m.value),!1}return e?!0:d(c,a,!0)}function l(a,c){var e,h;e=a.nodeType;h=c.nodeType;if(e!==h)return b("Nodetype '"+e+"' should be '"+h+"'"),!1;if(e===Node.TEXT_NODE){if(a.data===c.data)return!0;b("Textnode data '"+a.data+"' should be '"+c.data+"'");return!1}runtime.assert(e===Node.ELEMENT_NODE,
"Only textnodes and elements supported.");if(a.namespaceURI!==c.namespaceURI)return b("namespace '"+a.namespaceURI+"' should be '"+c.namespaceURI+"'"),!1;if(a.localName!==c.localName)return b("localName '"+a.localName+"' should be '"+c.localName+"'"),!1;if(!d(a,c,!1))return!1;e=a.firstChild;for(h=c.firstChild;e;){if(!h)return b("Nodetype '"+e.nodeType+"' is unexpected here."),!1;if(!l(e,h))return!1;e=e.nextSibling;h=h.nextSibling}return h?(b("Nodetype '"+h.nodeType+"' is missing here."),!1):!0}function n(b,
e,d){if(0===e)return b===e&&1/b===1/e;if(b===e)return!0;if(null===b||null===e)return!1;if("number"===typeof e&&isNaN(e))return"number"===typeof b&&isNaN(b);if("number"===typeof e&&"number"===typeof b){if(b===e)return!0;void 0===d&&(d=1E-4);runtime.assert("number"===typeof d,"Absolute tolerance not given as number.");runtime.assert(0<=d,"Absolute tolerance should be given as positive number, was "+d);b=Math.abs(b-e);return b<=d}return Object.prototype.toString.call(e)===Object.prototype.toString.call([])?
c(b,e):"object"===typeof e&&"object"===typeof b?e.constructor===Element||e.constructor===Node?l(b,e):a(b,e):!1}function p(a){if(0===a&&0>1/a)return"-0";if("object"===typeof a)try{return JSON.stringify(a)}catch(b){}return String(a)}function r(a,c,e,d){"string"===typeof c&&"string"===typeof e||k.debug("WARN: shouldBe() expects string arguments");var h,f;try{f=eval(c)}catch(m){h=m}a=eval(e);h?b(c+" should be "+a+". Threw exception "+h):n(f,a,d)?k.pass(c+" is "+e):String(typeof f)===String(typeof a)?
b(c+" should be "+p(a)+". Was "+p(f)+"."):b(c+" should be "+a+" (of type "+typeof a+"). Was "+f+" (of type "+typeof f+").")}var m=0,h,a,e=!1;this.resourcePrefix=function(){return f};this.beginExpectFail=function(){h=m;e=!0};this.endExpectFail=function(){var a=h===m;e=!1;m=h;a&&(m+=1,k.fail("Expected at least one failed test, but none registered."))};a=function(a,e){var d=Object.keys(a),h=Object.keys(e);d.sort();h.sort();return c(d,h)&&Object.keys(a).every(function(c){var d=a[c],h=e[c];return n(d,
h)?!0:(b(d+" should be "+h+" for key "+c),!1)})};this.areNodesEqual=l;this.shouldBeNull=function(a,b){r(a,b,"null")};this.shouldBeNonNull=function(a,c){var e,d;try{d=eval(c)}catch(h){e=h}e?b(c+" should be non-null. Threw exception "+e):null!==d?k.pass(c+" is non-null."):b(c+" should be non-null. Was "+d)};this.shouldBe=r;this.testFailed=b;this.countFailedTests=function(){return m};this.name=function(a){var b,c,e=[],d=a.length;e.length=d;for(b=0;b<d;b+=1){c=Runtime.getFunctionName(a[b])||"";if(""===
c)throw"Found a function without a name.";e[b]={f:a[b],name:c}}return e}};
core.UnitTester=function(){function f(b,c){return"<span style='color:blue;cursor:pointer' onclick='"+c+"'>"+b+"</span>"}function k(c){b.reporter&&b.reporter(c)}var b=this,c=0,d=new core.UnitTestLogger,l={},n="BrowserRuntime"===runtime.type();this.resourcePrefix="";this.reporter=function(b){var c,d;n?runtime.log("<span>Running "+f(b.description,'runTest("'+b.suite[0]+'","'+b.description+'")')+"</span>"):runtime.log("Running "+b.description);if(!b.success)for(c=0;c<b.log.length;c+=1)d=b.log[c],runtime.log(d.category,
d.message)};this.runTests=function(p,r,m){function h(b){function f(){p&&e.endExpectFail();k(d.endTest());q.tearDown();g[n]=s===e.countFailedTests();h(b.slice(1))}var n,p;if(0===b.length)l[a]=g,c+=e.countFailedTests(),r();else if(u=b[0].f,n=b[0].name,p=!0===b[0].expectFail,s=e.countFailedTests(),m.length&&-1===m.indexOf(n))h(b.slice(1));else{q.setUp();d.startTest(a,n);p&&e.beginExpectFail();try{u(f)}catch(y){e.testFailed("Unexpected exception encountered: "+y.toString()+"\n"+y.stack),f()}}}var a=Runtime.getFunctionName(p)||
"",e=new core.UnitTestRunner(b.resourcePrefix,d),q=new p(e),g={},y,u,z,v,s;if(l.hasOwnProperty(a))runtime.log("Test "+a+" has already run.");else{n?runtime.log("<span>Running "+f(a,'runSuite("'+a+'");')+": "+q.description()+"</span>"):runtime.log("Running "+a+": "+q.description);z=q.tests();for(y=0;y<z.length;y+=1)if(u=z[y].f,p=z[y].name,v=!0===z[y].expectFail,!m.length||-1!==m.indexOf(p)){s=e.countFailedTests();q.setUp();d.startTest(a,p);v&&e.beginExpectFail();try{u()}catch(w){e.testFailed("Unexpected exception encountered: "+
w.toString()+"\n"+w.stack)}v&&e.endExpectFail();k(d.endTest());q.tearDown();g[p]=s===e.countFailedTests()}h(q.asyncTests())}};this.failedTestsCount=function(){return c};this.results=function(){return l}};core.Utils=function(){function f(k,b){if(b&&Array.isArray(b)){k=k||[];if(!Array.isArray(k))throw"Destination is not an array.";k=k.concat(b.map(function(b){return f(null,b)}))}else if(b&&"object"===typeof b){k=k||{};if("object"!==typeof k)throw"Destination is not an object.";Object.keys(b).forEach(function(c){k[c]=f(k[c],b[c])})}else k=b;return k}this.hashString=function(f){var b=0,c,d;c=0;for(d=f.length;c<d;c+=1)b=(b<<5)-b+f.charCodeAt(c),b|=0;return b};this.mergeObjects=function(k,b){Object.keys(b).forEach(function(c){k[c]=
f(k[c],b[c])});return k}};core.Zip=function(f,k){function b(a,b,c){y?c(null,y.subarray(a,a+b)):c("File data not loaded",null)}function c(a){var b=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,
1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,
1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,
1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,
628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,
3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],c,e,g=a.length,d=0,d=0;c=-1;for(e=0;e<g;e+=1)d=(c^a[e])&255,d=b[d],c=c>>>8^d;return c^-1}function d(a){return new Date((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&15,
a>>5&63,(a&31)<<1)}function l(a){var b=a.getFullYear();return 1980>b?0:b-1980<<25|a.getMonth()+1<<21|a.getDate()<<16|a.getHours()<<11|a.getMinutes()<<5|a.getSeconds()>>1}function n(a,c){var e,g,h,q,f,m,l,n=this;this.load=function(c){if(null!==n.data)c(null,n.data);else{var e=f+34+g+h+256;e+l>u&&(e=u-l);b(l,e,function(b,e){if(b||null===e)c(b,e);else a:{var g=e,d=new core.ByteArray(g),h=d.readUInt32LE(),l;if(67324752!==h)c("File entry signature is wrong."+h.toString()+" "+g.length.toString(),null);
else{d.pos+=22;h=d.readUInt16LE();l=d.readUInt16LE();d.pos+=h+l;if(q){g=g.subarray(d.pos,d.pos+f);if(f!==g.length){c("The amount of compressed bytes read was "+g.length.toString()+" instead of "+f.toString()+" for "+n.filename+" in "+a+".",null);break a}g=v(g,m)}else g=g.subarray(d.pos,d.pos+m);m!==g.length?c("The amount of bytes read was "+g.length.toString()+" instead of "+m.toString()+" for "+n.filename+" in "+a+".",null):(n.data=g,c(null,g))}}})}};this.set=function(a,c,b,e){n.filename=a;n.data=
c;n.compressed=b;n.date=e};this.error=null;c&&(e=c.readUInt32LE(),33639248!==e?this.error="Central directory entry has wrong signature at position "+(c.pos-4).toString()+' for file "'+a+'": '+c.data.length.toString():(c.pos+=6,q=c.readUInt16LE(),this.date=d(c.readUInt32LE()),c.readUInt32LE(),f=c.readUInt32LE(),m=c.readUInt32LE(),g=c.readUInt16LE(),h=c.readUInt16LE(),e=c.readUInt16LE(),c.pos+=8,l=c.readUInt32LE(),this.filename=runtime.byteArrayToString(c.data.subarray(c.pos,c.pos+g),"utf8"),this.data=
null,c.pos+=g+h+e))}function p(a,c){if(22!==a.length)c("Central directory length should be 22.",s);else{var e=new core.ByteArray(a),d;d=e.readUInt32LE();101010256!==d?c("Central directory signature is wrong: "+d.toString(),s):(d=e.readUInt16LE(),0!==d?c("Zip files with non-zero disk numbers are not supported.",s):(d=e.readUInt16LE(),0!==d?c("Zip files with non-zero disk numbers are not supported.",s):(d=e.readUInt16LE(),z=e.readUInt16LE(),d!==z?c("Number of entries is inconsistent.",s):(d=e.readUInt32LE(),
e=e.readUInt16LE(),e=u-22-d,b(e,u-e,function(a,b){if(a||null===b)c(a,s);else a:{var e=new core.ByteArray(b),d,h;g=[];for(d=0;d<z;d+=1){h=new n(f,e);if(h.error){c(h.error,s);break a}g[g.length]=h}c(null,s)}})))))}}function r(a,c){var b=null,e,d;for(d=0;d<g.length;d+=1)if(e=g[d],e.filename===a){b=e;break}b?b.data?c(null,b.data):b.load(c):c(a+" not found.",null)}function m(a){var b=new core.ByteArrayWriter("utf8"),e=0;b.appendArray([80,75,3,4,20,0,0,0,0,0]);a.data&&(e=a.data.length);b.appendUInt32LE(l(a.date));
b.appendUInt32LE(a.data?c(a.data):0);b.appendUInt32LE(e);b.appendUInt32LE(e);b.appendUInt16LE(a.filename.length);b.appendUInt16LE(0);b.appendString(a.filename);a.data&&b.appendByteArray(a.data);return b}function h(a,b){var e=new core.ByteArrayWriter("utf8"),d=0;e.appendArray([80,75,1,2,20,0,20,0,0,0,0,0]);a.data&&(d=a.data.length);e.appendUInt32LE(l(a.date));e.appendUInt32LE(a.data?c(a.data):0);e.appendUInt32LE(d);e.appendUInt32LE(d);e.appendUInt16LE(a.filename.length);e.appendArray([0,0,0,0,0,0,
0,0,0,0,0,0]);e.appendUInt32LE(b);e.appendString(a.filename);return e}function a(b,c){if(b===g.length)c(null);else{var e=g[b];null!==e.data?a(b+1,c):e.load(function(e){e?c(e):a(b+1,c)})}}function e(b,c){a(0,function(a){if(a)c(a);else{var e,d,q=new core.ByteArrayWriter("utf8"),f=[0];for(e=0;e<g.length;e+=1)q.appendByteArrayWriter(m(g[e])),f.push(q.getLength());a=q.getLength();for(e=0;e<g.length;e+=1)d=g[e],q.appendByteArrayWriter(h(d,f[e]));e=q.getLength()-a;q.appendArray([80,75,5,6,0,0,0,0]);q.appendUInt16LE(g.length);
q.appendUInt16LE(g.length);q.appendUInt32LE(e);q.appendUInt32LE(a);q.appendArray([0,0]);b(q.getByteArray())}})}function q(a,b){e(function(c){runtime.writeFile(a,c,function(a){a||(y=c,u=y.length);b(a)})},b)}var g,y,u,z,v=core.RawInflate.inflate,s=this,w=new core.Base64;this.load=r;this.save=function(a,b,c,e){var d,h;for(d=0;d<g.length;d+=1)if(h=g[d],h.filename===a){h.set(a,b,c,e);return}h=new n(f);h.set(a,b,c,e);g.push(h)};this.remove=function(a){var b,c;for(b=0;b<g.length;b+=1)if(c=g[b],c.filename===
a)return g.splice(b,1),!0;return!1};this.write=function(a){q(f,a)};this.writeAs=q;this.createByteArray=e;this.loadContentXmlAsFragments=function(a,b){s.loadAsString(a,function(a,c){if(a)return b.rootElementReady(a);b.rootElementReady(null,c,!0)})};this.loadAsString=function(a,b){r(a,function(a,c){if(a||null===c)return b(a,null);var e=runtime.byteArrayToString(c,"utf8");b(null,e)})};this.loadAsDOM=function(a,b){s.loadAsString(a,function(a,c){if(a||null===c)b(a,null);else{var e=(new DOMParser).parseFromString(c,
"text/xml");b(null,e)}})};this.loadAsDataURL=function(a,b,c){r(a,function(a,e){if(a||!e)return c(a,null);var d=0,g;b||(b=80===e[1]&&78===e[2]&&71===e[3]?"image/png":255===e[0]&&216===e[1]&&255===e[2]?"image/jpeg":71===e[0]&&73===e[1]&&70===e[2]?"image/gif":"");for(g="data:"+b+";base64,";d<e.length;)g+=w.convertUTF8ArrayToBase64(e.subarray(d,Math.min(d+45E3,e.length))),d+=45E3;c(null,g)})};this.getEntries=function(){return g.slice()};u=-1;null===k?g=[]:runtime.readFile(f,"binary",function(a,c){"string"===
typeof c&&(a="file was read as a string. Should be Uint8Array.");a||!c||0===c.length?k("File '"+f+"' cannot be read. Err: "+(a||"[none]"),s):(y=c,u=y.length,b(u-22,22,function(a,b){a||null===b?k(a,s):p(b,k)}))})};core.SimpleClientRect=null;gui.CommonConstraints={EDIT:{ANNOTATIONS:{ONLY_DELETE_OWN:"onlyDeleteOwn"},REVIEW_MODE:"reviewMode"}};gui.SessionConstraints=function(){function f(c){k.hasOwnProperty(c)||(k[c]=!1,b.register(c))}var k={},b=new core.EventNotifier;this.registerConstraint=f;this.subscribe=function(c,d){f(c);b.subscribe(c,d)};this.unsubscribe=function(c,d){b.unsubscribe(c,d)};this.setState=function(c,d){runtime.assert(!0===k.hasOwnProperty(c),"No such constraint");k[c]!==d&&(k[c]=d,b.emit(c,d))};this.getState=function(b){runtime.assert(!0===k.hasOwnProperty(b),"No such constraint");return k[b]}};gui.BlacklistNamespaceNodeFilter=function(f){var k={},b=NodeFilter.FILTER_REJECT,c=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(d){return!d||k.hasOwnProperty(d.namespaceURI)?b:c};(function(){f.forEach(function(b){k[b]=!0})})()};odf.Namespaces={namespaceMap:{config:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",db:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dc:"http://purl.org/dc/elements/1.1/",dr3d:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chart:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fo:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",form:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",math:"http://www.w3.org/1998/Math/MathML",
meta:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",number:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",style:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svg:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",table:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xforms:"http://www.w3.org/2002/xforms",
xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},prefixMap:{},configns:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",dbns:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dcns:"http://purl.org/dc/elements/1.1/",dr3dns:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",drawns:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chartns:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fons:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",formns:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",
mathns:"http://www.w3.org/1998/Math/MathML",metans:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",numberns:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",officens:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentationns:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",stylens:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svgns:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",tablens:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",textns:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",
xformsns:"http://www.w3.org/2002/xforms",xlinkns:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/XML/1998/namespace"};(function(){var f=odf.Namespaces.namespaceMap,k=odf.Namespaces.prefixMap,b;for(b in f)f.hasOwnProperty(b)&&(k[f[b]]=b)})();odf.Namespaces.forEachPrefix=function(f){var k=odf.Namespaces.namespaceMap,b;for(b in k)k.hasOwnProperty(b)&&f(b,k[b])};
odf.Namespaces.lookupNamespaceURI=function(f){var k=null;odf.Namespaces.namespaceMap.hasOwnProperty(f)&&(k=odf.Namespaces.namespaceMap[f]);return k};odf.Namespaces.lookupPrefix=function(f){var k=odf.Namespaces.prefixMap;return k.hasOwnProperty(f)?k[f]:null};odf.Namespaces.lookupNamespaceURI.lookupNamespaceURI=odf.Namespaces.lookupNamespaceURI;(function(){odf.OdfSchemaImpl=function(){var f=[["config:config-item","uncategorized"],["form:item","object"],["form:option","uncategorized"],["math:math","field"],["meta:user-defined","uncategorized"],["number:currency-symbol","uncategorized"],["number:embedded-text","uncategorized"],["number:text","uncategorized"],["presentation:date-time-decl","uncategorized"],["presentation:footer-decl","uncategorized"],["presentation:header-decl","uncategorized"],["svg:desc","text"],["svg:title","text"],["table:desc",
"uncategorized"],["table:title","uncategorized"],["text:a","text"],["text:author-initials","field"],["text:author-name","field"],["text:bibliography-mark","field"],["text:bookmark-ref","field"],["text:chapter","field"],["text:character-count","field"],["text:conditional-text","field"],["text:creation-date","field"],["text:creation-time","field"],["text:creator","field"],["text:database-display","field"],["text:database-name","field"],["text:database-row-number","field"],["text:date","field"],["text:dde-connection",
"field"],["text:description","field"],["text:editing-cycles","field"],["text:editing-duration","field"],["text:execute-macro","uncategorized"],["text:expression","uncategorized"],["text:file-name","field"],["text:h","text"],["text:hidden-paragraph","text"],["text:hidden-text","text"],["text:image-count","field"],["text:index-entry-span","uncategorized"],["text:index-title-template","uncategorized"],["text:initial-creator","field"],["text:keywords","field"],["text:linenumbering-separator","style"],
["text:measure","uncategorized"],["text:meta","uncategorized"],["text:meta-field","uncategorized"],["text:modification-date","field"],["text:modification-time","field"],["text:note-citation","field"],["text:note-continuation-notice-backward","style"],["text:note-continuation-notice-forward","style"],["text:note-ref","field"],["text:object-count","field"],["text:p","text"],["text:page-continuation","uncategorized"],["text:page-count","field"],["text:page-number","field"],["text:page-variable-get",
"field"],["text:page-variable-set","field"],["text:paragraph-count","field"],["text:placeholder","field"],["text:print-date","field"],["text:print-time","field"],["text:printed-by","field"],["text:reference-ref","field"],["text:ruby-base","text"],["text:ruby-text","text"],["text:script","text"],["text:sender-city","field"],["text:sender-company","field"],["text:sender-country","field"],["text:sender-email","field"],["text:sender-fax","field"],["text:sender-firstname","field"],["text:sender-initials",
"field"],["text:sender-lastname","field"],["text:sender-phone-private","field"],["text:sender-phone-work","field"],["text:sender-position","field"],["text:sender-postal-code","field"],["text:sender-state-or-province","field"],["text:sender-street","field"],["text:sender-title","field"],["text:sequence","uncategorized"],["text:sequence-ref","uncategorized"],["text:sheet-name","uncategorized"],["text:span","text"],["text:subject","field"],["text:table-count","field"],["text:table-formula","deprecated"],
["text:template-name","uncategorized"],["text:text-input","field"],["text:time","field"],["text:title","field"],["text:user-defined","field"],["text:user-field-get","field"],["text:user-field-input","field"],["text:variable-get","field"],["text:variable-input","field"],["text:variable-set","field"],["text:word-count","field"],["xforms:model","uncategorized"]],k={};this.isTextContainer=function(b,c){return"text"===k[b+":"+c]};this.isField=function(b,c){return"field"===k[b+":"+c]};this.getFields=function(){return f.filter(function(b){return"field"===
b[1]}).map(function(b){return b[0]})};(function(){f.forEach(function(b){var c=b[1],d=b[0].split(":");b=d[0];var d=d[1],f=odf.Namespaces.lookupNamespaceURI(b);f?k[f+":"+d]=c:runtime.log("DEBUG: OdfSchema - unknown prefix '"+b+"'")})})()};odf.OdfSchema=new odf.OdfSchemaImpl})();odf.OdfUtilsImpl=function(){function f(a){return"image"===(a&&a.localName)&&a.namespaceURI===V}function k(a){return null!==a&&a.nodeType===Node.ELEMENT_NODE&&"frame"===a.localName&&a.namespaceURI===V&&"as-char"===a.getAttributeNS(Y,"anchor-type")}function b(a){var b;(b="annotation"===(a&&a.localName)&&a.namespaceURI===odf.Namespaces.officens)||(b="div"===(a&&a.localName)&&"annotationWrapper"===a.className);return b}function c(a){return"a"===(a&&a.localName)&&a.namespaceURI===Y}function d(a){var b=
a&&a.localName;return("p"===b||"h"===b)&&a.namespaceURI===Y}function l(a,b){for(a&&void 0!==b&&!d(a)&&a.childNodes.item(b)&&(a=a.childNodes.item(b));a&&!d(a);)a=a.parentNode;return a}function n(a,b){for(;a&&a!==b;){if(a.namespaceURI===odf.Namespaces.officens&&"annotation"===a.localName)return a;a=a.parentNode}return null}function p(a){return/^[ \t\r\n]+$/.test(a)}function r(a){if(null===a||a.nodeType!==Node.ELEMENT_NODE)return!1;var b=a.localName;return O.isTextContainer(a.namespaceURI,b)||"span"===
b&&"webodf-annotationHighlight"===a.className}function m(a){return null===a||a.nodeType!==Node.ELEMENT_NODE?!1:O.isField(a.namespaceURI,a.localName)}function h(a){var b=a&&a.localName,c=!1;b&&(a=a.namespaceURI,a===Y&&(c="s"===b||"tab"===b||"line-break"===b));return c}function a(a){return h(a)||m(a)||k(a)||b(a)}function e(a){var b=a&&a.localName,c=!1;b&&(a=a.namespaceURI,a===Y&&(c="s"===b));return c}function q(a){return-1!==Z.indexOf(a.namespaceURI)}function g(a){if(h(a)||m(a))return!1;if(r(a.parentNode)&&
a.nodeType===Node.TEXT_NODE)return 0===a.textContent.length;for(a=a.firstChild;a;){if(q(a)||!g(a))return!1;a=a.nextSibling}return!0}function y(a){for(;null!==a.firstChild&&r(a);)a=a.firstChild;return a}function u(a){for(;null!==a.lastChild&&r(a);)a=a.lastChild;return a}function z(a){for(;!d(a)&&null===a.previousSibling;)a=a.parentNode;return d(a)?null:u(a.previousSibling)}function v(a){for(;!d(a)&&null===a.nextSibling;)a=a.parentNode;return d(a)?null:y(a.nextSibling)}function s(b){for(var c=!1;b;)if(b.nodeType===
Node.TEXT_NODE)if(0===b.length)b=z(b);else return!p(b.data.substr(b.length-1,1));else a(b)?(c=!1===e(b),b=null):b=z(b);return c}function w(b){var c=!1,e;for(b=b&&y(b);b;){e=b.nodeType===Node.TEXT_NODE?b.length:0;if(0<e&&!p(b.data)){c=!0;break}if(a(b)){c=!0;break}b=v(b)}return c}function x(a,b){return p(a.data.substr(b))?!w(v(a)):!1}function B(b,c){var e=b.data,d;if(!p(e[c])||a(b.parentNode))return!1;0<c?p(e[c-1])||(d=!0):s(z(b))&&(d=!0);return!0===d?x(b,c)?!1:!0:!1}function I(a){return(a=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px)|(%))/.exec(a))?
{value:parseFloat(a[1]),unit:a[3]}:null}function F(a){return(a=I(a))&&(0>a.value||"%"===a.unit)?null:a}function H(a){return(a=I(a))&&"%"!==a.unit?null:a}function A(a){switch(a.namespaceURI){case odf.Namespaces.drawns:case odf.Namespaces.svgns:case odf.Namespaces.dr3dns:return!1;case odf.Namespaces.textns:switch(a.localName){case "note-body":case "ruby-text":return!1}break;case odf.Namespaces.officens:switch(a.localName){case "annotation":case "binary-data":case "event-listeners":return!1}break;default:switch(a.localName){case "cursor":case "editinfo":return!1}}return!0}
function J(a,b){for(;0<b.length&&!W.rangeContainsNode(a,b[0]);)b.shift();for(;0<b.length&&!W.rangeContainsNode(a,b[b.length-1]);)b.pop()}function L(c,e,d){var g;g=W.getNodesInRange(c,function(c){var e=NodeFilter.FILTER_REJECT;if(h(c.parentNode)||m(c.parentNode)||b(c))e=NodeFilter.FILTER_REJECT;else if(c.nodeType===Node.TEXT_NODE){if(d||Boolean(l(c)&&(!p(c.textContent)||B(c,0))))e=NodeFilter.FILTER_ACCEPT}else if(a(c))e=NodeFilter.FILTER_ACCEPT;else if(A(c)||r(c))e=NodeFilter.FILTER_SKIP;return e},
NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);e||J(c,g);return g}function Q(a,c,e){for(;a;){if(e(a)){c[0]!==a&&c.unshift(a);break}if(b(a))break;a=a.parentNode}}function E(a,b){var c=a;if(b<c.childNodes.length-1)c=c.childNodes[b+1];else{for(;!c.nextSibling;)c=c.parentNode;c=c.nextSibling}for(;c.firstChild;)c=c.firstChild;return c}var Y=odf.Namespaces.textns,V=odf.Namespaces.drawns,t=odf.Namespaces.xlinkns,W=core.DomUtils,Z=[odf.Namespaces.dbns,odf.Namespaces.dcns,odf.Namespaces.dr3dns,odf.Namespaces.drawns,
odf.Namespaces.chartns,odf.Namespaces.formns,odf.Namespaces.numberns,odf.Namespaces.officens,odf.Namespaces.presentationns,odf.Namespaces.stylens,odf.Namespaces.svgns,odf.Namespaces.tablens,odf.Namespaces.textns],O=odf.OdfSchema;this.isImage=f;this.isCharacterFrame=k;this.isInlineRoot=b;this.isTextSpan=function(a){return"span"===(a&&a.localName)&&a.namespaceURI===Y};this.isHyperlink=c;this.getHyperlinkTarget=function(a){return a.getAttributeNS(t,"href")||""};this.isParagraph=d;this.getParagraphElement=
l;this.getParentAnnotation=n;this.isWithinAnnotation=function(a,b){return Boolean(n(a,b))};this.getAnnotationCreator=function(a){return a.getElementsByTagNameNS(odf.Namespaces.dcns,"creator")[0].textContent};this.isListItem=function(a){return"list-item"===(a&&a.localName)&&a.namespaceURI===Y};this.isLineBreak=function(a){return"line-break"===(a&&a.localName)&&a.namespaceURI===Y};this.isODFWhitespace=p;this.isGroupingElement=r;this.isFieldElement=m;this.isCharacterElement=h;this.isAnchoredAsCharacterElement=
a;this.isSpaceElement=e;this.isODFNode=q;this.hasNoODFContent=g;this.firstChild=y;this.lastChild=u;this.previousNode=z;this.nextNode=v;this.scanLeftForNonSpace=s;this.lookLeftForCharacter=function(b){var c,e=c=0;b.nodeType===Node.TEXT_NODE&&(e=b.length);0<e?(c=b.data,c=p(c.substr(e-1,1))?1===e?s(z(b))?2:0:p(c.substr(e-2,1))?0:2:1):a(b)&&(c=1);return c};this.lookRightForCharacter=function(b){var c=!1,e=0;b&&b.nodeType===Node.TEXT_NODE&&(e=b.length);0<e?c=!p(b.data.substr(0,1)):a(b)&&(c=!0);return c};
this.scanLeftForAnyCharacter=function(b){var c=!1,e;for(b=b&&u(b);b;){e=b.nodeType===Node.TEXT_NODE?b.length:0;if(0<e&&!p(b.data)){c=!0;break}if(a(b)){c=!0;break}b=z(b)}return c};this.scanRightForAnyCharacter=w;this.isTrailingWhitespace=x;this.isSignificantWhitespace=B;this.isDowngradableSpaceElement=function(a){return e(a)?s(z(a))&&w(v(a)):!1};this.parseLength=I;this.parseNonNegativeLength=F;this.parseFoFontSize=function(a){var b;b=(b=I(a))&&(0>=b.value||"%"===b.unit)?null:b;return b||H(a)};this.parseFoLineHeight=
function(a){return F(a)||H(a)};this.isTextContentContainingNode=A;this.getTextNodes=function(a,b){var c;c=W.getNodesInRange(a,function(a){var b=NodeFilter.FILTER_REJECT;a.nodeType===Node.TEXT_NODE?Boolean(l(a)&&(!p(a.textContent)||B(a,0)))&&(b=NodeFilter.FILTER_ACCEPT):A(a)&&(b=NodeFilter.FILTER_SKIP);return b},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);b||J(a,c);return c};this.getTextElements=L;this.getParagraphElements=function(a){var b;b=W.getNodesInRange(a,function(a){var b=NodeFilter.FILTER_REJECT;
if(d(a))b=NodeFilter.FILTER_ACCEPT;else if(A(a)||r(a))b=NodeFilter.FILTER_SKIP;return b},NodeFilter.SHOW_ELEMENT);Q(a.startContainer,b,d);return b};this.getImageElements=function(a){var b;b=W.getNodesInRange(a,function(a){var b=NodeFilter.FILTER_SKIP;f(a)&&(b=NodeFilter.FILTER_ACCEPT);return b},NodeFilter.SHOW_ELEMENT);Q(a.startContainer,b,f);return b};this.getHyperlinkElements=function(a){var b=[],e=a.cloneRange();a.collapsed&&a.endContainer.nodeType===Node.ELEMENT_NODE&&(a=E(a.endContainer,a.endOffset),
a.nodeType===Node.TEXT_NODE&&e.setEnd(a,1));L(e,!0,!1).forEach(function(a){for(a=a.parentNode;!d(a);){if(c(a)&&-1===b.indexOf(a)){b.push(a);break}a=a.parentNode}});e.detach();return b};this.getNormalizedFontFamilyName=function(a){/^(["'])(?:.|[\n\r])*?\1$/.test(a)||(a=a.replace(/^[ \t\r\n\f]*((?:.|[\n\r])*?)[ \t\r\n\f]*$/,"$1"),/[ \t\r\n\f]/.test(a)&&(a="'"+a.replace(/[ \t\r\n\f]+/g," ")+"'"));return a}};odf.OdfUtils=new odf.OdfUtilsImpl;gui.OdfTextBodyNodeFilter=function(){var f=odf.OdfUtils,k=Node.TEXT_NODE,b=NodeFilter.FILTER_REJECT,c=NodeFilter.FILTER_ACCEPT,d=odf.Namespaces.textns;this.acceptNode=function(l){if(l.nodeType===k){if(!f.isGroupingElement(l.parentNode))return b}else if(l.namespaceURI===d&&"tracked-changes"===l.localName)return b;return c}};xmldom.LSSerializerFilter=function(){};xmldom.LSSerializerFilter.prototype.acceptNode=function(f){};odf.OdfNodeFilter=function(){this.acceptNode=function(f){return"http://www.w3.org/1999/xhtml"===f.namespaceURI?NodeFilter.FILTER_SKIP:f.namespaceURI&&f.namespaceURI.match(/^urn:webodf:/)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}};xmldom.XPathIterator=function(){};xmldom.XPathIterator.prototype.next=function(){};xmldom.XPathIterator.prototype.reset=function(){};
function createXPathSingleton(){function f(b,a,c){return-1!==b&&(b<a||-1===a)&&(b<c||-1===c)}function k(b){for(var a=[],c=0,d=b.length,g;c<d;){var l=b,n=d,p=a,k="",r=[],w=l.indexOf("[",c),x=l.indexOf("/",c),B=l.indexOf("=",c);f(x,w,B)?(k=l.substring(c,x),c=x+1):f(w,x,B)?(k=l.substring(c,w),c=m(l,w,r)):f(B,x,w)?(k=l.substring(c,B),c=B):(k=l.substring(c,n),c=n);p.push({location:k,predicates:r});if(c<d&&"="===b[c]){g=b.substring(c+1,d);if(2<g.length&&("'"===g[0]||'"'===g[0]))g=g.slice(1,g.length-1);
else try{g=parseInt(g,10)}catch(I){}c=d}}return{steps:a,value:g}}function b(){var b=null,a=!1;this.setNode=function(a){b=a};this.reset=function(){a=!1};this.next=function(){var c=a?null:b;a=!0;return c}}function c(b,a,c){this.reset=function(){b.reset()};this.next=function(){for(var d=b.next();d;){d.nodeType===Node.ELEMENT_NODE&&(d=d.getAttributeNodeNS(a,c));if(d)break;d=b.next()}return d}}function d(b,a){var c=b.next(),d=null;this.reset=function(){b.reset();c=b.next();d=null};this.next=function(){for(;c;){if(d)if(a&&
d.firstChild)d=d.firstChild;else{for(;!d.nextSibling&&d!==c;)d=d.parentNode;d===c?c=b.next():d=d.nextSibling}else{do(d=c.firstChild)||(c=b.next());while(c&&!d)}if(d&&d.nodeType===Node.ELEMENT_NODE)return d}return null}}function l(b,a){this.reset=function(){b.reset()};this.next=function(){for(var c=b.next();c&&!a(c);)c=b.next();return c}}function n(b,a,c){a=a.split(":",2);var d=c(a[0]),g=a[1];return new l(b,function(a){return a.localName===g&&a.namespaceURI===d})}function p(c,a,e){var d=new b,g=r(d,
a,e),f=a.value;return void 0===f?new l(c,function(a){d.setNode(a);g.reset();return null!==g.next()}):new l(c,function(a){d.setNode(a);g.reset();return(a=g.next())?a.nodeValue===f:!1})}var r,m;m=function(b,a,c){for(var d=a,g=b.length,f=0;d<g;)"]"===b[d]?(f-=1,0>=f&&c.push(k(b.substring(a,d)))):"["===b[d]&&(0>=f&&(a=d+1),f+=1),d+=1;return d};r=function(b,a,e){var q,g,f,l;for(q=0;q<a.steps.length;q+=1){f=a.steps[q];g=f.location;if(""===g)b=new d(b,!1);else if("@"===g[0]){g=g.substr(1).split(":",2);l=
e(g[0]);if(!l)throw"No namespace associated with the prefix "+g[0];b=new c(b,l,g[1])}else"."!==g&&(b=new d(b,!1),-1!==g.indexOf(":")&&(b=n(b,g,e)));for(g=0;g<f.predicates.length;g+=1)l=f.predicates[g],b=p(b,l,e)}return b};return{getODFElementsWithXPath:function(c,a,e){var d=c.ownerDocument,g=[],f=null;if(d&&"function"===typeof d.evaluate)for(e=d.evaluate(a,c,e,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null),f=e.iterateNext();null!==f;)f.nodeType===Node.ELEMENT_NODE&&g.push(f),f=e.iterateNext();else{g=
new b;g.setNode(c);c=k(a);g=r(g,c,e);c=[];for(e=g.next();e;)c.push(e),e=g.next();g=c}return g}}}xmldom.XPath=createXPathSingleton();odf.StyleInfo=function(){function f(a,b){var c,e,d,g,h,q=0;if(c=F[a.localName])if(d=c[a.namespaceURI])q=d.length;for(c=0;c<q;c+=1)e=d[c],g=e.ns,h=e.localname,(e=a.getAttributeNS(g,h))&&a.setAttributeNS(g,B[g]+h,b+e);for(d=a.firstElementChild;d;)f(d,b),d=d.nextElementSibling}function k(a,b){var c,e,d,g,h,f=0;if(c=F[a.localName])if(d=c[a.namespaceURI])f=d.length;for(c=0;c<f;c+=1)if(e=d[c],g=e.ns,h=e.localname,e=a.getAttributeNS(g,h))e=e.replace(b,""),a.setAttributeNS(g,B[g]+h,e);for(d=a.firstElementChild;d;)k(d,
b),d=d.nextElementSibling}function b(a,b){var c,e,d,g,h,f=0;if(c=F[a.localName])if(d=c[a.namespaceURI])f=d.length;for(c=0;c<f;c+=1)if(g=d[c],e=g.ns,h=g.localname,e=a.getAttributeNS(e,h))b=b||{},g=g.keyname,b.hasOwnProperty(g)?b[g][e]=1:(h={},h[e]=1,b[g]=h);return b}function c(a,e){var d,g;b(a,e);for(d=a.firstChild;d;)d.nodeType===Node.ELEMENT_NODE&&(g=d,c(g,e)),d=d.nextSibling}function d(a,b,c){this.key=a;this.name=b;this.family=c;this.requires={}}function l(a,b,c){var e=a+'"'+b,g=c[e];g||(g=c[e]=
new d(e,a,b));return g}function n(a,b,c){var e,d,g,h,f,q=0;e=a.getAttributeNS(s,"name");h=a.getAttributeNS(s,"family");e&&h&&(b=l(e,h,c));if(b){if(e=F[a.localName])if(g=e[a.namespaceURI])q=g.length;for(e=0;e<q;e+=1)if(h=g[e],d=h.ns,f=h.localname,d=a.getAttributeNS(d,f))h=h.keyname,h=l(d,h,c),b.requires[h.key]=h}for(a=a.firstElementChild;a;)n(a,b,c),a=a.nextElementSibling;return c}function p(a,b){var c=b[a.family];c||(c=b[a.family]={});c[a.name]=1;Object.keys(a.requires).forEach(function(c){p(a.requires[c],
b)})}function r(a,b){var c=n(a,null,{});Object.keys(c).forEach(function(a){a=c[a];var e=b[a.family];e&&e.hasOwnProperty(a.name)&&p(a,b)})}function m(a,b){function c(b){(b=g.getAttributeNS(s,b))&&(a[b]=!0)}var e=["font-name","font-name-asian","font-name-complex"],d,g;for(d=b&&b.firstElementChild;d;)g=d,e.forEach(c),m(a,g),d=d.nextElementSibling}function h(a,b){function c(a){var e=g.getAttributeNS(s,a);e&&b.hasOwnProperty(e)&&g.setAttributeNS(s,"style:"+a,b[e])}var e=["font-name","font-name-asian",
"font-name-complex"],d,g;for(d=a&&a.firstElementChild;d;)g=d,e.forEach(c),h(g,b),d=d.nextElementSibling}var a=odf.Namespaces.chartns,e=odf.Namespaces.dbns,q=odf.Namespaces.dr3dns,g=odf.Namespaces.drawns,y=odf.Namespaces.formns,u=odf.Namespaces.numberns,z=odf.Namespaces.officens,v=odf.Namespaces.presentationns,s=odf.Namespaces.stylens,w=odf.Namespaces.tablens,x=odf.Namespaces.textns,B={"urn:oasis:names:tc:opendocument:xmlns:chart:1.0":"chart:","urn:oasis:names:tc:opendocument:xmlns:database:1.0":"db:",
"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0":"dr3d:","urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":"draw:","urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":"fo:","urn:oasis:names:tc:opendocument:xmlns:form:1.0":"form:","urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":"number:","urn:oasis:names:tc:opendocument:xmlns:office:1.0":"office:","urn:oasis:names:tc:opendocument:xmlns:presentation:1.0":"presentation:","urn:oasis:names:tc:opendocument:xmlns:style:1.0":"style:","urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0":"svg:",
"urn:oasis:names:tc:opendocument:xmlns:table:1.0":"table:","urn:oasis:names:tc:opendocument:xmlns:text:1.0":"chart:","http://www.w3.org/XML/1998/namespace":"xml:"},I={text:[{ens:s,en:"tab-stop",ans:s,a:"leader-text-style"},{ens:s,en:"drop-cap",ans:s,a:"style-name"},{ens:x,en:"notes-configuration",ans:x,a:"citation-body-style-name"},{ens:x,en:"notes-configuration",ans:x,a:"citation-style-name"},{ens:x,en:"a",ans:x,a:"style-name"},{ens:x,en:"alphabetical-index",ans:x,a:"style-name"},{ens:x,en:"linenumbering-configuration",
ans:x,a:"style-name"},{ens:x,en:"list-level-style-number",ans:x,a:"style-name"},{ens:x,en:"ruby-text",ans:x,a:"style-name"},{ens:x,en:"span",ans:x,a:"style-name"},{ens:x,en:"a",ans:x,a:"visited-style-name"},{ens:s,en:"text-properties",ans:s,a:"text-line-through-text-style"},{ens:x,en:"alphabetical-index-source",ans:x,a:"main-entry-style-name"},{ens:x,en:"index-entry-bibliography",ans:x,a:"style-name"},{ens:x,en:"index-entry-chapter",ans:x,a:"style-name"},{ens:x,en:"index-entry-link-end",ans:x,a:"style-name"},
{ens:x,en:"index-entry-link-start",ans:x,a:"style-name"},{ens:x,en:"index-entry-page-number",ans:x,a:"style-name"},{ens:x,en:"index-entry-span",ans:x,a:"style-name"},{ens:x,en:"index-entry-tab-stop",ans:x,a:"style-name"},{ens:x,en:"index-entry-text",ans:x,a:"style-name"},{ens:x,en:"index-title-template",ans:x,a:"style-name"},{ens:x,en:"list-level-style-bullet",ans:x,a:"style-name"},{ens:x,en:"outline-level-style",ans:x,a:"style-name"}],paragraph:[{ens:g,en:"caption",ans:g,a:"text-style-name"},{ens:g,
en:"circle",ans:g,a:"text-style-name"},{ens:g,en:"connector",ans:g,a:"text-style-name"},{ens:g,en:"control",ans:g,a:"text-style-name"},{ens:g,en:"custom-shape",ans:g,a:"text-style-name"},{ens:g,en:"ellipse",ans:g,a:"text-style-name"},{ens:g,en:"frame",ans:g,a:"text-style-name"},{ens:g,en:"line",ans:g,a:"text-style-name"},{ens:g,en:"measure",ans:g,a:"text-style-name"},{ens:g,en:"path",ans:g,a:"text-style-name"},{ens:g,en:"polygon",ans:g,a:"text-style-name"},{ens:g,en:"polyline",ans:g,a:"text-style-name"},
{ens:g,en:"rect",ans:g,a:"text-style-name"},{ens:g,en:"regular-polygon",ans:g,a:"text-style-name"},{ens:z,en:"annotation",ans:g,a:"text-style-name"},{ens:y,en:"column",ans:y,a:"text-style-name"},{ens:s,en:"style",ans:s,a:"next-style-name"},{ens:w,en:"body",ans:w,a:"paragraph-style-name"},{ens:w,en:"even-columns",ans:w,a:"paragraph-style-name"},{ens:w,en:"even-rows",ans:w,a:"paragraph-style-name"},{ens:w,en:"first-column",ans:w,a:"paragraph-style-name"},{ens:w,en:"first-row",ans:w,a:"paragraph-style-name"},
{ens:w,en:"last-column",ans:w,a:"paragraph-style-name"},{ens:w,en:"last-row",ans:w,a:"paragraph-style-name"},{ens:w,en:"odd-columns",ans:w,a:"paragraph-style-name"},{ens:w,en:"odd-rows",ans:w,a:"paragraph-style-name"},{ens:x,en:"notes-configuration",ans:x,a:"default-style-name"},{ens:x,en:"alphabetical-index-entry-template",ans:x,a:"style-name"},{ens:x,en:"bibliography-entry-template",ans:x,a:"style-name"},{ens:x,en:"h",ans:x,a:"style-name"},{ens:x,en:"illustration-index-entry-template",ans:x,a:"style-name"},
{ens:x,en:"index-source-style",ans:x,a:"style-name"},{ens:x,en:"object-index-entry-template",ans:x,a:"style-name"},{ens:x,en:"p",ans:x,a:"style-name"},{ens:x,en:"table-index-entry-template",ans:x,a:"style-name"},{ens:x,en:"table-of-content-entry-template",ans:x,a:"style-name"},{ens:x,en:"table-index-entry-template",ans:x,a:"style-name"},{ens:x,en:"user-index-entry-template",ans:x,a:"style-name"},{ens:s,en:"page-layout-properties",ans:s,a:"register-truth-ref-style-name"}],chart:[{ens:a,en:"axis",ans:a,
a:"style-name"},{ens:a,en:"chart",ans:a,a:"style-name"},{ens:a,en:"data-label",ans:a,a:"style-name"},{ens:a,en:"data-point",ans:a,a:"style-name"},{ens:a,en:"equation",ans:a,a:"style-name"},{ens:a,en:"error-indicator",ans:a,a:"style-name"},{ens:a,en:"floor",ans:a,a:"style-name"},{ens:a,en:"footer",ans:a,a:"style-name"},{ens:a,en:"grid",ans:a,a:"style-name"},{ens:a,en:"legend",ans:a,a:"style-name"},{ens:a,en:"mean-value",ans:a,a:"style-name"},{ens:a,en:"plot-area",ans:a,a:"style-name"},{ens:a,en:"regression-curve",
ans:a,a:"style-name"},{ens:a,en:"series",ans:a,a:"style-name"},{ens:a,en:"stock-gain-marker",ans:a,a:"style-name"},{ens:a,en:"stock-loss-marker",ans:a,a:"style-name"},{ens:a,en:"stock-range-line",ans:a,a:"style-name"},{ens:a,en:"subtitle",ans:a,a:"style-name"},{ens:a,en:"title",ans:a,a:"style-name"},{ens:a,en:"wall",ans:a,a:"style-name"}],section:[{ens:x,en:"alphabetical-index",ans:x,a:"style-name"},{ens:x,en:"bibliography",ans:x,a:"style-name"},{ens:x,en:"illustration-index",ans:x,a:"style-name"},
{ens:x,en:"index-title",ans:x,a:"style-name"},{ens:x,en:"object-index",ans:x,a:"style-name"},{ens:x,en:"section",ans:x,a:"style-name"},{ens:x,en:"table-of-content",ans:x,a:"style-name"},{ens:x,en:"table-index",ans:x,a:"style-name"},{ens:x,en:"user-index",ans:x,a:"style-name"}],ruby:[{ens:x,en:"ruby",ans:x,a:"style-name"}],table:[{ens:e,en:"query",ans:e,a:"style-name"},{ens:e,en:"table-representation",ans:e,a:"style-name"},{ens:w,en:"background",ans:w,a:"style-name"},{ens:w,en:"table",ans:w,a:"style-name"}],
"table-column":[{ens:e,en:"column",ans:e,a:"style-name"},{ens:w,en:"table-column",ans:w,a:"style-name"}],"table-row":[{ens:e,en:"query",ans:e,a:"default-row-style-name"},{ens:e,en:"table-representation",ans:e,a:"default-row-style-name"},{ens:w,en:"table-row",ans:w,a:"style-name"}],"table-cell":[{ens:e,en:"column",ans:e,a:"default-cell-style-name"},{ens:w,en:"table-column",ans:w,a:"default-cell-style-name"},{ens:w,en:"table-row",ans:w,a:"default-cell-style-name"},{ens:w,en:"body",ans:w,a:"style-name"},
{ens:w,en:"covered-table-cell",ans:w,a:"style-name"},{ens:w,en:"even-columns",ans:w,a:"style-name"},{ens:w,en:"covered-table-cell",ans:w,a:"style-name"},{ens:w,en:"even-columns",ans:w,a:"style-name"},{ens:w,en:"even-rows",ans:w,a:"style-name"},{ens:w,en:"first-column",ans:w,a:"style-name"},{ens:w,en:"first-row",ans:w,a:"style-name"},{ens:w,en:"last-column",ans:w,a:"style-name"},{ens:w,en:"last-row",ans:w,a:"style-name"},{ens:w,en:"odd-columns",ans:w,a:"style-name"},{ens:w,en:"odd-rows",ans:w,a:"style-name"},
{ens:w,en:"table-cell",ans:w,a:"style-name"}],graphic:[{ens:q,en:"cube",ans:g,a:"style-name"},{ens:q,en:"extrude",ans:g,a:"style-name"},{ens:q,en:"rotate",ans:g,a:"style-name"},{ens:q,en:"scene",ans:g,a:"style-name"},{ens:q,en:"sphere",ans:g,a:"style-name"},{ens:g,en:"caption",ans:g,a:"style-name"},{ens:g,en:"circle",ans:g,a:"style-name"},{ens:g,en:"connector",ans:g,a:"style-name"},{ens:g,en:"control",ans:g,a:"style-name"},{ens:g,en:"custom-shape",ans:g,a:"style-name"},{ens:g,en:"ellipse",ans:g,a:"style-name"},
{ens:g,en:"frame",ans:g,a:"style-name"},{ens:g,en:"g",ans:g,a:"style-name"},{ens:g,en:"line",ans:g,a:"style-name"},{ens:g,en:"measure",ans:g,a:"style-name"},{ens:g,en:"page-thumbnail",ans:g,a:"style-name"},{ens:g,en:"path",ans:g,a:"style-name"},{ens:g,en:"polygon",ans:g,a:"style-name"},{ens:g,en:"polyline",ans:g,a:"style-name"},{ens:g,en:"rect",ans:g,a:"style-name"},{ens:g,en:"regular-polygon",ans:g,a:"style-name"},{ens:z,en:"annotation",ans:g,a:"style-name"}],presentation:[{ens:q,en:"cube",ans:v,
a:"style-name"},{ens:q,en:"extrude",ans:v,a:"style-name"},{ens:q,en:"rotate",ans:v,a:"style-name"},{ens:q,en:"scene",ans:v,a:"style-name"},{ens:q,en:"sphere",ans:v,a:"style-name"},{ens:g,en:"caption",ans:v,a:"style-name"},{ens:g,en:"circle",ans:v,a:"style-name"},{ens:g,en:"connector",ans:v,a:"style-name"},{ens:g,en:"control",ans:v,a:"style-name"},{ens:g,en:"custom-shape",ans:v,a:"style-name"},{ens:g,en:"ellipse",ans:v,a:"style-name"},{ens:g,en:"frame",ans:v,a:"style-name"},{ens:g,en:"g",ans:v,a:"style-name"},
{ens:g,en:"line",ans:v,a:"style-name"},{ens:g,en:"measure",ans:v,a:"style-name"},{ens:g,en:"page-thumbnail",ans:v,a:"style-name"},{ens:g,en:"path",ans:v,a:"style-name"},{ens:g,en:"polygon",ans:v,a:"style-name"},{ens:g,en:"polyline",ans:v,a:"style-name"},{ens:g,en:"rect",ans:v,a:"style-name"},{ens:g,en:"regular-polygon",ans:v,a:"style-name"},{ens:z,en:"annotation",ans:v,a:"style-name"}],"drawing-page":[{ens:g,en:"page",ans:g,a:"style-name"},{ens:v,en:"notes",ans:g,a:"style-name"},{ens:s,en:"handout-master",
ans:g,a:"style-name"},{ens:s,en:"master-page",ans:g,a:"style-name"}],"list-style":[{ens:x,en:"list",ans:x,a:"style-name"},{ens:x,en:"numbered-paragraph",ans:x,a:"style-name"},{ens:x,en:"list-item",ans:x,a:"style-override"},{ens:s,en:"style",ans:s,a:"list-style-name"}],data:[{ens:s,en:"style",ans:s,a:"data-style-name"},{ens:s,en:"style",ans:s,a:"percentage-data-style-name"},{ens:v,en:"date-time-decl",ans:s,a:"data-style-name"},{ens:x,en:"creation-date",ans:s,a:"data-style-name"},{ens:x,en:"creation-time",
ans:s,a:"data-style-name"},{ens:x,en:"database-display",ans:s,a:"data-style-name"},{ens:x,en:"date",ans:s,a:"data-style-name"},{ens:x,en:"editing-duration",ans:s,a:"data-style-name"},{ens:x,en:"expression",ans:s,a:"data-style-name"},{ens:x,en:"meta-field",ans:s,a:"data-style-name"},{ens:x,en:"modification-date",ans:s,a:"data-style-name"},{ens:x,en:"modification-time",ans:s,a:"data-style-name"},{ens:x,en:"print-date",ans:s,a:"data-style-name"},{ens:x,en:"print-time",ans:s,a:"data-style-name"},{ens:x,
en:"table-formula",ans:s,a:"data-style-name"},{ens:x,en:"time",ans:s,a:"data-style-name"},{ens:x,en:"user-defined",ans:s,a:"data-style-name"},{ens:x,en:"user-field-get",ans:s,a:"data-style-name"},{ens:x,en:"user-field-input",ans:s,a:"data-style-name"},{ens:x,en:"variable-get",ans:s,a:"data-style-name"},{ens:x,en:"variable-input",ans:s,a:"data-style-name"},{ens:x,en:"variable-set",ans:s,a:"data-style-name"}],"page-layout":[{ens:v,en:"notes",ans:s,a:"page-layout-name"},{ens:s,en:"handout-master",ans:s,
a:"page-layout-name"},{ens:s,en:"master-page",ans:s,a:"page-layout-name"}]},F,H=xmldom.XPath;this.collectUsedFontFaces=m;this.changeFontFaceNames=h;this.UsedStyleList=function(a,b){var e={};this.uses=function(a){var b=a.localName,c=a.getAttributeNS(g,"name")||a.getAttributeNS(s,"name");a="style"===b?a.getAttributeNS(s,"family"):a.namespaceURI===u?"data":b;return(a=e[a])?0<a[c]:!1};c(a,e);b&&r(b,e)};this.getStyleName=function(a,b){var c,e,d=F[b.localName];if(d&&(d=d[b.namespaceURI]))for(e=0;e<d.length;e+=
1)if(d[e].keyname===a&&(d=d[e],b.hasAttributeNS(d.ns,d.localname))){c=b.getAttributeNS(d.ns,d.localname);break}return c};this.hasDerivedStyles=function(a,b,c){var e=c.getAttributeNS(s,"name");c=c.getAttributeNS(s,"family");return H.getODFElementsWithXPath(a,"//style:*[@style:parent-style-name='"+e+"'][@style:family='"+c+"']",b).length?!0:!1};this.prefixStyleNames=function(a,b,c){var e;if(a){for(e=a.firstChild;e;){if(e.nodeType===Node.ELEMENT_NODE){var d=e,h=b,q=d.getAttributeNS(g,"name"),l=void 0;
q?l=g:(q=d.getAttributeNS(s,"name"))&&(l=s);l&&d.setAttributeNS(l,B[l]+"name",h+q)}e=e.nextSibling}f(a,b);c&&f(c,b)}};this.removePrefixFromStyleNames=function(a,b,c){var e=RegExp("^"+b);if(a){for(b=a.firstChild;b;){if(b.nodeType===Node.ELEMENT_NODE){var d=b,h=e,f=d.getAttributeNS(g,"name"),q=void 0;f?q=g:(f=d.getAttributeNS(s,"name"))&&(q=s);q&&(f=f.replace(h,""),d.setAttributeNS(q,B[q]+"name",f))}b=b.nextSibling}k(a,e);c&&k(c,e)}};this.determineStylesForNode=b;F=function(){var a,b,c,e,d,g={},h,f,
q,l;for(c in I)if(I.hasOwnProperty(c))for(e=I[c],b=e.length,a=0;a<b;a+=1)d=e[a],q=d.en,l=d.ens,g.hasOwnProperty(q)?h=g[q]:g[q]=h={},h.hasOwnProperty(l)?f=h[l]:h[l]=f=[],f.push({ns:d.ans,localname:d.a,keyname:c});return g}()};"function"!==typeof Object.create&&(Object.create=function(f){var k=function(){};k.prototype=f;return new k});
xmldom.LSSerializer=function(){function f(b){var c=b||{},f=function(b){var a={},c;for(c in b)b.hasOwnProperty(c)&&(a[b[c]]=c);return a}(b),p=[c],k=[f],m=0;this.push=function(){m+=1;c=p[m]=Object.create(c);f=k[m]=Object.create(f)};this.pop=function(){p.pop();k.pop();m-=1;c=p[m];f=k[m]};this.getLocalNamespaceDefinitions=function(){return f};this.getQName=function(b){var a=b.namespaceURI,e=0,d;if(!a)return b.localName;if(d=f[a])return d+":"+b.localName;do{d||!b.prefix?(d="ns"+e,e+=1):d=b.prefix;if(c[d]===
a)break;if(!c[d]){c[d]=a;f[a]=d;break}d=null}while(null===d);return d+":"+b.localName}}function k(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function b(d,f){var n="",p=c.filter?c.filter.acceptNode(f):NodeFilter.FILTER_ACCEPT,r;if(p===NodeFilter.FILTER_ACCEPT&&f.nodeType===Node.ELEMENT_NODE){d.push();r=d.getQName(f);var m,h=f.attributes,a,e,q,g="",y;m="<"+r;a=h.length;for(e=0;e<a;e+=1)q=h.item(e),"http://www.w3.org/2000/xmlns/"!==
q.namespaceURI&&(y=c.filter?c.filter.acceptNode(q):NodeFilter.FILTER_ACCEPT,y===NodeFilter.FILTER_ACCEPT&&(y=d.getQName(q),q="string"===typeof q.value?k(q.value):q.value,g+=" "+(y+'="'+q+'"')));a=d.getLocalNamespaceDefinitions();for(e in a)a.hasOwnProperty(e)&&((h=a[e])?"xmlns"!==h&&(m+=" xmlns:"+a[e]+'="'+e+'"'):m+=' xmlns="'+e+'"');n+=m+(g+">")}if(p===NodeFilter.FILTER_ACCEPT||p===NodeFilter.FILTER_SKIP){for(p=f.firstChild;p;)n+=b(d,p),p=p.nextSibling;f.nodeValue&&(n+=k(f.nodeValue))}r&&(n+="</"+
r+">",d.pop());return n}var c=this;this.filter=null;this.writeToString=function(c,l){if(!c)return"";var n=new f(l);return b(n,c)}};(function(){function f(b){var a,c=p.length;for(a=0;a<c;a+=1)if("urn:oasis:names:tc:opendocument:xmlns:office:1.0"===b.namespaceURI&&b.localName===p[a])return a;return-1}function k(b,a){var c=new d.UsedStyleList(b,a),f=new odf.OdfNodeFilter;this.acceptNode=function(b){var d=f.acceptNode(b);d===NodeFilter.FILTER_ACCEPT&&b.parentNode===a&&b.nodeType===Node.ELEMENT_NODE&&(d=c.uses(b)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);return d}}function b(b,a){var c=new k(b,a);this.acceptNode=function(a){var b=
c.acceptNode(a);b!==NodeFilter.FILTER_ACCEPT||!a.parentNode||a.parentNode.namespaceURI!==odf.Namespaces.textns||"s"!==a.parentNode.localName&&"tab"!==a.parentNode.localName||(b=NodeFilter.FILTER_REJECT);return b}}function c(b,a){if(a){var c=f(a),d,g=b.firstChild;if(-1!==c){for(;g;){d=f(g);if(-1!==d&&d>c)break;g=g.nextSibling}b.insertBefore(a,g)}}}var d=new odf.StyleInfo,l=core.DomUtils,n=odf.Namespaces.stylens,p="meta settings scripts font-face-decls styles automatic-styles master-styles body".split(" "),
r=Date.now()+"_webodf_",m=new core.Base64;odf.ODFElement=function(){};odf.ODFDocumentElement=function(){};odf.ODFDocumentElement.prototype=new odf.ODFElement;odf.ODFDocumentElement.prototype.constructor=odf.ODFDocumentElement;odf.ODFDocumentElement.prototype.fontFaceDecls=null;odf.ODFDocumentElement.prototype.manifest=null;odf.ODFDocumentElement.prototype.settings=null;odf.ODFDocumentElement.namespaceURI="urn:oasis:names:tc:opendocument:xmlns:office:1.0";odf.ODFDocumentElement.localName="document";
odf.AnnotationElement=function(){};odf.OdfPart=function(b,a,c,d){var g=this;this.size=0;this.type=null;this.name=b;this.container=c;this.url=null;this.mimetype=a;this.onstatereadychange=this.document=null;this.EMPTY=0;this.LOADING=1;this.DONE=2;this.state=this.EMPTY;this.data="";this.load=function(){null!==d&&(this.mimetype=a,d.loadAsDataURL(b,a,function(a,b){a&&runtime.log(a);g.url=b;if(g.onchange)g.onchange(g);if(g.onstatereadychange)g.onstatereadychange(g)}))}};odf.OdfPart.prototype.load=function(){};
odf.OdfPart.prototype.getUrl=function(){return this.data?"data:;base64,"+m.toBase64(this.data):null};odf.OdfContainer=function a(e,f){function g(a){for(var b=a.firstChild,c;b;)c=b.nextSibling,b.nodeType===Node.ELEMENT_NODE?g(b):b.nodeType===Node.PROCESSING_INSTRUCTION_NODE&&a.removeChild(b),b=c}function p(a){var b={},c,e,d=a.ownerDocument.createNodeIterator(a,NodeFilter.SHOW_ELEMENT,null,!1);for(a=d.nextNode();a;)"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&("annotation"===
a.localName?(c=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))&&(b.hasOwnProperty(c)?runtime.log("Warning: annotation name used more than once with <office:annotation/>: '"+c+"'"):b[c]=a):"annotation-end"===a.localName&&((c=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))?b.hasOwnProperty(c)?(e=b[c],e.annotationEndElement?runtime.log("Warning: annotation name used more than once with <office:annotation-end/>: '"+c+"'"):e.annotationEndElement=
a):runtime.log("Warning: annotation end without an annotation start, name: '"+c+"'"):runtime.log("Warning: annotation end without a name found"))),a=d.nextNode()}function u(a,b){for(var c=a&&a.firstChild;c;)c.nodeType===Node.ELEMENT_NODE&&c.setAttributeNS("urn:webodf:names:scope","scope",b),c=c.nextSibling}function z(a,b){for(var c=C.rootElement.meta,c=c&&c.firstChild;c&&(c.namespaceURI!==a||c.localName!==b);)c=c.nextSibling;for(c=c&&c.firstChild;c&&c.nodeType!==Node.TEXT_NODE;)c=c.nextSibling;return c?
c.data:null}function v(a){var b={},c;for(a=a.firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&a.namespaceURI===n&&"font-face"===a.localName&&(c=a.getAttributeNS(n,"name"),b[c]=a),a=a.nextSibling;return b}function s(a,b){var c=null,e,d,g;if(a)for(c=a.cloneNode(!0),e=c.firstElementChild;e;)d=e.nextElementSibling,(g=e.getAttributeNS("urn:webodf:names:scope","scope"))&&g!==b&&c.removeChild(e),e=d;return c}function w(a,b){var c,e,g,f=null,q={};if(a)for(b.forEach(function(a){d.collectUsedFontFaces(q,a)}),
f=a.cloneNode(!0),c=f.firstElementChild;c;)e=c.nextElementSibling,g=c.getAttributeNS(n,"name"),q[g]||f.removeChild(c),c=e;return f}function x(a){var b=C.rootElement.ownerDocument,c;if(a){g(a.documentElement);try{c=b.importNode(a.documentElement,!0)}catch(e){}}return c}function B(a){C.state=a;if(C.onchange)C.onchange(C);if(C.onstatereadychange)C.onstatereadychange(C)}function I(a){ia=null;C.rootElement=a;a.fontFaceDecls=l.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");
a.styles=l.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles");a.automaticStyles=l.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");a.masterStyles=l.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles");a.body=l.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");a.meta=l.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta");a.settings=l.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"settings");a.scripts=l.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","scripts");p(a)}function F(b){var e=x(b),g=C.rootElement,f;e&&"document-styles"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI?(g.fontFaceDecls=l.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),c(g,g.fontFaceDecls),f=l.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),g.styles=f||b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"styles"),c(g,g.styles),f=l.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),g.automaticStyles=f||b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),u(g.automaticStyles,"document-styles"),c(g,g.automaticStyles),e=l.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),g.masterStyles=e||b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),c(g,g.masterStyles),
d.prefixStyleNames(g.automaticStyles,r,g.masterStyles)):B(a.INVALID)}function H(b){b=x(b);var e,g,f,q;if(b&&"document-content"===b.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===b.namespaceURI){e=C.rootElement;f=l.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");if(e.fontFaceDecls&&f){q=e.fontFaceDecls;var m,p,k,r,L={};g=v(q);r=v(f);for(f=f.firstElementChild;f;){m=f.nextElementSibling;if(f.namespaceURI===n&&"font-face"===f.localName)if(p=f.getAttributeNS(n,
"name"),g.hasOwnProperty(p)){if(!f.isEqualNode(g[p])){k=p;for(var s=g,E=r,t=0,y=void 0,y=k=k.replace(/\d+$/,"");s.hasOwnProperty(y)||E.hasOwnProperty(y);)t+=1,y=k+t;k=y;f.setAttributeNS(n,"style:name",k);q.appendChild(f);g[k]=f;delete r[p];L[p]=k}}else q.appendChild(f),g[p]=f,delete r[p];f=m}q=L}else f&&(e.fontFaceDecls=f,c(e,f));g=l.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");u(g,"document-content");q&&d.changeFontFaceNames(g,q);if(e.automaticStyles&&g)for(q=
g.firstChild;q;)e.automaticStyles.appendChild(q),q=g.firstChild;else g&&(e.automaticStyles=g,c(e,g));b=l.getDirectChild(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");if(null===b)throw"<office:body/> tag is mising.";e.body=b;c(e,e.body)}else B(a.INVALID)}function A(a){a=x(a);var b;a&&"document-meta"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(b=C.rootElement,b.meta=l.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),
c(b,b.meta))}function J(a){a=x(a);var b;a&&"document-settings"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(b=C.rootElement,b.settings=l.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),c(b,b.settings))}function L(a){a=x(a);var b;if(a&&"manifest"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===a.namespaceURI)for(b=C.rootElement,b.manifest=a,a=b.manifest.firstElementChild;a;)"file-entry"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===
a.namespaceURI&&(T[a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","full-path")]=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","media-type")),a=a.nextElementSibling}function Q(a,b,c){a=l.getElementsByTagName(a,b);var e;for(e=0;e<a.length;e+=1)b=a[e],c.hasOwnProperty(b.namespaceURI)||b.parentNode.removeChild(b)}function E(a){Q(a,"script",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:office:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:table:1.0":!0,
"urn:oasis:names:tc:opendocument:xmlns:text:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":!0});Q(a,"style",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:style:1.0":!0})}function Y(a){var b=a.firstElementChild,c=[],e,d,g,f=a.attributes,q=f.length;for(e=0;e<q;e+=1)g=f.item(e),d=g.localName.substr(0,2).toLowerCase(),null===g.namespaceURI&&"on"===d&&c.push(g);q=c.length;for(e=
0;e<q;e+=1)a.removeAttributeNode(c[e]);for(;b;)Y(b),b=b.nextElementSibling}function V(b){var c=b.shift();c?U.loadAsDOM(c.path,function(e,d){d&&(E(d),Y(d.documentElement));c.handler(d);C.state===a.INVALID?e?runtime.log("ERROR: Unable to load "+c.path+" - "+e):runtime.log("ERROR: Unable to load "+c.path):(e&&runtime.log("DEBUG: Unable to load "+c.path+" - "+e),V(b))}):(p(C.rootElement),B(a.DONE))}function t(a){var b="";odf.Namespaces.forEachPrefix(function(a,c){b+=" xmlns:"+a+'="'+c+'"'});return'<?xml version="1.0" encoding="UTF-8"?><office:'+
a+" "+b+' office:version="1.2">'}function W(){var a=new xmldom.LSSerializer,b=t("document-meta");a.filter=new odf.OdfNodeFilter;b+=a.writeToString(C.rootElement.meta,odf.Namespaces.namespaceMap);return b+"</office:document-meta>"}function Z(a,b){var c=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:file-entry");c.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:full-path",a);c.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0",
"manifest:media-type",b);return c}function O(){var a=runtime.parseXML('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2"></manifest:manifest>'),b=a.documentElement,c=new xmldom.LSSerializer,e;for(e in T)T.hasOwnProperty(e)&&b.appendChild(Z(e,T[e]));c.filter=new odf.OdfNodeFilter;return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+c.writeToString(a,odf.Namespaces.namespaceMap)}function G(){var a,b,c,e=odf.Namespaces.namespaceMap,
g=new xmldom.LSSerializer,f=t("document-styles");b=s(C.rootElement.automaticStyles,"document-styles");c=C.rootElement.masterStyles.cloneNode(!0);a=w(C.rootElement.fontFaceDecls,[c,C.rootElement.styles,b]);d.removePrefixFromStyleNames(b,r,c);g.filter=new k(c,b);f+=g.writeToString(a,e);f+=g.writeToString(C.rootElement.styles,e);f+=g.writeToString(b,e);f+=g.writeToString(c,e);return f+"</office:document-styles>"}function S(){var a,c,e=odf.Namespaces.namespaceMap,d=new xmldom.LSSerializer,g=t("document-content");
c=s(C.rootElement.automaticStyles,"document-content");a=w(C.rootElement.fontFaceDecls,[c]);d.filter=new b(C.rootElement.body,c);g+=d.writeToString(a,e);g+=d.writeToString(c,e);g+=d.writeToString(C.rootElement.body,e);return g+"</office:document-content>"}function $(b,c){runtime.loadXML(b,function(b,e){if(b)c(b);else if(e){E(e);Y(e.documentElement);var d=x(e);d&&"document"===d.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===d.namespaceURI?(I(d),B(a.DONE)):B(a.INVALID)}else c("No DOM was loaded.")})}
function D(a,b){var e;e=C.rootElement;var d=e.meta;d||(e.meta=d=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),c(e,d));e=d;a&&l.mapKeyValObjOntoNode(e,a,odf.Namespaces.lookupNamespaceURI);b&&l.removeKeyElementsFromNode(e,b,odf.Namespaces.lookupNamespaceURI)}function R(b,c){function e(a,b){var c;b||(b=a);c=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",b);q[a]=c;q.appendChild(c)}var d=new core.Zip("",null),g="application/vnd.oasis.opendocument."+
b+(!0===c?"-template":""),f=runtime.byteArrayFromString(g,"utf8"),q=C.rootElement,l=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",b);d.save("mimetype",f,!1,new Date);e("meta");e("settings");e("scripts");e("fontFaceDecls","font-face-decls");e("styles");e("automaticStyles","automatic-styles");e("masterStyles","master-styles");e("body");q.body.appendChild(l);T["/"]=g;T["settings.xml"]="text/xml";T["meta.xml"]="text/xml";T["styles.xml"]="text/xml";T["content.xml"]="text/xml";
B(a.DONE);return d}function aa(){var a,b=new Date,c="";C.rootElement.settings&&C.rootElement.settings.firstElementChild&&(a=new xmldom.LSSerializer,c=t("document-settings"),a.filter=new odf.OdfNodeFilter,c+=a.writeToString(C.rootElement.settings,odf.Namespaces.namespaceMap),c+="</office:document-settings>");(a=c)?(a=runtime.byteArrayFromString(a,"utf8"),U.save("settings.xml",a,!0,b)):U.remove("settings.xml");c=runtime.getWindow();a="WebODF/"+webodf.Version;c&&(a=a+" "+c.navigator.userAgent);D({"meta:generator":a},
null);a=runtime.byteArrayFromString(W(),"utf8");U.save("meta.xml",a,!0,b);a=runtime.byteArrayFromString(G(),"utf8");U.save("styles.xml",a,!0,b);a=runtime.byteArrayFromString(S(),"utf8");U.save("content.xml",a,!0,b);a=runtime.byteArrayFromString(O(),"utf8");U.save("META-INF/manifest.xml",a,!0,b)}function ea(a,b){aa();U.writeAs(a,function(a){b(a)})}var C=this,U,T={},ia,P="";this.onstatereadychange=f;this.state=this.onchange=null;this.getMetadata=z;this.setRootElement=I;this.getContentElement=function(){var a;
ia||(a=C.rootElement.body,ia=l.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","text")||l.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","presentation")||l.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","spreadsheet"));if(!ia)throw"Could not find content element in <office:body/>.";return ia};this.getDocumentType=function(){var a=C.getContentElement();return a&&a.localName};this.isTemplate=function(){return"-template"===T["/"].substr(-9)};
this.setIsTemplate=function(a){var b=T["/"],c="-template"===b.substr(-9);a!==c&&(b=a?b+"-template":b.substr(0,b.length-9),T["/"]=b,a=runtime.byteArrayFromString(b,"utf8"),U.save("mimetype",a,!1,new Date))};this.getPart=function(a){return new odf.OdfPart(a,T[a],C,U)};this.getPartData=function(a,b){U.load(a,b)};this.setMetadata=D;this.incrementEditingCycles=function(){var a=z(odf.Namespaces.metans,"editing-cycles"),a=a?parseInt(a,10):0;isNaN(a)&&(a=0);D({"meta:editing-cycles":a+1},null);return a+1};
this.createByteArray=function(a,b){aa();U.createByteArray(a,b)};this.saveAs=ea;this.save=function(a){ea(P,a)};this.getUrl=function(){return P};this.setBlob=function(a,b,c){c=m.convertBase64ToByteArray(c);U.save(a,c,!1,new Date);T.hasOwnProperty(a)&&runtime.log(a+" has been overwritten.");T[a]=b};this.removeBlob=function(a){var b=U.remove(a);runtime.assert(b,"file is not found: "+a);delete T[a]};this.state=a.LOADING;this.rootElement=function(a){var b=document.createElementNS(a.namespaceURI,a.localName),
c;a=new a.Type;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}({Type:odf.ODFDocumentElement,namespaceURI:odf.ODFDocumentElement.namespaceURI,localName:odf.ODFDocumentElement.localName});e===odf.OdfContainer.DocumentType.TEXT?U=R("text"):e===odf.OdfContainer.DocumentType.TEXT_TEMPLATE?U=R("text",!0):e===odf.OdfContainer.DocumentType.PRESENTATION?U=R("presentation"):e===odf.OdfContainer.DocumentType.PRESENTATION_TEMPLATE?U=R("presentation",!0):e===odf.OdfContainer.DocumentType.SPREADSHEET?U=R("spreadsheet"):
e===odf.OdfContainer.DocumentType.SPREADSHEET_TEMPLATE?U=R("spreadsheet",!0):(P=e,U=new core.Zip(P,function(b,c){U=c;b?$(P,function(c){b&&(U.error=b+"\n"+c,B(a.INVALID))}):V([{path:"styles.xml",handler:F},{path:"content.xml",handler:H},{path:"meta.xml",handler:A},{path:"settings.xml",handler:J},{path:"META-INF/manifest.xml",handler:L}])}))};odf.OdfContainer.EMPTY=0;odf.OdfContainer.LOADING=1;odf.OdfContainer.DONE=2;odf.OdfContainer.INVALID=3;odf.OdfContainer.SAVING=4;odf.OdfContainer.MODIFIED=5;odf.OdfContainer.getContainer=
function(a){return new odf.OdfContainer(a,null)}})();odf.OdfContainer.DocumentType={TEXT:1,TEXT_TEMPLATE:2,PRESENTATION:3,PRESENTATION_TEMPLATE:4,SPREADSHEET:5,SPREADSHEET_TEMPLATE:6};gui.AnnotatableCanvas=function(){};gui.AnnotatableCanvas.prototype.refreshSize=function(){};gui.AnnotatableCanvas.prototype.getZoomLevel=function(){};gui.AnnotatableCanvas.prototype.getSizer=function(){};
gui.AnnotationViewManager=function(f,k,b,c){function d(a){var b=a.annotationEndElement,c=m.createRange(),d=a.getAttributeNS(odf.Namespaces.officens,"name");b&&(c.setStart(a,a.childNodes.length),c.setEnd(b,0),a=h.getTextNodes(c,!1),a.forEach(function(a){var b;a:{for(b=a.parentNode;b.namespaceURI!==odf.Namespaces.officens||"body"!==b.localName;){if(b.namespaceURI===e&&"webodf-annotationHighlight"===b.className&&b.getAttribute("annotation")===d){b=!0;break a}b=b.parentNode}b=!1}b||(b=m.createElement("span"),
b.className="webodf-annotationHighlight",b.setAttribute("annotation",d),a.parentNode.replaceChild(b,a),b.appendChild(a))}));c.detach()}function l(c){var e=f.getSizer();c?(b.style.display="inline-block",e.style.paddingRight=a.getComputedStyle(b).width):(b.style.display="none",e.style.paddingRight=0);f.refreshSize()}function n(){r.sort(function(a,b){return 0!==(a.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_FOLLOWING)?-1:1})}function p(){var a;for(a=0;a<r.length;a+=1){var c=r[a],e=c.parentNode,
d=e.nextElementSibling,h=d.nextElementSibling,l=e.parentNode,m=0,m=r[r.indexOf(c)-1],n=void 0,c=f.getZoomLevel();e.style.left=(b.getBoundingClientRect().left-l.getBoundingClientRect().left)/c+"px";e.style.width=b.getBoundingClientRect().width/c+"px";d.style.width=parseFloat(e.style.left)-30+"px";m&&(n=m.parentNode.getBoundingClientRect(),20>=(l.getBoundingClientRect().top-n.bottom)/c?e.style.top=Math.abs(l.getBoundingClientRect().top-n.bottom)/c+20+"px":e.style.top="0px");h.style.left=d.getBoundingClientRect().width/
c+"px";var d=h.style,l=h.getBoundingClientRect().left/c,m=h.getBoundingClientRect().top/c,n=e.getBoundingClientRect().left/c,p=e.getBoundingClientRect().top/c,k=0,I=0,k=n-l,k=k*k,I=p-m,I=I*I,l=Math.sqrt(k+I);d.width=l+"px";m=Math.asin((e.getBoundingClientRect().top-h.getBoundingClientRect().top)/(c*parseFloat(h.style.width)));h.style.transform="rotate("+m+"rad)";h.style.MozTransform="rotate("+m+"rad)";h.style.WebkitTransform="rotate("+m+"rad)";h.style.msTransform="rotate("+m+"rad)"}}var r=[],m=k.ownerDocument,
h=odf.OdfUtils,a=runtime.getWindow(),e="http://www.w3.org/1999/xhtml";runtime.assert(Boolean(a),"Expected to be run in an environment which has a global window, like a browser.");this.rerenderAnnotations=p;this.rehighlightAnnotations=function(){r.forEach(function(a){d(a)})};this.getMinimumHeightForAnnotationPane=function(){return"none"!==b.style.display&&0<r.length?(r[r.length-1].parentNode.getBoundingClientRect().bottom-b.getBoundingClientRect().top)/f.getZoomLevel()+"px":null};this.addAnnotation=
function(a){l(!0);r.push(a);n();var b=m.createElement("div"),e=m.createElement("div"),f=m.createElement("div"),k=m.createElement("div"),v;b.className="annotationWrapper";b.setAttribute("creator",h.getAnnotationCreator(a));a.parentNode.insertBefore(b,a);e.className="annotationNote";e.appendChild(a);c&&(v=m.createElement("div"),v.className="annotationRemoveButton",e.appendChild(v));f.className="annotationConnector horizontal";k.className="annotationConnector angular";b.appendChild(e);b.appendChild(f);
b.appendChild(k);a.annotationEndElement&&d(a);p()};this.forgetAnnotations=function(){for(;r.length;){var a=r[0],b=r.indexOf(a),c=a.parentNode.parentNode;"div"===c.localName&&(c.parentNode.insertBefore(a,c),c.parentNode.removeChild(c));for(var a=a.getAttributeNS(odf.Namespaces.officens,"name"),a=m.querySelectorAll('span.webodf-annotationHighlight[annotation="'+a+'"]'),e=c=void 0,c=0;c<a.length;c+=1){for(e=a.item(c);e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.parentNode.removeChild(e)}-1!==
b&&r.splice(b,1);0===r.length&&l(!1)}}};gui.Viewport=function(){};gui.Viewport.prototype.scrollIntoView=function(f,k){};gui.SingleScrollViewport=function(f){this.scrollIntoView=function(k,b){var c,d,l,n;n=f.offsetHeight-f.clientHeight;l=f.offsetWidth-f.clientWidth;var p=f.getBoundingClientRect();if(k&&p){c=p.left+5;d=p.top+5;l=p.right-(l+5);n=p.bottom-(n+5);if(b||k.top<d)f.scrollTop-=d-k.top;else if(k.top>n||k.bottom>n)f.scrollTop=k.bottom-k.top<=n-d?f.scrollTop+(k.bottom-n):f.scrollTop+(k.top-d);k.left<c?f.scrollLeft-=c-k.left:k.right>l&&(f.scrollLeft=k.right-k.left<=l-c?f.scrollLeft+(k.right-l):f.scrollLeft-(c-k.left))}}};(function(){function f(b,l,n,k,r){var m,h=0,a;for(a in b)if(b.hasOwnProperty(a)){if(h===n){m=a;break}h+=1}m?l.getPartData(b[m].href,function(a,h){if(a)runtime.log(a);else if(h){var g="@font-face { font-family: "+(b[m].family||m)+"; src: url(data:application/x-font-ttf;charset=binary;base64,"+c.convertUTF8ArrayToBase64(h)+') format("truetype"); }';try{k.insertRule(g,k.cssRules.length)}catch(y){runtime.log("Problem inserting rule in CSS: "+runtime.toJson(y)+"\nRule: "+g)}}else runtime.log("missing font data for "+
b[m].href);f(b,l,n+1,k,r)}):r&&r()}var k=xmldom.XPath,b=odf.OdfUtils,c=new core.Base64;odf.FontLoader=function(){this.loadFonts=function(c,l){for(var n=c.rootElement.fontFaceDecls;l.cssRules.length;)l.deleteRule(l.cssRules.length-1);if(n){var p={},r,m,h,a;if(n)for(n=k.getODFElementsWithXPath(n,"style:font-face[svg:font-face-src]",odf.Namespaces.lookupNamespaceURI),r=0;r<n.length;r+=1)m=n[r],h=m.getAttributeNS(odf.Namespaces.stylens,"name"),a=b.getNormalizedFontFamilyName(m.getAttributeNS(odf.Namespaces.svgns,
"font-family")),m=k.getODFElementsWithXPath(m,"svg:font-face-src/svg:font-face-uri",odf.Namespaces.lookupNamespaceURI),0<m.length&&(m=m[0].getAttributeNS(odf.Namespaces.xlinkns,"href"),p[h]={href:m,family:a});f(p,c,0,l)}}}})();odf.Formatting=function(){function f(a){return(a=B[a])?w.mergeObjects({},a):{}}function k(){for(var b=a.rootElement.fontFaceDecls,c={},e,d,b=b&&b.firstElementChild;b;){if(e=b.getAttributeNS(g,"name"))if((d=b.getAttributeNS(q,"font-family"))||0<b.getElementsByTagNameNS(q,"font-face-uri").length)c[e]=d;b=b.nextElementSibling}return c}function b(b){for(var c=a.rootElement.styles.firstElementChild;c;){if(c.namespaceURI===g&&"default-style"===c.localName&&c.getAttributeNS(g,"family")===b)return c;c=c.nextElementSibling}return null}
function c(b,c,e){var d,f,h;e=e||[a.rootElement.automaticStyles,a.rootElement.styles];for(h=0;h<e.length;h+=1)for(d=e[h],d=d.firstElementChild;d;){f=d.getAttributeNS(g,"name");if(d.namespaceURI===g&&"style"===d.localName&&d.getAttributeNS(g,"family")===c&&f===b||"list-style"===c&&d.namespaceURI===y&&"list-style"===d.localName&&f===b||"data"===c&&d.namespaceURI===u&&f===b)return d;d=d.nextElementSibling}return null}function d(a){for(var b,c,e,d,f={},h=a.firstElementChild;h;){if(h.namespaceURI===g)for(e=
f[h.nodeName]={},c=h.attributes,b=0;b<c.length;b+=1)d=c.item(b),e[d.name]=d.value;h=h.nextElementSibling}c=a.attributes;for(b=0;b<c.length;b+=1)d=c.item(b),f[d.name]=d.value;return f}function l(e,h){for(var q=a.rootElement.styles,l,m={},n=e.getAttributeNS(g,"family"),k=e;k;)l=d(k),m=w.mergeObjects(l,m),k=(l=k.getAttributeNS(g,"parent-style-name"))?c(l,n,[q]):null;if(k=b(n))l=d(k),m=w.mergeObjects(l,m);!1!==h&&(l=f(n),m=w.mergeObjects(l,m));return m}function n(a,b){function c(a){Object.keys(a).forEach(function(b){Object.keys(a[b]).forEach(function(a){h+=
"|"+b+":"+a+"|"})})}for(var d=a.nodeType===Node.TEXT_NODE?a.parentNode:a,g,f=[],h="",q=!1;d;)!q&&v.isGroupingElement(d)&&(q=!0),(g=e.determineStylesForNode(d))&&f.push(g),d=d.parentNode;q&&(f.forEach(c),b&&(b[h]=f));return q?f:void 0}function p(b){var e={orderedStyles:[],styleProperties:{}};b.forEach(function(b){Object.keys(b).forEach(function(d){var f=Object.keys(b[d])[0],h={name:f,family:d,displayName:void 0,isCommonStyle:!1},q;(q=c(f,d))?(d=l(q),e.styleProperties=w.mergeObjects(d,e.styleProperties),
h.displayName=q.getAttributeNS(g,"display-name")||void 0,h.isCommonStyle=q.parentNode===a.rootElement.styles):runtime.log("No style element found for '"+f+"' of family '"+d+"'");e.orderedStyles.push(h)})});return e}function r(a,b){var c={},e=[];b||(b={});a.forEach(function(a){n(a,c)});Object.keys(c).forEach(function(a){b[a]||(b[a]=p(c[a]));e.push(b[a])});return e}function m(b){for(var c=a.rootElement.masterStyles.firstElementChild;c&&(c.namespaceURI!==g||"master-page"!==c.localName||c.getAttributeNS(g,
"name")!==b);)c=c.nextElementSibling;return c}function h(a,b){var c;a&&(c=x.convertMeasure(a,"px"));void 0===c&&b&&(c=x.convertMeasure(b,"px"));return c}var a,e=new odf.StyleInfo,q=odf.Namespaces.svgns,g=odf.Namespaces.stylens,y=odf.Namespaces.textns,u=odf.Namespaces.numberns,z=odf.Namespaces.fons,v=odf.OdfUtils,s=core.DomUtils,w=new core.Utils,x=new core.CSSUnits,B={paragraph:{"style:paragraph-properties":{"fo:text-align":"left"}}};this.getSystemDefaultStyleAttributes=f;this.setOdfContainer=function(b){a=
b};this.getFontMap=k;this.getAvailableParagraphStyles=function(){for(var b=a.rootElement.styles,c,e,d=[],b=b&&b.firstElementChild;b;)"style"===b.localName&&b.namespaceURI===g&&(c=b.getAttributeNS(g,"family"),"paragraph"===c&&(c=b.getAttributeNS(g,"name"),e=b.getAttributeNS(g,"display-name")||c,c&&e&&d.push({name:c,displayName:e}))),b=b.nextElementSibling;return d};this.isStyleUsed=function(b){var c,d=a.rootElement;c=e.hasDerivedStyles(d,odf.Namespaces.lookupNamespaceURI,b);b=(new e.UsedStyleList(d.styles)).uses(b)||
(new e.UsedStyleList(d.automaticStyles)).uses(b)||(new e.UsedStyleList(d.body)).uses(b);return c||b};this.getDefaultStyleElement=b;this.getStyleElement=c;this.getStyleAttributes=d;this.getInheritedStyleAttributes=l;this.getFirstCommonParentStyleNameOrSelf=function(b){var e=a.rootElement.styles,d;if(d=c(b,"paragraph",[a.rootElement.automaticStyles]))if(b=d.getAttributeNS(g,"parent-style-name"),!b)return null;return(d=c(b,"paragraph",[e]))?b:null};this.hasParagraphStyle=function(a){return Boolean(c(a,
"paragraph"))};this.getAppliedStyles=r;this.getAppliedStylesForElement=function(a,b){return r([a],b)[0]};this.updateStyle=function(b,c){var e,d;s.mapObjOntoNode(b,c,odf.Namespaces.lookupNamespaceURI);(e=(e=c["style:text-properties"])&&e["style:font-name"])&&!k().hasOwnProperty(e)&&(d=b.ownerDocument.createElementNS(g,"style:font-face"),d.setAttributeNS(g,"style:name",e),d.setAttributeNS(q,"svg:font-family",e),a.rootElement.fontFaceDecls.appendChild(d))};this.createDerivedStyleObject=function(b,e,
g){var f=c(b,e);runtime.assert(Boolean(f),"No style element found for '"+b+"' of family '"+e+"'");b=f.parentNode===a.rootElement.styles?{"style:parent-style-name":b}:d(f);b["style:family"]=e;w.mergeObjects(b,g);return b};this.getDefaultTabStopDistance=function(){for(var a=b("paragraph"),a=a&&a.firstElementChild,c;a;)a.namespaceURI===g&&"paragraph-properties"===a.localName&&(c=a.getAttributeNS(g,"tab-stop-distance")),a=a.nextElementSibling;c||(c="1.25cm");return v.parseNonNegativeLength(c)};this.getMasterPageElement=
m;this.getContentSize=function(b,e){var d,f,q,l,n,k,p,r,t,y;a:{f=c(b,e);runtime.assert("paragraph"===e||"table"===e,"styleFamily must be either paragraph or table");if(f){if(f=f.getAttributeNS(g,"master-page-name"))(d=m(f))||runtime.log("WARN: No master page definition found for "+f);d||(d=m("Standard"));d||(d=a.rootElement.masterStyles.getElementsByTagNameNS(g,"master-page")[0])||runtime.log("WARN: Document has no master pages defined");if(d)for(f=d.getAttributeNS(g,"page-layout-name"),q=a.rootElement.automaticStyles.getElementsByTagNameNS(g,
"page-layout"),l=0;l<q.length;l+=1)if(d=q.item(l),d.getAttributeNS(g,"name")===f)break a}d=null}d||(d=s.getDirectChild(a.rootElement.styles,g,"default-page-layout"));(d=s.getDirectChild(d,g,"page-layout-properties"))?("landscape"===d.getAttributeNS(g,"print-orientation")?(f="29.7cm",q="21.001cm"):(f="21.001cm",q="29.7cm"),f=h(d.getAttributeNS(z,"page-width"),f),q=h(d.getAttributeNS(z,"page-height"),q),l=h(d.getAttributeNS(z,"margin")),void 0===l?(l=h(d.getAttributeNS(z,"margin-left"),"2cm"),n=h(d.getAttributeNS(z,
"margin-right"),"2cm"),k=h(d.getAttributeNS(z,"margin-top"),"2cm"),p=h(d.getAttributeNS(z,"margin-bottom"),"2cm")):l=n=k=p=l,r=h(d.getAttributeNS(z,"padding")),void 0===r?(r=h(d.getAttributeNS(z,"padding-left"),"0cm"),t=h(d.getAttributeNS(z,"padding-right"),"0cm"),y=h(d.getAttributeNS(z,"padding-top"),"0cm"),d=h(d.getAttributeNS(z,"padding-bottom"),"0cm")):r=t=y=d=r):(f=h("21.001cm"),q=h("29.7cm"),l=n=k=p=l=h("2cm"),r=t=y=d=r=h("0cm"));return{width:f-l-n-r-t,height:q-k-p-y-d}}};(function(){var f=odf.Namespaces.stylens,k=odf.Namespaces.textns,b={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"};odf.StyleTreeNode=function(b){this.derivedStyles={};this.element=b};odf.StyleTree=function(c,d){function l(b){var a,c,d,g={};if(!b)return g;for(b=b.firstElementChild;b;){if(c=b.namespaceURI!==f||"style"!==b.localName&&
"default-style"!==b.localName?b.namespaceURI===k&&"list-style"===b.localName?"list":b.namespaceURI!==f||"page-layout"!==b.localName&&"default-page-layout"!==b.localName?void 0:"page":b.getAttributeNS(f,"family"))(a=b.getAttributeNS(f,"name"))||(a=""),g.hasOwnProperty(c)?d=g[c]:g[c]=d={},d[a]=b;b=b.nextElementSibling}return g}function n(b,a){if(b.hasOwnProperty(a))return b[a];var c=null,d=Object.keys(b),g;for(g=0;g<d.length&&!(c=n(b[d[g]].derivedStyles,a));g+=1);return c}function p(b,a,c){var d,g,
l;if(!a.hasOwnProperty(b))return null;d=new odf.StyleTreeNode(a[b]);g=d.element.getAttributeNS(f,"parent-style-name");l=null;g&&(l=n(c,g)||p(g,a,c));l?l.derivedStyles[b]=d:c[b]=d;delete a[b];return d}function r(b,a){b&&Object.keys(b).forEach(function(c){p(c,b,a)})}var m={};this.getStyleTree=function(){return m};(function(){var f,a,e;a=l(c);e=l(d);Object.keys(b).forEach(function(b){f=m[b]={};r(a[b],f);r(e[b],f)})})()}})();(function(){function f(b,c){try{b.insertRule(c,b.cssRules.length)}catch(d){runtime.log("cannot load rule: "+c+" - "+d)}}function k(b,c){this.listCounterCount=0;this.contentRules=b;this.counterIdStack=[];this.continuedCounterIdStack=c}function b(b){function c(e,d,h,n){var k=d.namespaceURI===l&&"list"===d.localName,p=d.namespaceURI===l&&"list-item"===d.localName;if(k||p){if(k){var k=h+=1,s,w,x;n.listCounterCount+=1;p=e+"-level"+k+"-"+n.listCounterCount;d.setAttributeNS("urn:webodf:names:helper","counter-id",
p);s=n.continuedCounterIdStack.shift();s||(s=p,a+=p+" 1 ",w='text|list[webodfhelper|counter-id="'+p+'"] > text|list-item:first-child > :not(text|list):first-child:before',w+="{",w+="counter-increment: "+s+" 0;",w+="}",f(b,w));for(;n.counterIdStack.length>=k;)n.counterIdStack.pop();n.counterIdStack.push(s);x=n.contentRules[k.toString()]||"";for(w=1;w<=k;w+=1)x=x.replace(w+"webodf-listLevel",n.counterIdStack[w-1]);w='text|list[webodfhelper|counter-id="'+p+'"] > text|list-item > :not(text|list):first-child:before';
w+="{";w+=x;w+="counter-increment: "+s+";";w+="}";f(b,w)}for(d=d.firstElementChild;d;)c(e,d,h,n),d=d.nextElementSibling}else n.continuedCounterIdStack=[]}var d=0,a="",e={};this.createCounterRules=function(a,b,f){var l=b.getAttributeNS(n,"id"),p=[];f&&(f=f.getAttributeNS("urn:webodf:names:helper","counter-id"),p=e[f].slice(0));a=new k(a,p);l?l="Y"+l:(d+=1,l="X"+d);c(l,b,0,a);e[l+"-level1-1"]=a.counterIdStack};this.initialiseCreatedCounters=function(){var c;c="office|document{"+("counter-reset: "+a+
";");c+="}";f(b,c)}}var c=odf.Namespaces.fons,d=odf.Namespaces.stylens,l=odf.Namespaces.textns,n=odf.Namespaces.xmlns,p={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"};odf.ListStyleToCss=function(){function k(a){var b=q.parseLength(a);return b?e.convert(b.value,b.unit,"px"):(runtime.log("Could not parse value '"+a+"'."),0)}function m(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function h(a,b){var c;a&&(c=a.getAttributeNS(l,"style-name"));return c===b}function a(a,
c,e){c=c.getElementsByTagNameNS(l,"list");a=new b(a);var f,q,k,r,x,B,I={},F;for(F=0;F<c.length;F+=1)if(f=c.item(F),B=f.getAttributeNS(l,"style-name")){k=f.getAttributeNS(l,"continue-numbering");r=f.getAttributeNS(l,"continue-list");(x=f.getAttributeNS(n,"id"))&&(I[x]=f);x=e[B].element.firstElementChild;for(var H=void 0,A={};x;){var H=(H=x.getAttributeNS(l,"level"))&&parseInt(H,10),J=A,L=x,Q="",E=void 0,Y=void 0,V=E=void 0;if("list-level-style-number"===L.localName){var t=L,Q=t.getAttributeNS(d,"num-format"),
E=t.getAttributeNS(d,"num-suffix")||"",Y=t.getAttributeNS(d,"num-prefix")||"",W="",Z=t.getAttributeNS(l,"level"),t=t.getAttributeNS(l,"display-levels");Y&&(W+='"'+m(Y)+'"\n');if(p.hasOwnProperty(Q))for(Z=Z?parseInt(Z,10):1,t=t?parseInt(t,10):1;0<t;)W+=" counter("+(Z-t+1)+"webodf-listLevel,"+p[Q]+")",1<t&&(W+='"."'),t-=1;else W=Q?W+(' "'+Q+'"'):W+' ""';Q="content:"+W+' "'+m(E)+'"'}else"list-level-style-image"===L.localName?Q="content: none":"list-level-style-bullet"===L.localName&&(Q=L.getAttributeNS(l,
"bullet-char"),Q='content: "'+m(Q)+'"');if(E=L.getElementsByTagNameNS(d,"list-level-properties")[0])Y=E.getAttributeNS(l,"list-level-position-and-space-mode"),"label-alignment"===Y&&((E=E.getElementsByTagNameNS(d,"list-level-label-alignment")[0])&&(V=E.getAttributeNS(l,"label-followed-by")),"space"===V&&(Q+=' "\\a0"'));J[H]="\n"+Q+";\n";x=x.nextElementSibling}x=A;k&&!r&&h(q,B)?a.createCounterRules(x,f,q):r&&h(I[r],B)?a.createCounterRules(x,f,I[r]):a.createCounterRules(x,f);q=f}a.initialiseCreatedCounters()}
var e=new core.CSSUnits,q=odf.OdfUtils;this.applyListStyles=function(b,e,h){var q,m;(q=e.list)&&Object.keys(q).forEach(function(a){m=q[a];for(var e=m.element.firstElementChild;e;){if(e.namespaceURI===l){for(var h=b,n=e,p='text|list[text|style-name="'+a+'"]',y=n.getAttributeNS(l,"level"),u=void 0,A=void 0,J=A=void 0,L=void 0,Q=void 0,E=u=void 0,Y=void 0,V=void 0,t=void 0,L=void 0,J=(A=n.getElementsByTagNameNS(d,"list-level-properties")[0])&&A.getAttributeNS(l,"list-level-position-and-space-mode"),
L=A&&A.getElementsByTagNameNS(d,"list-level-label-alignment")[0],u=y=y&&parseInt(y,10);1<u;)p+=" > text|list-item > text|list",u-=1;u=A&&A.getAttributeNS(c,"text-align")||"left";switch(u){case "end":u="right";break;case "start":u="left"}"label-alignment"===J?(Q=L&&L.getAttributeNS(c,"margin-left")||"0px",V=L&&L.getAttributeNS(c,"text-indent")||"0px",t=L&&L.getAttributeNS(l,"label-followed-by"),L=k(Q)):(Q=A&&A.getAttributeNS(l,"space-before")||"0px",E=A&&A.getAttributeNS(l,"min-label-width")||"0px",
Y=A&&A.getAttributeNS(l,"min-label-distance")||"0px",L=k(Q)+k(E));A=p+" > text|list-item";A+="{";A+="margin-left: "+L+"px;";A+="}";f(h,A);A=p+" > text|list-item > text|list";A+="{";A+="margin-left: "+-L+"px;";A+="}";f(h,A);A=p+" > text|list-item > :not(text|list):first-child:before";A+="{";A+="text-align: "+u+";";A+="display: inline-block;";"label-alignment"===J?(A+="margin-left: "+V+";","listtab"===t&&(A+="padding-right: 0.2cm;")):(A+="min-width: "+E+";",A+="margin-left: "+(0===parseFloat(E)?"":
"-")+E+";",A+="padding-right: "+Y+";");A+="}";f(h,A)}e=e.nextElementSibling}});a(b,h,q)}}})();odf.LazyStyleProperties=function(f,k){var b={};this.value=function(c){var d;b.hasOwnProperty(c)?d=b[c]:(d=k[c](),void 0===d&&f&&(d=f.value(c)),b[c]=d);return d};this.reset=function(c){f=c;b={}}};
odf.StyleParseUtils=function(){function f(b){var c,d;b=(b=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px))/.exec(b))?{value:parseFloat(b[1]),unit:b[3]}:null;d=b&&b.unit;"px"===d?c=b.value:"cm"===d?c=96*(b.value/2.54):"mm"===d?c=96*(b.value/25.4):"in"===d?c=96*b.value:"pt"===d?c=b.value/0.75:"pc"===d&&(c=16*b.value);return c}var k=odf.Namespaces.stylens;this.parseLength=f;this.parsePositiveLengthOrPercent=function(b,c,d){var l;b&&(l=parseFloat(b.substr(0,
b.indexOf("%"))),isNaN(l)&&(l=void 0));var n;void 0!==l?(d&&(n=d.value(c)),l=void 0===n?void 0:l*(n/100)):l=f(b);return l};this.getPropertiesElement=function(b,c,d){for(c=d?d.nextElementSibling:c.firstElementChild;null!==c&&(c.localName!==b||c.namespaceURI!==k);)c=c.nextElementSibling;return c};this.parseAttributeList=function(b){b&&(b=b.replace(/^\s*(.*?)\s*$/g,"$1"));return b&&0<b.length?b.split(/\s+/):[]}};odf.Style2CSS=function(){function f(a,b,c){var e=[];c=c.derivedStyles;var d;var g=z[a],h;void 0===g?b=null:(h=b?"["+g+'|style-name="'+b+'"]':"","presentation"===g&&(g="draw",h=b?'[presentation|style-name="'+b+'"]':""),b=g+"|"+v[a].join(h+","+g+"|")+h);null!==b&&e.push(b);for(d in c)c.hasOwnProperty(d)&&(b=f(a,d,c[d]),e=e.concat(b));return e}function k(a){var b="",c="",b=null;if("default-style"===a.localName)return null;b=a.getAttributeNS(h,"parent-style-name");c=a.getAttributeNS(h,"family");return b=
O.getODFElementsWithXPath(W,b?"//style:*[@style:name='"+b+"'][@style:family='"+c+"']":"//style:default-style[@style:family='"+c+"']",odf.Namespaces.lookupNamespaceURI)[0]}function b(a,b){var c="",e,d,g;for(e=0;e<b.length;e+=1)if(d=b[e],g=a.getAttributeNS(d[0],d[1])){g=g.trim();if(Q.hasOwnProperty(d[1])){var f=g,q=f.indexOf(" "),l=void 0;g=void 0;-1!==q?(l=f.substring(0,q),g=f.substring(q)):(l=f,g="");(l=V.parseLength(l))&&"pt"===l.unit&&0.75>l.value&&(f="0.75pt"+g);g=f}else if(E.hasOwnProperty(d[1])){var f=
a,q=d[0],l=d[1],m=V.parseLength(g),n=void 0,p=void 0,r=void 0,L=void 0,r=void 0;if(m&&"%"===m.unit){n=m.value/100;p=k(f.parentNode);for(L="0";p;){if(r=y.getDirectChild(p,h,"paragraph-properties"))if(r=V.parseLength(r.getAttributeNS(q,l))){if("%"!==r.unit){L=r.value*n+r.unit;break}n*=r.value/100}p=k(p)}g=L}}d[2]&&(c+=d[2]+":"+g+";")}return c}function c(a,b,c,e){return b+b+c+c+e+e}function d(a,b){var c=[a],e=b.derivedStyles;Object.keys(e).forEach(function(a){a=d(a,e[a]);c=c.concat(a)});return c}function l(a,
b,c,e){function f(b,c){var e=[],d;b.forEach(function(a){h.forEach(function(b){e.push("draw|page[webodfhelper|page-style-name='"+b+"'] draw|frame[presentation|class='"+a+"']")})});0<e.length&&(d=e.join(",")+"{visibility:"+c+";}",a.insertRule(d,a.cssRules.length))}var h=d(b,e),q=[],l=[];["page-number","date-time","header","footer"].forEach(function(a){var b;b=c.getAttributeNS(g,"display-"+a);"true"===b?q.push(a):"false"===b&&l.push(a)});f(q,"visible");f(l,"hidden")}function n(a,d,E,Q){var v,z;if("page"===
d){var C=Q.element,W="",T,O;O=T="";E=y.getDirectChild(C,h,"page-layout-properties");var P;if(E)if(P=C.getAttributeNS(h,"name"),W+=b(E,J),(T=y.getDirectChild(E,h,"background-image"))&&(O=T.getAttributeNS(q,"href"))&&(W=W+("background-image: url('odfkit:"+O+"');")+b(T,w)),"presentation"===t)for(C=(C=y.getDirectChild(C.parentNode.parentNode,m,"master-styles"))&&C.firstElementChild;C;)C.namespaceURI===h&&"master-page"===C.localName&&C.getAttributeNS(h,"page-layout-name")===P&&(O=C.getAttributeNS(h,"name"),
T="draw|page[draw|master-page-name="+O+"] {"+W+"}",O="office|body, draw|page[draw|master-page-name="+O+"] {"+b(E,L)+" }",a.insertRule(T,a.cssRules.length),a.insertRule(O,a.cssRules.length)),C=C.nextElementSibling;else"text"===t&&(T="office|text {"+W+"}",O="office|body {width: "+E.getAttributeNS(r,"page-width")+";}",a.insertRule(T,a.cssRules.length),a.insertRule(O,a.cssRules.length))}else{W=f(d,E,Q).join(",");P="";if(C=y.getDirectChild(Q.element,h,"text-properties")){var N=C,fa=z="";T="";O=1;C=""+
b(N,s);v=N.getAttributeNS(h,"text-underline-style");"solid"===v&&(z+=" underline");v=N.getAttributeNS(h,"text-line-through-style");"solid"===v&&(z+=" line-through");z.length&&(C=C+("text-decoration:"+z+";\n")+("text-decoration-line:"+z+";\n"),C+="-moz-text-decoration-line:"+z+";\n");v=N.getAttributeNS(h,"text-line-through-type");switch(v){case "double":fa+=" double";break;case "single":fa+=" single"}fa&&(C+="text-decoration-style:"+fa+";\n",C+="-moz-text-decoration-style:"+fa+";\n");if(z=N.getAttributeNS(h,
"font-name")||N.getAttributeNS(r,"font-family"))v=Y[z],C+="font-family: "+(v||z)+";";if(v=N.getAttributeNS(h,"text-position"))z=u.parseAttributeList(v),v=z[0],z=z[1],C+="vertical-align: "+v+"\n; ",z&&(O=parseFloat(z)/100);if(N.hasAttributeNS(r,"font-size")||1!==O){for(N=N.parentNode;N;){if(v=(v=y.getDirectChild(N,h,"text-properties"))?V.parseFoFontSize(v.getAttributeNS(r,"font-size")):null){if("%"!==v.unit){T="font-size: "+v.value*O+v.unit+";";break}O*=v.value/100}N=k(N)}T||(T="font-size: "+parseFloat(Z)*
O+G.getUnits(Z)+";")}C+=T;P+=C}if(C=y.getDirectChild(Q.element,h,"paragraph-properties"))T=C,C=""+b(T,x),(O=y.getDirectChild(T,h,"background-image"))&&(N=O.getAttributeNS(q,"href"))&&(C=C+("background-image: url('odfkit:"+N+"');")+b(O,w)),(T=T.getAttributeNS(r,"line-height"))&&"normal"!==T&&(T=V.parseFoLineHeight(T),C="%"!==T.unit?C+("line-height: "+T.value+T.unit+";"):C+("line-height: "+T.value/100+";")),P+=C;if(C=y.getDirectChild(Q.element,h,"graphic-properties"))N=C,C=""+b(N,B),T=N.getAttributeNS(p,
"opacity"),O=N.getAttributeNS(p,"fill"),N=N.getAttributeNS(p,"fill-color"),"solid"===O||"hatch"===O?N&&"none"!==N?(T=isNaN(parseFloat(T))?1:parseFloat(T)/100,O=N.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,c),(N=(O=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(O))?{r:parseInt(O[1],16),g:parseInt(O[2],16),b:parseInt(O[3],16)}:null)&&(C+="background-color: rgba("+N.r+","+N.g+","+N.b+","+T+");")):C+="background: none;":"none"===O&&(C+="background: none;"),P+=C;if(C=y.getDirectChild(Q.element,h,"drawing-page-properties"))T=
C,O=""+b(T,B),"true"===T.getAttributeNS(g,"background-visible")&&(O+="background: none;"),P+=O,l(a,E,C,Q);if(C=y.getDirectChild(Q.element,h,"table-cell-properties"))E=P,P=""+b(C,I),P=E+P;if(C=y.getDirectChild(Q.element,h,"table-row-properties"))E=P,P=""+b(C,H),P=E+P;if(C=y.getDirectChild(Q.element,h,"table-column-properties"))E=P,P=""+b(C,F),P=E+P;if(C=y.getDirectChild(Q.element,h,"table-properties"))E=P,P=""+b(C,A),C=C.getAttributeNS(e,"border-model"),"collapsing"===C?P+="border-collapse:collapse;":
"separating"===C&&(P+="border-collapse:separate;"),P=E+P;0!==P.length&&a.insertRule(W+"{"+P+"}",a.cssRules.length)}for(var ga in Q.derivedStyles)Q.derivedStyles.hasOwnProperty(ga)&&n(a,d,ga,Q.derivedStyles[ga])}var p=odf.Namespaces.drawns,r=odf.Namespaces.fons,m=odf.Namespaces.officens,h=odf.Namespaces.stylens,a=odf.Namespaces.svgns,e=odf.Namespaces.tablens,q=odf.Namespaces.xlinkns,g=odf.Namespaces.presentationns,y=core.DomUtils,u=new odf.StyleParseUtils,z={graphic:"draw","drawing-page":"draw",paragraph:"text",
presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"},v={graphic:"circle connected control custom-shape ellipse frame g line measure page page-thumbnail path polygon polyline rect regular-polygon".split(" "),paragraph:"alphabetical-index-entry-template h illustration-index-entry-template index-source-style object-index-entry-template p table-index-entry-template table-of-content-entry-template user-index-entry-template".split(" "),
presentation:"caption circle connector control custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),"drawing-page":"caption circle connector control page custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),ruby:["ruby","ruby-text"],section:"alphabetical-index bibliography illustration-index index-title object-index section table-of-content table-index user-index".split(" "),table:["background",
"table"],"table-cell":"body covered-table-cell even-columns even-rows first-column first-row last-column last-row odd-columns odd-rows table-cell".split(" "),"table-column":["table-column"],"table-row":["table-row"],text:"a index-entry-chapter index-entry-link-end index-entry-link-start index-entry-page-number index-entry-span index-entry-tab-stop index-entry-text index-title-template linenumbering-configuration list-level-style-number list-level-style-bullet outline-level-style span".split(" "),
list:["list-item"]},s=[[r,"color","color"],[r,"background-color","background-color"],[r,"font-weight","font-weight"],[r,"font-style","font-style"]],w=[[h,"repeat","background-repeat"]],x=[[r,"background-color","background-color"],[r,"text-align","text-align"],[r,"text-indent","text-indent"],[r,"padding","padding"],[r,"padding-left","padding-left"],[r,"padding-right","padding-right"],[r,"padding-top","padding-top"],[r,"padding-bottom","padding-bottom"],[r,"border-left","border-left"],[r,"border-right",
"border-right"],[r,"border-top","border-top"],[r,"border-bottom","border-bottom"],[r,"margin","margin"],[r,"margin-left","margin-left"],[r,"margin-right","margin-right"],[r,"margin-top","margin-top"],[r,"margin-bottom","margin-bottom"],[r,"border","border"]],B=[[r,"background-color","background-color"],[r,"min-height","min-height"],[p,"stroke","border"],[a,"stroke-color","border-color"],[a,"stroke-width","border-width"],[r,"border","border"],[r,"border-left","border-left"],[r,"border-right","border-right"],
[r,"border-top","border-top"],[r,"border-bottom","border-bottom"]],I=[[r,"background-color","background-color"],[r,"border-left","border-left"],[r,"border-right","border-right"],[r,"border-top","border-top"],[r,"border-bottom","border-bottom"],[r,"border","border"]],F=[[h,"column-width","width"]],H=[[h,"row-height","height"],[r,"keep-together",null]],A=[[h,"width","width"],[r,"margin-left","margin-left"],[r,"margin-right","margin-right"],[r,"margin-top","margin-top"],[r,"margin-bottom","margin-bottom"]],
J=[[r,"background-color","background-color"],[r,"padding","padding"],[r,"padding-left","padding-left"],[r,"padding-right","padding-right"],[r,"padding-top","padding-top"],[r,"padding-bottom","padding-bottom"],[r,"border","border"],[r,"border-left","border-left"],[r,"border-right","border-right"],[r,"border-top","border-top"],[r,"border-bottom","border-bottom"],[r,"margin","margin"],[r,"margin-left","margin-left"],[r,"margin-right","margin-right"],[r,"margin-top","margin-top"],[r,"margin-bottom","margin-bottom"]],
L=[[r,"page-width","width"],[r,"page-height","height"]],Q={border:!0,"border-left":!0,"border-right":!0,"border-top":!0,"border-bottom":!0,"stroke-width":!0},E={margin:!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"margin-bottom":!0},Y={},V=odf.OdfUtils,t,W,Z,O=xmldom.XPath,G=new core.CSSUnits;this.style2css=function(a,b,c,e,d){function g(a,b){f="@namespace "+a+" url("+b+");";try{c.insertRule(f,c.cssRules.length)}catch(e){}}var f,h,q;for(W=b;c.cssRules.length;)c.deleteRule(c.cssRules.length-
1);odf.Namespaces.forEachPrefix(g);g("webodfhelper","urn:webodf:names:helper");Y=e;t=a;Z=runtime.getWindow().getComputedStyle(document.body,null).getPropertyValue("font-size")||"12pt";for(q in z)if(z.hasOwnProperty(q))for(h in a=d[q],a)a.hasOwnProperty(h)&&n(c,q,h,a[h])}};(function(){function f(k,b){var c=this;this.getDistance=function(b){var f=c.x-b.x;b=c.y-b.y;return Math.sqrt(f*f+b*b)};this.getCenter=function(b){return new f((c.x+b.x)/2,(c.y+b.y)/2)};c.x=k;c.y=b}gui.ZoomHelper=function(){function k(a,b,c,d){a=d?"translate3d("+a+"px, "+b+"px, 0) scale3d("+c+", "+c+", 1)":"translate("+a+"px, "+b+"px) scale("+c+")";e.style.WebkitTransform=a;e.style.MozTransform=a;e.style.msTransform=a;e.style.OTransform=a;e.style.transform=a}function b(a){a?k(-q.x,-q.y,u,!0):(k(0,
0,u,!0),k(0,0,u,!1))}function c(a){if(s&&F){var b=s.style.overflow,c=s.classList.contains("webodf-customScrollbars");a&&c||!a&&!c||(a?(s.classList.add("webodf-customScrollbars"),s.style.overflow="hidden",runtime.requestAnimationFrame(function(){s.style.overflow=b})):s.classList.remove("webodf-customScrollbars"))}}function d(){k(-q.x,-q.y,u,!0);s.scrollLeft=0;s.scrollTop=0;H=w.style.overflow;w.style.overflow="visible";c(!1)}function l(){k(0,0,u,!0);s.scrollLeft=q.x;s.scrollTop=q.y;w.style.overflow=
H||"";c(!0)}function n(a){return new f(a.pageX-e.offsetLeft,a.pageY-e.offsetTop)}function p(a){g&&(q.x-=a.x-g.x,q.y-=a.y-g.y,q=new f(Math.min(Math.max(q.x,e.offsetLeft),(e.offsetLeft+e.offsetWidth)*u-s.clientWidth),Math.min(Math.max(q.y,e.offsetTop),(e.offsetTop+e.offsetHeight)*u-s.clientHeight)));g=a}function r(a){var b=a.touches.length,c=0<b?n(a.touches[0]):null;a=1<b?n(a.touches[1]):null;c&&a?(y=c.getDistance(a),z=u,g=c.getCenter(a),d(),I=B.PINCH):c&&(g=c,I=B.SCROLL)}function m(a){var c=a.touches.length,
g=0<c?n(a.touches[0]):null,c=1<c?n(a.touches[1]):null;if(g&&c)if(a.preventDefault(),I===B.SCROLL)I=B.PINCH,d(),y=g.getDistance(c);else{a=g.getCenter(c);g=g.getDistance(c)/y;p(a);var c=u,f=Math.min(v,e.offsetParent.clientWidth/e.offsetWidth);u=z*g;u=Math.min(Math.max(u,f),v);g=u/c;q.x+=(g-1)*(a.x+q.x);q.y+=(g-1)*(a.y+q.y);b(!0)}else g&&(I===B.PINCH?(I=B.SCROLL,l()):p(g))}function h(){I===B.PINCH&&(x.emit(gui.ZoomHelper.signalZoomChanged,u),l(),b(!1));I=B.NONE}function a(){s&&(s.removeEventListener("touchstart",
r,!1),s.removeEventListener("touchmove",m,!1),s.removeEventListener("touchend",h,!1))}var e,q,g,y,u,z,v=4,s,w,x=new core.EventNotifier([gui.ZoomHelper.signalZoomChanged]),B={NONE:0,SCROLL:1,PINCH:2},I=B.NONE,F=runtime.getWindow().hasOwnProperty("ontouchstart"),H="";this.subscribe=function(a,b){x.subscribe(a,b)};this.unsubscribe=function(a,b){x.unsubscribe(a,b)};this.getZoomLevel=function(){return u};this.setZoomLevel=function(a){e&&(u=a,b(!1),x.emit(gui.ZoomHelper.signalZoomChanged,u))};this.destroy=
function(b){a();c(!1);b()};this.setZoomableElement=function(d){a();e=d;s=e.offsetParent;w=e.parentNode;b(!1);s&&(s.addEventListener("touchstart",r,!1),s.addEventListener("touchmove",m,!1),s.addEventListener("touchend",h,!1));c(!0)};z=u=1;q=new f(0,0)};gui.ZoomHelper.signalZoomChanged="zoomChanged"})();ops.Canvas=function(){};ops.Canvas.prototype.getZoomLevel=function(){};ops.Canvas.prototype.getElement=function(){};ops.Canvas.prototype.getSizer=function(){};ops.Canvas.prototype.getZoomHelper=function(){};(function(){function f(){function a(e){c=!0;runtime.setTimeout(function(){try{e()}catch(d){runtime.log(String(d)+"\n"+d.stack)}c=!1;0<b.length&&a(b.pop())},10)}var b=[],c=!1;this.clearQueue=function(){b.length=0};this.addToQueue=function(e){if(0===b.length&&!c)return a(e);b.push(e)}}function k(a){function b(){for(;0<c.cssRules.length;)c.deleteRule(0);c.insertRule("#shadowContent draw|page {display:none;}",0);c.insertRule("office|presentation draw|page {display:none;}",1);c.insertRule("#shadowContent draw|page:nth-of-type("+
e+") {display:block;}",2);c.insertRule("office|presentation draw|page:nth-of-type("+e+") {display:block;}",3)}var c=a.sheet,e=1;this.showFirstPage=function(){e=1;b()};this.showNextPage=function(){e+=1;b()};this.showPreviousPage=function(){1<e&&(e-=1,b())};this.showPage=function(a){0<a&&(e=a,b())};this.css=a;this.destroy=function(b){a.parentNode.removeChild(a);b()}}function b(a){for(;a.firstChild;)a.removeChild(a.firstChild)}function c(a){a=a.sheet;for(var b=a.cssRules;b.length;)a.deleteRule(b.length-
1)}function d(a,b,c){var e=new odf.Style2CSS,d=new odf.ListStyleToCss;c=c.sheet;var g=(new odf.StyleTree(a.rootElement.styles,a.rootElement.automaticStyles)).getStyleTree();e.style2css(a.getDocumentType(),a.rootElement,c,b.getFontMap(),g);d.applyListStyles(c,g,a.rootElement.body)}function l(a,b){(new odf.FontLoader).loadFonts(a,b.sheet)}function n(a,b,c){var e=null;a=a.rootElement.body.getElementsByTagNameNS(J,c+"-decl");c=b.getAttributeNS(J,"use-"+c+"-name");var d;if(c&&0<a.length)for(b=0;b<a.length;b+=
1)if(d=a[b],d.getAttributeNS(J,"name")===c){e=d.textContent;break}return e}function p(a,c,e,d){var g=a.ownerDocument;c=Q.getElementsByTagNameNS(a,c,e);for(a=0;a<c.length;a+=1)b(c[a]),d&&(e=c[a],e.appendChild(g.createTextNode(d)))}function r(a,b,c){b.setAttributeNS("urn:webodf:names:helper","styleid",a);var e,d=b.getAttributeNS(H,"anchor-type"),g=b.getAttributeNS(I,"x"),f=b.getAttributeNS(I,"y"),h=b.getAttributeNS(I,"width"),q=b.getAttributeNS(I,"height"),l=b.getAttributeNS(w,"min-height"),m=b.getAttributeNS(w,
"min-width");if("as-char"===d)e="display: inline-block;";else if(d||g||f)e="position: absolute;";else if(h||q||l||m)e="display: block;";g&&(e+="left: "+g+";");f&&(e+="top: "+f+";");h&&(e+="width: "+h+";");q&&(e+="height: "+q+";");l&&(e+="min-height: "+l+";");m&&(e+="min-width: "+m+";");e&&(e="draw|"+b.localName+'[webodfhelper|styleid="'+a+'"] {'+e+"}",c.insertRule(e,c.cssRules.length))}function m(a){for(a=a.firstChild;a;){if(a.namespaceURI===x&&"binary-data"===a.localName)return"data:image/png;base64,"+
a.textContent.replace(/[\r\n\s]/g,"");a=a.nextSibling}return""}function h(a,b,c,e){function d(b){b&&(b='draw|image[webodfhelper|styleid="'+a+'"] {'+("background-image: url("+b+");")+"}",e.insertRule(b,e.cssRules.length))}function g(a){d(a.url)}c.setAttributeNS("urn:webodf:names:helper","styleid",a);var f=c.getAttributeNS(A,"href"),h;if(f)try{h=b.getPart(f),h.onchange=g,h.load()}catch(q){runtime.log("slight problem: "+String(q))}else f=m(c),d(f)}function a(a){var b=a.ownerDocument;Q.getElementsByTagNameNS(a,
H,"line-break").forEach(function(a){a.hasChildNodes()||a.appendChild(b.createElement("br"))})}function e(a){var b=a.ownerDocument;Q.getElementsByTagNameNS(a,H,"s").forEach(function(a){for(var c,e;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(b.createTextNode(" "));e=parseInt(a.getAttributeNS(H,"c"),10);if(1<e)for(a.removeAttributeNS(H,"c"),c=1;c<e;c+=1)a.parentNode.insertBefore(a.cloneNode(!0),a)})}function q(a){Q.getElementsByTagNameNS(a,H,"tab").forEach(function(a){a.textContent="\t"})}
function g(a,b){function c(a,e){var f=h.documentElement.namespaceURI;"video/"===e.substr(0,6)?(d=h.createElementNS(f,"video"),d.setAttribute("controls","controls"),g=h.createElementNS(f,"source"),a&&g.setAttribute("src",a),g.setAttribute("type",e),d.appendChild(g),b.parentNode.appendChild(d)):b.innerHtml="Unrecognised Plugin"}function e(a){c(a.url,a.mimetype)}var d,g,f,h=b.ownerDocument,q;if(f=b.getAttributeNS(A,"href"))try{q=a.getPart(f),q.onchange=e,q.load()}catch(l){runtime.log("slight problem: "+
String(l))}else runtime.log("using MP4 data fallback"),f=m(b),c(f,"video/mp4")}function y(){var a=odf.OdfSchema.getFields().map(function(a){return a.replace(":","|")}),b=a.join(",\n")+"\n{ background-color: #D0D0D0; }\n",a=a.map(function(a){return a+":empty::after"}).join(",\n")+"\n{ content:' '; white-space: pre; }\n";return b+"\n"+a}function u(a){var b=a.getElementsByTagName("head")[0],c,e;c=a.styleSheets.length;for(e=b.firstElementChild;e&&("style"!==e.localName||!e.hasAttribute("webodfcss"));)e=
e.nextElementSibling;if(e)return c=parseInt(e.getAttribute("webodfcss"),10),e.setAttribute("webodfcss",c+1),e;"string"===String(typeof webodf_css)?c=webodf_css:(e="webodf.css",runtime.currentDirectory&&(e=runtime.currentDirectory(),0<e.length&&"/"!==e.substr(-1)&&(e+="/"),e+="../webodf.css"),c=runtime.readFileSync(e,"utf-8"));e=a.createElementNS(b.namespaceURI,"style");e.setAttribute("media","screen, print, handheld, projection");e.setAttribute("type","text/css");e.setAttribute("webodfcss","1");e.appendChild(a.createTextNode(c+
"\n"));e.appendChild(a.createTextNode(y()));b.appendChild(e);return e}function z(a){var b=parseInt(a.getAttribute("webodfcss"),10);1===b?a.parentNode.removeChild(a):a.setAttribute("count",b-1)}function v(a){var b=a.getElementsByTagName("head")[0],c=a.createElementNS(b.namespaceURI,"style"),e="";c.setAttribute("type","text/css");c.setAttribute("media","screen, print, handheld, projection");odf.Namespaces.forEachPrefix(function(a,b){e+="@namespace "+a+" url("+b+");\n"});e+="@namespace webodfhelper url(urn:webodf:names:helper);\n";
c.appendChild(a.createTextNode(e));b.appendChild(c);return c}var s=odf.Namespaces.drawns,w=odf.Namespaces.fons,x=odf.Namespaces.officens,B=odf.Namespaces.stylens,I=odf.Namespaces.svgns,F=odf.Namespaces.tablens,H=odf.Namespaces.textns,A=odf.Namespaces.xlinkns,J=odf.Namespaces.presentationns,L=xmldom.XPath,Q=core.DomUtils;odf.OdfCanvas=function(m,y){function A(a,b,c){function e(a,b,c,d){oa.addToQueue(function(){h(a,b,c,d)})}var d,g;d=b.getElementsByTagNameNS(s,"image");for(b=0;b<d.length;b+=1)g=d.item(b),
e("image"+String(b),a,g,c)}function t(a,b){function c(a,b){oa.addToQueue(function(){g(a,b)})}var e,d,f;d=b.getElementsByTagNameNS(s,"plugin");for(e=0;e<d.length;e+=1)f=d.item(e),c(a,f)}function w(){var a;a=C.firstChild;var b=ca.getZoomLevel();a&&(C.style.WebkitTransformOrigin="0% 0%",C.style.MozTransformOrigin="0% 0%",C.style.msTransformOrigin="0% 0%",C.style.OTransformOrigin="0% 0%",C.style.transformOrigin="0% 0%",P&&((a=P.getMinimumHeightForAnnotationPane())?C.style.minHeight=a:C.style.removeProperty("min-height")),
m.style.width=Math.round(b*C.offsetWidth)+"px",m.style.height=Math.round(b*C.offsetHeight)+"px",m.style.display="inline-block")}function I(c,d){var g=ba.sheet;b(m);C=D.createElementNS(m.namespaceURI,"div");C.style.display="inline-block";C.style.background="white";C.style.setProperty("float","left","important");C.appendChild(d);m.appendChild(C);U=D.createElementNS(m.namespaceURI,"div");U.id="annotationsPane";da=D.createElementNS(m.namespaceURI,"div");da.id="shadowContent";da.style.position="absolute";
da.style.top=0;da.style.left=0;c.getContentElement().appendChild(da);var f=d.body,h,l=[],k;for(h=f.firstElementChild;h&&h!==f;)if(h.namespaceURI===s&&(l[l.length]=h),h.firstElementChild)h=h.firstElementChild;else{for(;h&&h!==f&&!h.nextElementSibling;)h=h.parentNode;h&&h.nextElementSibling&&(h=h.nextElementSibling)}for(k=0;k<l.length;k+=1)h=l[k],r("frame"+String(k),h,g);l=L.getODFElementsWithXPath(f,".//*[*[@text:anchor-type='paragraph']]",odf.Namespaces.lookupNamespaceURI);for(h=0;h<l.length;h+=1)f=
l[h],f.setAttributeNS&&f.setAttributeNS("urn:webodf:names:helper","containsparagraphanchor",!0);f=aa;h=da;var y,u,v,z,w=0,Y;k=c.rootElement.ownerDocument;if((l=d.body.firstElementChild)&&l.namespaceURI===x&&("presentation"===l.localName||"drawing"===l.localName))for(l=l.firstElementChild;l;){if(y=(y=l.getAttributeNS(s,"master-page-name"))?f.getMasterPageElement(y):null){u=l.getAttributeNS("urn:webodf:names:helper","styleid");v=k.createElementNS(s,"draw:page");Y=y.firstElementChild;for(w=0;Y;)"true"!==
Y.getAttributeNS(J,"placeholder")&&(z=Y.cloneNode(!0),v.appendChild(z)),Y=Y.nextElementSibling,w+=1;Y=z=w=void 0;for(var G=Q.getElementsByTagNameNS(v,s,"frame"),w=0;w<G.length;w+=1)z=G[w],(Y=z.getAttributeNS(J,"class"))&&!/^(date-time|footer|header|page-number)$/.test(Y)&&z.parentNode.removeChild(z);z=Q.getElementsByTagNameNS(v,s,"*");for(w=0;w<z.length;w+=1)r(u+"_"+w,z[w],g);h.appendChild(v);w=String(h.getElementsByTagNameNS(s,"page").length);p(v,H,"page-number",w);p(v,J,"header",n(c,l,"header"));
p(v,J,"footer",n(c,l,"footer"));r(u,v,g);v.setAttributeNS("urn:webodf:names:helper","page-style-name",l.getAttributeNS(s,"style-name"));v.setAttributeNS(s,"draw:master-page-name",y.getAttributeNS(B,"name"))}l=l.nextElementSibling}f=m.namespaceURI;l=Q.getElementsByTagNameNS(d.body,F,"table-cell");for(h=0;h<l.length;h+=1)k=l[h],k.hasAttributeNS(F,"number-columns-spanned")&&k.setAttributeNS(f,"colspan",k.getAttributeNS(F,"number-columns-spanned")),k.hasAttributeNS(F,"number-rows-spanned")&&k.setAttributeNS(f,
"rowspan",k.getAttributeNS(F,"number-rows-spanned"));a(d.body);e(d.body);q(d.body);A(c,d.body,g);t(c,d.body);C.insertBefore(da,C.firstChild);ca.setZoomableElement(C)}function O(a){T?(U.parentNode||C.appendChild(U),P&&P.forgetAnnotations(),P=new gui.AnnotationViewManager($,a.body,U,ia),Q.getElementsByTagNameNS(a.body,x,"annotation").forEach(P.addAnnotation),P.rerenderAnnotations(),w()):U.parentNode&&(C.removeChild(U),P.forgetAnnotations(),w())}function G(a){function e(){c(fa);c(ga);c(ba);b(m);m.style.display=
"inline-block";var g=R.rootElement;m.ownerDocument.importNode(g,!0);aa.setOdfContainer(R);l(R,fa);d(R,aa,ga);I(R,g);O(g);a||oa.addToQueue(function(){var a=[R];if(na.hasOwnProperty("statereadychange")){var b=na.statereadychange,c;for(c=0;c<b.length;c+=1)b[c].apply(null,a)}})}R.state===odf.OdfContainer.DONE?e():(runtime.log("WARNING: refreshOdf called but ODF was not DONE."),ka=runtime.setTimeout(function qa(){R.state===odf.OdfContainer.DONE?e():(runtime.log("will be back later..."),ka=runtime.setTimeout(qa,
500))},100))}function S(a){oa.clearQueue();m.innerHTML=runtime.tr("Loading")+" "+a+"...";m.removeAttribute("style");R=new odf.OdfContainer(a,function(a){R=a;G(!1)})}runtime.assert(null!==m&&void 0!==m,"odf.OdfCanvas constructor needs DOM element");runtime.assert(null!==m.ownerDocument&&void 0!==m.ownerDocument,"odf.OdfCanvas constructor needs DOM");var $=this,D=m.ownerDocument,R,aa=new odf.Formatting,ea,C=null,U=null,T=!1,ia=!1,P=null,N,fa,ga,ba,da,na={},ka,ha,ja=!1,la=!1,oa=new f,ca=new gui.ZoomHelper,
ma=y||new gui.SingleScrollViewport(m.parentNode);this.refreshCSS=function(){ja=!0;ha.trigger()};this.refreshSize=function(){ha.trigger()};this.odfContainer=function(){return R};this.setOdfContainer=function(a,b){R=a;G(!0===b)};this.load=this.load=S;this.save=function(a){R.save(a)};this.addListener=function(a,b){switch(a){case "click":var c=m,e=a;c.addEventListener?c.addEventListener(e,b,!1):c.attachEvent?c.attachEvent("on"+e,b):c["on"+e]=b;break;default:c=na.hasOwnProperty(a)?na[a]:na[a]=[],b&&-1===
c.indexOf(b)&&c.push(b)}};this.getFormatting=function(){return aa};this.getAnnotationViewManager=function(){return P};this.refreshAnnotations=function(){O(R.rootElement)};this.rerenderAnnotations=function(){P&&(la=!0,ha.trigger())};this.getSizer=function(){return C};this.enableAnnotations=function(a,b){a!==T&&(T=a,ia=b,R&&O(R.rootElement))};this.addAnnotation=function(a){P&&(P.addAnnotation(a),w())};this.forgetAnnotations=function(){P&&(P.forgetAnnotations(),w())};this.getZoomHelper=function(){return ca};
this.setZoomLevel=function(a){ca.setZoomLevel(a)};this.getZoomLevel=function(){return ca.getZoomLevel()};this.fitToContainingElement=function(a,b){var c=ca.getZoomLevel(),e=m.offsetHeight/c,c=a/(m.offsetWidth/c);b/e<c&&(c=b/e);ca.setZoomLevel(c)};this.fitToWidth=function(a){var b=m.offsetWidth/ca.getZoomLevel();ca.setZoomLevel(a/b)};this.fitSmart=function(a,b){var c,e;e=ca.getZoomLevel();c=m.offsetWidth/e;e=m.offsetHeight/e;c=a/c;void 0!==b&&b/e<c&&(c=b/e);ca.setZoomLevel(Math.min(1,c))};this.fitToHeight=
function(a){var b=m.offsetHeight/ca.getZoomLevel();ca.setZoomLevel(a/b)};this.showFirstPage=function(){ea.showFirstPage()};this.showNextPage=function(){ea.showNextPage()};this.showPreviousPage=function(){ea.showPreviousPage()};this.showPage=function(a){ea.showPage(a);w()};this.getElement=function(){return m};this.getViewport=function(){return ma};this.addCssForFrameWithImage=function(a){var b=a.getAttributeNS(s,"name"),c=a.firstElementChild;r(b,a,ba.sheet);c&&h(b+"img",R,c,ba.sheet)};this.destroy=
function(a){var b=D.getElementsByTagName("head")[0],c=[ea.destroy,ha.destroy];runtime.clearTimeout(ka);U&&U.parentNode&&U.parentNode.removeChild(U);ca.destroy(function(){C&&(m.removeChild(C),C=null)});z(N);b.removeChild(fa);b.removeChild(ga);b.removeChild(ba);core.Async.destroyAll(c,a)};N=u(D);ea=new k(v(D));fa=v(D);ga=v(D);ba=v(D);ha=core.Task.createRedrawTask(function(){ja&&(d(R,aa,ga),ja=!1);la&&(P&&P.rerenderAnnotations(),la=!1);w()});ca.subscribe(gui.ZoomHelper.signalZoomChanged,w)}})();odf.StepUtils=function(){this.getContentBounds=function(f){var k=f.container(),b,c;runtime.assert(f.isStep(),"Step iterator must be on a step");k.nodeType===Node.TEXT_NODE&&0<f.offset()?b=f.offset():(k=f.leftNode())&&k.nodeType===Node.TEXT_NODE&&(b=k.length);k&&(k.nodeType===Node.TEXT_NODE?(runtime.assert(0<b,"Empty text node found"),c={container:k,startOffset:b-1,endOffset:b}):c={container:k,startOffset:0,endOffset:k.childNodes.length});return c}};ops.MemberProperties=function(){};
ops.Member=function(f,k){var b=new ops.MemberProperties;this.getMemberId=function(){return f};this.getProperties=function(){return b};this.setProperties=function(c){Object.keys(c).forEach(function(d){b[d]=c[d]})};this.removeProperties=function(c){Object.keys(c).forEach(function(c){"fullName"!==c&&"color"!==c&&"imageUrl"!==c&&b.hasOwnProperty(c)&&delete b[c]})};runtime.assert(Boolean(f),"No memberId was supplied!");k.fullName||(k.fullName=runtime.tr("Unknown Author"));k.color||(k.color="black");k.imageUrl||
(k.imageUrl="avatar-joe.png");b=k};ops.Document=function(){};ops.Document.prototype.getMemberIds=function(){};ops.Document.prototype.removeCursor=function(f){};ops.Document.prototype.getDocumentElement=function(){};ops.Document.prototype.getRootNode=function(){};ops.Document.prototype.getDOMDocument=function(){};ops.Document.prototype.cloneDocumentElement=function(){};ops.Document.prototype.setDocumentElement=function(f){};ops.Document.prototype.subscribe=function(f,k){};ops.Document.prototype.unsubscribe=function(f,k){};
ops.Document.prototype.getCanvas=function(){};ops.Document.prototype.createRootFilter=function(f){};ops.Document.prototype.createPositionIterator=function(f){};ops.Document.signalCursorAdded="cursor/added";ops.Document.signalCursorRemoved="cursor/removed";ops.Document.signalCursorMoved="cursor/moved";ops.Document.signalMemberAdded="member/added";ops.Document.signalMemberUpdated="member/updated";ops.Document.signalMemberRemoved="member/removed";ops.OdtCursor=function(f,k){var b=this,c={},d,l,n=new core.EventNotifier([ops.OdtCursor.signalCursorUpdated]);this.removeFromDocument=function(){l.remove()};this.subscribe=function(b,c){n.subscribe(b,c)};this.unsubscribe=function(b,c){n.unsubscribe(b,c)};this.getMemberId=function(){return f};this.getNode=function(){return l.getNode()};this.getAnchorNode=function(){return l.getAnchorNode()};this.getSelectedRange=function(){return l.getSelectedRange()};this.setSelectedRange=function(c,d){l.setSelectedRange(c,
d);n.emit(ops.OdtCursor.signalCursorUpdated,b)};this.hasForwardSelection=function(){return l.hasForwardSelection()};this.getDocument=function(){return k};this.getSelectionType=function(){return d};this.setSelectionType=function(b){c.hasOwnProperty(b)?d=b:runtime.log("Invalid selection type: "+b)};this.resetSelectionType=function(){b.setSelectionType(ops.OdtCursor.RangeSelection)};l=new core.Cursor(k.getDOMDocument(),f);c[ops.OdtCursor.RangeSelection]=!0;c[ops.OdtCursor.RegionSelection]=!0;b.resetSelectionType()};
ops.OdtCursor.RangeSelection="Range";ops.OdtCursor.RegionSelection="Region";ops.OdtCursor.signalCursorUpdated="cursorUpdated";(function(){var f=0;ops.StepsCache=function(k,b,c){function d(a,b){var e=this;this.nodeId=a;this.steps=-1;this.node=b;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(a){a.setPositionBeforeElement(b);c(e.steps,a)}}function l(a,b,e){var d=this;this.nodeId=a;this.steps=b;this.node=e;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(a){a.setUnfilteredPosition(e,0);c(d.steps,a)}}function n(a,b){var c="["+a.nodeId;b&&(c+=" => "+b.nodeId);return c+
"]"}function p(){for(var a=z,b,c,e,d=new core.LoopWatchDog(0,1E5),f={};a;){d.check();(b=a.previousBookmark)?runtime.assert(b.nextBookmark===a,"Broken bookmark link to previous @"+n(b,a)):(runtime.assert(a===z,"Broken bookmark link @"+n(a)),runtime.assert(void 0===v||z===z||z.steps<=v,"Base point is damaged @"+n(a)));(c=a.nextBookmark)&&runtime.assert(c.previousBookmark===a,"Broken bookmark link to next @"+n(a,c));if(void 0===v||a===z||a.steps<=v)runtime.assert(u.containsNode(k,a.node),"Disconnected node is being reported as undamaged @"+
n(a)),b&&(e=a.node.compareDocumentPosition(b.node),runtime.assert(0===e||0!==(e&w),"Bookmark order with previous does not reflect DOM order @"+n(b,a))),c&&u.containsNode(k,c.node)&&(e=a.node.compareDocumentPosition(c.node),runtime.assert(0===e||0!==(e&s),"Bookmark order with next does not reflect DOM order @"+n(a,c)));a=a.nextBookmark}Object.keys(g).forEach(function(a){var b=g[a];(void 0===v||a<=v)&&runtime.assert(b.steps<=a,"Bookmark step of "+b.steps+" exceeds cached step lookup for "+a+" @"+n(b));
runtime.assert(!1===f.hasOwnProperty(b.nodeId),"Bookmark "+n(b)+" appears twice in cached step lookup at steps "+f[b.nodeId]+" and "+a);f[b.nodeId]=a})}function r(a){var b="";a.nodeType===Node.ELEMENT_NODE&&(b=a.getAttributeNS(q,"nodeId")||"");return b}function m(a){var b=f.toString();a.setAttributeNS(q,"nodeId",b);f+=1;return b}function h(a){var c,e,d=new core.LoopWatchDog(0,1E4);void 0!==v&&a>v&&(a=v);for(c=Math.floor(a/b)*b;!e&&0<=c;)e=g[c],c-=b;for(e=e||z;e.nextBookmark&&e.nextBookmark.steps<=
a;)d.check(),e=e.nextBookmark;runtime.assert(-1===a||e.steps<=a,"Bookmark @"+n(e)+" at step "+e.steps+" exceeds requested step of "+a);return e}function a(a){a.previousBookmark&&(a.previousBookmark.nextBookmark=a.nextBookmark);a.nextBookmark&&(a.nextBookmark.previousBookmark=a.previousBookmark)}function e(a){for(var b,c=null;!c&&a&&a!==k;)(b=r(a))&&(c=y[b])&&c.node!==a&&(runtime.log("Cloned node detected. Creating new bookmark"),c=null,a.removeAttributeNS(q,"nodeId")),a=a.parentNode;return c}var q=
"urn:webodf:names:steps",g={},y={},u=core.DomUtils,z,v,s=Node.DOCUMENT_POSITION_FOLLOWING,w=Node.DOCUMENT_POSITION_PRECEDING,x;this.updateBookmark=function(c,e){var f,q=Math.ceil(c/b)*b,l,n,p;if(void 0!==v&&v<c){l=h(v);for(n=l.nextBookmark;n&&n.steps<=c;)f=n.nextBookmark,p=Math.ceil(n.steps/b)*b,g[p]===n&&delete g[p],u.containsNode(k,n.node)?n.steps=c+1:(a(n),delete y[n.nodeId]),n=f;v=c}else l=h(c);n=r(e)||m(e);f=y[n];f?f.node!==e&&(runtime.log("Cloned node detected. Creating new bookmark"),n=m(e),
f=y[n]=new d(n,e)):f=y[n]=new d(n,e);n=f;n.steps!==c&&(f=Math.ceil(n.steps/b)*b,f!==q&&g[f]===n&&delete g[f],n.steps=c);if(l!==n&&l.nextBookmark!==n){if(l.steps===n.steps)for(;0!==(n.node.compareDocumentPosition(l.node)&s)&&l!==z;)l=l.previousBookmark;l!==n&&l.nextBookmark!==n&&(a(n),f=l.nextBookmark,n.nextBookmark=l.nextBookmark,n.previousBookmark=l,l.nextBookmark=n,f&&(f.previousBookmark=n))}l=g[q];if(!l||n.steps>l.steps)g[q]=n;x()};this.setToClosestStep=function(a,b){var c;x();c=h(a);c.setIteratorPosition(b);
return c.steps};this.setToClosestDomPoint=function(a,b,c){var d,f;x();if(a===k&&0===b)d=z;else if(a===k&&b===k.childNodes.length)for(f in d=z,g)g.hasOwnProperty(f)&&(a=g[f],a.steps>d.steps&&(d=a));else if(d=e(a.childNodes.item(b)||a),!d)for(c.setUnfilteredPosition(a,b);!d&&c.previousNode();)d=e(c.getCurrentNode());d=d||z;void 0!==v&&d.steps>v&&(d=h(v));d.setIteratorPosition(c);return d.steps};this.damageCacheAfterStep=function(a){0>a&&(a=-1);void 0===v?v=a:a<v&&(v=a);x()};(function(){var a=r(k)||
m(k);z=new l(a,0,k);x=ops.StepsCache.ENABLE_CACHE_VERIFICATION?p:function(){}})()};ops.StepsCache.ENABLE_CACHE_VERIFICATION=!1;ops.StepsCache.Bookmark=function(){};ops.StepsCache.Bookmark.prototype.setIteratorPosition=function(f){}})();(function(){ops.OdtStepsTranslator=function(f,k,b,c){function d(a,b,c){var e=b.getCurrentNode();b.isBeforeNode()&&h.isParagraph(e)&&(c||(a+=1),m.updateBookmark(a,e))}function l(a,c){do{if(b.acceptPosition(c)===q){d(a,c,!0);break}d(a-1,c,!1)}while(c.nextPosition())}function n(){var a=f();a!==r&&(r&&runtime.log("Undo detected. Resetting steps cache"),r=a,m=new ops.StepsCache(r,c,l),e=k(r))}function p(a,c){if(!c||b.acceptPosition(a)===q)return!0;for(;a.previousPosition();)if(b.acceptPosition(a)===q){if(c(g,
a.container(),a.unfilteredDomOffset()))return!0;break}for(;a.nextPosition();)if(b.acceptPosition(a)===q){if(c(y,a.container(),a.unfilteredDomOffset()))return!0;break}return!1}var r,m,h=odf.OdfUtils,a=core.DomUtils,e,q=core.PositionFilter.FilterResult.FILTER_ACCEPT,g=core.StepDirection.PREVIOUS,y=core.StepDirection.NEXT;this.convertStepsToDomPoint=function(a){var c,g;if(isNaN(a))throw new TypeError("Requested steps is not numeric ("+a+")");if(0>a)throw new RangeError("Requested steps is negative ("+
a+")");n();for(c=m.setToClosestStep(a,e);c<a&&e.nextPosition();)(g=b.acceptPosition(e)===q)&&(c+=1),d(c,e,g);if(c!==a)throw new RangeError("Requested steps ("+a+") exceeds available steps ("+c+")");return{node:e.container(),offset:e.unfilteredDomOffset()}};this.convertDomPointToSteps=function(c,g,f){var h;n();a.containsNode(r,c)||(g=0>a.comparePoints(r,0,c,g),c=r,g=g?0:r.childNodes.length);e.setUnfilteredPosition(c,g);p(e,f)||e.setUnfilteredPosition(c,g);f=e.container();g=e.unfilteredDomOffset();
c=m.setToClosestDomPoint(f,g,e);if(0>a.comparePoints(e.container(),e.unfilteredDomOffset(),f,g))return 0<c?c-1:c;for(;(e.container()!==f||e.unfilteredDomOffset()!==g)&&e.nextPosition();)(h=b.acceptPosition(e)===q)&&(c+=1),d(c,e,h);return c+0};this.prime=function(){var a,c;n();for(a=m.setToClosestStep(0,e);e.nextPosition();)(c=b.acceptPosition(e)===q)&&(a+=1),d(a,e,c)};this.handleStepsInserted=function(a){n();m.damageCacheAfterStep(a.position)};this.handleStepsRemoved=function(a){n();m.damageCacheAfterStep(a.position-
1)};n()}})();ops.Operation=function(){};ops.Operation.prototype.init=function(f){};ops.Operation.prototype.execute=function(f){};ops.Operation.prototype.spec=function(){};ops.TextPositionFilter=function(){function f(b,c,f){var m,h;if(c){if(k.isInlineRoot(c)&&k.isGroupingElement(f))return l;m=k.lookLeftForCharacter(c);if(1===m||2===m&&(k.scanRightForAnyCharacter(f)||k.scanRightForAnyCharacter(k.nextNode(b))))return d}else if(k.isInlineRoot(b.previousSibling)&&k.isGroupingElement(b))return d;m=null===c&&k.isParagraph(b);h=k.lookRightForCharacter(f);if(m)return h?d:k.scanRightForAnyCharacter(f)?l:d;if(!h)return l;c=c||k.previousNode(b);return k.scanLeftForAnyCharacter(c)?
l:d}var k=odf.OdfUtils,b=Node.ELEMENT_NODE,c=Node.TEXT_NODE,d=core.PositionFilter.FilterResult.FILTER_ACCEPT,l=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(n){var p=n.container(),r=p.nodeType,m,h,a;if(r!==b&&r!==c)return l;if(r===c){r=n.unfilteredDomOffset();m=p.data;runtime.assert(r!==m.length,"Unexpected offset.");if(0<r){n=m[r-1];if(!k.isODFWhitespace(n))return d;if(1<r)if(n=m[r-2],!k.isODFWhitespace(n))h=d;else{if(!k.isODFWhitespace(m.substr(0,r)))return l}else a=
k.previousNode(p),k.scanLeftForNonSpace(a)&&(h=d);if(h===d)return k.isTrailingWhitespace(p,r)?l:d;h=m[r];return k.isODFWhitespace(h)?l:k.scanLeftForAnyCharacter(k.previousNode(p))?l:d}a=n.leftNode();h=p;p=p.parentNode;h=f(p,a,h)}else k.isGroupingElement(p)?(a=n.leftNode(),h=n.rightNode(),h=f(p,a,h)):h=l;return h}};ops.OdtDocument=function(f){function k(a){return new core.PositionIterator(a,F,J,!1)}function b(){var a=f.odfContainer().getContentElement(),b=a&&a.localName;runtime.assert("text"===b,"Unsupported content element type '"+b+"' for OdtDocument");return a}function c(){return a.getDocumentElement().ownerDocument}function d(a){for(;a&&!(a.namespaceURI===odf.Namespaces.officens&&"text"===a.localName||a.namespaceURI===odf.Namespaces.officens&&"annotation"===a.localName);)a=a.parentNode;return a}function l(a){this.acceptPosition=
function(b){b=b.container();var c;c="string"===typeof a?y[a].getNode():a;return d(b)===d(c)?v:s}}function n(a,b,c,e){e=k(e);var d;1===c.length?d=c[0]:(d=new core.PositionFilterChain,c.forEach(d.addFilter));c=new core.StepIterator(d,e);c.setPosition(a,b);return c}function p(a){var c=k(b());a=B.convertStepsToDomPoint(a);c.setUnfilteredPosition(a.node,a.offset);return c}function r(a){return a===w}function m(a){var b,c=[],d,f=2;runtime.assert(a.isStep(),"positionIterator is not at a step");do{if(b=e.getContentBounds(a))if(b=
b.container,q.isDowngradableSpaceElement(b)){for(d=b.lastChild;b.firstChild;)c.push(b.firstChild),b.parentNode.insertBefore(b.firstChild,b);b.parentNode.removeChild(b);a.setPosition(d,d.nodeType===Node.TEXT_NODE?d.length:d.childNodes.length);a.roundToPreviousStep()}f-=1}while(0<f&&a.nextStep());c.forEach(g.normalizeTextNodes)}function h(a,b,c){a=a.childNodes.item(b)||a;return(a=q.getParagraphElement(a))&&g.containsNode(c,a)?a:c}var a=this,e,q=odf.OdfUtils,g=core.DomUtils,y={},u={},z=new core.EventNotifier([ops.Document.signalMemberAdded,
ops.Document.signalMemberUpdated,ops.Document.signalMemberRemoved,ops.Document.signalCursorAdded,ops.Document.signalCursorRemoved,ops.Document.signalCursorMoved,ops.OdtDocument.signalParagraphChanged,ops.OdtDocument.signalParagraphStyleModified,ops.OdtDocument.signalCommonStyleCreated,ops.OdtDocument.signalCommonStyleDeleted,ops.OdtDocument.signalTableAdded,ops.OdtDocument.signalOperationStart,ops.OdtDocument.signalOperationEnd,ops.OdtDocument.signalProcessingBatchStart,ops.OdtDocument.signalProcessingBatchEnd,
ops.OdtDocument.signalUndoStackChanged,ops.OdtDocument.signalStepsInserted,ops.OdtDocument.signalStepsRemoved,ops.OdtDocument.signalMetadataUpdated,ops.OdtDocument.signalAnnotationAdded]),v=core.PositionFilter.FilterResult.FILTER_ACCEPT,s=core.PositionFilter.FilterResult.FILTER_REJECT,w=core.StepDirection.NEXT,x,B,I,F=NodeFilter.SHOW_ALL,H=new gui.BlacklistNamespaceNodeFilter(["urn:webodf:names:cursor","urn:webodf:names:editinfo"]),A=new gui.OdfTextBodyNodeFilter,J=new core.NodeFilterChain([H,A]);
this.createPositionIterator=k;this.getDocumentElement=function(){return f.odfContainer().rootElement};this.getDOMDocument=function(){return this.getDocumentElement().ownerDocument};this.cloneDocumentElement=function(){var b=a.getDocumentElement(),c=f.getAnnotationViewManager();c&&c.forgetAnnotations();b=b.cloneNode(!0);f.refreshAnnotations();return b};this.setDocumentElement=function(a){var b=f.odfContainer();b.setRootElement(a);f.setOdfContainer(b,!0);f.refreshCSS()};this.getDOMDocument=c;this.getRootElement=
d;this.createStepIterator=n;this.getIteratorAtPosition=p;this.convertCursorStepToDomPoint=function(a){return B.convertStepsToDomPoint(a)};this.convertDomPointToCursorStep=function(a,b,c){var e;c===w&&(e=r);return B.convertDomPointToSteps(a,b,e)};this.convertDomToCursorRange=function(a){var b;b=B.convertDomPointToSteps(a.anchorNode,a.anchorOffset);a=a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset?b:B.convertDomPointToSteps(a.focusNode,a.focusOffset);return{position:b,length:a-b}};this.convertCursorToDomRange=
function(a,b){var e=c().createRange(),d,g;d=B.convertStepsToDomPoint(a);b?(g=B.convertStepsToDomPoint(a+b),0<b?(e.setStart(d.node,d.offset),e.setEnd(g.node,g.offset)):(e.setStart(g.node,g.offset),e.setEnd(d.node,d.offset))):e.setStart(d.node,d.offset);return e};this.upgradeWhitespacesAtPosition=function(a){var b=p(a),b=new core.StepIterator(x,b),c,d=2;runtime.assert(b.isStep(),"positionIterator is not at a step (requested step: "+a+")");do{if(c=e.getContentBounds(b))if(a=c.container,c=c.startOffset,
a.nodeType===Node.TEXT_NODE&&q.isSignificantWhitespace(a,c)){runtime.assert(" "===a.data[c],"upgradeWhitespaceToElement: textNode.data[offset] should be a literal space");var g=a.ownerDocument.createElementNS(odf.Namespaces.textns,"text:s"),f=a.parentNode,h=a;g.appendChild(a.ownerDocument.createTextNode(" "));1===a.length?f.replaceChild(g,a):(a.deleteData(c,1),0<c&&(c<a.length&&a.splitText(c),h=a.nextSibling),f.insertBefore(g,h));a=g;b.setPosition(a,a.childNodes.length);b.roundToPreviousStep()}d-=
1}while(0<d&&b.nextStep())};this.downgradeWhitespaces=m;this.downgradeWhitespacesAtPosition=function(a){a=p(a);a=new core.StepIterator(x,a);m(a)};this.getTextNodeAtStep=function(b,e){var d=p(b),g=d.container(),f,h=0,l=null;g.nodeType===Node.TEXT_NODE?(f=g,h=d.unfilteredDomOffset(),0<f.length&&(0<h&&(f=f.splitText(h)),f.parentNode.insertBefore(c().createTextNode(""),f),f=f.previousSibling,h=0)):(f=c().createTextNode(""),h=0,g.insertBefore(f,d.rightNode()));if(e){if(y[e]&&a.getCursorPosition(e)===b){for(l=
y[e].getNode();l.nextSibling&&"cursor"===l.nextSibling.localName;)l.parentNode.insertBefore(l.nextSibling,l);0<f.length&&f.nextSibling!==l&&(f=c().createTextNode(""),h=0);l.parentNode.insertBefore(f,l)}}else for(;f.nextSibling&&"cursor"===f.nextSibling.localName;)f.parentNode.insertBefore(f.nextSibling,f);for(;f.previousSibling&&f.previousSibling.nodeType===Node.TEXT_NODE;)d=f.previousSibling,d.appendData(f.data),h=d.length,f=d,f.parentNode.removeChild(f.nextSibling);for(;f.nextSibling&&f.nextSibling.nodeType===
Node.TEXT_NODE;)d=f.nextSibling,f.appendData(d.data),f.parentNode.removeChild(d);return{textNode:f,offset:h}};this.fixCursorPositions=function(){Object.keys(y).forEach(function(b){var c=y[b],e=d(c.getNode()),g=a.createRootFilter(e),f,l,q,m=!1;q=c.getSelectedRange();f=h(q.startContainer,q.startOffset,e);l=n(q.startContainer,q.startOffset,[x,g],f);q.collapsed?e=l:(f=h(q.endContainer,q.endOffset,e),e=n(q.endContainer,q.endOffset,[x,g],f));l.isStep()&&e.isStep()?l.container()!==e.container()||l.offset()!==
e.offset()||q.collapsed&&c.getAnchorNode()===c.getNode()||(m=!0,q.setStart(l.container(),l.offset()),q.collapse(!0)):(m=!0,runtime.assert(l.roundToClosestStep(),"No walkable step found for cursor owned by "+b),q.setStart(l.container(),l.offset()),runtime.assert(e.roundToClosestStep(),"No walkable step found for cursor owned by "+b),q.setEnd(e.container(),e.offset()));m&&(c.setSelectedRange(q,c.hasForwardSelection()),a.emit(ops.Document.signalCursorMoved,c))})};this.getCursorPosition=function(a){return(a=
y[a])?B.convertDomPointToSteps(a.getNode(),0):0};this.getCursorSelection=function(a){a=y[a];var b=0,c=0;a&&(b=B.convertDomPointToSteps(a.getNode(),0),c=B.convertDomPointToSteps(a.getAnchorNode(),0));return{position:c,length:b-c}};this.getPositionFilter=function(){return x};this.getOdfCanvas=function(){return f};this.getCanvas=function(){return f};this.getRootNode=b;this.addMember=function(a){runtime.assert(void 0===u[a.getMemberId()],"This member already exists");u[a.getMemberId()]=a};this.getMember=
function(a){return u.hasOwnProperty(a)?u[a]:null};this.removeMember=function(a){delete u[a]};this.getCursor=function(a){return y[a]};this.getMemberIds=function(){var a=[],b;for(b in y)y.hasOwnProperty(b)&&a.push(y[b].getMemberId());return a};this.addCursor=function(b){runtime.assert(Boolean(b),"OdtDocument::addCursor without cursor");var c=b.getMemberId(),e=a.convertCursorToDomRange(0,0);runtime.assert("string"===typeof c,"OdtDocument::addCursor has cursor without memberid");runtime.assert(!y[c],
"OdtDocument::addCursor is adding a duplicate cursor with memberid "+c);b.setSelectedRange(e,!0);y[c]=b};this.removeCursor=function(b){var c=y[b];return c?(c.removeFromDocument(),delete y[b],a.emit(ops.Document.signalCursorRemoved,b),!0):!1};this.moveCursor=function(b,c,e,d){b=y[b];c=a.convertCursorToDomRange(c,e);b&&(b.setSelectedRange(c,0<=e),b.setSelectionType(d||ops.OdtCursor.RangeSelection))};this.getFormatting=function(){return f.getFormatting()};this.emit=function(a,b){z.emit(a,b)};this.subscribe=
function(a,b){z.subscribe(a,b)};this.unsubscribe=function(a,b){z.unsubscribe(a,b)};this.createRootFilter=function(a){return new l(a)};this.close=function(a){a()};this.destroy=function(a){a()};x=new ops.TextPositionFilter;e=new odf.StepUtils;B=new ops.OdtStepsTranslator(b,k,x,500);z.subscribe(ops.OdtDocument.signalStepsInserted,B.handleStepsInserted);z.subscribe(ops.OdtDocument.signalStepsRemoved,B.handleStepsRemoved);z.subscribe(ops.OdtDocument.signalOperationEnd,function(b){var c=b.spec(),e=c.memberid,
d=(new Date(c.timestamp)).toISOString(),g=f.odfContainer(),h={setProperties:{},removedProperties:[]};b.isEdit&&("UpdateMetadata"===c.optype&&(h.setProperties=JSON.parse(JSON.stringify(c.setProperties)),c.removedProperties&&(h.removedProperties=c.removedProperties.attributes.split(","))),c=a.getMember(e).getProperties().fullName,g.setMetadata({"dc:creator":c,"dc:date":d},null),h.setProperties["dc:creator"]=c,h.setProperties["dc:date"]=d,I||(h.setProperties["meta:editing-cycles"]=g.incrementEditingCycles(),
g.setMetadata(null,["meta:editing-duration","meta:document-statistic"])),I=b,a.emit(ops.OdtDocument.signalMetadataUpdated,h))});z.subscribe(ops.OdtDocument.signalProcessingBatchEnd,core.Task.processTasks)};ops.OdtDocument.signalParagraphChanged="paragraph/changed";ops.OdtDocument.signalTableAdded="table/added";ops.OdtDocument.signalCommonStyleCreated="style/created";ops.OdtDocument.signalCommonStyleDeleted="style/deleted";ops.OdtDocument.signalParagraphStyleModified="paragraphstyle/modified";
ops.OdtDocument.signalOperationStart="operation/start";ops.OdtDocument.signalOperationEnd="operation/end";ops.OdtDocument.signalProcessingBatchStart="router/batchstart";ops.OdtDocument.signalProcessingBatchEnd="router/batchend";ops.OdtDocument.signalUndoStackChanged="undo/changed";ops.OdtDocument.signalStepsInserted="steps/inserted";ops.OdtDocument.signalStepsRemoved="steps/removed";ops.OdtDocument.signalMetadataUpdated="metadata/updated";ops.OdtDocument.signalAnnotationAdded="annotation/added";ops.OpAddAnnotation=function(){function f(b,c,d){var f=b.getTextNodeAtStep(d,k);f&&(b=f.textNode,d=b.parentNode,f.offset!==b.length&&b.splitText(f.offset),d.insertBefore(c,b.nextSibling),0===b.length&&d.removeChild(b))}var k,b,c,d,l,n;this.init=function(f){k=f.memberid;b=parseInt(f.timestamp,10);c=parseInt(f.position,10);d=parseInt(f.length,10)||0;l=f.name};this.isEdit=!0;this.group=void 0;this.execute=function(p){var r=p.getCursor(k),m,h;n=p.getDOMDocument();var a=new Date(b),e,q,g;e=n.createElementNS(odf.Namespaces.officens,
"office:annotation");e.setAttributeNS(odf.Namespaces.officens,"office:name",l);m=n.createElementNS(odf.Namespaces.dcns,"dc:creator");m.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",k);m.textContent=p.getMember(k).getProperties().fullName;h=n.createElementNS(odf.Namespaces.dcns,"dc:date");h.appendChild(n.createTextNode(a.toISOString()));a=n.createElementNS(odf.Namespaces.textns,"text:list");q=n.createElementNS(odf.Namespaces.textns,"text:list-item");g=n.createElementNS(odf.Namespaces.textns,
"text:p");q.appendChild(g);a.appendChild(q);e.appendChild(m);e.appendChild(h);e.appendChild(a);d&&(m=n.createElementNS(odf.Namespaces.officens,"office:annotation-end"),m.setAttributeNS(odf.Namespaces.officens,"office:name",l),e.annotationEndElement=m,f(p,m,c+d));f(p,e,c);p.emit(ops.OdtDocument.signalStepsInserted,{position:c});r&&(m=n.createRange(),h=e.getElementsByTagNameNS(odf.Namespaces.textns,"p")[0],m.selectNodeContents(h),r.setSelectedRange(m,!1),r.setSelectionType(ops.OdtCursor.RangeSelection),
p.emit(ops.Document.signalCursorMoved,r));p.getOdfCanvas().addAnnotation(e);p.fixCursorPositions();p.emit(ops.OdtDocument.signalAnnotationAdded,{memberId:k,annotation:e});return!0};this.spec=function(){return{optype:"AddAnnotation",memberid:k,timestamp:b,position:c,length:d,name:l}}};ops.OpAddCursor=function(){var f,k;this.init=function(b){f=b.memberid;k=b.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(b){var c=b.getCursor(f);if(c)return!1;c=new ops.OdtCursor(f,b);b.addCursor(c);b.emit(ops.Document.signalCursorAdded,c);return!0};this.spec=function(){return{optype:"AddCursor",memberid:f,timestamp:k}}};ops.OpAddMember=function(){var f,k,b;this.init=function(c){f=c.memberid;k=parseInt(c.timestamp,10);b=c.setProperties};this.isEdit=!1;this.group=void 0;this.execute=function(c){var d;if(c.getMember(f))return!1;d=new ops.Member(f,b);c.addMember(d);c.emit(ops.Document.signalMemberAdded,d);return!0};this.spec=function(){return{optype:"AddMember",memberid:f,timestamp:k,setProperties:b}}};ops.OpAddStyle=function(){var f,k,b,c,d,l,n=odf.Namespaces.stylens;this.init=function(n){f=n.memberid;k=n.timestamp;b=n.styleName;c=n.styleFamily;d="true"===n.isAutomaticStyle||!0===n.isAutomaticStyle;l=n.setProperties};this.isEdit=!0;this.group=void 0;this.execute=function(f){var k=f.getOdfCanvas().odfContainer(),m=f.getFormatting(),h=f.getDOMDocument().createElementNS(n,"style:style");if(!h)return!1;l&&m.updateStyle(h,l);h.setAttributeNS(n,"style:family",c);h.setAttributeNS(n,"style:name",b);d?
k.rootElement.automaticStyles.appendChild(h):k.rootElement.styles.appendChild(h);f.getOdfCanvas().refreshCSS();d||f.emit(ops.OdtDocument.signalCommonStyleCreated,{name:b,family:c});return!0};this.spec=function(){return{optype:"AddStyle",memberid:f,timestamp:k,styleName:b,styleFamily:c,isAutomaticStyle:d,setProperties:l}}};odf.ObjectNameGenerator=function(f,k){function b(a,b){var c={};this.generateName=function(){var e=b(),d=0,f;do f=a+d,d+=1;while(c[f]||e[f]);c[f]=!0;return f}}function c(){var a={};[f.rootElement.automaticStyles,f.rootElement.styles].forEach(function(b){for(b=b.firstElementChild;b;)b.namespaceURI===d&&"style"===b.localName&&(a[b.getAttributeNS(d,"name")]=!0),b=b.nextElementSibling});return a}var d=odf.Namespaces.stylens,l=odf.Namespaces.drawns,n=odf.Namespaces.xlinkns,p=(new core.Utils).hashString(k),
r=null,m=null,h=null,a={},e={};this.generateStyleName=function(){null===r&&(r=new b("auto"+p+"_",function(){return c()}));return r.generateName()};this.generateFrameName=function(){var c,e,d;if(null===m){e=f.rootElement.body.getElementsByTagNameNS(l,"frame");for(c=0;c<e.length;c+=1)d=e.item(c),a[d.getAttributeNS(l,"name")]=!0;m=new b("fr"+p+"_",function(){return a})}return m.generateName()};this.generateImageName=function(){var a,c,d;if(null===h){d=f.rootElement.body.getElementsByTagNameNS(l,"image");
for(a=0;a<d.length;a+=1)c=d.item(a),c=c.getAttributeNS(n,"href"),c=c.substring(9,c.lastIndexOf(".")),e[c]=!0;h=new b("img"+p+"_",function(){return e})}return h.generateName()}};odf.TextStyleApplicator=function(f,k,b){function c(b){function c(a,b){return"object"===typeof a&&"object"===typeof b?Object.keys(a).every(function(d){return c(a[d],b[d])}):a===b}var a={};this.isStyleApplied=function(e){e=k.getAppliedStylesForElement(e,a).styleProperties;return c(b,e)}}function d(c){var d={};this.applyStyleToContainer=function(a){var e;e=a.getAttributeNS(p,"style-name");var l=a.ownerDocument;e=e||"";if(!d.hasOwnProperty(e)){var g=e,n;n=e?k.createDerivedStyleObject(e,"text",c):c;l=
l.createElementNS(r,"style:style");k.updateStyle(l,n);l.setAttributeNS(r,"style:name",f.generateStyleName());l.setAttributeNS(r,"style:family","text");l.setAttributeNS("urn:webodf:names:scope","scope","document-content");b.appendChild(l);d[g]=l}e=d[e].getAttributeNS(r,"name");a.setAttributeNS(p,"text:style-name",e)}}function l(b,c){var a=b.ownerDocument,e=b.parentNode,d,g,f,l=new core.LoopWatchDog(1E4);g=[];g.push(b);for(f=b.nextSibling;f&&n.rangeContainsNode(c,f);)l.check(),g.push(f),f=f.nextSibling;
"span"!==e.localName||e.namespaceURI!==p?(d=a.createElementNS(p,"text:span"),e.insertBefore(d,b),a=!1):(b.previousSibling&&!n.rangeContainsNode(c,e.firstChild)?(d=e.cloneNode(!1),e.parentNode.insertBefore(d,e.nextSibling)):d=e,a=!0);g.forEach(function(a){a.parentNode!==d&&d.appendChild(a)});if(f&&a)for(g=d.cloneNode(!1),d.parentNode.insertBefore(g,d.nextSibling);f;)l.check(),a=f.nextSibling,g.appendChild(f),f=a;return d}var n=core.DomUtils,p=odf.Namespaces.textns,r=odf.Namespaces.stylens;this.applyStyle=
function(b,f,a){var e={},q,g,n,k;runtime.assert(a&&a.hasOwnProperty("style:text-properties"),"applyStyle without any text properties");e["style:text-properties"]=a["style:text-properties"];n=new d(e);k=new c(e);b.forEach(function(a){q=k.isStyleApplied(a);!1===q&&(g=l(a,f),n.applyStyleToContainer(g))})}};ops.OpApplyDirectStyling=function(){function f(b,c,d){var a=b.getOdfCanvas().odfContainer(),e=p.splitBoundaries(c),f=n.getTextNodes(c,!1);(new odf.TextStyleApplicator(new odf.ObjectNameGenerator(a,k),b.getFormatting(),a.rootElement.automaticStyles)).applyStyle(f,c,d);e.forEach(p.normalizeTextNodes)}var k,b,c,d,l,n=odf.OdfUtils,p=core.DomUtils;this.init=function(f){k=f.memberid;b=f.timestamp;c=parseInt(f.position,10);d=parseInt(f.length,10);l=f.setProperties};this.isEdit=!0;this.group=void 0;this.execute=
function(p){var m=p.convertCursorToDomRange(c,d),h=n.getParagraphElements(m);f(p,m,l);m.detach();p.getOdfCanvas().refreshCSS();p.fixCursorPositions();h.forEach(function(a){p.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:a,memberId:k,timeStamp:b})});p.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"ApplyDirectStyling",memberid:k,timestamp:b,position:c,length:d,setProperties:l}}};ops.OpApplyHyperlink=function(){function f(b){for(;b;){if(p.isHyperlink(b))return!0;b=b.parentNode}return!1}var k,b,c,d,l,n=core.DomUtils,p=odf.OdfUtils;this.init=function(f){k=f.memberid;b=f.timestamp;c=f.position;d=f.length;l=f.hyperlink};this.isEdit=!0;this.group=void 0;this.execute=function(r){var m=r.getDOMDocument(),h=r.convertCursorToDomRange(c,d),a=n.splitBoundaries(h),e=[],q=p.getTextNodes(h,!1);if(0===q.length)return!1;q.forEach(function(a){var b=p.getParagraphElement(a);runtime.assert(!1===
f(a),"The given range should not contain any link.");var c=l,d=m.createElementNS(odf.Namespaces.textns,"text:a");d.setAttributeNS(odf.Namespaces.xlinkns,"xlink:type","simple");d.setAttributeNS(odf.Namespaces.xlinkns,"xlink:href",c);a.parentNode.insertBefore(d,a);d.appendChild(a);-1===e.indexOf(b)&&e.push(b)});a.forEach(n.normalizeTextNodes);h.detach();r.fixCursorPositions();r.getOdfCanvas().refreshSize();r.getOdfCanvas().rerenderAnnotations();e.forEach(function(a){r.emit(ops.OdtDocument.signalParagraphChanged,
{paragraphElement:a,memberId:k,timeStamp:b})});return!0};this.spec=function(){return{optype:"ApplyHyperlink",memberid:k,timestamp:b,position:c,length:d,hyperlink:l}}};ops.OpInsertImage=function(){var f,k,b,c,d,l,n,p,r=odf.Namespaces.drawns,m=odf.Namespaces.svgns,h=odf.Namespaces.textns,a=odf.Namespaces.xlinkns,e=odf.OdfUtils;this.init=function(a){f=a.memberid;k=a.timestamp;b=a.position;c=a.filename;d=a.frameWidth;l=a.frameHeight;n=a.frameStyleName;p=a.frameName};this.isEdit=!0;this.group=void 0;this.execute=function(q){var g=q.getOdfCanvas(),y=q.getTextNodeAtStep(b,f),u,z;if(!y)return!1;u=y.textNode;z=e.getParagraphElement(u);var y=y.offset!==u.length?u.splitText(y.offset):
u.nextSibling,v=q.getDOMDocument(),s=v.createElementNS(r,"draw:image"),v=v.createElementNS(r,"draw:frame");s.setAttributeNS(a,"xlink:href",c);s.setAttributeNS(a,"xlink:type","simple");s.setAttributeNS(a,"xlink:show","embed");s.setAttributeNS(a,"xlink:actuate","onLoad");v.setAttributeNS(r,"draw:style-name",n);v.setAttributeNS(r,"draw:name",p);v.setAttributeNS(h,"text:anchor-type","as-char");v.setAttributeNS(m,"svg:width",d);v.setAttributeNS(m,"svg:height",l);v.appendChild(s);u.parentNode.insertBefore(v,
y);q.emit(ops.OdtDocument.signalStepsInserted,{position:b});0===u.length&&u.parentNode.removeChild(u);g.addCssForFrameWithImage(v);g.refreshCSS();q.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:z,memberId:f,timeStamp:k});g.rerenderAnnotations();return!0};this.spec=function(){return{optype:"InsertImage",memberid:f,timestamp:k,filename:c,position:b,frameWidth:d,frameHeight:l,frameStyleName:n,frameName:p}}};ops.OpInsertTable=function(){function f(a,b){var f;if(1===m.length)f=m[0];else if(3===m.length)switch(a){case 0:f=m[0];break;case c-1:f=m[2];break;default:f=m[1]}else f=m[a];if(1===f.length)return f[0];if(3===f.length)switch(b){case 0:return f[0];case d-1:return f[2];default:return f[1]}return f[b]}var k,b,c,d,l,n,p,r,m,h=odf.OdfUtils;this.init=function(a){k=a.memberid;b=a.timestamp;l=a.position;c=a.initialRows;d=a.initialColumns;n=a.tableName;p=a.tableStyleName;r=a.tableColumnStyleName;m=a.tableCellStyleMatrix};
this.isEdit=!0;this.group=void 0;this.execute=function(a){var e=a.getTextNodeAtStep(l),q=a.getRootNode();if(e){var g=a.getDOMDocument(),m=g.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table"),u=g.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-column"),z,v,s,w;p&&m.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",p);n&&m.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:name",n);u.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0",
"table:number-columns-repeated",d);r&&u.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",r);m.appendChild(u);for(s=0;s<c;s+=1){u=g.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-row");for(w=0;w<d;w+=1)z=g.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-cell"),(v=f(s,w))&&z.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",v),v=g.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0",
"text:p"),z.appendChild(v),u.appendChild(z);m.appendChild(u)}e=h.getParagraphElement(e.textNode);q.insertBefore(m,e.nextSibling);a.emit(ops.OdtDocument.signalStepsInserted,{position:l});a.getOdfCanvas().refreshSize();a.emit(ops.OdtDocument.signalTableAdded,{tableElement:m,memberId:k,timeStamp:b});a.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertTable",memberid:k,timestamp:b,position:l,initialRows:c,initialColumns:d,tableName:n,tableStyleName:p,tableColumnStyleName:r,
tableCellStyleMatrix:m}}};ops.OpInsertText=function(){var f,k,b,c,d,l=odf.OdfUtils;this.init=function(l){f=l.memberid;k=l.timestamp;b=l.position;d=l.text;c="true"===l.moveCursor||!0===l.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(n){var p,r,m,h=null,a=n.getDOMDocument(),e,q=0,g,y=n.getCursor(f),u;n.upgradeWhitespacesAtPosition(b);if(p=n.getTextNodeAtStep(b)){r=p.textNode;h=r.nextSibling;m=r.parentNode;e=l.getParagraphElement(r);for(u=0;u<d.length;u+=1)if("\t"===d[u]||"\t"!==d[u]&&l.isODFWhitespace(d[u])&&
(0===u||u===d.length-1||"\t"!==d[u-1]&&l.isODFWhitespace(d[u-1])))0===q?(p.offset!==r.length&&(h=r.splitText(p.offset)),0<u&&r.appendData(d.substring(0,u))):q<u&&(q=d.substring(q,u),m.insertBefore(a.createTextNode(q),h)),q=u+1,"\t"===d[u]?(g=a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:tab"),g.appendChild(a.createTextNode("\t"))):(" "!==d[u]&&runtime.log("WARN: InsertText operation contains non-tab, non-space whitespace character (character code "+d.charCodeAt(u)+")"),
g=a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:s"),g.appendChild(a.createTextNode(" "))),m.insertBefore(g,h);0===q?r.insertData(p.offset,d):q<d.length&&(p=d.substring(q),m.insertBefore(a.createTextNode(p),h));m=r.parentNode;h=r.nextSibling;m.removeChild(r);m.insertBefore(r,h);0===r.length&&r.parentNode.removeChild(r);n.emit(ops.OdtDocument.signalStepsInserted,{position:b});y&&c&&(n.moveCursor(f,b+d.length,0),n.emit(ops.Document.signalCursorMoved,y));n.downgradeWhitespacesAtPosition(b);
n.downgradeWhitespacesAtPosition(b+d.length);n.getOdfCanvas().refreshSize();n.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:e,memberId:f,timeStamp:k});n.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertText",memberid:f,timestamp:k,position:b,text:d,moveCursor:c}}};odf.CollapsingRules=function(f){function k(b){return c.isODFNode(b)||"br"===b.localName&&c.isLineBreak(b.parentNode)||b.nodeType===Node.TEXT_NODE&&c.isODFNode(b.parentNode)}function b(l){var n;l.nodeType===Node.TEXT_NODE?(n=l.parentNode,n.removeChild(l)):n=d.removeUnwantedNodes(l,k);return n&&!c.isParagraph(n)&&n!==f&&c.hasNoODFContent(n)?b(n):n}var c=odf.OdfUtils,d=core.DomUtils;this.mergeChildrenIntoParent=b};ops.OpMergeParagraph=function(){function f(a){return h.isGroupingElement(a)&&h.hasNoODFContent(a)}function k(a){if(a.nodeType===Node.TEXT_NODE){if(0===a.length)return runtime.log("WARN: Empty text node found during merge operation"),!0;if(h.isODFWhitespace(a.data)&&!1===h.isSignificantWhitespace(a,0))return!0;a="#text"}else a=(a.prefix?a.prefix+":":"")+a.localName;runtime.log("WARN: Unexpected text element found near paragraph boundary ["+a+"]");return!1}function b(b){b.collapsed||(a.splitBoundaries(b),
b=h.getTextElements(b,!1,!0).filter(k),b.forEach(function(a){a.parentNode.removeChild(a)}))}function c(a,b,c){a=a.convertCursorStepToDomPoint(b);var e=h.getParagraphElement(a.node,a.offset);runtime.assert(Boolean(e),"Paragraph not found at step "+b);c&&c.setPosition(a.node,a.offset);return e}var d,l,n,p,r,m,h=odf.OdfUtils,a=core.DomUtils,e=odf.Namespaces.textns;this.init=function(a){d=a.memberid;l=a.timestamp;n=a.moveCursor;p=a.paragraphStyleName;r=parseInt(a.sourceStartPosition,10);m=parseInt(a.destinationStartPosition,
10)};this.isEdit=!0;this.group=void 0;this.execute=function(h){var g,k,u=h.getCursor(d);g=h.getRootNode();var z=new odf.CollapsingRules(g),v=h.createStepIterator(g,0,[h.getPositionFilter()],g),s;runtime.assert(m<r,"Destination paragraph ("+m+") must be before source paragraph ("+r+")");k=c(h,m);g=c(h,r,v);v.previousStep();runtime.assert(a.containsNode(k,v.container()),"Destination paragraph must be adjacent to the source paragraph");s=k.ownerDocument.createRange();v.setPosition(k,k.childNodes.length);
v.roundToPreviousStep();s.setStart(v.container(),v.offset());s.setEnd(k,k.childNodes.length);b(s);s=k.childNodes.length;var w=g.ownerDocument.createRange();v.setPosition(g,0);v.roundToNextStep();w.setStart(g,0);w.setEnd(v.container(),v.offset());b(w);for(w=g.firstChild;w;)"editinfo"===w.localName?g.removeChild(w):(k.appendChild(w),a.removeUnwantedNodes(w,f)),w=g.firstChild;runtime.assert(0===g.childNodes.length,"Source paragraph should be empty before it is removed");z.mergeChildrenIntoParent(g);
h.emit(ops.OdtDocument.signalStepsRemoved,{position:r-1});v.setPosition(k,s);v.roundToClosestStep();v.previousStep()||v.roundToNextStep();h.downgradeWhitespaces(v);p?k.setAttributeNS(e,"text:style-name",p):k.removeAttributeNS(e,"style-name");u&&n&&(h.moveCursor(d,r-1,0),h.emit(ops.Document.signalCursorMoved,u));h.fixCursorPositions();h.getOdfCanvas().refreshSize();h.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:k,memberId:d,timeStamp:l});h.getOdfCanvas().rerenderAnnotations();return!0};
this.spec=function(){return{optype:"MergeParagraph",memberid:d,timestamp:l,moveCursor:n,paragraphStyleName:p,sourceStartPosition:r,destinationStartPosition:m}}};ops.OpMoveCursor=function(){var f,k,b,c,d;this.init=function(l){f=l.memberid;k=l.timestamp;b=l.position;c=l.length||0;d=l.selectionType||ops.OdtCursor.RangeSelection};this.isEdit=!1;this.group=void 0;this.execute=function(l){var n=l.getCursor(f),k;if(!n)return!1;k=l.convertCursorToDomRange(b,c);n.setSelectedRange(k,0<=c);n.setSelectionType(d);l.emit(ops.Document.signalCursorMoved,n);return!0};this.spec=function(){return{optype:"MoveCursor",memberid:f,timestamp:k,position:b,length:c,selectionType:d}}};ops.OpRemoveAnnotation=function(){var f,k,b,c,d=core.DomUtils;this.init=function(d){f=d.memberid;k=d.timestamp;b=parseInt(d.position,10);c=parseInt(d.length,10)};this.isEdit=!0;this.group=void 0;this.execute=function(c){function f(b){r.parentNode.insertBefore(b,r)}for(var k=c.getIteratorAtPosition(b).container(),r;k.namespaceURI!==odf.Namespaces.officens||"annotation"!==k.localName;)k=k.parentNode;if(null===k)return!1;r=k;k=r.annotationEndElement;c.getOdfCanvas().forgetAnnotations();d.getElementsByTagNameNS(r,
"urn:webodf:names:cursor","cursor").forEach(f);d.getElementsByTagNameNS(r,"urn:webodf:names:cursor","anchor").forEach(f);r.parentNode.removeChild(r);k&&k.parentNode.removeChild(k);c.emit(ops.OdtDocument.signalStepsRemoved,{position:0<b?b-1:b});c.fixCursorPositions();c.getOdfCanvas().refreshAnnotations();return!0};this.spec=function(){return{optype:"RemoveAnnotation",memberid:f,timestamp:k,position:b,length:c}}};ops.OpRemoveBlob=function(){var f,k,b;this.init=function(c){f=c.memberid;k=c.timestamp;b=c.filename};this.isEdit=!0;this.group=void 0;this.execute=function(c){c.getOdfCanvas().odfContainer().removeBlob(b);return!0};this.spec=function(){return{optype:"RemoveBlob",memberid:f,timestamp:k,filename:b}}};ops.OpRemoveCursor=function(){var f,k;this.init=function(b){f=b.memberid;k=b.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(b){return b.removeCursor(f)?!0:!1};this.spec=function(){return{optype:"RemoveCursor",memberid:f,timestamp:k}}};ops.OpRemoveHyperlink=function(){var f,k,b,c,d=core.DomUtils,l=odf.OdfUtils;this.init=function(d){f=d.memberid;k=d.timestamp;b=d.position;c=d.length};this.isEdit=!0;this.group=void 0;this.execute=function(n){var p=n.convertCursorToDomRange(b,c),r=l.getHyperlinkElements(p);runtime.assert(1===r.length,"The given range should only contain a single link.");r=d.mergeIntoParent(r[0]);p.detach();n.fixCursorPositions();n.getOdfCanvas().refreshSize();n.getOdfCanvas().rerenderAnnotations();n.emit(ops.OdtDocument.signalParagraphChanged,
{paragraphElement:l.getParagraphElement(r),memberId:f,timeStamp:k});return!0};this.spec=function(){return{optype:"RemoveHyperlink",memberid:f,timestamp:k,position:b,length:c}}};ops.OpRemoveMember=function(){var f,k;this.init=function(b){f=b.memberid;k=parseInt(b.timestamp,10)};this.isEdit=!1;this.group=void 0;this.execute=function(b){if(!b.getMember(f))return!1;b.removeMember(f);b.emit(ops.Document.signalMemberRemoved,f);return!0};this.spec=function(){return{optype:"RemoveMember",memberid:f,timestamp:k}}};ops.OpRemoveStyle=function(){var f,k,b,c;this.init=function(d){f=d.memberid;k=d.timestamp;b=d.styleName;c=d.styleFamily};this.isEdit=!0;this.group=void 0;this.execute=function(d){var f=d.getFormatting().getStyleElement(b,c);if(!f)return!1;f.parentNode.removeChild(f);d.getOdfCanvas().refreshCSS();d.emit(ops.OdtDocument.signalCommonStyleDeleted,{name:b,family:c});return!0};this.spec=function(){return{optype:"RemoveStyle",memberid:f,timestamp:k,styleName:b,styleFamily:c}}};ops.OpRemoveText=function(){var f,k,b,c,d=odf.OdfUtils,l=core.DomUtils;this.init=function(d){runtime.assert(0<=d.length,"OpRemoveText only supports positive lengths");f=d.memberid;k=d.timestamp;b=parseInt(d.position,10);c=parseInt(d.length,10)};this.isEdit=!0;this.group=void 0;this.execute=function(n){var p,r,m,h=n.getCursor(f),a=new odf.CollapsingRules(n.getRootNode());n.upgradeWhitespacesAtPosition(b);n.upgradeWhitespacesAtPosition(b+c);p=n.convertCursorToDomRange(b,c);l.splitBoundaries(p);r=d.getTextElements(p,
!1,!0);m=d.getParagraphElement(p.startContainer,p.startOffset);runtime.assert(void 0!==m,"Attempting to remove text outside a paragraph element");p.detach();r.forEach(function(b){b.parentNode?(runtime.assert(l.containsNode(m,b),"RemoveText only supports removing elements within the same paragraph"),a.mergeChildrenIntoParent(b)):runtime.log("WARN: text element has already been removed from it's container")});n.emit(ops.OdtDocument.signalStepsRemoved,{position:b});n.downgradeWhitespacesAtPosition(b);
n.fixCursorPositions();n.getOdfCanvas().refreshSize();n.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:m,memberId:f,timeStamp:k});h&&(h.resetSelectionType(),n.emit(ops.Document.signalCursorMoved,h));n.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"RemoveText",memberid:f,timestamp:k,position:b,length:c}}};ops.OpSetBlob=function(){var f,k,b,c,d;this.init=function(l){f=l.memberid;k=l.timestamp;b=l.filename;c=l.mimetype;d=l.content};this.isEdit=!0;this.group=void 0;this.execute=function(f){f.getOdfCanvas().odfContainer().setBlob(b,c,d);return!0};this.spec=function(){return{optype:"SetBlob",memberid:f,timestamp:k,filename:b,mimetype:c,content:d}}};ops.OpSetParagraphStyle=function(){function f(b,c,d){var f=[b.getPositionFilter()],h=d.container();d=d.unfilteredDomOffset();return!1===b.createStepIterator(h,d,f,c).previousStep()}var k,b,c,d,l=odf.OdfUtils;this.init=function(f){k=f.memberid;b=f.timestamp;c=f.position;d=f.styleName};this.isEdit=!0;this.group=void 0;this.execute=function(n){var p,r;p=n.getIteratorAtPosition(c);return(r=l.getParagraphElement(p.container()))?(runtime.assert(f(n,r,p),"SetParagraphStyle position should be the first position in the paragraph"),
d?r.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:style-name",d):r.removeAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","style-name"),n.getOdfCanvas().refreshSize(),n.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:r,timeStamp:b,memberId:k}),n.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=function(){return{optype:"SetParagraphStyle",memberid:k,timestamp:b,position:c,styleName:d}}};ops.OpSplitParagraph=function(){var f,k,b,c,d,l,n=odf.OdfUtils,p=odf.Namespaces.textns;this.init=function(n){f=n.memberid;k=n.timestamp;c=n.position;b=n.sourceParagraphPosition;l=n.paragraphStyleName;d="true"===n.moveCursor||!0===n.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(b){var m,h,a,e,q,g,y,u=b.getCursor(f);b.upgradeWhitespacesAtPosition(c);m=b.getTextNodeAtStep(c);if(!m)return!1;h=n.getParagraphElement(m.textNode);if(!h)return!1;a=n.isListItem(h.parentNode)?h.parentNode:
h;0===m.offset?(y=m.textNode.previousSibling,g=null):(y=m.textNode,g=m.offset>=m.textNode.length?null:m.textNode.splitText(m.offset));for(e=m.textNode;e!==a;){e=e.parentNode;q=e.cloneNode(!1);g&&q.appendChild(g);if(y)for(;y&&y.nextSibling;)q.appendChild(y.nextSibling);else for(;e.firstChild;)q.appendChild(e.firstChild);e.parentNode.insertBefore(q,e.nextSibling);y=e;g=q}n.isListItem(g)&&(g=g.childNodes.item(0));l?g.setAttributeNS(p,"text:style-name",l):g.removeAttributeNS(p,"style-name");0===m.textNode.length&&
m.textNode.parentNode.removeChild(m.textNode);b.emit(ops.OdtDocument.signalStepsInserted,{position:c});u&&d&&(b.moveCursor(f,c+1,0),b.emit(ops.Document.signalCursorMoved,u));b.fixCursorPositions();b.getOdfCanvas().refreshSize();b.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:h,memberId:f,timeStamp:k});b.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:g,memberId:f,timeStamp:k});b.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"SplitParagraph",
memberid:f,timestamp:k,position:c,sourceParagraphPosition:b,paragraphStyleName:l,moveCursor:d}}};ops.OpUpdateMember=function(){function f(b){var d="//dc:creator[@editinfo:memberid='"+k+"']";b=xmldom.XPath.getODFElementsWithXPath(b.getRootNode(),d,function(b){return"editinfo"===b?"urn:webodf:names:editinfo":odf.Namespaces.lookupNamespaceURI(b)});for(d=0;d<b.length;d+=1)b[d].textContent=c.fullName}var k,b,c,d;this.init=function(f){k=f.memberid;b=parseInt(f.timestamp,10);c=f.setProperties;d=f.removedProperties};this.isEdit=!1;this.group=void 0;this.execute=function(b){var n=b.getMember(k);if(!n)return!1;
d&&n.removeProperties(d);c&&(n.setProperties(c),c.fullName&&f(b));b.emit(ops.Document.signalMemberUpdated,n);return!0};this.spec=function(){return{optype:"UpdateMember",memberid:k,timestamp:b,setProperties:c,removedProperties:d}}};ops.OpUpdateMetadata=function(){var f,k,b,c;this.init=function(d){f=d.memberid;k=parseInt(d.timestamp,10);b=d.setProperties;c=d.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(d){d=d.getOdfCanvas().odfContainer();var f=null;c&&(f=c.attributes.split(","));d.setMetadata(b,f);return!0};this.spec=function(){return{optype:"UpdateMetadata",memberid:f,timestamp:k,setProperties:b,removedProperties:c}}};ops.OpUpdateParagraphStyle=function(){function f(b,c){var d,f,a=c?c.split(","):[];for(d=0;d<a.length;d+=1)f=a[d].split(":"),b.removeAttributeNS(odf.Namespaces.lookupNamespaceURI(f[0]),f[1])}var k,b,c,d,l,n=odf.Namespaces.stylens;this.init=function(f){k=f.memberid;b=f.timestamp;c=f.styleName;d=f.setProperties;l=f.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(b){var k=b.getFormatting(),m,h,a;return(m=""!==c?k.getStyleElement(c,"paragraph"):k.getDefaultStyleElement("paragraph"))?
(h=m.getElementsByTagNameNS(n,"paragraph-properties").item(0),a=m.getElementsByTagNameNS(n,"text-properties").item(0),d&&k.updateStyle(m,d),l&&(k=l["style:paragraph-properties"],h&&k&&(f(h,k.attributes),0===h.attributes.length&&m.removeChild(h)),k=l["style:text-properties"],a&&k&&(f(a,k.attributes),0===a.attributes.length&&m.removeChild(a)),f(m,l.attributes)),b.getOdfCanvas().refreshCSS(),b.emit(ops.OdtDocument.signalParagraphStyleModified,c),b.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=
function(){return{optype:"UpdateParagraphStyle",memberid:k,timestamp:b,styleName:c,setProperties:d,removedProperties:l}}};ops.OperationFactory=function(){function f(b){return function(c){return new b}}var k;this.register=function(b,c){k[b]=c};this.create=function(b){var c=null,d=k[b.optype];d&&(c=d(b),c.init(b));return c};k={AddMember:f(ops.OpAddMember),UpdateMember:f(ops.OpUpdateMember),RemoveMember:f(ops.OpRemoveMember),AddCursor:f(ops.OpAddCursor),ApplyDirectStyling:f(ops.OpApplyDirectStyling),SetBlob:f(ops.OpSetBlob),RemoveBlob:f(ops.OpRemoveBlob),InsertImage:f(ops.OpInsertImage),InsertTable:f(ops.OpInsertTable),
InsertText:f(ops.OpInsertText),RemoveText:f(ops.OpRemoveText),MergeParagraph:f(ops.OpMergeParagraph),SplitParagraph:f(ops.OpSplitParagraph),SetParagraphStyle:f(ops.OpSetParagraphStyle),UpdateParagraphStyle:f(ops.OpUpdateParagraphStyle),AddStyle:f(ops.OpAddStyle),RemoveStyle:f(ops.OpRemoveStyle),MoveCursor:f(ops.OpMoveCursor),RemoveCursor:f(ops.OpRemoveCursor),AddAnnotation:f(ops.OpAddAnnotation),RemoveAnnotation:f(ops.OpRemoveAnnotation),UpdateMetadata:f(ops.OpUpdateMetadata),ApplyHyperlink:f(ops.OpApplyHyperlink),
RemoveHyperlink:f(ops.OpRemoveHyperlink)}};ops.OperationRouter=function(){};ops.OperationRouter.prototype.setOperationFactory=function(f){};ops.OperationRouter.prototype.setPlaybackFunction=function(f){};ops.OperationRouter.prototype.push=function(f){};ops.OperationRouter.prototype.close=function(f){};ops.OperationRouter.prototype.subscribe=function(f,k){};ops.OperationRouter.prototype.unsubscribe=function(f,k){};ops.OperationRouter.prototype.hasLocalUnsyncedOps=function(){};ops.OperationRouter.prototype.hasSessionHostConnection=function(){};
ops.OperationRouter.signalProcessingBatchStart="router/batchstart";ops.OperationRouter.signalProcessingBatchEnd="router/batchend";ops.TrivialOperationRouter=function(){var f=new core.EventNotifier([ops.OperationRouter.signalProcessingBatchStart,ops.OperationRouter.signalProcessingBatchEnd]),k,b,c=0;this.setOperationFactory=function(b){k=b};this.setPlaybackFunction=function(c){b=c};this.push=function(d){c+=1;f.emit(ops.OperationRouter.signalProcessingBatchStart,{});d.forEach(function(d){d=d.spec();d.timestamp=Date.now();d=k.create(d);d.group="g"+c;b(d)});f.emit(ops.OperationRouter.signalProcessingBatchEnd,{})};this.close=function(b){b()};
this.subscribe=function(b,c){f.subscribe(b,c)};this.unsubscribe=function(b,c){f.unsubscribe(b,c)};this.hasLocalUnsyncedOps=function(){return!1};this.hasSessionHostConnection=function(){return!0}};ops.Session=function(f){function k(b){d.emit(ops.OdtDocument.signalProcessingBatchStart,b)}function b(b){d.emit(ops.OdtDocument.signalProcessingBatchEnd,b)}var c=new ops.OperationFactory,d=new ops.OdtDocument(f),l=null;this.setOperationFactory=function(b){c=b;l&&l.setOperationFactory(c)};this.setOperationRouter=function(f){l&&(l.unsubscribe(ops.OperationRouter.signalProcessingBatchStart,k),l.unsubscribe(ops.OperationRouter.signalProcessingBatchEnd,b));l=f;l.subscribe(ops.OperationRouter.signalProcessingBatchStart,
k);l.subscribe(ops.OperationRouter.signalProcessingBatchEnd,b);f.setPlaybackFunction(function(b){d.emit(ops.OdtDocument.signalOperationStart,b);return b.execute(d)?(d.emit(ops.OdtDocument.signalOperationEnd,b),!0):!1});f.setOperationFactory(c)};this.getOperationFactory=function(){return c};this.getOdtDocument=function(){return d};this.enqueue=function(b){l.push(b)};this.close=function(b){l.close(function(c){c?b(c):d.close(b)})};this.destroy=function(b){d.destroy(b)};this.setOperationRouter(new ops.TrivialOperationRouter)};gui.AnnotationController=function(f,k,b){function c(){var a=p.getCursor(b),a=a&&a.getNode(),c=!1;a&&(c=!h.isWithinAnnotation(a,p.getRootNode()));c!==r&&(r=c,m.emit(gui.AnnotationController.annotatableChanged,r))}function d(a){a.getMemberId()===b&&c()}function l(a){a===b&&c()}function n(a){a.getMemberId()===b&&c()}var p=f.getOdtDocument(),r=!1,m=new core.EventNotifier([gui.AnnotationController.annotatableChanged]),h=odf.OdfUtils,a=core.StepDirection.NEXT;this.isAnnotatable=function(){return r};this.addAnnotation=
function(){var a=new ops.OpAddAnnotation,c=p.getCursorSelection(b),d=c.length,c=c.position;r&&(c=0<=d?c:c+d,d=Math.abs(d),a.init({memberid:b,position:c,length:d,name:b+Date.now()}),f.enqueue([a]))};this.removeAnnotation=function(c){var d,g;d=p.getMember(b).getProperties().fullName;if(!0!==k.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)||d===h.getAnnotationCreator(c))d=p.convertDomPointToCursorStep(c,0,a),g=p.convertDomPointToCursorStep(c,c.childNodes.length),c=new ops.OpRemoveAnnotation,
c.init({memberid:b,position:d,length:g-d}),g=new ops.OpMoveCursor,g.init({memberid:b,position:0<d?d-1:d,length:0}),f.enqueue([c,g])};this.subscribe=function(a,b){m.subscribe(a,b)};this.unsubscribe=function(a,b){m.unsubscribe(a,b)};this.destroy=function(a){p.unsubscribe(ops.Document.signalCursorAdded,d);p.unsubscribe(ops.Document.signalCursorRemoved,l);p.unsubscribe(ops.Document.signalCursorMoved,n);a()};k.registerConstraint(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN);p.subscribe(ops.Document.signalCursorAdded,
d);p.subscribe(ops.Document.signalCursorRemoved,l);p.subscribe(ops.Document.signalCursorMoved,n);c()};gui.AnnotationController.annotatableChanged="annotatable/changed";gui.Avatar=function(f,k){var b=this,c,d,l;this.setColor=function(b){d.style.borderColor=b};this.setImageUrl=function(c){b.isVisible()?d.src=c:l=c};this.isVisible=function(){return"block"===c.style.display};this.show=function(){l&&(d.src=l,l=void 0);c.style.display="block"};this.hide=function(){c.style.display="none"};this.markAsFocussed=function(b){b?c.classList.add("active"):c.classList.remove("active")};this.destroy=function(b){f.removeChild(c);b()};(function(){var b=f.ownerDocument;c=b.createElement("div");
d=b.createElement("img");c.appendChild(d);c.style.display=k?"block":"none";c.className="handle";f.appendChild(c)})()};gui.StepInfo=function(){};gui.StepInfo.VisualDirection={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1};gui.StepInfo.prototype.container=function(){};gui.StepInfo.prototype.offset=function(){};gui.VisualStepScanner=function(){};gui.VisualStepScanner.prototype.process=function(f,k,b){};gui.GuiStepUtils=function(){function f(d){d=b.getContentBounds(d);var f,l=null;if(d)if(d.container.nodeType===Node.TEXT_NODE)f=d.container.ownerDocument.createRange(),f.setStart(d.container,d.startOffset),f.setEnd(d.container,d.endOffset),(l=0<f.getClientRects().length?f.getBoundingClientRect():null)&&" "===d.container.data.substring(d.startOffset,d.endOffset)&&1>=l.width&&(l=null),f.detach();else if(k.isCharacterElement(d.container)||k.isCharacterFrame(d.container))l=c.getBoundingClientRect(d.container);
return l}var k=odf.OdfUtils,b=new odf.StepUtils,c=core.DomUtils,d=core.StepDirection.NEXT,l=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT,n=gui.StepInfo.VisualDirection.RIGHT_TO_LEFT;this.getContentRect=f;this.moveToFilteredStep=function(b,c,k){function h(a,b){b.process(v,g,y)&&(a=!0,!u&&b.token&&(u=b.token));return a}var a=c===d,e,q,g,y,u,z=b.snapshot();e=!1;var v;do e=f(b),v={token:b.snapshot(),container:b.container,offset:b.offset,direction:c,visualDirection:c===d?l:n},q=b.nextStep()?f(b):null,b.restore(v.token),
a?(g=e,y=q):(g=q,y=e),e=k.reduce(h,!1);while(!e&&b.advanceStep(c));e||k.forEach(function(a){!u&&a.token&&(u=a.token)});b.restore(u||z);return Boolean(u)}};gui.Caret=function(f,k,b,c){function d(){h.style.opacity="0"===h.style.opacity?"1":"0";w.trigger()}function l(){g.selectNodeContents(q);return g.getBoundingClientRect()}function n(){Object.keys(F).forEach(function(a){H[a]=F[a]})}function p(){if(!1===F.isShown||f.getSelectionType()!==ops.OdtCursor.RangeSelection||!c&&!f.getSelectedRange().collapsed)F.visibility="hidden",h.style.visibility="hidden",w.cancel();else if(F.visibility="visible",h.style.visibility="visible",!1===F.isFocused)h.style.opacity=
"1",w.cancel();else{if(x||H.visibility!==F.visibility)h.style.opacity="1",w.cancel();w.trigger()}if(I||B){var b;b=f.getNode();var d,g,q=u.getBoundingClientRect(y.getSizer()),p=!1,r=0;b.removeAttributeNS("urn:webodf:names:cursor","caret-sizer-active");if(0<b.getClientRects().length)g=l(),r=g.left-u.getBoundingClientRect(b).left,p=!0;else if(v.setPosition(b,0),g=z.getContentRect(v),!g&&v.nextStep()&&(d=z.getContentRect(v))&&(g=d,p=!0),g||(b.setAttributeNS("urn:webodf:names:cursor","caret-sizer-active",
"true"),g=l(),p=!0),!g)for(runtime.log("WARN: No suitable client rectangle found for visual caret for "+f.getMemberId());b;){if(0<b.getClientRects().length){g=u.getBoundingClientRect(b);p=!0;break}b=b.parentNode}g=u.translateRect(g,q,y.getZoomLevel());b={top:g.top,height:g.height,right:p?g.left:g.right,width:u.adaptRangeDifferenceToZoomLevel(r,y.getZoomLevel())};8>b.height&&(b={top:b.top-(8-b.height)/2,height:8,right:b.right});m.style.height=b.height+"px";m.style.top=b.top+"px";m.style.left=b.right-
b.width+"px";m.style.width=b.width?b.width+"px":"";e&&(b=runtime.getWindow().getComputedStyle(f.getNode(),null),b.font?e.style.font=b.font:(e.style.fontStyle=b.fontStyle,e.style.fontVariant=b.fontVariant,e.style.fontWeight=b.fontWeight,e.style.fontSize=b.fontSize,e.style.lineHeight=b.lineHeight,e.style.fontFamily=b.fontFamily))}F.isShown&&B&&k.scrollIntoView(h.getBoundingClientRect());H.isFocused!==F.isFocused&&a.markAsFocussed(F.isFocused);n();I=B=x=!1}function r(a){m.parentNode.removeChild(m);q.parentNode.removeChild(q);
a()}var m,h,a,e,q,g,y=f.getDocument().getCanvas(),u=core.DomUtils,z=new gui.GuiStepUtils,v,s,w,x=!1,B=!1,I=!1,F={isFocused:!1,isShown:!0,visibility:"hidden"},H={isFocused:!F.isFocused,isShown:!F.isShown,visibility:"hidden"};this.handleUpdate=function(){I=!0;s.trigger()};this.refreshCursorBlinking=function(){x=!0;s.trigger()};this.setFocus=function(){F.isFocused=!0;s.trigger()};this.removeFocus=function(){F.isFocused=!1;s.trigger()};this.show=function(){F.isShown=!0;s.trigger()};this.hide=function(){F.isShown=
!1;s.trigger()};this.setAvatarImageUrl=function(b){a.setImageUrl(b)};this.setColor=function(b){h.style.borderColor=b;a.setColor(b)};this.getCursor=function(){return f};this.getFocusElement=function(){return h};this.toggleHandleVisibility=function(){a.isVisible()?a.hide():a.show()};this.showHandle=function(){a.show()};this.hideHandle=function(){a.hide()};this.setOverlayElement=function(a){e=a;m.appendChild(a);I=!0;s.trigger()};this.ensureVisible=function(){B=!0;s.trigger()};this.getBoundingClientRect=
function(){return u.getBoundingClientRect(m)};this.destroy=function(b){core.Async.destroyAll([s.destroy,w.destroy,a.destroy,r],b)};(function(){var c=f.getDocument(),e=[c.createRootFilter(f.getMemberId()),c.getPositionFilter()],l=c.getDOMDocument();g=l.createRange();q=l.createElement("span");q.className="webodf-caretSizer";q.textContent="|";f.getNode().appendChild(q);m=l.createElement("div");m.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",f.getMemberId());m.className="webodf-caretOverlay";
h=l.createElement("div");h.className="caret";m.appendChild(h);a=new gui.Avatar(m,b);y.getSizer().appendChild(m);v=c.createStepIterator(f.getNode(),0,e,c.getRootNode());s=core.Task.createRedrawTask(p);w=core.Task.createTimeoutTask(d,500);s.triggerImmediate()})()};odf.TextSerializer=function(){function f(c){var d="",l=k.filter?k.filter.acceptNode(c):NodeFilter.FILTER_ACCEPT,n=c.nodeType,p;if((l===NodeFilter.FILTER_ACCEPT||l===NodeFilter.FILTER_SKIP)&&b.isTextContentContainingNode(c))for(p=c.firstChild;p;)d+=f(p),p=p.nextSibling;l===NodeFilter.FILTER_ACCEPT&&(n===Node.ELEMENT_NODE&&b.isParagraph(c)?d+="\n":n===Node.TEXT_NODE&&c.textContent&&(d+=c.textContent));return d}var k=this,b=odf.OdfUtils;this.filter=null;this.writeToString=function(b){if(!b)return"";
b=f(b);"\n"===b[b.length-1]&&(b=b.substr(0,b.length-1));return b}};gui.MimeDataExporter=function(){var f;this.exportRangeToDataTransfer=function(k,b){var c;c=b.startContainer.ownerDocument.createElement("span");c.appendChild(b.cloneContents());c=f.writeToString(c);try{k.setData("text/plain",c)}catch(d){k.setData("Text",c)}};f=new odf.TextSerializer;f.filter=new odf.OdfNodeFilter};gui.Clipboard=function(f){this.setDataFromRange=function(k,b){var c,d=k.clipboardData;c=runtime.getWindow();!d&&c&&(d=c.clipboardData);d?(c=!0,f.exportRangeToDataTransfer(d,b),k.preventDefault()):c=!1;return c}};gui.SessionContext=function(f,k){var b=f.getOdtDocument(),c=odf.OdfUtils;this.isLocalCursorWithinOwnAnnotation=function(){var d=b.getCursor(k),f;if(!d)return!1;f=d&&d.getNode();d=b.getMember(k).getProperties().fullName;return(f=c.getParentAnnotation(f,b.getRootNode()))&&c.getAnnotationCreator(f)===d?!0:!1}};gui.StyleSummary=function(f){function k(b,c){var k=b+"|"+c,r;d.hasOwnProperty(k)||(r=[],f.forEach(function(d){d=(d=d.styleProperties[b])&&d[c];-1===r.indexOf(d)&&r.push(d)}),d[k]=r);return d[k]}function b(b,c,d){return function(){var f=k(b,c);return d.length>=f.length&&f.every(function(b){return-1!==d.indexOf(b)})}}function c(b,c){var d=k(b,c);return 1===d.length?d[0]:void 0}var d={};this.getPropertyValues=k;this.getCommonValue=c;this.isBold=b("style:text-properties","fo:font-weight",["bold"]);this.isItalic=
b("style:text-properties","fo:font-style",["italic"]);this.hasUnderline=b("style:text-properties","style:text-underline-style",["solid"]);this.hasStrikeThrough=b("style:text-properties","style:text-line-through-style",["solid"]);this.fontSize=function(){var b=c("style:text-properties","fo:font-size");return b&&parseFloat(b)};this.fontName=function(){return c("style:text-properties","style:font-name")};this.isAlignedLeft=b("style:paragraph-properties","fo:text-align",["left","start"]);this.isAlignedCenter=
b("style:paragraph-properties","fo:text-align",["center"]);this.isAlignedRight=b("style:paragraph-properties","fo:text-align",["right","end"]);this.isAlignedJustified=b("style:paragraph-properties","fo:text-align",["justify"]);this.text={isBold:this.isBold,isItalic:this.isItalic,hasUnderline:this.hasUnderline,hasStrikeThrough:this.hasStrikeThrough,fontSize:this.fontSize,fontName:this.fontName};this.paragraph={isAlignedLeft:this.isAlignedLeft,isAlignedCenter:this.isAlignedCenter,isAlignedRight:this.isAlignedRight,
isAlignedJustified:this.isAlignedJustified}};gui.DirectFormattingController=function(f,k,b,c,d,l,n){function p(){return R.value().styleSummary}function r(){return R.value().enabledFeatures}function m(a){var b;a.collapsed?(b=a.startContainer,b.hasChildNodes()&&a.startOffset<b.childNodes.length&&(b=b.childNodes.item(a.startOffset)),a=[b]):a=Z.getTextElements(a,!0,!1);return a}function h(){var a=t.getCursor(c),e=a&&a.getSelectedRange(),d=[],d=[],g=!0,f={directTextStyling:!0,directParagraphStyling:!0};e&&(d=m(e),0===d.length&&(d=[e.startContainer,
e.endContainer],g=!1),d=t.getFormatting().getAppliedStyles(d));void 0!==d[0]&&$&&(d[0].styleProperties=W.mergeObjects(d[0].styleProperties,$));!0===k.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(f.directTextStyling=f.directParagraphStyling=b.isLocalCursorWithinOwnAnnotation());f.directTextStyling&&(f.directTextStyling=g&&void 0!==a&&a.getSelectionType()===ops.OdtCursor.RangeSelection);return{enabledFeatures:f,appliedStyles:d,styleSummary:new gui.StyleSummary(d)}}function a(a,b){var c={};Object.keys(a).forEach(function(e){var d=
a[e](),g=b[e]();d!==g&&(c[e]=g)});return c}function e(){var b,c;c=D.styleSummary;var e=R.value(),d=e.styleSummary,g=D.enabledFeatures,f=e.enabledFeatures;b=a(c.text,d.text);c=a(c.paragraph,d.paragraph);g=!(f.directTextStyling===g.directTextStyling&&f.directParagraphStyling===g.directParagraphStyling);D=e;g&&O.emit(gui.DirectFormattingController.enabledChanged,f);0<Object.keys(b).length&&O.emit(gui.DirectFormattingController.textStylingChanged,b);0<Object.keys(c).length&&O.emit(gui.DirectFormattingController.paragraphStylingChanged,
c)}function q(){R.reset();e()}function g(a){("string"===typeof a?a:a.getMemberId())===c&&R.reset()}function y(){R.reset()}function u(a){var b=t.getCursor(c);a=a.paragraphElement;b&&Z.getParagraphElement(b.getNode())===a&&R.reset()}function z(a,b){b(!a());return!0}function v(a){if(r().directTextStyling){var b=t.getCursorSelection(c),e={"style:text-properties":a};0!==b.length?(a=new ops.OpApplyDirectStyling,a.init({memberid:c,position:b.position,length:b.length,setProperties:e}),f.enqueue([a])):($=
W.mergeObjects($||{},e),R.reset())}}function s(a,b){var c={};c[a]=b;v(c)}function w(a){a=a.spec();$&&a.memberid===c&&"SplitParagraph"!==a.optype&&($=null,R.reset())}function x(a){s("fo:font-weight",a?"bold":"normal")}function B(a){s("fo:font-style",a?"italic":"normal")}function I(a){s("style:text-underline-style",a?"solid":"none")}function F(a){s("style:text-line-through-style",a?"solid":"none")}function H(a){if(r().directParagraphStyling){var b=t.getCursor(c).getSelectedRange(),b=Z.getParagraphElements(b),
e=t.getFormatting(),g=[],h={},l;b.forEach(function(b){var f=t.convertDomPointToCursorStep(b,0,S),k=b.getAttributeNS(odf.Namespaces.textns,"style-name"),m;b=k?h.hasOwnProperty(k)?h[k]:void 0:l;b||(b=d.generateStyleName(),k?(h[k]=b,m=e.createDerivedStyleObject(k,"paragraph",{})):(l=b,m={}),m=a(m),k=new ops.OpAddStyle,k.init({memberid:c,styleName:b.toString(),styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:m}),g.push(k));k=new ops.OpSetParagraphStyle;k.init({memberid:c,styleName:b.toString(),
position:f});g.push(k)});f.enqueue(g)}}function A(a){H(function(b){return W.mergeObjects(b,a)})}function J(a){A({"style:paragraph-properties":{"fo:text-align":a}})}function L(a,b){var c=t.getFormatting().getDefaultTabStopDistance(),e=b["style:paragraph-properties"],d;e&&(e=e["fo:margin-left"],d=Z.parseLength(e));return W.mergeObjects(b,{"style:paragraph-properties":{"fo:margin-left":d&&d.unit===c.unit?d.value+a*c.value+d.unit:a*c.value+c.unit}})}function Q(a,b){var c=m(a),c=0===c.length?[a.startContainer]:
c,c=t.getFormatting().getAppliedStyles(c),e=0<c.length?c[0].styleProperties:void 0,d=t.getFormatting().getAppliedStylesForElement(b).styleProperties;if(!e||"text"!==e["style:family"]||!e["style:text-properties"])return!1;if(!d||!d["style:text-properties"])return!0;e=e["style:text-properties"];d=d["style:text-properties"];return!Object.keys(e).every(function(a){return e[a]===d[a]})}function E(){}function Y(){return!1}var V=this,t=f.getOdtDocument(),W=new core.Utils,Z=odf.OdfUtils,O=new core.EventNotifier([gui.DirectFormattingController.enabledChanged,
gui.DirectFormattingController.textStylingChanged,gui.DirectFormattingController.paragraphStylingChanged]),G=odf.Namespaces.textns,S=core.StepDirection.NEXT,$=null,D,R;this.enabledFeatures=r;this.formatTextSelection=v;this.createCursorStyleOp=function(a,b,e){var d=null,g=$;e&&(g=(e=R.value().appliedStyles[0])&&e.styleProperties);g&&g["style:text-properties"]&&(d=new ops.OpApplyDirectStyling,d.init({memberid:c,position:a,length:b,setProperties:{"style:text-properties":g["style:text-properties"]}}),
$=null,R.reset());return d};this.setBold=x;this.setItalic=B;this.setHasUnderline=I;this.setHasStrikethrough=F;this.setFontSize=function(a){s("fo:font-size",a+"pt")};this.setFontName=function(a){s("style:font-name",a)};this.getAppliedStyles=function(){return R.value().appliedStyles};this.toggleBold=z.bind(V,function(){return p().isBold()},x);this.toggleItalic=z.bind(V,function(){return p().isItalic()},B);this.toggleUnderline=z.bind(V,function(){return p().hasUnderline()},I);this.toggleStrikethrough=
z.bind(V,function(){return p().hasStrikeThrough()},F);this.isBold=function(){return p().isBold()};this.isItalic=function(){return p().isItalic()};this.hasUnderline=function(){return p().hasUnderline()};this.hasStrikeThrough=function(){return p().hasStrikeThrough()};this.fontSize=function(){return p().fontSize()};this.fontName=function(){return p().fontName()};this.isAlignedLeft=function(){return p().isAlignedLeft()};this.isAlignedCenter=function(){return p().isAlignedCenter()};this.isAlignedRight=
function(){return p().isAlignedRight()};this.isAlignedJustified=function(){return p().isAlignedJustified()};this.alignParagraphLeft=function(){J("left");return!0};this.alignParagraphCenter=function(){J("center");return!0};this.alignParagraphRight=function(){J("right");return!0};this.alignParagraphJustified=function(){J("justify");return!0};this.indent=function(){H(L.bind(null,1));return!0};this.outdent=function(){H(L.bind(null,-1));return!0};this.createParagraphStyleOps=function(a){if(!r().directParagraphStyling)return[];
var b=t.getCursor(c),e=b.getSelectedRange(),g=[],f,h;b.hasForwardSelection()?(f=b.getAnchorNode(),h=b.getNode()):(f=b.getNode(),h=b.getAnchorNode());b=Z.getParagraphElement(h);runtime.assert(Boolean(b),"DirectFormattingController: Cursor outside paragraph");var l=b,k=[t.getPositionFilter(),t.createRootFilter(c)];if(!1!==t.createStepIterator(e.endContainer,e.endOffset,k,l).nextStep())return g;h!==f&&(b=Z.getParagraphElement(f));if(!$&&!Q(e,b))return g;e=(e=R.value().appliedStyles[0])&&e.styleProperties;
if(!e)return g;if(b=b.getAttributeNS(G,"style-name"))e={"style:text-properties":e["style:text-properties"]},e=t.getFormatting().createDerivedStyleObject(b,"paragraph",e);f=d.generateStyleName();b=new ops.OpAddStyle;b.init({memberid:c,styleName:f,styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:e});g.push(b);b=new ops.OpSetParagraphStyle;b.init({memberid:c,styleName:f,position:a});g.push(b);return g};this.subscribe=function(a,b){O.subscribe(a,b)};this.unsubscribe=function(a,b){O.unsubscribe(a,
b)};this.destroy=function(a){t.unsubscribe(ops.Document.signalCursorAdded,g);t.unsubscribe(ops.Document.signalCursorRemoved,g);t.unsubscribe(ops.Document.signalCursorMoved,g);t.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,y);t.unsubscribe(ops.OdtDocument.signalParagraphChanged,u);t.unsubscribe(ops.OdtDocument.signalOperationEnd,w);t.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,e);k.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,q);a()};(function(){t.subscribe(ops.Document.signalCursorAdded,
g);t.subscribe(ops.Document.signalCursorRemoved,g);t.subscribe(ops.Document.signalCursorMoved,g);t.subscribe(ops.OdtDocument.signalParagraphStyleModified,y);t.subscribe(ops.OdtDocument.signalParagraphChanged,u);t.subscribe(ops.OdtDocument.signalOperationEnd,w);t.subscribe(ops.OdtDocument.signalProcessingBatchEnd,e);k.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,q);R=new core.LazyProperty(h);D=R.value();l||(V.formatTextSelection=E,V.setBold=E,V.setItalic=E,V.setHasUnderline=E,V.setHasStrikethrough=
E,V.setFontSize=E,V.setFontName=E,V.toggleBold=Y,V.toggleItalic=Y,V.toggleUnderline=Y,V.toggleStrikethrough=Y);n||(V.alignParagraphCenter=E,V.alignParagraphJustified=E,V.alignParagraphLeft=E,V.alignParagraphRight=E,V.createParagraphStyleOps=function(){return[]},V.indent=E,V.outdent=E)})()};gui.DirectFormattingController.enabledChanged="enabled/changed";gui.DirectFormattingController.textStylingChanged="textStyling/changed";gui.DirectFormattingController.paragraphStylingChanged="paragraphStyling/changed";
gui.DirectFormattingController.SelectionInfo=function(){};gui.KeyboardHandler=function(){function f(b,c){c||(c=k.None);switch(b){case gui.KeyboardHandler.KeyCode.LeftMeta:case gui.KeyboardHandler.KeyCode.RightMeta:case gui.KeyboardHandler.KeyCode.MetaInMozilla:c|=k.Meta;break;case gui.KeyboardHandler.KeyCode.Ctrl:c|=k.Ctrl;break;case gui.KeyboardHandler.KeyCode.Alt:c|=k.Alt;break;case gui.KeyboardHandler.KeyCode.Shift:c|=k.Shift}return b+":"+c}var k=gui.KeyboardHandler.Modifier,b=null,c={};this.setDefault=function(c){b=c};this.bind=function(b,l,k,p){b=f(b,
l);runtime.assert(p||!1===c.hasOwnProperty(b),"tried to overwrite the callback handler of key combo: "+b);c[b]=k};this.unbind=function(b,l){var k=f(b,l);delete c[k]};this.reset=function(){b=null;c={}};this.handleEvent=function(d){var l=d.keyCode,n=k.None;d.metaKey&&(n|=k.Meta);d.ctrlKey&&(n|=k.Ctrl);d.altKey&&(n|=k.Alt);d.shiftKey&&(n|=k.Shift);l=f(l,n);l=c[l];n=!1;l?n=l():null!==b&&(n=b(d));n&&(d.preventDefault?d.preventDefault():d.returnValue=!1)}};
gui.KeyboardHandler.Modifier={None:0,Meta:1,Ctrl:2,Alt:4,CtrlAlt:6,Shift:8,MetaShift:9,CtrlShift:10,AltShift:12};gui.KeyboardHandler.KeyCode={Backspace:8,Tab:9,Clear:12,Enter:13,Shift:16,Ctrl:17,Alt:18,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,MetaInMozilla:224};gui.HyperlinkClickHandler=function(f,k,b){function c(){var a=f();runtime.assert(Boolean(a.classList),"Document container has no classList element");a.classList.remove("webodf-inactiveLinks")}function d(){var a=f();runtime.assert(Boolean(a.classList),"Document container has no classList element");a.classList.add("webodf-inactiveLinks")}function l(){a.removeEventListener("focus",d,!1);q.forEach(function(a){k.unbind(a.keyCode,a.modifier);b.unbind(a.keyCode,a.modifier)});q.length=0}function n(e){l();
if(e!==p.None){a.addEventListener("focus",d,!1);switch(e){case p.Ctrl:q.push({keyCode:r.Ctrl,modifier:p.None});break;case p.Meta:q.push({keyCode:r.LeftMeta,modifier:p.None}),q.push({keyCode:r.RightMeta,modifier:p.None}),q.push({keyCode:r.MetaInMozilla,modifier:p.None})}q.forEach(function(a){k.bind(a.keyCode,a.modifier,c);b.bind(a.keyCode,a.modifier,d)})}}var p=gui.KeyboardHandler.Modifier,r=gui.KeyboardHandler.KeyCode,m=xmldom.XPath,h=odf.OdfUtils,a=runtime.getWindow(),e=p.None,q=[];runtime.assert(null!==
a,"Expected to be run in an environment which has a global window, like a browser.");this.handleClick=function(b){var c=b.target||b.srcElement,d,l;b.ctrlKey?d=p.Ctrl:b.metaKey&&(d=p.Meta);if(e===p.None||e===d){a:{for(;null!==c;){if(h.isHyperlink(c))break a;if(h.isParagraph(c))break;c=c.parentNode}c=null}c&&(c=h.getHyperlinkTarget(c),""!==c&&("#"===c[0]?(c=c.substring(1),d=f(),l=m.getODFElementsWithXPath(d,"//text:bookmark-start[@text:name='"+c+"']",odf.Namespaces.lookupNamespaceURI),0===l.length&&
(l=m.getODFElementsWithXPath(d,"//text:bookmark[@text:name='"+c+"']",odf.Namespaces.lookupNamespaceURI)),0<l.length&&l[0].scrollIntoView(!0)):a.open(c),b.preventDefault?b.preventDefault():b.returnValue=!1))}};this.setModifier=function(a){e!==a&&(runtime.assert(a===p.None||a===p.Ctrl||a===p.Meta,"Unsupported KeyboardHandler.Modifier value: "+a),e=a,e!==p.None?d():c(),n(e))};this.getModifier=function(){return e};this.destroy=function(a){d();l();a()}};gui.EventManager=function(f){function k(a){function b(a,c,e){var d,g=!1;d="on"+c;a.attachEvent&&(a.attachEvent(d,e),g=!0);!g&&a.addEventListener&&(a.addEventListener(c,e,!1),g=!0);g&&!w[c]||!a.hasOwnProperty(d)||(a[d]=e)}function c(a,b,e){var d="on"+b;a.detachEvent&&a.detachEvent(d,e);a.removeEventListener&&a.removeEventListener(b,e,!1);a[d]===e&&(a[d]=null)}function e(b){if(-1===g.indexOf(b)){g.push(b);if(d.filters.every(function(a){return a(b)}))try{f.emit(a,b)}catch(c){runtime.log("Error occurred while processing "+
a+":\n"+c.message+"\n"+c.stack)}runtime.setTimeout(function(){g.splice(g.indexOf(b),1)},0)}}var d=this,g=[],f=new core.EventNotifier([a]);this.filters=[];this.subscribe=function(b){f.subscribe(a,b)};this.unsubscribe=function(b){f.unsubscribe(a,b)};this.destroy=function(){c(s,a,e);c(F,a,e);c(H,a,e)};x[a]&&b(s,a,e);b(F,a,e);b(H,a,e)}function b(a,b,c){function e(b){c(b,d,function(b){b.type=a;g.emit(a,b)})}var d={},g=new core.EventNotifier([a]);this.subscribe=function(b){g.subscribe(a,b)};this.unsubscribe=
function(b){g.unsubscribe(a,b)};this.destroy=function(){b.forEach(function(a){A.unsubscribe(a,e)})};(function(){b.forEach(function(a){A.subscribe(a,e)})})()}function c(a){runtime.clearTimeout(a);delete J[a]}function d(a,b){var e=runtime.setTimeout(function(){a();c(e)},b);J[e]=!0;return e}function l(a,b,e){var g=a.touches.length,f=a.touches[0],h=b.timer;"touchmove"===a.type||"touchend"===a.type?h&&c(h):"touchstart"===a.type&&(1!==g?runtime.clearTimeout(h):h=d(function(){e({clientX:f.clientX,clientY:f.clientY,
pageX:f.pageX,pageY:f.pageY,target:a.target||a.srcElement||null,detail:1})},400));b.timer=h}function n(a,b,c){var e=a.touches[0],d=a.target||a.srcElement||null,g=b.target;1!==a.touches.length||"touchend"===a.type?g=null:"touchstart"===a.type&&"webodf-draggable"===d.getAttribute("class")?g=d:"touchmove"===a.type&&g&&(a.preventDefault(),a.stopPropagation(),c({clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,target:g,detail:1}));b.target=g}function p(a,b,c){var e=a.target||a.srcElement||
null,d=b.dragging;"drag"===a.type?d=!0:"touchend"===a.type&&d&&(d=!1,a=a.changedTouches[0],c({clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY,target:e,detail:1}));b.dragging=d}function r(){H.classList.add("webodf-touchEnabled");A.unsubscribe("touchstart",r)}function m(a){var b=a.scrollX,c=a.scrollY;this.restore=function(){a.scrollX===b&&a.scrollY===c||a.scrollTo(b,c)}}function h(a){var b=a.scrollTop,c=a.scrollLeft;this.restore=function(){if(a.scrollTop!==b||a.scrollLeft!==c)a.scrollTop=
b,a.scrollLeft=c}}function a(a,b){var c=I[a]||B[a]||null;!c&&b&&(c=I[a]=new k(a));return c}function e(b,c){a(b,!0).subscribe(c)}function q(b,c){var e=a(b,!1);e&&e.unsubscribe(c)}function g(){return f.getDOMDocument().activeElement===F}function y(){g()&&F.blur();F.setAttribute("disabled","true")}function u(){F.removeAttribute("disabled")}function z(a){for(var b=[];a;)(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight)&&b.push(new h(a)),a=a.parentNode;b.push(new m(s));return b}function v(){var a;
g()||(a=z(F),u(),F.focus(),a.forEach(function(a){a.restore()}))}var s=runtime.getWindow(),w={beforecut:!0,beforepaste:!0,longpress:!0,drag:!0,dragstop:!0},x={mousedown:!0,mouseup:!0,focus:!0},B={},I={},F,H=f.getCanvas().getElement(),A=this,J={};this.addFilter=function(b,c){a(b,!0).filters.push(c)};this.removeFilter=function(b,c){var e=a(b,!0),d=e.filters.indexOf(c);-1!==d&&e.filters.splice(d,1)};this.subscribe=e;this.unsubscribe=q;this.hasFocus=g;this.focus=v;this.getEventTrap=function(){return F};
this.setEditing=function(a){var b=g();b&&F.blur();a?F.removeAttribute("readOnly"):F.setAttribute("readOnly","true");b&&v()};this.destroy=function(a){q("touchstart",r);Object.keys(J).forEach(function(a){c(parseInt(a,10))});J.length=0;Object.keys(B).forEach(function(a){B[a].destroy()});B={};q("mousedown",y);q("mouseup",u);q("contextmenu",u);Object.keys(I).forEach(function(a){I[a].destroy()});I={};F.parentNode.removeChild(F);a()};(function(){var a=f.getOdfCanvas().getSizer(),c=a.ownerDocument;runtime.assert(Boolean(s),
"EventManager requires a window object to operate correctly");F=c.createElement("textarea");F.id="eventTrap";F.setAttribute("tabindex","-1");F.setAttribute("readOnly","true");F.setAttribute("rows","1");a.appendChild(F);e("mousedown",y);e("mouseup",u);e("contextmenu",u);B.longpress=new b("longpress",["touchstart","touchmove","touchend"],l);B.drag=new b("drag",["touchstart","touchmove","touchend"],n);B.dragstop=new b("dragstop",["drag","touchend"],p);e("touchstart",r)})()};gui.IOSSafariSupport=function(f){function k(){b.innerHeight!==b.outerHeight&&(c.style.display="none",runtime.requestAnimationFrame(function(){c.style.display="block"}))}var b=runtime.getWindow(),c=f.getEventTrap();this.destroy=function(b){f.unsubscribe("focus",k);c.removeAttribute("autocapitalize");c.style.WebkitTransform="";b()};f.subscribe("focus",k);c.setAttribute("autocapitalize","off");c.style.WebkitTransform="translateX(-10000px)"};gui.HyperlinkController=function(f,k,b,c){function d(){var c=!0;!0===k.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(c=b.isLocalCursorWithinOwnAnnotation());c!==m&&(m=c,r.emit(gui.HyperlinkController.enabledChanged,m))}function l(b){b.getMemberId()===c&&d()}var n=odf.OdfUtils,p=f.getOdtDocument(),r=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),m=!1;this.isEnabled=function(){return m};this.subscribe=function(b,a){r.subscribe(b,a)};this.unsubscribe=function(b,a){r.unsubscribe(b,
a)};this.addHyperlink=function(b,a){if(m){var e=p.getCursorSelection(c),d=new ops.OpApplyHyperlink,g=[];if(0===e.length||a)a=a||b,d=new ops.OpInsertText,d.init({memberid:c,position:e.position,text:a}),e.length=a.length,g.push(d);d=new ops.OpApplyHyperlink;d.init({memberid:c,position:e.position,length:e.length,hyperlink:b});g.push(d);f.enqueue(g)}};this.removeHyperlinks=function(){if(m){var b=p.createPositionIterator(p.getRootNode()),a=p.getCursor(c).getSelectedRange(),e=n.getHyperlinkElements(a),
d=a.collapsed&&1===e.length,g=p.getDOMDocument().createRange(),l=[],k,r;0!==e.length&&(e.forEach(function(a){g.selectNodeContents(a);k=p.convertDomToCursorRange({anchorNode:g.startContainer,anchorOffset:g.startOffset,focusNode:g.endContainer,focusOffset:g.endOffset});r=new ops.OpRemoveHyperlink;r.init({memberid:c,position:k.position,length:k.length});l.push(r)}),d||(d=e[0],-1===a.comparePoint(d,0)&&(g.setStart(d,0),g.setEnd(a.startContainer,a.startOffset),k=p.convertDomToCursorRange({anchorNode:g.startContainer,
anchorOffset:g.startOffset,focusNode:g.endContainer,focusOffset:g.endOffset}),0<k.length&&(r=new ops.OpApplyHyperlink,r.init({memberid:c,position:k.position,length:k.length,hyperlink:n.getHyperlinkTarget(d)}),l.push(r))),e=e[e.length-1],b.moveToEndOfNode(e),b=b.unfilteredDomOffset(),1===a.comparePoint(e,b)&&(g.setStart(a.endContainer,a.endOffset),g.setEnd(e,b),k=p.convertDomToCursorRange({anchorNode:g.startContainer,anchorOffset:g.startOffset,focusNode:g.endContainer,focusOffset:g.endOffset}),0<k.length&&
(r=new ops.OpApplyHyperlink,r.init({memberid:c,position:k.position,length:k.length,hyperlink:n.getHyperlinkTarget(e)}),l.push(r)))),f.enqueue(l),g.detach())}};this.destroy=function(b){p.unsubscribe(ops.Document.signalCursorMoved,l);k.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,d);b()};p.subscribe(ops.Document.signalCursorMoved,l);k.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,d);d()};gui.HyperlinkController.enabledChanged="enabled/changed";gui.ImageController=function(f,k,b,c,d){function l(){var a=!0;!0===k.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(a=b.isLocalCursorWithinOwnAnnotation());a!==q&&(q=a,e.emit(gui.ImageController.enabledChanged,q))}function n(a){a.getMemberId()===c&&l()}var p={"image/gif":".gif","image/jpeg":".jpg","image/png":".png"},r=odf.Namespaces.textns,m=f.getOdtDocument(),h=odf.OdfUtils,a=m.getFormatting(),e=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),q=!1;this.isEnabled=function(){return q};
this.subscribe=function(a,b){e.subscribe(a,b)};this.unsubscribe=function(a,b){e.unsubscribe(a,b)};this.insertImage=function(b,e,l,k){if(q){runtime.assert(0<l&&0<k,"Both width and height of the image should be greater than 0px.");k={width:l,height:k};if(l=h.getParagraphElement(m.getCursor(c).getNode()).getAttributeNS(r,"style-name")){l=a.getContentSize(l,"paragraph");var n=1,s=1;k.width>l.width&&(n=l.width/k.width);k.height>l.height&&(s=l.height/k.height);l=Math.min(n,s);k={width:k.width*l,height:k.height*
l}}l=k.width+"px";k=k.height+"px";var w=m.getOdfCanvas().odfContainer().rootElement.styles,n=b.toLowerCase(),s=p.hasOwnProperty(n)?p[n]:null,x,n=[];runtime.assert(null!==s,"Image type is not supported: "+b);s="Pictures/"+d.generateImageName()+s;x=new ops.OpSetBlob;x.init({memberid:c,filename:s,mimetype:b,content:e});n.push(x);a.getStyleElement("Graphics","graphic",[w])||(b=new ops.OpAddStyle,b.init({memberid:c,styleName:"Graphics",styleFamily:"graphic",isAutomaticStyle:!1,setProperties:{"style:graphic-properties":{"text:anchor-type":"paragraph",
"svg:x":"0cm","svg:y":"0cm","style:wrap":"dynamic","style:number-wrapped-paragraphs":"no-limit","style:wrap-contour":"false","style:vertical-pos":"top","style:vertical-rel":"paragraph","style:horizontal-pos":"center","style:horizontal-rel":"paragraph"}}}),n.push(b));b=d.generateStyleName();e=new ops.OpAddStyle;e.init({memberid:c,styleName:b,styleFamily:"graphic",isAutomaticStyle:!0,setProperties:{"style:parent-style-name":"Graphics","style:graphic-properties":{"style:vertical-pos":"top","style:vertical-rel":"baseline",
"style:horizontal-pos":"center","style:horizontal-rel":"paragraph","fo:background-color":"transparent","style:background-transparency":"100%","style:shadow":"none","style:mirror":"none","fo:clip":"rect(0cm, 0cm, 0cm, 0cm)","draw:luminance":"0%","draw:contrast":"0%","draw:red":"0%","draw:green":"0%","draw:blue":"0%","draw:gamma":"100%","draw:color-inversion":"false","draw:image-opacity":"100%","draw:color-mode":"standard"}}});n.push(e);x=new ops.OpInsertImage;x.init({memberid:c,position:m.getCursorPosition(c),
filename:s,frameWidth:l,frameHeight:k,frameStyleName:b,frameName:d.generateFrameName()});n.push(x);f.enqueue(n)}};this.destroy=function(a){m.unsubscribe(ops.Document.signalCursorMoved,n);k.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,l);a()};m.subscribe(ops.Document.signalCursorMoved,n);k.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,l);l()};gui.ImageController.enabledChanged="enabled/changed";gui.ImageSelector=function(f){function k(){var b=f.getSizer(),l=d.createElement("div");l.id="imageSelector";l.style.borderWidth="1px";b.appendChild(l);c.forEach(function(b){var c=d.createElement("div");c.className=b;l.appendChild(c)});return l}var b=odf.Namespaces.svgns,c="topLeft topRight bottomRight bottomLeft topMiddle rightMiddle bottomMiddle leftMiddle".split(" "),d=f.getElement().ownerDocument,l=!1;this.select=function(c){var p,r,m=d.getElementById("imageSelector");m||(m=k());l=!0;p=m.parentNode;
r=c.getBoundingClientRect();var h=p.getBoundingClientRect(),a=f.getZoomLevel();p=(r.left-h.left)/a-1;r=(r.top-h.top)/a-1;m.style.display="block";m.style.left=p+"px";m.style.top=r+"px";m.style.width=c.getAttributeNS(b,"width");m.style.height=c.getAttributeNS(b,"height")};this.clearSelection=function(){var b;l&&(b=d.getElementById("imageSelector"))&&(b.style.display="none");l=!1};this.isSelectorElement=function(b){var c=d.getElementById("imageSelector");return c?b===c||b.parentNode===c:!1}};(function(){function f(f){function b(b){n=b.which&&String.fromCharCode(b.which)===l;l=void 0;return!1===n}function c(){n=!1}function d(b){l=b.data;n=!1}var l,n=!1;this.destroy=function(l){f.unsubscribe("textInput",c);f.unsubscribe("compositionend",d);f.removeFilter("keypress",b);l()};f.subscribe("textInput",c);f.subscribe("compositionend",d);f.addFilter("keypress",b)}gui.InputMethodEditor=function(k,b){function c(b){e&&(b?e.getNode().setAttributeNS(a,"composing","true"):(e.getNode().removeAttributeNS(a,
"composing"),y.textContent=""))}function d(){z&&(z=!1,c(!1),s.emit(gui.InputMethodEditor.signalCompositionEnd,{data:v}),v="")}function l(){F||(F=!0,d(),e&&e.getSelectedRange().collapsed?q.value="":q.value=x.writeToString(e.getSelectedRange().cloneContents()),q.setSelectionRange(0,q.value.length),F=!1)}function n(){b.hasFocus()&&u.trigger()}function p(){w=void 0;u.cancel();c(!0);z||s.emit(gui.InputMethodEditor.signalCompositionStart,{data:""})}function r(a){a=w=a.data;z=!0;v+=a;u.trigger()}function m(a){a.data!==
w&&(a=a.data,z=!0,v+=a,u.trigger());w=void 0}function h(){y.textContent=q.value}var a="urn:webodf:names:cursor",e=null,q=b.getEventTrap(),g=q.ownerDocument,y,u,z=!1,v="",s=new core.EventNotifier([gui.InputMethodEditor.signalCompositionStart,gui.InputMethodEditor.signalCompositionEnd]),w,x,B=[],I,F=!1;this.subscribe=s.subscribe;this.unsubscribe=s.unsubscribe;this.registerCursor=function(a){a.getMemberId()===k&&(e=a,e.getNode().appendChild(y),a.subscribe(ops.OdtCursor.signalCursorUpdated,n),b.subscribe("input",
h),b.subscribe("compositionupdate",h))};this.removeCursor=function(a){e&&a===k&&(e.getNode().removeChild(y),e.unsubscribe(ops.OdtCursor.signalCursorUpdated,n),b.unsubscribe("input",h),b.unsubscribe("compositionupdate",h),e=null)};this.destroy=function(a){b.unsubscribe("compositionstart",p);b.unsubscribe("compositionend",r);b.unsubscribe("textInput",m);b.unsubscribe("keypress",d);b.unsubscribe("focus",l);core.Async.destroyAll(I,a)};(function(){x=new odf.TextSerializer;x.filter=new odf.OdfNodeFilter;
b.subscribe("compositionstart",p);b.subscribe("compositionend",r);b.subscribe("textInput",m);b.subscribe("keypress",d);b.subscribe("focus",l);B.push(new f(b));I=B.map(function(a){return a.destroy});y=g.createElement("span");y.setAttribute("id","composer");u=core.Task.createTimeoutTask(l,1);I.push(u.destroy)})()};gui.InputMethodEditor.signalCompositionStart="input/compositionstart";gui.InputMethodEditor.signalCompositionEnd="input/compositionend"})();gui.MetadataController=function(f,k){function b(b){l.emit(gui.MetadataController.signalMetadataChanged,b)}function c(b){var c=-1===n.indexOf(b);c||runtime.log("Setting "+b+" is restricted.");return c}var d=f.getOdtDocument(),l=new core.EventNotifier([gui.MetadataController.signalMetadataChanged]),n=["dc:creator","dc:date","meta:editing-cycles","meta:editing-duration","meta:document-statistic"];this.setMetadata=function(b,d){var l={},h="",a;b&&Object.keys(b).filter(c).forEach(function(a){l[a]=b[a]});
d&&(h=d.filter(c).join(","));if(0<h.length||0<Object.keys(l).length)a=new ops.OpUpdateMetadata,a.init({memberid:k,setProperties:l,removedProperties:0<h.length?{attributes:h}:null}),f.enqueue([a])};this.getMetadata=function(b){var c;runtime.assert("string"===typeof b,"Property must be a string");c=b.split(":");runtime.assert(2===c.length,"Property must be a namespace-prefixed string");b=odf.Namespaces.lookupNamespaceURI(c[0]);runtime.assert(Boolean(b),"Prefix must be for an ODF namespace.");return d.getOdfCanvas().odfContainer().getMetadata(b,
c[1])};this.subscribe=function(b,c){l.subscribe(b,c)};this.unsubscribe=function(b,c){l.unsubscribe(b,c)};this.destroy=function(c){d.unsubscribe(ops.OdtDocument.signalMetadataUpdated,b);c()};d.subscribe(ops.OdtDocument.signalMetadataUpdated,b)};gui.MetadataController.signalMetadataChanged="metadata/changed";gui.PasteController=function(f,k,b,c){function d(){p=!0===k.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?b.isLocalCursorWithinOwnAnnotation():!0}function l(a){a.getMemberId()===c&&d()}var n=f.getOdtDocument(),p=!1,r=odf.Namespaces.textns,m=core.StepDirection.NEXT,h=odf.OdfUtils;this.isEnabled=function(){return p};this.paste=function(a){if(p){var b=n.getCursorPosition(c),d=n.getCursor(c).getNode(),d=h.getParagraphElement(d),g=d.getAttributeNS(r,"style-name")||"",l=b,k=[],z=n.convertDomPointToCursorStep(d,
0,m);a.replace(/\r/g,"").split("\n").forEach(function(a){var b=new ops.OpInsertText,e=new ops.OpSplitParagraph;b.init({memberid:c,position:l,text:a,moveCursor:!0});k.push(b);l+=a.length;e.init({memberid:c,position:l,paragraphStyleName:g,sourceParagraphPosition:z,moveCursor:!0});k.push(e);z=l+=1});k.pop();f.enqueue(k)}};this.destroy=function(a){n.unsubscribe(ops.Document.signalCursorMoved,l);k.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,d);a()};n.subscribe(ops.Document.signalCursorMoved,l);
k.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,d);d()};gui.ClosestXOffsetScanner=function(f){function k(b){return null!==b&&void 0!==d?Math.abs(b-f)>d:!1}function b(b){null!==b&&!1===k(b)&&(d=Math.abs(b-f))}var c=this,d,l=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT;this.token=void 0;this.process=function(d,f,r){var m,h;d.visualDirection===l?(m=f&&f.right,h=r&&r.left):(m=f&&f.left,h=r&&r.right);if(k(m)||k(h))return!0;if(f||r)b(m),b(h),c.token=d.token;return!1}};gui.LineBoundaryScanner=function(){var f=this,k=null;this.token=void 0;this.process=function(b,c,d){var l;if(l=d)if(k){var n=k;l=Math.min(n.bottom-n.top,d.bottom-d.top);var p=Math.max(n.top,d.top),n=Math.min(n.bottom,d.bottom)-p;l=0.4>=(0<l?n/l:0)}else l=!1;!c||d&&!l||(f.token=b.token);if(l)return!0;k=(b=k)&&c?{left:Math.min(b.left,c.left),right:Math.max(b.right,c.right),top:Math.min(b.top,c.top),bottom:Math.min(b.bottom,c.bottom)}:b||c;return!1}};gui.ParagraphBoundaryScanner=function(){var f=this,k=!1,b,c=odf.OdfUtils;this.token=void 0;this.process=function(d){var l=c.getParagraphElement(d.container());k||(b=l,k=!0);if(b!==l)return!0;f.token=d.token;return!1}};odf.WordBoundaryFilter=function(f,k){function b(a,b,c){for(var e=null,d=f.getRootNode(),h;a!==d&&null!==a&&null===e;)h=0>b?a.previousSibling:a.nextSibling,c(h)===NodeFilter.FILTER_ACCEPT&&(e=h),a=a.parentNode;return e}function c(a,b){var c;return null===a?q.NO_NEIGHBOUR:n.isCharacterElement(a)?q.SPACE_CHAR:a.nodeType===d||n.isTextSpan(a)||n.isHyperlink(a)?(c=a.textContent.charAt(b()),r.test(c)?q.SPACE_CHAR:p.test(c)?q.PUNCTUATION_CHAR:q.WORD_CHAR):q.OTHER}var d=Node.TEXT_NODE,l=Node.ELEMENT_NODE,
n=odf.OdfUtils,p=/[!-#%-*,-\/:-;?-@\[-\]_{}\u00a1\u00ab\u00b7\u00bb\u00bf;\u00b7\u055a-\u055f\u0589-\u058a\u05be\u05c0\u05c3\u05c6\u05f3-\u05f4\u0609-\u060a\u060c-\u060d\u061b\u061e-\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964-\u0965\u0970\u0df4\u0e4f\u0e5a-\u0e5b\u0f04-\u0f12\u0f3a-\u0f3d\u0f85\u0fd0-\u0fd4\u104a-\u104f\u10fb\u1361-\u1368\u166d-\u166e\u169b-\u169c\u16eb-\u16ed\u1735-\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u180a\u1944-\u1945\u19de-\u19df\u1a1e-\u1a1f\u1b5a-\u1b60\u1c3b-\u1c3f\u1c7e-\u1c7f\u2000-\u206e\u207d-\u207e\u208d-\u208e\u3008-\u3009\u2768-\u2775\u27c5-\u27c6\u27e6-\u27ef\u2983-\u2998\u29d8-\u29db\u29fc-\u29fd\u2cf9-\u2cfc\u2cfe-\u2cff\u2e00-\u2e7e\u3000-\u303f\u30a0\u30fb\ua60d-\ua60f\ua673\ua67e\ua874-\ua877\ua8ce-\ua8cf\ua92e-\ua92f\ua95f\uaa5c-\uaa5f\ufd3e-\ufd3f\ufe10-\ufe19\ufe30-\ufe52\ufe54-\ufe61\ufe63\ufe68\ufe6a-\ufe6b\uff01-\uff03\uff05-\uff0a\uff0c-\uff0f\uff1a-\uff1b\uff1f-\uff20\uff3b-\uff3d\uff3f\uff5b\uff5d\uff5f-\uff65]|\ud800[\udd00-\udd01\udf9f\udfd0]|\ud802[\udd1f\udd3f\ude50-\ude58]|\ud809[\udc00-\udc7e]/,
r=/\s/,m=core.PositionFilter.FilterResult.FILTER_ACCEPT,h=core.PositionFilter.FilterResult.FILTER_REJECT,a=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,e=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,q={NO_NEIGHBOUR:0,SPACE_CHAR:1,PUNCTUATION_CHAR:2,WORD_CHAR:3,OTHER:4};this.acceptPosition=function(d){var f=d.container(),n=d.leftNode(),p=d.rightNode(),r=d.unfilteredDomOffset,s=function(){return d.unfilteredDomOffset()-1};f.nodeType===l&&(null===p&&(p=b(f,1,d.getNodeFilter())),null===n&&(n=
b(f,-1,d.getNodeFilter())));f!==p&&(r=function(){return 0});f!==n&&null!==n&&(s=function(){return n.textContent.length-1});f=c(n,s);p=c(p,r);return f===q.WORD_CHAR&&p===q.WORD_CHAR||f===q.PUNCTUATION_CHAR&&p===q.PUNCTUATION_CHAR||k===a&&f!==q.NO_NEIGHBOUR&&p===q.SPACE_CHAR||k===e&&f===q.SPACE_CHAR&&p!==q.NO_NEIGHBOUR?h:m}};odf.WordBoundaryFilter.IncludeWhitespace={None:0,TRAILING:1,LEADING:2};gui.SelectionController=function(f,k){function b(a){var b=a.spec();if(a.isEdit||b.memberid===k)I=void 0,F.cancel()}function c(){var a=u.getCursor(k).getNode();return u.createStepIterator(a,0,[s,x],u.getRootElement(a))}function d(a,b,c){c=new odf.WordBoundaryFilter(u,c);var e=u.getRootElement(a)||u.getRootNode(),d=u.createRootFilter(e);return u.createStepIterator(a,b,[s,d,c],e)}function l(a,b){return b?{anchorNode:a.startContainer,anchorOffset:a.startOffset,focusNode:a.endContainer,focusOffset:a.endOffset}:
{anchorNode:a.endContainer,anchorOffset:a.endOffset,focusNode:a.startContainer,focusOffset:a.startOffset}}function n(a,b,c){var e=new ops.OpMoveCursor;e.init({memberid:k,position:a,length:b||0,selectionType:c});return e}function p(a,b,c){var e;e=u.getCursor(k);e=l(e.getSelectedRange(),e.hasForwardSelection());e.focusNode=a;e.focusOffset=b;c||(e.anchorNode=e.focusNode,e.anchorOffset=e.focusOffset);a=u.convertDomToCursorRange(e);f.enqueue([n(a.position,a.length)])}function r(a){var b;b=d(a.startContainer,
a.startOffset,H);b.roundToPreviousStep()&&a.setStart(b.container(),b.offset());b=d(a.endContainer,a.endOffset,A);b.roundToNextStep()&&a.setEnd(b.container(),b.offset())}function m(a){var b=v.getParagraphElements(a),c=b[0],b=b[b.length-1];c&&a.setStart(c,0);b&&(v.isParagraph(a.endContainer)&&0===a.endOffset?a.setEndBefore(b):a.setEnd(b,b.childNodes.length))}function h(a,b,c,e){var d,f;e?(d=c.startContainer,f=c.startOffset):(d=c.endContainer,f=c.endOffset);z.containsNode(a,d)||(f=0>z.comparePoints(a,
0,d,f)?0:a.childNodes.length,d=a);a=u.createStepIterator(d,f,b,v.getParagraphElement(d)||a);a.roundToClosestStep()||runtime.assert(!1,"No step found in requested range");e?c.setStart(a.container(),a.offset()):c.setEnd(a.container(),a.offset())}function a(a,b){var e=c();e.advanceStep(a)&&p(e.container(),e.offset(),b)}function e(a,b){var e,d=I,f=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];void 0===d&&B&&(d=B());isNaN(d)||(e=c(),w.moveToFilteredStep(e,a,f)&&e.advanceStep(a)&&(f=[new gui.ClosestXOffsetScanner(d),
new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner],w.moveToFilteredStep(e,a,f)&&(p(e.container(),e.offset(),b),I=d,F.restart())))}function q(a,b){var e=c(),d=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];w.moveToFilteredStep(e,a,d)&&p(e.container(),e.offset(),b)}function g(a,b){var c=u.getCursor(k),c=l(c.getSelectedRange(),c.hasForwardSelection()),c=d(c.focusNode,c.focusOffset,H);c.advanceStep(a)&&p(c.container(),c.offset(),b)}function y(a,b,c){var e=!1,d=u.getCursor(k),
d=l(d.getSelectedRange(),d.hasForwardSelection()),e=u.getRootElement(d.focusNode);runtime.assert(Boolean(e),"SelectionController: Cursor outside root");d=u.createStepIterator(d.focusNode,d.focusOffset,[s,x],e);d.roundToClosestStep();d.advanceStep(a)&&(c=c(d.container()))&&(a===J?(d.setPosition(c,0),e=d.roundToNextStep()):(d.setPosition(c,c.childNodes.length),e=d.roundToPreviousStep()),e&&p(d.container(),d.offset(),b))}var u=f.getOdtDocument(),z=core.DomUtils,v=odf.OdfUtils,s=u.getPositionFilter(),
w=new gui.GuiStepUtils,x=u.createRootFilter(k),B=null,I,F,H=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,A=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,J=core.StepDirection.PREVIOUS,L=core.StepDirection.NEXT;this.selectionToRange=function(a){var b=0<=z.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset),c=a.focusNode.ownerDocument.createRange();b?(c.setStart(a.anchorNode,a.anchorOffset),c.setEnd(a.focusNode,a.focusOffset)):(c.setStart(a.focusNode,a.focusOffset),c.setEnd(a.anchorNode,
a.anchorOffset));return{range:c,hasForwardSelection:b}};this.rangeToSelection=l;this.selectImage=function(a){var b=u.getRootElement(a),c=u.createRootFilter(b),b=u.createStepIterator(a,0,[c,u.getPositionFilter()],b),e;b.roundToPreviousStep()||runtime.assert(!1,"No walkable position before frame");c=b.container();e=b.offset();b.setPosition(a,a.childNodes.length);b.roundToNextStep()||runtime.assert(!1,"No walkable position after frame");a=u.convertDomToCursorRange({anchorNode:c,anchorOffset:e,focusNode:b.container(),
focusOffset:b.offset()});a=n(a.position,a.length,ops.OdtCursor.RegionSelection);f.enqueue([a])};this.expandToWordBoundaries=r;this.expandToParagraphBoundaries=m;this.selectRange=function(a,b,c){var e=u.getOdfCanvas().getElement(),d,g=[s];d=z.containsNode(e,a.startContainer);e=z.containsNode(e,a.endContainer);if(d||e)if(d&&e&&(2===c?r(a):3<=c&&m(a)),(c=b?u.getRootElement(a.startContainer):u.getRootElement(a.endContainer))||(c=u.getRootNode()),g.push(u.createRootFilter(c)),h(c,g,a,!0),h(c,g,a,!1),a=
l(a,b),b=u.convertDomToCursorRange(a),a=u.getCursorSelection(k),b.position!==a.position||b.length!==a.length)a=n(b.position,b.length,ops.OdtCursor.RangeSelection),f.enqueue([a])};this.moveCursorToLeft=function(){a(J,!1);return!0};this.moveCursorToRight=function(){a(L,!1);return!0};this.extendSelectionToLeft=function(){a(J,!0);return!0};this.extendSelectionToRight=function(){a(L,!0);return!0};this.setCaretXPositionLocator=function(a){B=a};this.moveCursorUp=function(){e(J,!1);return!0};this.moveCursorDown=
function(){e(L,!1);return!0};this.extendSelectionUp=function(){e(J,!0);return!0};this.extendSelectionDown=function(){e(L,!0);return!0};this.moveCursorBeforeWord=function(){g(J,!1);return!0};this.moveCursorPastWord=function(){g(L,!1);return!0};this.extendSelectionBeforeWord=function(){g(J,!0);return!0};this.extendSelectionPastWord=function(){g(L,!0);return!0};this.moveCursorToLineStart=function(){q(J,!1);return!0};this.moveCursorToLineEnd=function(){q(L,!1);return!0};this.extendSelectionToLineStart=
function(){q(J,!0);return!0};this.extendSelectionToLineEnd=function(){q(L,!0);return!0};this.extendSelectionToParagraphStart=function(){y(J,!0,v.getParagraphElement);return!0};this.extendSelectionToParagraphEnd=function(){y(L,!0,v.getParagraphElement);return!0};this.moveCursorToParagraphStart=function(){y(J,!1,v.getParagraphElement);return!0};this.moveCursorToParagraphEnd=function(){y(L,!1,v.getParagraphElement);return!0};this.moveCursorToDocumentStart=function(){y(J,!1,u.getRootElement);return!0};
this.moveCursorToDocumentEnd=function(){y(L,!1,u.getRootElement);return!0};this.extendSelectionToDocumentStart=function(){y(J,!0,u.getRootElement);return!0};this.extendSelectionToDocumentEnd=function(){y(L,!0,u.getRootElement);return!0};this.extendSelectionToEntireDocument=function(){var a=u.getCursor(k),a=u.getRootElement(a.getNode()),b,c,e;runtime.assert(Boolean(a),"SelectionController: Cursor outside root");e=u.createStepIterator(a,0,[s,x],a);e.roundToClosestStep();b=e.container();c=e.offset();
e.setPosition(a,a.childNodes.length);e.roundToClosestStep();a=u.convertDomToCursorRange({anchorNode:b,anchorOffset:c,focusNode:e.container(),focusOffset:e.offset()});f.enqueue([n(a.position,a.length)]);return!0};this.destroy=function(a){u.unsubscribe(ops.OdtDocument.signalOperationStart,b);core.Async.destroyAll([F.destroy],a)};(function(){F=core.Task.createTimeoutTask(function(){I=void 0},2E3);u.subscribe(ops.OdtDocument.signalOperationStart,b)})()};gui.TextController=function(f,k,b,c,d,l){function n(){y=!0===k.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?b.isLocalCursorWithinOwnAnnotation():!0}function p(a){a.getMemberId()===c&&n()}function r(a,b,c){var d=[e.getPositionFilter()];c&&d.push(e.createRootFilter(a.startContainer));c=e.createStepIterator(a.startContainer,a.startOffset,d,b);c.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range start");b=e.convertDomPointToCursorStep(c.container(),c.offset());
a.collapsed?a=b:(c.setPosition(a.endContainer,a.endOffset),c.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range end"),a=e.convertDomPointToCursorStep(c.container(),c.offset()));return{position:b,length:a-b}}function m(a){var b,e,d,f=q.getParagraphElements(a),h=a.cloneRange(),l=[];b=f[0];1<f.length&&(q.hasNoODFContent(b)&&(b=f[f.length-1]),e=b.getAttributeNS(odf.Namespaces.textns,"style-name")||"");f.forEach(function(b,f){var k,m;h.setStart(b,0);h.collapse(!0);
k=r(h,b,!1).position;0<f&&(m=new ops.OpMergeParagraph,m.init({memberid:c,paragraphStyleName:e,destinationStartPosition:d,sourceStartPosition:k,moveCursor:1===f}),l.unshift(m));d=k;h.selectNodeContents(b);if(k=g.rangeIntersection(h,a))k=r(k,b,!0),0<k.length&&(m=new ops.OpRemoveText,m.init({memberid:c,position:k.position,length:k.length}),l.unshift(m))});return l}function h(a){0>a.length&&(a.position+=a.length,a.length=-a.length);return a}function a(a){if(!y)return!1;var b,d=e.getCursor(c).getSelectedRange().cloneRange(),
g=h(e.getCursorSelection(c)),l;if(0===g.length){g=void 0;b=e.getCursor(c).getNode();l=e.getRootElement(b);var k=[e.getPositionFilter(),e.createRootFilter(l)];l=e.createStepIterator(b,0,k,l);l.roundToClosestStep()&&(a?l.nextStep():l.previousStep())&&(g=h(e.convertDomToCursorRange({anchorNode:b,anchorOffset:0,focusNode:l.container(),focusOffset:l.offset()})),a?(d.setStart(b,0),d.setEnd(l.container(),l.offset())):(d.setStart(l.container(),l.offset()),d.setEnd(b,0)))}g&&f.enqueue(m(d));return void 0!==
g}var e=f.getOdtDocument(),q=odf.OdfUtils,g=core.DomUtils,y=!1,u=odf.Namespaces.textns,z=core.StepDirection.NEXT;this.isEnabled=function(){return y};this.enqueueParagraphSplittingOps=function(){if(!y)return!1;var a=e.getCursor(c),b=a.getSelectedRange(),d=h(e.getCursorSelection(c)),g=[],a=q.getParagraphElement(a.getNode()),k=a.getAttributeNS(u,"style-name")||"";0<d.length&&(g=g.concat(m(b)));b=new ops.OpSplitParagraph;b.init({memberid:c,position:d.position,paragraphStyleName:k,sourceParagraphPosition:e.convertDomPointToCursorStep(a,
0,z),moveCursor:!0});g.push(b);l&&(d=l(d.position+1),g=g.concat(d));f.enqueue(g);return!0};this.removeTextByBackspaceKey=function(){return a(!1)};this.removeTextByDeleteKey=function(){return a(!0)};this.removeCurrentSelection=function(){if(!y)return!1;var a=e.getCursor(c).getSelectedRange();f.enqueue(m(a));return!0};this.insertText=function(a){if(y){var b=e.getCursor(c).getSelectedRange(),g=h(e.getCursorSelection(c)),l=[],k=!1;0<g.length&&(l=l.concat(m(b)),k=!0);b=new ops.OpInsertText;b.init({memberid:c,
position:g.position,text:a,moveCursor:!0});l.push(b);d&&(a=d(g.position,a.length,k))&&l.push(a);f.enqueue(l)}};this.destroy=function(a){e.unsubscribe(ops.Document.signalCursorMoved,p);k.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,n);a()};e.subscribe(ops.Document.signalCursorMoved,p);k.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,n);n()};gui.UndoManager=function(){};gui.UndoManager.prototype.subscribe=function(f,k){};gui.UndoManager.prototype.unsubscribe=function(f,k){};gui.UndoManager.prototype.setDocument=function(f){};gui.UndoManager.prototype.setInitialState=function(){};gui.UndoManager.prototype.initialize=function(){};gui.UndoManager.prototype.purgeInitialState=function(){};gui.UndoManager.prototype.setPlaybackFunction=function(f){};gui.UndoManager.prototype.hasUndoStates=function(){};
gui.UndoManager.prototype.hasRedoStates=function(){};gui.UndoManager.prototype.moveForward=function(f){};gui.UndoManager.prototype.moveBackward=function(f){};gui.UndoManager.prototype.onOperationExecuted=function(f){};gui.UndoManager.signalUndoStackChanged="undoStackChanged";gui.UndoManager.signalUndoStateCreated="undoStateCreated";gui.UndoManager.signalUndoStateModified="undoStateModified";gui.SessionControllerOptions=function(){this.annotationsEnabled=this.directParagraphStylingEnabled=this.directTextStylingEnabled=!1};
(function(){var f=core.PositionFilter.FilterResult.FILTER_ACCEPT;gui.SessionController=function(k,b,c,d){function l(a){return a.target||a.srcElement||null}function n(a,b){var c=t.getDOMDocument(),e=null;c.caretRangeFromPoint?(c=c.caretRangeFromPoint(a,b),e={container:c.startContainer,offset:c.startOffset}):c.caretPositionFromPoint&&(c=c.caretPositionFromPoint(a,b))&&c.offsetNode&&(e={container:c.offsetNode,offset:c.offset});return e}function p(a){var c=t.getCursor(b).getSelectedRange();c.collapsed?
a.preventDefault():$.setDataFromRange(a,c)?da.removeCurrentSelection():runtime.log("Cut operation failed")}function r(){return!1!==t.getCursor(b).getSelectedRange().collapsed}function m(a){var c=t.getCursor(b).getSelectedRange();c.collapsed?a.preventDefault():$.setDataFromRange(a,c)||runtime.log("Copy operation failed")}function h(a){var b;V.clipboardData&&V.clipboardData.getData?b=V.clipboardData.getData("Text"):a.clipboardData&&a.clipboardData.getData&&(b=a.clipboardData.getData("text/plain"));
b&&(da.removeCurrentSelection(),oa.paste(b));a.preventDefault?a.preventDefault():a.returnValue=!1}function a(){return!1}function e(a){if(P)P.onOperationExecuted(a)}function q(a){t.emit(ops.OdtDocument.signalUndoStackChanged,a)}function g(){var a;return P?(a=N.hasFocus(),P.moveBackward(1),a&&N.focus(),!0):!1}function y(){var a;return P?(a=N.hasFocus(),P.moveForward(1),a&&N.focus(),!0):!1}function u(a){var e=t.getCursor(b).getSelectedRange(),d=l(a).getAttribute("end");e&&d&&(a=n(a.clientX,a.clientY))&&
(ha.setUnfilteredPosition(a.container,a.offset),T.acceptPosition(ha)===f&&(e=e.cloneRange(),"left"===d?e.setStart(ha.container(),ha.unfilteredDomOffset()):e.setEnd(ha.container(),ha.unfilteredDomOffset()),c.setSelectedRange(e,"right"===d),t.emit(ops.Document.signalCursorMoved,c)))}function z(){X.selectRange(c.getSelectedRange(),c.hasForwardSelection(),1)}function v(){var a=V.getSelection(),b=0<a.rangeCount&&X.selectionToRange(a);ea&&b&&(U=!0,ka.clearSelection(),ha.setUnfilteredPosition(a.focusNode,
a.focusOffset),T.acceptPosition(ha)===f&&(2===ma?X.expandToWordBoundaries(b.range):3<=ma&&X.expandToParagraphBoundaries(b.range),c.setSelectedRange(b.range,b.hasForwardSelection),t.emit(ops.Document.signalCursorMoved,c)))}function s(a){var c=l(a),e=t.getCursor(b);if(ea=null!==c&&O.containsNode(t.getOdfCanvas().getElement(),c))U=!1,c=t.getRootElement(c)||t.getRootNode(),T=t.createRootFilter(c),ma=0===a.button?a.detail:0,e&&a.shiftKey?V.getSelection().collapse(e.getAnchorNode(),0):(a=V.getSelection(),
c=e.getSelectedRange(),a.extend?e.hasForwardSelection()?(a.collapse(c.startContainer,c.startOffset),a.extend(c.endContainer,c.endOffset)):(a.collapse(c.endContainer,c.endOffset),a.extend(c.startContainer,c.startOffset)):(a.removeAllRanges(),a.addRange(c.cloneRange()))),1<ma&&v()}function w(a){var b=t.getRootElement(a),c=t.createRootFilter(b),b=t.createStepIterator(a,0,[c,t.getPositionFilter()],b);b.setPosition(a,a.childNodes.length);return b.roundToNextStep()?{container:b.container(),offset:b.offset()}:
null}function x(a){var b;b=(b=V.getSelection())?{anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}:null;var c=V.getSelection().isCollapsed,e,d;b.anchorNode||b.focusNode||!(e=n(a.clientX,a.clientY))||(b.anchorNode=e.container,b.anchorOffset=e.offset,b.focusNode=b.anchorNode,b.focusOffset=b.anchorOffset);if(G.isImage(b.focusNode)&&0===b.focusOffset&&G.isCharacterFrame(b.focusNode.parentNode)){if(d=b.focusNode.parentNode,e=d.getBoundingClientRect(),
a.clientX>e.left&&(e=w(d)))b.focusNode=e.container,b.focusOffset=e.offset,c&&(b.anchorNode=b.focusNode,b.anchorOffset=b.focusOffset)}else G.isImage(b.focusNode.firstChild)&&1===b.focusOffset&&G.isCharacterFrame(b.focusNode)&&(e=w(b.focusNode))&&(b.anchorNode=b.focusNode=e.container,b.anchorOffset=b.focusOffset=e.offset);b.anchorNode&&b.focusNode&&(b=X.selectionToRange(b),X.selectRange(b.range,b.hasForwardSelection,0===a.button?a.detail:0));N.focus()}function B(a){var b;if(b=n(a.clientX,a.clientY))a=
b.container,b=b.offset,a={anchorNode:a,anchorOffset:b,focusNode:a,focusOffset:b},a=X.selectionToRange(a),X.selectRange(a.range,a.hasForwardSelection,2),N.focus()}function I(a){var b=l(a),e,d,f;ja.processRequests();ea&&(G.isImage(b)&&G.isCharacterFrame(b.parentNode)&&V.getSelection().isCollapsed?(X.selectImage(b.parentNode),N.focus()):ka.isSelectorElement(b)?N.focus():U?(b=c.getSelectedRange(),d=b.collapsed,G.isImage(b.endContainer)&&0===b.endOffset&&G.isCharacterFrame(b.endContainer.parentNode)&&
(f=b.endContainer.parentNode,f=w(f))&&(b.setEnd(f.container,f.offset),d&&b.collapse(!1)),X.selectRange(b,c.hasForwardSelection(),0===a.button?a.detail:0),N.focus()):ua?x(a):(e=O.cloneEvent(a),ia=runtime.setTimeout(function(){x(e)},0)),ma=0,U=ea=!1)}function F(a){var c=t.getCursor(b).getSelectedRange();c.collapsed||S.exportRangeToDataTransfer(a.dataTransfer,c)}function H(){ea&&N.focus();ma=0;U=ea=!1}function A(a){I(a)}function J(a){var b=l(a),c=null;"annotationRemoveButton"===b.className?(runtime.assert(fa,
"Remove buttons are displayed on annotations while annotation editing is disabled in the controller."),c=b.parentNode.getElementsByTagNameNS(odf.Namespaces.officens,"annotation").item(0),ga.removeAnnotation(c),N.focus()):"webodf-draggable"!==b.getAttribute("class")&&I(a)}function L(a){(a=a.data)&&(-1===a.indexOf("\n")?da.insertText(a):oa.paste(a))}function Q(a){return function(){a();return!0}}function E(a){return function(c){return t.getCursor(b).getSelectionType()===ops.OdtCursor.RangeSelection?
a(c):!0}}function Y(a){N.unsubscribe("keydown",D.handleEvent);N.unsubscribe("keypress",R.handleEvent);N.unsubscribe("keyup",aa.handleEvent);N.unsubscribe("copy",m);N.unsubscribe("mousedown",s);N.unsubscribe("mousemove",ja.trigger);N.unsubscribe("mouseup",J);N.unsubscribe("contextmenu",A);N.unsubscribe("dragstart",F);N.unsubscribe("dragend",H);N.unsubscribe("click",pa.handleClick);N.unsubscribe("longpress",B);N.unsubscribe("drag",u);N.unsubscribe("dragstop",z);t.unsubscribe(ops.OdtDocument.signalOperationEnd,
la.trigger);t.unsubscribe(ops.Document.signalCursorAdded,ca.registerCursor);t.unsubscribe(ops.Document.signalCursorRemoved,ca.removeCursor);t.unsubscribe(ops.OdtDocument.signalOperationEnd,e);a()}var V=runtime.getWindow(),t=k.getOdtDocument(),W=new gui.SessionConstraints,Z=new gui.SessionContext(k,b),O=core.DomUtils,G=odf.OdfUtils,S=new gui.MimeDataExporter,$=new gui.Clipboard(S),D=new gui.KeyboardHandler,R=new gui.KeyboardHandler,aa=new gui.KeyboardHandler,ea=!1,C=new odf.ObjectNameGenerator(t.getOdfCanvas().odfContainer(),
b),U=!1,T=null,ia,P=null,N=new gui.EventManager(t),fa=d.annotationsEnabled,ga=new gui.AnnotationController(k,W,b),ba=new gui.DirectFormattingController(k,W,Z,b,C,d.directTextStylingEnabled,d.directParagraphStylingEnabled),da=new gui.TextController(k,W,Z,b,ba.createCursorStyleOp,ba.createParagraphStyleOps),na=new gui.ImageController(k,W,Z,b,C),ka=new gui.ImageSelector(t.getOdfCanvas()),ha=t.createPositionIterator(t.getRootNode()),ja,la,oa=new gui.PasteController(k,W,Z,b),ca=new gui.InputMethodEditor(b,
N),ma=0,pa=new gui.HyperlinkClickHandler(t.getOdfCanvas().getElement,D,aa),ta=new gui.HyperlinkController(k,W,Z,b),X=new gui.SelectionController(k,b),qa=new gui.MetadataController(k,b),K=gui.KeyboardHandler.Modifier,M=gui.KeyboardHandler.KeyCode,ra=-1!==V.navigator.appVersion.toLowerCase().indexOf("mac"),ua=-1!==["iPad","iPod","iPhone"].indexOf(V.navigator.platform),sa;runtime.assert(null!==V,"Expected to be run in an environment which has a global window, like a browser.");this.undo=g;this.redo=
y;this.insertLocalCursor=function(){runtime.assert(void 0===k.getOdtDocument().getCursor(b),"Inserting local cursor a second time.");var a=new ops.OpAddCursor;a.init({memberid:b});k.enqueue([a]);N.focus()};this.removeLocalCursor=function(){runtime.assert(void 0!==k.getOdtDocument().getCursor(b),"Removing local cursor without inserting before.");var a=new ops.OpRemoveCursor;a.init({memberid:b});k.enqueue([a])};this.startEditing=function(){ca.subscribe(gui.InputMethodEditor.signalCompositionStart,da.removeCurrentSelection);
ca.subscribe(gui.InputMethodEditor.signalCompositionEnd,L);N.subscribe("beforecut",r);N.subscribe("cut",p);N.subscribe("beforepaste",a);N.subscribe("paste",h);P&&P.initialize();N.setEditing(!0);pa.setModifier(ra?K.Meta:K.Ctrl);D.bind(M.Backspace,K.None,Q(da.removeTextByBackspaceKey),!0);D.bind(M.Delete,K.None,da.removeTextByDeleteKey);D.bind(M.Tab,K.None,E(function(){da.insertText("\t");return!0}));ra?(D.bind(M.Clear,K.None,da.removeCurrentSelection),D.bind(M.B,K.Meta,E(ba.toggleBold)),D.bind(M.I,
K.Meta,E(ba.toggleItalic)),D.bind(M.U,K.Meta,E(ba.toggleUnderline)),D.bind(M.L,K.MetaShift,E(ba.alignParagraphLeft)),D.bind(M.E,K.MetaShift,E(ba.alignParagraphCenter)),D.bind(M.R,K.MetaShift,E(ba.alignParagraphRight)),D.bind(M.J,K.MetaShift,E(ba.alignParagraphJustified)),fa&&D.bind(M.C,K.MetaShift,ga.addAnnotation),D.bind(M.Z,K.Meta,g),D.bind(M.Z,K.MetaShift,y)):(D.bind(M.B,K.Ctrl,E(ba.toggleBold)),D.bind(M.I,K.Ctrl,E(ba.toggleItalic)),D.bind(M.U,K.Ctrl,E(ba.toggleUnderline)),D.bind(M.L,K.CtrlShift,
E(ba.alignParagraphLeft)),D.bind(M.E,K.CtrlShift,E(ba.alignParagraphCenter)),D.bind(M.R,K.CtrlShift,E(ba.alignParagraphRight)),D.bind(M.J,K.CtrlShift,E(ba.alignParagraphJustified)),fa&&D.bind(M.C,K.CtrlAlt,ga.addAnnotation),D.bind(M.Z,K.Ctrl,g),D.bind(M.Z,K.CtrlShift,y));R.setDefault(E(function(a){var b;b=null===a.which||void 0===a.which?String.fromCharCode(a.keyCode):0!==a.which&&0!==a.charCode?String.fromCharCode(a.which):null;return!b||a.altKey||a.ctrlKey||a.metaKey?!1:(da.insertText(b),!0)}));
R.bind(M.Enter,K.None,E(da.enqueueParagraphSplittingOps))};this.endEditing=function(){ca.unsubscribe(gui.InputMethodEditor.signalCompositionStart,da.removeCurrentSelection);ca.unsubscribe(gui.InputMethodEditor.signalCompositionEnd,L);N.unsubscribe("cut",p);N.unsubscribe("beforecut",r);N.unsubscribe("paste",h);N.unsubscribe("beforepaste",a);N.setEditing(!1);pa.setModifier(K.None);D.bind(M.Backspace,K.None,function(){return!0},!0);D.unbind(M.Delete,K.None);D.unbind(M.Tab,K.None);ra?(D.unbind(M.Clear,
K.None),D.unbind(M.B,K.Meta),D.unbind(M.I,K.Meta),D.unbind(M.U,K.Meta),D.unbind(M.L,K.MetaShift),D.unbind(M.E,K.MetaShift),D.unbind(M.R,K.MetaShift),D.unbind(M.J,K.MetaShift),fa&&D.unbind(M.C,K.MetaShift),D.unbind(M.Z,K.Meta),D.unbind(M.Z,K.MetaShift)):(D.unbind(M.B,K.Ctrl),D.unbind(M.I,K.Ctrl),D.unbind(M.U,K.Ctrl),D.unbind(M.L,K.CtrlShift),D.unbind(M.E,K.CtrlShift),D.unbind(M.R,K.CtrlShift),D.unbind(M.J,K.CtrlShift),fa&&D.unbind(M.C,K.CtrlAlt),D.unbind(M.Z,K.Ctrl),D.unbind(M.Z,K.CtrlShift));R.setDefault(null);
R.unbind(M.Enter,K.None)};this.getInputMemberId=function(){return b};this.getSession=function(){return k};this.getSessionConstraints=function(){return W};this.setUndoManager=function(a){P&&P.unsubscribe(gui.UndoManager.signalUndoStackChanged,q);if(P=a)P.setDocument(t),P.setPlaybackFunction(k.enqueue),P.subscribe(gui.UndoManager.signalUndoStackChanged,q)};this.getUndoManager=function(){return P};this.getMetadataController=function(){return qa};this.getAnnotationController=function(){return ga};this.getDirectFormattingController=
function(){return ba};this.getHyperlinkClickHandler=function(){return pa};this.getHyperlinkController=function(){return ta};this.getImageController=function(){return na};this.getSelectionController=function(){return X};this.getTextController=function(){return da};this.getEventManager=function(){return N};this.getKeyboardHandlers=function(){return{keydown:D,keypress:R}};this.destroy=function(a){var b=[ja.destroy,la.destroy,ba.destroy,ca.destroy,N.destroy,pa.destroy,ta.destroy,qa.destroy,X.destroy,
da.destroy,Y];sa&&b.unshift(sa.destroy);runtime.clearTimeout(ia);core.Async.destroyAll(b,a)};ja=core.Task.createRedrawTask(v);la=core.Task.createRedrawTask(function(){var a=t.getCursor(b);if(a&&a.getSelectionType()===ops.OdtCursor.RegionSelection&&(a=G.getImageElements(a.getSelectedRange())[0])){ka.select(a.parentNode);return}ka.clearSelection()});D.bind(M.Left,K.None,E(X.moveCursorToLeft));D.bind(M.Right,K.None,E(X.moveCursorToRight));D.bind(M.Up,K.None,E(X.moveCursorUp));D.bind(M.Down,K.None,E(X.moveCursorDown));
D.bind(M.Left,K.Shift,E(X.extendSelectionToLeft));D.bind(M.Right,K.Shift,E(X.extendSelectionToRight));D.bind(M.Up,K.Shift,E(X.extendSelectionUp));D.bind(M.Down,K.Shift,E(X.extendSelectionDown));D.bind(M.Home,K.None,E(X.moveCursorToLineStart));D.bind(M.End,K.None,E(X.moveCursorToLineEnd));D.bind(M.Home,K.Ctrl,E(X.moveCursorToDocumentStart));D.bind(M.End,K.Ctrl,E(X.moveCursorToDocumentEnd));D.bind(M.Home,K.Shift,E(X.extendSelectionToLineStart));D.bind(M.End,K.Shift,E(X.extendSelectionToLineEnd));D.bind(M.Up,
K.CtrlShift,E(X.extendSelectionToParagraphStart));D.bind(M.Down,K.CtrlShift,E(X.extendSelectionToParagraphEnd));D.bind(M.Home,K.CtrlShift,E(X.extendSelectionToDocumentStart));D.bind(M.End,K.CtrlShift,E(X.extendSelectionToDocumentEnd));ra?(D.bind(M.Left,K.Alt,E(X.moveCursorBeforeWord)),D.bind(M.Right,K.Alt,E(X.moveCursorPastWord)),D.bind(M.Left,K.Meta,E(X.moveCursorToLineStart)),D.bind(M.Right,K.Meta,E(X.moveCursorToLineEnd)),D.bind(M.Home,K.Meta,E(X.moveCursorToDocumentStart)),D.bind(M.End,K.Meta,
E(X.moveCursorToDocumentEnd)),D.bind(M.Left,K.AltShift,E(X.extendSelectionBeforeWord)),D.bind(M.Right,K.AltShift,E(X.extendSelectionPastWord)),D.bind(M.Left,K.MetaShift,E(X.extendSelectionToLineStart)),D.bind(M.Right,K.MetaShift,E(X.extendSelectionToLineEnd)),D.bind(M.Up,K.AltShift,E(X.extendSelectionToParagraphStart)),D.bind(M.Down,K.AltShift,E(X.extendSelectionToParagraphEnd)),D.bind(M.Up,K.MetaShift,E(X.extendSelectionToDocumentStart)),D.bind(M.Down,K.MetaShift,E(X.extendSelectionToDocumentEnd)),
D.bind(M.A,K.Meta,E(X.extendSelectionToEntireDocument))):(D.bind(M.Left,K.Ctrl,E(X.moveCursorBeforeWord)),D.bind(M.Right,K.Ctrl,E(X.moveCursorPastWord)),D.bind(M.Left,K.CtrlShift,E(X.extendSelectionBeforeWord)),D.bind(M.Right,K.CtrlShift,E(X.extendSelectionPastWord)),D.bind(M.A,K.Ctrl,E(X.extendSelectionToEntireDocument)));ua&&(sa=new gui.IOSSafariSupport(N));N.subscribe("keydown",D.handleEvent);N.subscribe("keypress",R.handleEvent);N.subscribe("keyup",aa.handleEvent);N.subscribe("copy",m);N.subscribe("mousedown",
s);N.subscribe("mousemove",ja.trigger);N.subscribe("mouseup",J);N.subscribe("contextmenu",A);N.subscribe("dragstart",F);N.subscribe("dragend",H);N.subscribe("click",pa.handleClick);N.subscribe("longpress",B);N.subscribe("drag",u);N.subscribe("dragstop",z);t.subscribe(ops.OdtDocument.signalOperationEnd,la.trigger);t.subscribe(ops.Document.signalCursorAdded,ca.registerCursor);t.subscribe(ops.Document.signalCursorRemoved,ca.removeCursor);t.subscribe(ops.OdtDocument.signalOperationEnd,e)}})();gui.CaretManager=function(f,k){function b(b){return l.hasOwnProperty(b)?l[b]:null}function c(){return Object.keys(l).map(function(b){return l[b]})}function d(b){var c=l[b];c&&(delete l[b],b===f.getInputMemberId()?(p.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,c.ensureVisible),p.unsubscribe(ops.Document.signalCursorMoved,c.refreshCursorBlinking),r.unsubscribe("compositionupdate",c.handleUpdate),r.unsubscribe("compositionend",c.handleUpdate),r.unsubscribe("focus",c.setFocus),r.unsubscribe("blur",
c.removeFocus),n.removeEventListener("focus",c.show,!1),n.removeEventListener("blur",c.hide,!1)):p.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,c.handleUpdate),c.destroy(function(){}))}var l={},n=runtime.getWindow(),p=f.getSession().getOdtDocument(),r=f.getEventManager();this.registerCursor=function(b,c,a){var e=b.getMemberId();b=new gui.Caret(b,k,c,a);l[e]=b;e===f.getInputMemberId()?(runtime.log("Starting to track input on new cursor of "+e),p.subscribe(ops.OdtDocument.signalProcessingBatchEnd,
b.ensureVisible),p.subscribe(ops.Document.signalCursorMoved,b.refreshCursorBlinking),r.subscribe("compositionupdate",b.handleUpdate),r.subscribe("compositionend",b.handleUpdate),r.subscribe("focus",b.setFocus),r.subscribe("blur",b.removeFocus),n.addEventListener("focus",b.show,!1),n.addEventListener("blur",b.hide,!1),b.setOverlayElement(r.getEventTrap())):p.subscribe(ops.OdtDocument.signalProcessingBatchEnd,b.handleUpdate);return b};this.getCaret=b;this.getCarets=c;this.destroy=function(b){var h=
c().map(function(a){return a.destroy});f.getSelectionController().setCaretXPositionLocator(null);p.unsubscribe(ops.Document.signalCursorRemoved,d);l={};core.Async.destroyAll(h,b)};f.getSelectionController().setCaretXPositionLocator(function(){var c=b(f.getInputMemberId()),d;c&&(d=c.getBoundingClientRect());return d?d.right:void 0});p.subscribe(ops.Document.signalCursorRemoved,d)};gui.EditInfoHandle=function(f){var k=[],b,c=f.ownerDocument,d=c.documentElement.namespaceURI;this.setEdits=function(f){k=f;var n,p,r,m;b.innerHTML="";for(f=0;f<k.length;f+=1)n=c.createElementNS(d,"div"),n.className="editInfo",p=c.createElementNS(d,"span"),p.className="editInfoColor",p.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",k[f].memberid),r=c.createElementNS(d,"span"),r.className="editInfoAuthor",r.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",k[f].memberid),
m=c.createElementNS(d,"span"),m.className="editInfoTime",m.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",k[f].memberid),m.innerHTML=k[f].time,n.appendChild(p),n.appendChild(r),n.appendChild(m),b.appendChild(n)};this.show=function(){b.style.display="block"};this.hide=function(){b.style.display="none"};this.destroy=function(c){f.removeChild(b);c()};b=c.createElementNS(d,"div");b.setAttribute("class","editInfoHandle");b.style.display="none";f.appendChild(b)};ops.EditInfo=function(f,k){function b(){var b=[],c;for(c in d)d.hasOwnProperty(c)&&b.push({memberid:c,time:d[c].time});b.sort(function(b,c){return b.time-c.time});return b}var c,d={};this.getNode=function(){return c};this.getOdtDocument=function(){return k};this.getEdits=function(){return d};this.getSortedEdits=function(){return b()};this.addEdit=function(b,c){d[b]={time:c}};this.clearEdits=function(){d={}};this.destroy=function(b){f.parentNode&&f.removeChild(c);b()};c=k.getDOMDocument().createElementNS("urn:webodf:names:editinfo",
"editinfo");f.insertBefore(c,f.firstChild)};gui.EditInfoMarker=function(f,k){function b(b,a){return runtime.setTimeout(function(){n.style.opacity=b},a)}var c=this,d,l,n,p,r,m;this.addEdit=function(c,a){var e=Date.now()-a;f.addEdit(c,a);l.setEdits(f.getSortedEdits());n.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",c);runtime.clearTimeout(r);runtime.clearTimeout(m);1E4>e?(p=b(1,0),r=b(0.5,1E4-e),m=b(0.2,2E4-e)):1E4<=e&&2E4>e?(p=b(0.5,0),m=b(0.2,2E4-e)):p=b(0.2,0)};this.getEdits=function(){return f.getEdits()};this.clearEdits=
function(){f.clearEdits();l.setEdits([]);n.hasAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")&&n.removeAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")};this.getEditInfo=function(){return f};this.show=function(){n.style.display="block"};this.hide=function(){c.hideHandle();n.style.display="none"};this.showHandle=function(){l.show()};this.hideHandle=function(){l.hide()};this.destroy=function(b){runtime.clearTimeout(p);runtime.clearTimeout(r);runtime.clearTimeout(m);d.removeChild(n);
l.destroy(function(a){a?b(a):f.destroy(b)})};(function(){var b=f.getOdtDocument().getDOMDocument();n=b.createElementNS(b.documentElement.namespaceURI,"div");n.setAttribute("class","editInfoMarker");n.onmouseover=function(){c.showHandle()};n.onmouseout=function(){c.hideHandle()};d=f.getNode();d.appendChild(n);l=new gui.EditInfoHandle(d);k||c.hide()})()};gui.HyperlinkTooltipView=function(f,k){var b=core.DomUtils,c=odf.OdfUtils,d=runtime.getWindow(),l,n,p;runtime.assert(null!==d,"Expected to be run in an environment which has a global window, like a browser.");this.showTooltip=function(r){var m=r.target||r.srcElement,h=f.getSizer(),a=f.getZoomLevel(),e;a:{for(;m;){if(c.isHyperlink(m))break a;if(c.isParagraph(m)||c.isInlineRoot(m))break;m=m.parentNode}m=null}if(m){b.containsNode(h,p)||h.appendChild(p);e=n;var q;switch(k()){case gui.KeyboardHandler.Modifier.Ctrl:q=
runtime.tr("Ctrl-click to follow link");break;case gui.KeyboardHandler.Modifier.Meta:q=runtime.tr("\u2318-click to follow link");break;default:q=""}e.textContent=q;l.textContent=c.getHyperlinkTarget(m);p.style.display="block";e=d.innerWidth-p.offsetWidth-15;m=r.clientX>e?e:r.clientX+15;e=d.innerHeight-p.offsetHeight-10;r=r.clientY>e?e:r.clientY+10;h=h.getBoundingClientRect();m=(m-h.left)/a;r=(r-h.top)/a;p.style.left=m+"px";p.style.top=r+"px"}};this.hideTooltip=function(){p.style.display="none"};this.destroy=
function(b){p.parentNode&&p.parentNode.removeChild(p);b()};(function(){var b=f.getElement().ownerDocument;l=b.createElement("span");n=b.createElement("span");l.className="webodf-hyperlinkTooltipLink";n.className="webodf-hyperlinkTooltipText";p=b.createElement("div");p.className="webodf-hyperlinkTooltip";p.appendChild(l);p.appendChild(n);f.getElement().appendChild(p)})()};gui.ShadowCursor=function(f){var k=f.getDOMDocument().createRange(),b=!0;this.removeFromDocument=function(){};this.getMemberId=function(){return gui.ShadowCursor.ShadowCursorMemberId};this.getSelectedRange=function(){return k};this.setSelectedRange=function(c,d){k=c;b=!1!==d};this.hasForwardSelection=function(){return b};this.getDocument=function(){return f};this.getSelectionType=function(){return ops.OdtCursor.RangeSelection};k.setStart(f.getRootNode(),0)};gui.ShadowCursor.ShadowCursorMemberId="";gui.SelectionView=function(f){};gui.SelectionView.prototype.rerender=function(){};gui.SelectionView.prototype.show=function(){};gui.SelectionView.prototype.hide=function(){};gui.SelectionView.prototype.destroy=function(f){};gui.SelectionViewManager=function(f){function k(){return Object.keys(b).map(function(c){return b[c]})}var b={};this.getSelectionView=function(c){return b.hasOwnProperty(c)?b[c]:null};this.getSelectionViews=k;this.removeSelectionView=function(c){b.hasOwnProperty(c)&&(b[c].destroy(function(){}),delete b[c])};this.hideSelectionView=function(c){b.hasOwnProperty(c)&&b[c].hide()};this.showSelectionView=function(c){b.hasOwnProperty(c)&&b[c].show()};this.rerenderSelectionViews=function(){Object.keys(b).forEach(function(c){b[c].rerender()})};
this.registerCursor=function(c,d){var l=c.getMemberId(),k=new f(c);d?k.show():k.hide();return b[l]=k};this.destroy=function(b){function d(k,p){p?b(p):k<f.length?f[k].destroy(function(b){d(k+1,b)}):b()}var f=k();d(0,void 0)}};gui.SessionViewOptions=function(){this.caretBlinksOnRangeSelect=this.caretAvatarsInitiallyVisible=this.editInfoMarkersInitiallyVisible=!0};
(function(){gui.SessionView=function(f,k,b,c,d,l){function n(a){a.memberId===k&&I.getViewport().scrollIntoView(a.annotation.getBoundingClientRect())}function p(){var a=document.getElementsByTagName("head").item(0),b=document.createElement("style");b.type="text/css";b.media="screen, print, handheld, projection";a.appendChild(b);return b}function r(a,b,c){function e(b,c,d){c=b+'[editinfo|memberid="'+a+'"]'+d+c;a:{var f=v.firstChild;for(b=b+'[editinfo|memberid="'+a+'"]'+d+"{";f;){if(f.nodeType===Node.TEXT_NODE&&
0===f.data.indexOf(b)){b=f;break a}f=f.nextSibling}b=null}b?b.data=c:v.appendChild(document.createTextNode(c))}e("div.editInfoMarker","{ background-color: "+c+"; }","");e("span.editInfoColor","{ background-color: "+c+"; }","");e("span.editInfoAuthor",'{ content: "'+b+'"; }',":before");e("dc|creator","{ background-color: "+c+"; }","");e(".webodf-selectionOverlay","{ fill: "+c+"; stroke: "+c+";}","");a===k&&(e(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"),
a=gui.ShadowCursor.ShadowCursorMemberId,e(".webodf-selectionOverlay","{ fill: "+c+"; stroke: "+c+";}",""),e(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"))}function m(a){var b,c;for(c in x)x.hasOwnProperty(c)&&(b=x[c],a?b.show():b.hide())}function h(a){d.getCarets().forEach(function(b){a?b.showHandle():b.hideHandle()})}function a(a){var b=a.getMemberId();a=a.getProperties();r(b,a.fullName,a.color)}function e(a){var c=a.getMemberId(),e=b.getOdtDocument().getMember(c).getProperties();
d.registerCursor(a,A,J);l.registerCursor(a,!0);if(a=d.getCaret(c))a.setAvatarImageUrl(e.imageUrl),a.setColor(e.color);runtime.log("+++ View here +++ eagerly created an Caret for '"+c+"'! +++")}function q(a){a=a.getMemberId();var b=l.getSelectionView(k),c=l.getSelectionView(gui.ShadowCursor.ShadowCursorMemberId),e=d.getCaret(k);a===k?(c.hide(),b&&b.show(),e&&e.show()):a===gui.ShadowCursor.ShadowCursorMemberId&&(c.show(),b&&b.hide(),e&&e.hide())}function g(a){l.removeSelectionView(a)}function y(a){var c=
a.paragraphElement,e=a.memberId;a=a.timeStamp;var d,f="",g=c.getElementsByTagNameNS(w,"editinfo").item(0);g?(f=g.getAttributeNS(w,"id"),d=x[f]):(f=Math.random().toString(),d=new ops.EditInfo(c,b.getOdtDocument()),d=new gui.EditInfoMarker(d,H),g=c.getElementsByTagNameNS(w,"editinfo").item(0),g.setAttributeNS(w,"id",f),x[f]=d);d.addEdit(e,new Date(a));F.trigger()}function u(){var a;""!==s.innerHTML&&(s.innerHTML="");!0===c.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&(a=b.getOdtDocument().getMember(k))&&
(a=a.getProperties().fullName,s.appendChild(document.createTextNode(".annotationWrapper:not([creator = '"+a+"']) .annotationRemoveButton { display: none; }")))}function z(b){var d=Object.keys(x).map(function(a){return x[a]});B.unsubscribe(ops.Document.signalMemberAdded,a);B.unsubscribe(ops.Document.signalMemberUpdated,a);B.unsubscribe(ops.Document.signalCursorAdded,e);B.unsubscribe(ops.Document.signalCursorRemoved,g);B.unsubscribe(ops.OdtDocument.signalParagraphChanged,y);B.unsubscribe(ops.Document.signalCursorMoved,
q);B.unsubscribe(ops.OdtDocument.signalParagraphChanged,l.rerenderSelectionViews);B.unsubscribe(ops.OdtDocument.signalTableAdded,l.rerenderSelectionViews);B.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,l.rerenderSelectionViews);c.unsubscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,u);B.unsubscribe(ops.Document.signalMemberAdded,u);B.unsubscribe(ops.Document.signalMemberUpdated,u);v.parentNode.removeChild(v);s.parentNode.removeChild(s);(function Y(a,c){c?b(c):a<d.length?
d[a].destroy(function(b){Y(a+1,b)}):b()})(0,void 0)}var v,s,w="urn:webodf:names:editinfo",x={},B,I,F,H=void 0!==f.editInfoMarkersInitiallyVisible?Boolean(f.editInfoMarkersInitiallyVisible):!0,A=void 0!==f.caretAvatarsInitiallyVisible?Boolean(f.caretAvatarsInitiallyVisible):!0,J=void 0!==f.caretBlinksOnRangeSelect?Boolean(f.caretBlinksOnRangeSelect):!0;this.showEditInfoMarkers=function(){H||(H=!0,m(H))};this.hideEditInfoMarkers=function(){H&&(H=!1,m(H))};this.showCaretAvatars=function(){A||(A=!0,h(A))};
this.hideCaretAvatars=function(){A&&(A=!1,h(A))};this.getSession=function(){return b};this.getCaret=function(a){return d.getCaret(a)};this.destroy=function(a){var b=[F.destroy,z];B.unsubscribe(ops.OdtDocument.signalAnnotationAdded,n);core.Async.destroyAll(b,a)};B=b.getOdtDocument();I=B.getOdfCanvas();B.subscribe(ops.OdtDocument.signalAnnotationAdded,n);B.subscribe(ops.Document.signalMemberAdded,a);B.subscribe(ops.Document.signalMemberUpdated,a);B.subscribe(ops.Document.signalCursorAdded,e);B.subscribe(ops.Document.signalCursorRemoved,
g);B.subscribe(ops.OdtDocument.signalParagraphChanged,y);B.subscribe(ops.Document.signalCursorMoved,q);B.subscribe(ops.OdtDocument.signalParagraphChanged,l.rerenderSelectionViews);B.subscribe(ops.OdtDocument.signalTableAdded,l.rerenderSelectionViews);B.subscribe(ops.OdtDocument.signalParagraphStyleModified,l.rerenderSelectionViews);c.subscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,u);B.subscribe(ops.Document.signalMemberAdded,u);B.subscribe(ops.Document.signalMemberUpdated,u);v=p();
v.appendChild(document.createTextNode("@namespace editinfo url(urn:webodf:names:editinfo);"));v.appendChild(document.createTextNode("@namespace dc url(http://purl.org/dc/elements/1.1/);"));s=p();u();F=core.Task.createRedrawTask(function(){var a=I.getAnnotationViewManager();a&&(a.rehighlightAnnotations(),B.fixCursorPositions())})}})();gui.SvgSelectionView=function(f){function k(){var a=e.getRootNode();q!==a&&(q=a,g=e.getCanvas().getSizer(),g.appendChild(u),u.setAttribute("class","webodf-selectionOverlay"),v.setAttribute("class","webodf-draggable"),s.setAttribute("class","webodf-draggable"),v.setAttribute("end","left"),s.setAttribute("end","right"),v.setAttribute("r",8),s.setAttribute("r",8),u.appendChild(z),u.appendChild(v),u.appendChild(s))}function b(a){a=a.getBoundingClientRect();return Boolean(a&&0!==a.height)}function c(a){var c=
w.getTextElements(a,!0,!1),e=a.cloneRange(),d=a.cloneRange();a=a.cloneRange();if(!c.length)return null;var f;a:{f=0;var g=c[f],h=e.startContainer===g?e.startOffset:0,l=h;e.setStart(g,h);for(e.setEnd(g,l);!b(e);){if(g.nodeType===Node.ELEMENT_NODE&&l<g.childNodes.length)l=g.childNodes.length;else if(g.nodeType===Node.TEXT_NODE&&l<g.length)l+=1;else if(c[f])g=c[f],f+=1,h=l=0;else{f=!1;break a}e.setStart(g,h);e.setEnd(g,l)}f=!0}if(!f)return null;a:{f=c.length-1;g=c[f];l=h=d.endContainer===g?d.endOffset:
g.nodeType===Node.TEXT_NODE?g.length:g.childNodes.length;d.setStart(g,h);for(d.setEnd(g,l);!b(d);){if(g.nodeType===Node.ELEMENT_NODE&&0<h)h=0;else if(g.nodeType===Node.TEXT_NODE&&0<h)h-=1;else if(c[f])g=c[f],f-=1,h=l=g.length||g.childNodes.length;else{c=!1;break a}d.setStart(g,h);d.setEnd(g,l)}c=!0}if(!c)return null;a.setStart(e.startContainer,e.startOffset);a.setEnd(d.endContainer,d.endOffset);return{firstRange:e,lastRange:d,fillerRange:a}}function d(a,b){var c={};c.top=Math.min(a.top,b.top);c.left=
Math.min(a.left,b.left);c.right=Math.max(a.right,b.right);c.bottom=Math.max(a.bottom,b.bottom);c.width=c.right-c.left;c.height=c.bottom-c.top;return c}function l(a,b){b&&0<b.width&&0<b.height&&(a=a?d(a,b):b);return a}function n(a){function b(a){F.setUnfilteredPosition(a,0);return u.acceptNode(a)===H&&s.acceptPosition(F)===H?H:A}function c(a){var e=null;b(a)===H&&(e=x.getBoundingClientRect(a));return e}var d=a.commonAncestorContainer,f=a.startContainer,g=a.endContainer,h=a.startOffset,k=a.endOffset,
m,n,q=null,p,r=y.createRange(),s,u=new odf.OdfNodeFilter,v;if(f===d||g===d)return r=a.cloneRange(),q=r.getBoundingClientRect(),r.detach(),q;for(a=f;a.parentNode!==d;)a=a.parentNode;for(n=g;n.parentNode!==d;)n=n.parentNode;s=e.createRootFilter(f);for(d=a.nextSibling;d&&d!==n;)p=c(d),q=l(q,p),d=d.nextSibling;if(w.isParagraph(a))q=l(q,x.getBoundingClientRect(a));else if(a.nodeType===Node.TEXT_NODE)d=a,r.setStart(d,h),r.setEnd(d,d===n?k:d.length),p=r.getBoundingClientRect(),q=l(q,p);else for(v=y.createTreeWalker(a,
NodeFilter.SHOW_TEXT,b,!1),d=v.currentNode=f;d&&d!==g;)r.setStart(d,h),r.setEnd(d,d.length),p=r.getBoundingClientRect(),q=l(q,p),m=d,h=0,d=v.nextNode();m||(m=f);if(w.isParagraph(n))q=l(q,x.getBoundingClientRect(n));else if(n.nodeType===Node.TEXT_NODE)d=n,r.setStart(d,d===a?h:0),r.setEnd(d,k),p=r.getBoundingClientRect(),q=l(q,p);else for(v=y.createTreeWalker(n,NodeFilter.SHOW_TEXT,b,!1),d=v.currentNode=g;d&&d!==m;)if(r.setStart(d,0),r.setEnd(d,k),p=r.getBoundingClientRect(),q=l(q,p),d=v.previousNode())k=
d.length;return q}function p(a,b){var c=a.getBoundingClientRect(),e={width:0};e.top=c.top;e.bottom=c.bottom;e.height=c.height;e.left=e.right=b?c.right:c.left;return e}function r(){var a=f.getSelectedRange(),b;if(b=I&&f.getSelectionType()===ops.OdtCursor.RangeSelection&&!a.collapsed){k();var e=x.getBoundingClientRect(g),h=B.getZoomLevel(),a=c(a),l,m,q,r,y,w;if(a){b=a.firstRange;l=a.lastRange;m=a.fillerRange;q=x.translateRect(p(b,!1),e,h);y=x.translateRect(p(l,!0),e,h);r=(r=n(m))?x.translateRect(r,
e,h):d(q,y);w=r.left;r=q.left+Math.max(0,r.width-(q.left-r.left));e=Math.min(q.top,y.top);h=y.top+y.height;w=[{x:q.left,y:e+q.height},{x:q.left,y:e},{x:r,y:e},{x:r,y:h-y.height},{x:y.right,y:h-y.height},{x:y.right,y:h},{x:w,y:h},{x:w,y:e+q.height},{x:q.left,y:e+q.height}];r="";var F;for(F=0;F<w.length;F+=1)r+=w[F].x+","+w[F].y+" ";z.setAttribute("points",r);v.setAttribute("cx",q.left);v.setAttribute("cy",e+q.height/2);s.setAttribute("cx",y.right);s.setAttribute("cy",h-y.height/2);b.detach();l.detach();
m.detach()}b=Boolean(a)}u.style.display=b?"block":"none"}function m(a){I&&a===f&&J.trigger()}function h(a){a=8/a;v.setAttribute("r",a);s.setAttribute("r",a)}function a(a){g.removeChild(u);g.classList.remove("webodf-virtualSelections");f.getDocument().unsubscribe(ops.Document.signalCursorMoved,m);B.unsubscribe(gui.ZoomHelper.signalZoomChanged,h);a()}var e=f.getDocument(),q,g,y=e.getDOMDocument(),u=y.createElementNS("http://www.w3.org/2000/svg","svg"),z=y.createElementNS("http://www.w3.org/2000/svg",
"polygon"),v=y.createElementNS("http://www.w3.org/2000/svg","circle"),s=y.createElementNS("http://www.w3.org/2000/svg","circle"),w=odf.OdfUtils,x=core.DomUtils,B=e.getCanvas().getZoomHelper(),I=!0,F=f.getDocument().createPositionIterator(e.getRootNode()),H=NodeFilter.FILTER_ACCEPT,A=NodeFilter.FILTER_REJECT,J;this.rerender=function(){I&&J.trigger()};this.show=function(){I=!0;J.trigger()};this.hide=function(){I=!1;J.trigger()};this.destroy=function(b){core.Async.destroyAll([J.destroy,a],b)};(function(){var a=
f.getMemberId();J=core.Task.createRedrawTask(r);k();u.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",a);g.classList.add("webodf-virtualSelections");f.getDocument().subscribe(ops.Document.signalCursorMoved,m);B.subscribe(gui.ZoomHelper.signalZoomChanged,h);h(B.getZoomLevel())})()};gui.UndoStateRules=function(){function f(b,c){var f=b.length;this.previous=function(){for(f-=1;0<=f;f-=1)if(c(b[f]))return b[f];return null}}function k(b){b=b.spec();var c;b.hasOwnProperty("position")&&(c=b.position);return c}function b(b){return b.isEdit}function c(b,c,f){if(!f)return f=k(b)-k(c),0===f||1===Math.abs(f);b=k(b);c=k(c);f=k(f);return b-c===c-f}this.isEditOperation=b;this.isPartOfOperationSet=function(d,l){var k=void 0!==d.group,p;if(!d.isEdit||0===l.length)return!0;p=l[l.length-1];if(k&&
d.group===p.group)return!0;a:switch(d.spec().optype){case "RemoveText":case "InsertText":p=!0;break a;default:p=!1}if(p&&l.some(b)){if(k){var r;k=d.spec().optype;p=new f(l,b);var m=p.previous(),h=null,a,e;runtime.assert(Boolean(m),"No edit operations found in state");e=m.group;runtime.assert(void 0!==e,"Operation has no group");for(a=1;m&&m.group===e;){if(k===m.spec().optype){r=m;break}m=p.previous()}if(r){for(m=p.previous();m;){if(m.group!==e){if(2===a)break;e=m.group;a+=1}if(k===m.spec().optype){h=
m;break}m=p.previous()}r=c(d,r,h)}else r=!1;return r}r=d.spec().optype;k=new f(l,b);p=k.previous();runtime.assert(Boolean(p),"No edit operations found in state");r=r===p.spec().optype?c(d,p,k.previous()):!1;return r}return!1}};gui.TrivialUndoManager=function(f){function k(a){0<a.length&&(w=!0,q(a),w=!1)}function b(){v.emit(gui.UndoManager.signalUndoStackChanged,{undoAvailable:r.hasUndoStates(),redoAvailable:r.hasRedoStates()})}function c(){y!==e&&y!==u[u.length-1]&&u.push(y)}function d(a){var b=a.previousSibling||a.nextSibling;a.parentNode.removeChild(a);h.normalizeTextNodes(b)}function l(a){return Object.keys(a).map(function(b){return a[b]})}function n(a){function b(a){var g=a.spec();if(d[g.memberid])switch(g.optype){case "AddCursor":c[g.memberid]||
(c[g.memberid]=a,delete d[g.memberid],f-=1);break;case "MoveCursor":e[g.memberid]||(e[g.memberid]=a)}}var c={},e={},d={},f,h=a.pop();g.getMemberIds().forEach(function(a){d[a]=!0});for(f=Object.keys(d).length;h&&0<f;)h.reverse(),h.forEach(b),h=a.pop();return l(c).concat(l(e))}function p(){var f=a=g.cloneDocumentElement();h.getElementsByTagNameNS(f,m,"cursor").forEach(d);h.getElementsByTagNameNS(f,m,"anchor").forEach(d);c();y=e=n([e].concat(u));u.length=0;z.length=0;b()}var r=this,m="urn:webodf:names:cursor",
h=core.DomUtils,a,e=[],q,g,y=[],u=[],z=[],v=new core.EventNotifier([gui.UndoManager.signalUndoStackChanged,gui.UndoManager.signalUndoStateCreated,gui.UndoManager.signalUndoStateModified,gui.TrivialUndoManager.signalDocumentRootReplaced]),s=f||new gui.UndoStateRules,w=!1;this.subscribe=function(a,b){v.subscribe(a,b)};this.unsubscribe=function(a,b){v.unsubscribe(a,b)};this.hasUndoStates=function(){return 0<u.length};this.hasRedoStates=function(){return 0<z.length};this.setDocument=function(a){g=a};
this.purgeInitialState=function(){u.length=0;z.length=0;e.length=0;y.length=0;a=null;b()};this.setInitialState=p;this.initialize=function(){a||p()};this.setPlaybackFunction=function(a){q=a};this.onOperationExecuted=function(a){w||(s.isEditOperation(a)&&(y===e||0<z.length)||!s.isPartOfOperationSet(a,y)?(z.length=0,c(),y=[a],u.push(y),v.emit(gui.UndoManager.signalUndoStateCreated,{operations:y}),b()):(y.push(a),v.emit(gui.UndoManager.signalUndoStateModified,{operations:y})))};this.moveForward=function(a){for(var c=
0,e;a&&z.length;)e=z.pop(),u.push(e),k(e),a-=1,c+=1;c&&(y=u[u.length-1],b());return c};this.moveBackward=function(c){for(var d=0;c&&u.length;)z.push(u.pop()),c-=1,d+=1;d&&(g.getMemberIds().forEach(function(a){g.removeCursor(a)}),g.setDocumentElement(a.cloneNode(!0)),v.emit(gui.TrivialUndoManager.signalDocumentRootReplaced,{}),k(e),u.forEach(k),y=u[u.length-1]||e,b());return d}};gui.TrivialUndoManager.signalDocumentRootReplaced="documentRootReplaced";odf.GraphicProperties=function(f,k,b){var c=this,d=odf.Namespaces.stylens,l=odf.Namespaces.svgns;this.verticalPos=function(){return c.data.value("verticalPos")};this.verticalRel=function(){return c.data.value("verticalRel")};this.horizontalPos=function(){return c.data.value("horizontalPos")};this.horizontalRel=function(){return c.data.value("horizontalRel")};this.strokeWidth=function(){return c.data.value("strokeWidth")};c.data=new odf.LazyStyleProperties(void 0===b?void 0:b.data,{verticalPos:function(){var b=
f.getAttributeNS(d,"vertical-pos");return""===b?void 0:b},verticalRel:function(){var b=f.getAttributeNS(d,"vertical-rel");return""===b?void 0:b},horizontalPos:function(){var b=f.getAttributeNS(d,"horizontal-pos");return""===b?void 0:b},horizontalRel:function(){var b=f.getAttributeNS(d,"horizontal-rel");return""===b?void 0:b},strokeWidth:function(){var b=f.getAttributeNS(l,"stroke-width");return k.parseLength(b)}})};
odf.ComputedGraphicProperties=function(){var f;this.setGraphicProperties=function(k){f=k};this.verticalPos=function(){return f&&f.verticalPos()||"from-top"};this.verticalRel=function(){return f&&f.verticalRel()||"page"};this.horizontalPos=function(){return f&&f.horizontalPos()||"from-left"};this.horizontalRel=function(){return f&&f.horizontalRel()||"page"}};odf.PageLayoutProperties=function(f,k,b){var c=this,d=odf.Namespaces.fons;this.pageHeight=function(){return c.data.value("pageHeight")||1123};this.pageWidth=function(){return c.data.value("pageWidth")||794};c.data=new odf.LazyStyleProperties(void 0===b?void 0:b.data,{pageHeight:function(){var b;f&&(b=f.getAttributeNS(d,"page-height"),b=k.parseLength(b));return b},pageWidth:function(){var b;f&&(b=f.getAttributeNS(d,"page-width"),b=k.parseLength(b));return b}})};
odf.PageLayout=function(f,k,b){var c=null;f&&(c=k.getPropertiesElement("page-layout-properties",f));this.pageLayout=new odf.PageLayoutProperties(c,k,b&&b.pageLayout)};odf.PageLayoutCache=function(){};odf.PageLayoutCache.prototype.getPageLayout=function(f){};odf.PageLayoutCache.prototype.getDefaultPageLayout=function(){};odf.ParagraphProperties=function(f,k,b){var c=this,d=odf.Namespaces.fons;this.marginTop=function(){return c.data.value("marginTop")};c.data=new odf.LazyStyleProperties(void 0===b?void 0:b.data,{marginTop:function(){var c=f.getAttributeNS(d,"margin-top");return k.parsePositiveLengthOrPercent(c,"marginTop",b&&b.data)}})};
odf.ComputedParagraphProperties=function(){var f={},k=[];this.setStyleChain=function(b){k=b;f={}};this.marginTop=function(){var b,c;if(f.hasOwnProperty("marginTop"))b=f.marginTop;else{for(c=0;void 0===b&&c<k.length;c+=1)b=k[c].marginTop();f.marginTop=b}return b||0}};odf.TextProperties=function(f,k,b){var c=this,d=odf.Namespaces.fons;this.fontSize=function(){return c.data.value("fontSize")};c.data=new odf.LazyStyleProperties(void 0===b?void 0:b.data,{fontSize:function(){var c=f.getAttributeNS(d,"font-size");return k.parsePositiveLengthOrPercent(c,"fontSize",b&&b.data)}})};
odf.ComputedTextProperties=function(){var f={},k=[];this.setStyleChain=function(b){k=b;f={}};this.fontSize=function(){var b,c;if(f.hasOwnProperty("fontSize"))b=f.fontSize;else{for(c=0;void 0===b&&c<k.length;c+=1)b=k[c].fontSize();f.fontSize=b}return b||12}};odf.MasterPage=function(f,k){var b;f?(b=f.getAttributeNS(odf.Namespaces.stylens,"page-layout-name"),this.pageLayout=k.getPageLayout(b)):this.pageLayout=k.getDefaultPageLayout()};odf.MasterPageCache=function(){};odf.MasterPageCache.prototype.getMasterPage=function(f){};
odf.StylePileEntry=function(f,k,b,c){this.masterPage=function(){var c=f.getAttributeNS(odf.Namespaces.stylens,"master-page-name"),k=null;c&&(k=b.getMasterPage(c));return k};(function(b){var l=f.getAttributeNS(odf.Namespaces.stylens,"family"),n=null;if("graphic"===l||"chart"===l)b.graphic=void 0===c?void 0:c.graphic,n=k.getPropertiesElement("graphic-properties",f,n),null!==n&&(b.graphic=new odf.GraphicProperties(n,k,b.graphic));if("paragraph"===l||"table-cell"===l||"graphic"===l||"presentation"===
l||"chart"===l)b.paragraph=void 0===c?void 0:c.paragraph,n=k.getPropertiesElement("paragraph-properties",f,n),null!==n&&(b.paragraph=new odf.ParagraphProperties(n,k,b.paragraph));if("text"===l||"paragraph"===l||"table-cell"===l||"graphic"===l||"presentation"===l||"chart"===l)b.text=void 0===c?void 0:c.text,n=k.getPropertiesElement("text-properties",f,n),null!==n&&(b.text=new odf.TextProperties(n,k,b.text))})(this)};
odf.StylePile=function(f,k){function b(b,a){var e,d;b.hasAttributeNS(c,"parent-style-name")&&(d=b.getAttributeNS(c,"parent-style-name"),-1===a.indexOf(d)&&(e=m(d,a)));return new odf.StylePileEntry(b,f,k,e)}var c=odf.Namespaces.stylens,d={},l={},n,p={},r={},m;m=function(c,a){var e=p[c],f;!e&&(f=d[c])&&(a.push(c),e=b(f,a),p[c]=e);return e};this.getStyle=function(c){var a=r[c]||p[c],e,f=[];a||(e=l[c],e||(e=d[c])&&f.push(c),e&&(a=b(e,f)));return a};this.addCommonStyle=function(b){var a;b.hasAttributeNS(c,
"name")&&(a=b.getAttributeNS(c,"name"),d.hasOwnProperty(a)||(d[a]=b))};this.addAutomaticStyle=function(b){var a;b.hasAttributeNS(c,"name")&&(a=b.getAttributeNS(c,"name"),l.hasOwnProperty(a)||(l[a]=b))};this.setDefaultStyle=function(c){void 0===n&&(n=b(c,[]))};this.getDefaultStyle=function(){return n}};odf.ComputedGraphicStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties;this.graphic=new odf.ComputedGraphicProperties};
odf.ComputedParagraphStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties};odf.ComputedTextStyle=function(){this.text=new odf.ComputedTextProperties};
odf.StyleCache=function(f){function k(a,b,c,e){b=c.getAttributeNS(b,"class-names");var d;if(b)for(b=b.split(" "),d=0;d<b.length;d+=1)if(c=b[d])e.push(a),e.push(c)}function b(a,b){var c=u.getStyleName("paragraph",a);void 0!==c&&(b.push("paragraph"),b.push(c));a.namespaceURI!==g||"h"!==a.localName&&"p"!==a.localName||k("paragraph",g,a,b);return b}function c(a,b,c){var e=[],d,f,g,h;for(d=0;d<a.length;d+=2)g=a[d],h=a[d+1],g=p[g],h=g.getStyle(h),void 0!==h&&(h=h[b],void 0!==h&&h!==f&&(e.push(h),f=h));
g=p[c];if(h=g.getDefaultStyle())h=h[b],void 0!==h&&h!==f&&e.push(h);return e}function d(a,c){var e=u.getStyleName("text",a),h=a.parentNode;void 0!==e&&(c.push("text"),c.push(e));"span"===a.localName&&a.namespaceURI===g&&k("text",g,a,c);if(!h||h===f)return c;h.namespaceURI!==g||"p"!==h.localName&&"h"!==h.localName?d(h,c):b(h,c);return c}function l(a){a=a.getAttributeNS(y,"family");return p[a]}var n=this,p,r,m,h,a,e,q,g=odf.Namespaces.textns,y=odf.Namespaces.stylens,u=new odf.StyleInfo,z=new odf.StyleParseUtils,
v,s,w,x,B,I;this.getComputedGraphicStyle=function(a){var b=[];a=u.getStyleName("graphic",a);void 0!==a&&(b.push("graphic"),b.push(a));a=b.join("/");var e=h[a];runtime.assert(0===b.length%2,"Invalid style chain.");void 0===e&&(e=new odf.ComputedGraphicStyle,e.graphic.setGraphicProperties(c(b,"graphic","graphic")[0]),e.text.setStyleChain(c(b,"text","graphic")),e.paragraph.setStyleChain(c(b,"paragraph","graphic")),h[a]=e);return e};this.getComputedParagraphStyle=function(a){a=b(a,[]);var e=a.join("/"),
d=m[e];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===d&&(d=new odf.ComputedParagraphStyle,d.text.setStyleChain(c(a,"text","paragraph")),d.paragraph.setStyleChain(c(a,"paragraph","paragraph")),m[e]=d);return d};this.getComputedTextStyle=function(a){a=d(a,[]);var b=a.join("/"),e=r[b];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===e&&(e=new odf.ComputedTextStyle,e.text.setStyleChain(c(a,"text","text")),r[b]=e);return e};this.getPageLayout=function(a){var b=I[a];b||((b=
B[a])?(b=new odf.PageLayout(b,z,x),I[a]=b):b=x);return b};this.getDefaultPageLayout=function(){return x};this.getMasterPage=function(a){var b=s[a];void 0===b&&((b=v[a])?(b=new odf.MasterPage(b,n),s[a]=b):b=null);return b};this.getDefaultMasterPage=function(){return w};this.update=function(){var b,c,d=null,g=null;r={};m={};h={};v={};s={};I={};B={};a=new odf.StylePile(z,n);e=new odf.StylePile(z,n);q=new odf.StylePile(z,n);p={text:a,paragraph:e,graphic:q};for(b=f.styles.firstElementChild;b;)b.namespaceURI===
y&&((c=l(b))?"style"===b.localName?c.addCommonStyle(b):"default-style"===b.localName&&c.setDefaultStyle(b):"default-page-layout"===b.localName&&(d=b)),b=b.nextElementSibling;x=new odf.PageLayout(d,z);for(b=f.automaticStyles.firstElementChild;b;)b.namespaceURI===y&&((c=l(b))&&"style"===b.localName?c.addAutomaticStyle(b):"page-layout"===b.localName&&(B[b.getAttributeNS(y,"name")]=b)),b=b.nextElementSibling;for(b=f.masterStyles.firstElementChild;b;)b.namespaceURI===y&&"master-page"===b.localName&&(g=
g||b,c=b,d=c.getAttributeNS(y,"name"),0<d.length&&!v.hasOwnProperty(d)&&(v[d]=c)),b=b.nextElementSibling;w=new odf.MasterPage(g,n)}};ops.OperationTransformMatrix=function(){function f(a){a.position+=a.length;a.length*=-1}function k(a){var b=0>a.length;b&&f(a);return b}function b(a,b){function c(f){a[f]===b&&d.push(f)}var d=[];a&&["style:parent-style-name","style:next-style-name"].forEach(c);return d}function c(a,b){function c(d){a[d]===b&&delete a[d]}a&&["style:parent-style-name","style:next-style-name"].forEach(c)}function d(a){var b={};Object.keys(a).forEach(function(c){b[c]="object"===typeof a[c]?d(a[c]):a[c]});return b}function l(a,
b,c,d){var f,h=!1,k=!1,l,m=[];d&&d.attributes&&(m=d.attributes.split(","));a&&(c||0<m.length)&&Object.keys(a).forEach(function(b){var e=a[b],d;"object"!==typeof e&&(c&&(d=c[b]),void 0!==d?(delete a[b],k=!0,d===e&&(delete c[b],h=!0)):-1!==m.indexOf(b)&&(delete a[b],k=!0))});if(b&&b.attributes&&(c||0<m.length)){l=b.attributes.split(",");for(d=0;d<l.length;d+=1)if(f=l[d],c&&void 0!==c[f]||m&&-1!==m.indexOf(f))l.splice(d,1),d-=1,k=!0;0<l.length?b.attributes=l.join(","):delete b.attributes}return{majorChanged:h,
minorChanged:k}}function n(a){for(var b in a)if(a.hasOwnProperty(b))return!0;return!1}function p(a){for(var b in a)if(a.hasOwnProperty(b)&&("attributes"!==b||0<a.attributes.length))return!0;return!1}function r(a,b,c,d,f){var h=a?a[f]:null,k=b?b[f]:null,m=c?c[f]:null,r=d?d[f]:null,w;w=l(h,k,m,r);h&&!n(h)&&delete a[f];k&&!p(k)&&delete b[f];m&&!n(m)&&delete c[f];r&&!p(r)&&delete d[f];return w}function m(a,b){return{opSpecsA:[a],opSpecsB:[b]}}var h;h={AddCursor:{AddCursor:m,AddMember:m,AddStyle:m,ApplyDirectStyling:m,
InsertText:m,MergeParagraph:m,MoveCursor:m,RemoveCursor:m,RemoveMember:m,RemoveStyle:m,RemoveText:m,SetParagraphStyle:m,SplitParagraph:m,UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},AddMember:{AddStyle:m,ApplyDirectStyling:m,InsertText:m,MergeParagraph:m,MoveCursor:m,RemoveCursor:m,RemoveStyle:m,RemoveText:m,SetParagraphStyle:m,SplitParagraph:m,UpdateMetadata:m,UpdateParagraphStyle:m},AddStyle:{AddStyle:m,ApplyDirectStyling:m,InsertText:m,MergeParagraph:m,MoveCursor:m,RemoveCursor:m,RemoveMember:m,
RemoveStyle:function(a,e){var d,f=[a],h=[e];a.styleFamily===e.styleFamily&&(d=b(a.setProperties,e.styleName),0<d.length&&(d={optype:"UpdateParagraphStyle",memberid:e.memberid,timestamp:e.timestamp,styleName:a.styleName,removedProperties:{attributes:d.join(",")}},h.unshift(d)),c(a.setProperties,e.styleName));return{opSpecsA:f,opSpecsB:h}},RemoveText:m,SetParagraphStyle:m,SplitParagraph:m,UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},ApplyDirectStyling:{ApplyDirectStyling:function(a,b,c){var f,
h,k,l,m,p,w,x;l=[a];k=[b];if(!(a.position+a.length<=b.position||a.position>=b.position+b.length)){f=c?a:b;h=c?b:a;if(a.position!==b.position||a.length!==b.length)p=d(f),w=d(h);b=r(h.setProperties,null,f.setProperties,null,"style:text-properties");if(b.majorChanged||b.minorChanged)k=[],a=[],l=f.position+f.length,m=h.position+h.length,h.position<f.position?b.minorChanged&&(x=d(w),x.length=f.position-h.position,a.push(x),h.position=f.position,h.length=m-h.position):f.position<h.position&&b.majorChanged&&
(x=d(p),x.length=h.position-f.position,k.push(x),f.position=h.position,f.length=l-f.position),m>l?b.minorChanged&&(p=w,p.position=l,p.length=m-l,a.push(p),h.length=l-h.position):l>m&&b.majorChanged&&(p.position=m,p.length=l-m,k.push(p),f.length=m-f.position),f.setProperties&&n(f.setProperties)&&k.push(f),h.setProperties&&n(h.setProperties)&&a.push(h),c?(l=k,k=a):l=a}return{opSpecsA:l,opSpecsB:k}},InsertText:function(a,b){b.position<=a.position?a.position+=b.text.length:b.position<=a.position+a.length&&
(a.length+=b.text.length);return{opSpecsA:[a],opSpecsB:[b]}},MergeParagraph:function(a,b){var c=a.position,d=a.position+a.length;c>=b.sourceStartPosition&&(c-=1);d>=b.sourceStartPosition&&(d-=1);a.position=c;a.length=d-c;return{opSpecsA:[a],opSpecsB:[b]}},MoveCursor:m,RemoveCursor:m,RemoveMember:m,RemoveStyle:m,RemoveText:function(a,b){var c=a.position+a.length,d=b.position+b.length,f=[a],h=[b];d<=a.position?a.position-=b.length:b.position<c&&(a.position<b.position?a.length=d<c?a.length-b.length:
b.position-a.position:(a.position=b.position,d<c?a.length=c-d:f=[]));return{opSpecsA:f,opSpecsB:h}},SetParagraphStyle:m,SplitParagraph:function(a,b){b.position<a.position?a.position+=1:b.position<a.position+a.length&&(a.length+=1);return{opSpecsA:[a],opSpecsB:[b]}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},InsertText:{InsertText:function(a,b,c){a.position<b.position?b.position+=a.text.length:a.position>b.position?a.position+=b.text.length:c?b.position+=a.text.length:a.position+=b.text.length;
return{opSpecsA:[a],opSpecsB:[b]}},MergeParagraph:function(a,b){a.position>=b.sourceStartPosition?a.position-=1:(a.position<b.sourceStartPosition&&(b.sourceStartPosition+=a.text.length),a.position<b.destinationStartPosition&&(b.destinationStartPosition+=a.text.length));return{opSpecsA:[a],opSpecsB:[b]}},MoveCursor:function(a,b){var c=k(b);a.position<b.position?b.position+=a.text.length:a.position<b.position+b.length&&(b.length+=a.text.length);c&&f(b);return{opSpecsA:[a],opSpecsB:[b]}},RemoveCursor:m,
RemoveMember:m,RemoveStyle:m,RemoveText:function(a,b){var c;c=b.position+b.length;var d=[a],f=[b];c<=a.position?a.position-=b.length:a.position<=b.position?b.position+=a.text.length:(b.length=a.position-b.position,c={optype:"RemoveText",memberid:b.memberid,timestamp:b.timestamp,position:a.position+a.text.length,length:c-a.position},f.unshift(c),a.position=b.position);return{opSpecsA:d,opSpecsB:f}},SetParagraphStyle:function(a,b){b.position>a.position&&(b.position+=a.text.length);return{opSpecsA:[a],
opSpecsB:[b]}},SplitParagraph:function(a,b){a.position<b.sourceParagraphPosition&&(b.sourceParagraphPosition+=a.text.length);a.position<=b.position?b.position+=a.text.length:a.position+=1;return{opSpecsA:[a],opSpecsB:[b]}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},MergeParagraph:{MergeParagraph:function(a,b,c){var d=[a],f=[b],h;a.destinationStartPosition===b.destinationStartPosition?(d=[],f=[],a.moveCursor&&(h={optype:"MoveCursor",memberid:a.memberid,timestamp:a.timestamp,position:a.sourceStartPosition-
1},d.push(h)),b.moveCursor&&(h={optype:"MoveCursor",memberid:b.memberid,timestamp:b.timestamp,position:b.sourceStartPosition-1},f.push(h)),a=c?a:b,a={optype:"SetParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,position:a.destinationStartPosition,styleName:a.paragraphStyleName},c?d.push(a):f.push(a)):b.sourceStartPosition===a.destinationStartPosition?(a.destinationStartPosition=b.destinationStartPosition,a.sourceStartPosition-=1,a.paragraphStyleName=b.paragraphStyleName):a.sourceStartPosition===
b.destinationStartPosition?(b.destinationStartPosition=a.destinationStartPosition,b.sourceStartPosition-=1,b.paragraphStyleName=a.paragraphStyleName):a.destinationStartPosition<b.destinationStartPosition?(b.destinationStartPosition-=1,b.sourceStartPosition-=1):(a.destinationStartPosition-=1,a.sourceStartPosition-=1);return{opSpecsA:d,opSpecsB:f}},MoveCursor:function(a,b){var c=b.position,d=b.position+b.length,f=Math.min(c,d),c=Math.max(c,d);f>=a.sourceStartPosition&&(f-=1);c>=a.sourceStartPosition&&
(c-=1);0<=b.length?(b.position=f,b.length=c-f):(b.position=c,b.length=f-c);return{opSpecsA:[a],opSpecsB:[b]}},RemoveCursor:m,RemoveMember:m,RemoveStyle:m,RemoveText:function(a,b){b.position>=a.sourceStartPosition?b.position-=1:(b.position<a.destinationStartPosition&&(a.destinationStartPosition-=b.length),b.position<a.sourceStartPosition&&(a.sourceStartPosition-=b.length));return{opSpecsA:[a],opSpecsB:[b]}},SetParagraphStyle:function(a,b){var c=[a],d=[b];if(b.position>a.sourceStartPosition)b.position-=
1;else if(b.position===a.destinationStartPosition||b.position===a.sourceStartPosition)b.position=a.destinationStartPosition,a.paragraphStyleName=b.styleName;return{opSpecsA:c,opSpecsB:d}},SplitParagraph:function(a,b){var c,d=[a],f=[b];b.position<a.destinationStartPosition?(a.destinationStartPosition+=1,a.sourceStartPosition+=1):b.position>=a.destinationStartPosition&&b.position<a.sourceStartPosition?(b.paragraphStyleName=a.paragraphStyleName,c={optype:"SetParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,
position:a.destinationStartPosition,styleName:a.paragraphStyleName},d.push(c),b.position===a.sourceStartPosition-1&&a.moveCursor&&(c={optype:"MoveCursor",memberid:a.memberid,timestamp:a.timestamp,position:b.position,length:0},d.push(c)),a.destinationStartPosition=b.position+1,a.sourceStartPosition+=1):b.position>=a.sourceStartPosition&&(b.position-=1,b.sourceParagraphPosition-=1);return{opSpecsA:d,opSpecsB:f}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},MoveCursor:{MoveCursor:m,RemoveCursor:function(a,
b){return{opSpecsA:a.memberid===b.memberid?[]:[a],opSpecsB:[b]}},RemoveMember:m,RemoveStyle:m,RemoveText:function(a,b){var c=k(a),d=a.position+a.length,h=b.position+b.length;h<=a.position?a.position-=b.length:b.position<d&&(a.position<b.position?a.length=h<d?a.length-b.length:b.position-a.position:(a.position=b.position,a.length=h<d?d-h:0));c&&f(a);return{opSpecsA:[a],opSpecsB:[b]}},SetParagraphStyle:m,SplitParagraph:function(a,b){var c=k(a);b.position<a.position?a.position+=1:b.position<a.position+
a.length&&(a.length+=1);c&&f(a);return{opSpecsA:[a],opSpecsB:[b]}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},RemoveCursor:{RemoveCursor:function(a,b){var c=a.memberid===b.memberid;return{opSpecsA:c?[]:[a],opSpecsB:c?[]:[b]}},RemoveMember:m,RemoveStyle:m,RemoveText:m,SetParagraphStyle:m,SplitParagraph:m,UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},RemoveMember:{RemoveStyle:m,RemoveText:m,SetParagraphStyle:m,SplitParagraph:m,UpdateMetadata:m,UpdateParagraphStyle:m},RemoveStyle:{RemoveStyle:function(a,
b){var c=a.styleName===b.styleName&&a.styleFamily===b.styleFamily;return{opSpecsA:c?[]:[a],opSpecsB:c?[]:[b]}},RemoveText:m,SetParagraphStyle:function(a,b){var c,d=[a],f=[b];"paragraph"===a.styleFamily&&a.styleName===b.styleName&&(c={optype:"SetParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,position:b.position,styleName:""},d.unshift(c),b.styleName="");return{opSpecsA:d,opSpecsB:f}},SplitParagraph:m,UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:function(a,d){var f,g=[a],h=[d];"paragraph"===
a.styleFamily&&(f=b(d.setProperties,a.styleName),0<f.length&&(f={optype:"UpdateParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,styleName:d.styleName,removedProperties:{attributes:f.join(",")}},g.unshift(f)),a.styleName===d.styleName?h=[]:c(d.setProperties,a.styleName));return{opSpecsA:g,opSpecsB:h}}},RemoveText:{RemoveText:function(a,b){var c=a.position+a.length,d=b.position+b.length,f=[a],h=[b];d<=a.position?a.position-=b.length:c<=b.position?b.position-=a.length:b.position<c&&(a.position<
b.position?(a.length=d<c?a.length-b.length:b.position-a.position,c<d?(b.position=a.position,b.length=d-c):h=[]):(c<d?b.length-=a.length:b.position<a.position?b.length=a.position-b.position:h=[],d<c?(a.position=b.position,a.length=c-d):f=[]));return{opSpecsA:f,opSpecsB:h}},SetParagraphStyle:function(a,b){a.position<b.position&&(b.position-=a.length);return{opSpecsA:[a],opSpecsB:[b]}},SplitParagraph:function(a,b){var c=a.position+a.length,d=[a],f=[b];b.position<=a.position?a.position+=1:b.position<
c&&(a.length=b.position-a.position,c={optype:"RemoveText",memberid:a.memberid,timestamp:a.timestamp,position:b.position+1,length:c-b.position},d.unshift(c));a.position+a.length<=b.position?b.position-=a.length:a.position<b.position&&(b.position=a.position);a.position+a.length<b.sourceParagraphPosition&&(b.sourceParagraphPosition-=a.length);return{opSpecsA:d,opSpecsB:f}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},SetParagraphStyle:{SetParagraphStyle:function(a,b,c){a.position===b.position&&
(c?b.styleName=a.styleName:a.styleName=b.styleName);return{opSpecsA:[a],opSpecsB:[b]}},SplitParagraph:function(a,b){var c=[a],f=[b],h;a.position>b.position?a.position+=1:a.position===b.sourceParagraphPosition&&(b.paragraphStyleName=a.styleName,h=d(a),h.position=b.position+1,c.push(h));return{opSpecsA:c,opSpecsB:f}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},SplitParagraph:{SplitParagraph:function(a,b,c){var d,f;a.position<b.position?d=!0:b.position<a.position?f=!0:a.position===b.position&&
(c?d=!0:f=!0);d?(b.position+=1,b.sourceParagraphPosition=a.position<b.sourceParagraphPosition?b.sourceParagraphPosition+1:a.position+1):f&&(a.position+=1,a.sourceParagraphPosition=b.position<b.sourceParagraphPosition?a.sourceParagraphPosition+1:b.position+1);return{opSpecsA:[a],opSpecsB:[b]}},UpdateMember:m,UpdateMetadata:m,UpdateParagraphStyle:m},UpdateMember:{UpdateMetadata:m,UpdateParagraphStyle:m},UpdateMetadata:{UpdateMetadata:function(a,b,c){var d,f=[a],h=[b];d=c?a:b;a=c?b:a;l(a.setProperties||
null,a.removedProperties||null,d.setProperties||null,d.removedProperties||null);d.setProperties&&n(d.setProperties)||d.removedProperties&&p(d.removedProperties)||(c?f=[]:h=[]);a.setProperties&&n(a.setProperties)||a.removedProperties&&p(a.removedProperties)||(c?h=[]:f=[]);return{opSpecsA:f,opSpecsB:h}},UpdateParagraphStyle:m},UpdateParagraphStyle:{UpdateParagraphStyle:function(a,b,c){var d,f=[a],h=[b];a.styleName===b.styleName&&(d=c?a:b,a=c?b:a,r(a.setProperties,a.removedProperties,d.setProperties,
d.removedProperties,"style:paragraph-properties"),r(a.setProperties,a.removedProperties,d.setProperties,d.removedProperties,"style:text-properties"),l(a.setProperties||null,a.removedProperties||null,d.setProperties||null,d.removedProperties||null),d.setProperties&&n(d.setProperties)||d.removedProperties&&p(d.removedProperties)||(c?f=[]:h=[]),a.setProperties&&n(a.setProperties)||a.removedProperties&&p(a.removedProperties)||(c?h=[]:f=[]));return{opSpecsA:f,opSpecsB:h}}}};this.passUnchanged=m;this.extendTransformations=
function(a){Object.keys(a).forEach(function(b){var c=a[b],d,f=h.hasOwnProperty(b);runtime.log((f?"Extending":"Adding")+" map for optypeA: "+b);f||(h[b]={});d=h[b];Object.keys(c).forEach(function(a){var f=d.hasOwnProperty(a);runtime.assert(b<=a,"Wrong order:"+b+", "+a);runtime.log("  "+(f?"Overwriting":"Adding")+" entry for optypeB: "+a);d[a]=c[a]})})};this.transformOpspecVsOpspec=function(a,b){var c=a.optype<=b.optype,d;runtime.log("Crosstransforming:");runtime.log(runtime.toJson(a));runtime.log(runtime.toJson(b));
c||(d=a,a=b,b=d);(d=(d=h[a.optype])&&d[b.optype])?(d=d(a,b,!c),c||null===d||(d={opSpecsA:d.opSpecsB,opSpecsB:d.opSpecsA})):d=null;runtime.log("result:");d?(runtime.log(runtime.toJson(d.opSpecsA)),runtime.log(runtime.toJson(d.opSpecsB))):runtime.log("null");return d}};ops.OperationTransformer=function(){function f(b,c){for(var d,l,n=[],p=[];0<b.length&&c;){d=b.shift();d=k.transformOpspecVsOpspec(d,c);if(!d)return null;n=n.concat(d.opSpecsA);if(0===d.opSpecsB.length){n=n.concat(b);c=null;break}for(;1<d.opSpecsB.length;){l=f(b,d.opSpecsB.shift());if(!l)return null;p=p.concat(l.opSpecsB);b=l.opSpecsA}c=d.opSpecsB.pop()}c&&p.push(c);return{opSpecsA:n,opSpecsB:p}}var k=new ops.OperationTransformMatrix;this.getOperationTransformMatrix=function(){return k};this.transform=
function(b,c){for(var d,k=[];0<c.length;){d=f(b,c.shift());if(!d)return null;b=d.opSpecsA;k=k.concat(d.opSpecsB)}return{opSpecsA:b,opSpecsB:k}}};var webodf_css='@namespace draw url(urn:oasis:names:tc:opendocument:xmlns:drawing:1.0);@namespace fo url(urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0);@namespace office url(urn:oasis:names:tc:opendocument:xmlns:office:1.0);@namespace presentation url(urn:oasis:names:tc:opendocument:xmlns:presentation:1.0);@namespace style url(urn:oasis:names:tc:opendocument:xmlns:style:1.0);@namespace svg url(urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0);@namespace table url(urn:oasis:names:tc:opendocument:xmlns:table:1.0);@namespace text url(urn:oasis:names:tc:opendocument:xmlns:text:1.0);@namespace webodfhelper url(urn:webodf:names:helper);@namespace cursor url(urn:webodf:names:cursor);@namespace editinfo url(urn:webodf:names:editinfo);@namespace annotation url(urn:webodf:names:annotation);@namespace dc url(http://purl.org/dc/elements/1.1/);@namespace svgns url(http://www.w3.org/2000/svg);office|document > *, office|document-content > * {display: none;}office|body, office|document {display: inline-block;position: relative;}text|p, text|h {display: block;padding: 0;margin: 0;line-height: normal;position: relative;}text|p::after, text|h::after {content: "\\200B";white-space: pre;}*[webodfhelper|containsparagraphanchor] {position: relative;}text|s {white-space: pre;}text|tab {display: inline;white-space: pre;}text|tracked-changes {display: none;}office|binary-data {display: none;}office|text {display: block;text-align: left;overflow: visible;word-wrap: break-word;}office|text::selection {background: transparent;}.webodf-virtualSelections *::selection {background: transparent;}.webodf-virtualSelections *::-moz-selection {background: transparent;}office|text * draw|text-box {display: block;border: 1px solid #d3d3d3;}office|text draw|frame {z-index: 1;}office|spreadsheet {display: block;border-collapse: collapse;empty-cells: show;font-family: sans-serif;font-size: 10pt;text-align: left;page-break-inside: avoid;overflow: hidden;}office|presentation {display: inline-block;text-align: left;}#shadowContent {display: inline-block;text-align: left;}draw|page {display: block;position: relative;overflow: hidden;}presentation|notes, presentation|footer-decl, presentation|date-time-decl {display: none;}@media print {draw|page {border: 1pt solid black;page-break-inside: avoid;}presentation|notes {}}office|spreadsheet text|p {border: 0px;padding: 1px;margin: 0px;}office|spreadsheet table|table {margin: 3px;}office|spreadsheet table|table:after {}office|spreadsheet table|table-row {counter-increment: row;}office|spreadsheet table|table-row:before {width: 3em;background: #cccccc;border: 1px solid black;text-align: center;content: counter(row);display: table-cell;}office|spreadsheet table|table-cell {border: 1px solid #cccccc;}table|table {display: table;}draw|frame table|table {width: 100%;height: 100%;background: white;}table|table-header-rows {display: table-header-group;}table|table-row {display: table-row;}table|table-column {display: table-column;}table|table-cell {width: 0.889in;display: table-cell;word-break: break-all;}draw|frame {display: block;}draw|image {display: block;width: 100%;height: 100%;top: 0px;left: 0px;background-repeat: no-repeat;background-size: 100% 100%;-moz-background-size: 100% 100%;}draw|frame > draw|image:nth-of-type(n+2) {display: none;}text|list:before {display: none;content:"";}text|list {display: block;}text|list-item {display: block;}text|number {display:none;}text|a {color: blue;text-decoration: underline;cursor: pointer;}.webodf-inactiveLinks text|a {cursor: text;}text|note-citation {vertical-align: super;font-size: smaller;}text|note-body {display: none;}text|note:hover text|note-citation {background: #dddddd;}text|note:hover text|note-body {display: block;left:1em;max-width: 80%;position: absolute;background: #ffffaa;}text|bibliography-source {display: none;}svg|title, svg|desc {display: none;}video {width: 100%;height: 100%}cursor|anchor {display: none;}cursor|cursor {display: none;}.webodf-caretOverlay {position: absolute;top: 5%;height: 1em;z-index: 10;padding-left: 1px;pointer-events: none;}.webodf-caretOverlay .caret {position: absolute;border-left: 2px solid black;top: 0;bottom: 0;right: 0;}.webodf-caretOverlay .handle {position: absolute;margin-top: 5px;padding-top: 3px;margin-left: auto;margin-right: auto;width: 64px;height: 68px;border-radius: 5px;opacity: 0.3;text-align: center;background-color: black;box-shadow: 0px 0px 5px rgb(90, 90, 90);border: 1px solid black;top: -85px;right: -32px;}.webodf-caretOverlay .handle > img {box-shadow: 0px 0px 5px rgb(90, 90, 90) inset;background-color: rgb(200, 200, 200);border-radius: 5px;border: 2px solid;height: 60px;width: 60px;display: block;margin: auto;}.webodf-caretOverlay .handle.active {opacity: 0.8;}.webodf-caretOverlay .handle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 43%;}.webodf-caretSizer {display: inline-block;width: 0;visibility: hidden;}#eventTrap {display: block;position: absolute;bottom: 0;left: 0;outline: none;opacity: 0;color: rgba(255, 255, 255, 0);pointer-events: none;white-space: pre;overflow: hidden;}cursor|cursor > #composer {text-decoration: underline;}cursor|cursor[cursor|caret-sizer-active="true"],cursor|cursor[cursor|composing="true"] {display: inline;}editinfo|editinfo {display: inline-block;}.editInfoMarker {position: absolute;width: 10px;height: 100%;left: -20px;opacity: 0.8;top: 0;border-radius: 5px;background-color: transparent;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);}.editInfoMarker:hover {box-shadow: 0px 0px 8px rgba(0, 0, 0, 1);}.editInfoHandle {position: absolute;background-color: black;padding: 5px;border-radius: 5px;opacity: 0.8;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);bottom: 100%;margin-bottom: 10px;z-index: 3;left: -25px;}.editInfoHandle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 5px;}.editInfo {font-family: sans-serif;font-weight: normal;font-style: normal;text-decoration: none;color: white;width: 100%;height: 12pt;}.editInfoColor {float: left;width: 10pt;height: 10pt;border: 1px solid white;}.editInfoAuthor {float: left;margin-left: 5pt;font-size: 10pt;text-align: left;height: 12pt;line-height: 12pt;}.editInfoTime {float: right;margin-left: 30pt;font-size: 8pt;font-style: italic;color: yellow;height: 12pt;line-height: 12pt;}.annotationWrapper {display: inline;position: relative;}.annotationRemoveButton:before {content: "\u00d7";color: white;padding: 5px;line-height: 1em;}.annotationRemoveButton {width: 20px;height: 20px;border-radius: 10px;background-color: black;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);position: absolute;top: -10px;left: -10px;z-index: 3;text-align: center;font-family: sans-serif;font-style: normal;font-weight: normal;text-decoration: none;font-size: 15px;}.annotationRemoveButton:hover {cursor: pointer;box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);}.annotationNote {width: 4cm;position: absolute;display: inline;z-index: 10;top: 0;}.annotationNote > office|annotation {display: block;text-align: left;}.annotationConnector {position: absolute;display: inline;top: 0;z-index: 2;border-top: 1px dashed brown;}.annotationConnector.angular {-moz-transform-origin: left top;-webkit-transform-origin: left top;-ms-transform-origin: left top;transform-origin: left top;}.annotationConnector.horizontal {left: 0;}.annotationConnector.horizontal:before {content: "";display: inline;position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: brown transparent transparent transparent;top: -1px;left: -5px;}office|annotation {width: 100%;height: 100%;display: none;background: rgb(198, 238, 184);background: -moz-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -webkit-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -o-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -ms-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: linear-gradient(180deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);box-shadow: 0 3px 4px -3px #ccc;}office|annotation > dc|creator {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;color: white;background-color: brown;padding: 4px;}office|annotation > dc|date {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;border: 4px solid transparent;color: black;}office|annotation > text|list {display: block;padding: 5px;}office|annotation text|p {font-size: 10pt;color: black;font-weight: normal;font-style: normal;text-decoration: none;font-family: sans-serif;}#annotationsPane {background-color: #EAEAEA;width: 4cm;height: 100%;display: none;position: absolute;outline: 1px solid #ccc;}.webodf-annotationHighlight {background-color: yellow;position: relative;}.webodf-selectionOverlay {position: absolute;pointer-events: none;top: 0;left: 0;top: 0;left: 0;width: 100%;height: 100%;z-index: 15;}.webodf-selectionOverlay > polygon {fill-opacity: 0.3;stroke-opacity: 0.8;stroke-width: 1;fill-rule: evenodd;}.webodf-selectionOverlay > .webodf-draggable {fill-opacity: 0.8;stroke-opacity: 0;stroke-width: 8;pointer-events: all;display: none;-moz-transform-origin: center center;-webkit-transform-origin: center center;-ms-transform-origin: center center;transform-origin: center center;}#imageSelector {display: none;position: absolute;border-style: solid;border-color: black;}#imageSelector > div {width: 5px;height: 5px;display: block;position: absolute;border: 1px solid black;background-color: #ffffff;}#imageSelector > .topLeft {top: -4px;left: -4px;}#imageSelector > .topRight {top: -4px;right: -4px;}#imageSelector > .bottomRight {right: -4px;bottom: -4px;}#imageSelector > .bottomLeft {bottom: -4px;left: -4px;}#imageSelector > .topMiddle {top: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .rightMiddle {top: 50%;right: -4px;margin-top: -2.5px;}#imageSelector > .bottomMiddle {bottom: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .leftMiddle {top: 50%;left: -4px;margin-top: -2.5px;}div.webodf-customScrollbars::-webkit-scrollbar{width: 8px;height: 8px;background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-track{background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-thumb{background-color: #444;border-radius: 4px;}.webodf-hyperlinkTooltip {display: none;color: white;background-color: black;border-radius: 5px;box-shadow: 2px 2px 5px gray;padding: 3px;position: absolute;max-width: 210px;text-align: left;word-break: break-all;z-index: 16;}.webodf-hyperlinkTooltipText {display: block;font-weight: bold;}';
